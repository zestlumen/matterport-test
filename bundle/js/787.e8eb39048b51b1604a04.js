/*! For license information please see 787.e8eb39048b51b1604a04.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[787],{57975:e=>{function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var n,r="",s=0,o=-1,i=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(o===a-1||1===i);else if(o!==a-1&&2===i){if(r.length<2||2!==s||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var c=r.lastIndexOf("/");if(c!==r.length-1){-1===c?(r="",s=0):s=(r=r.slice(0,c)).length-1-r.lastIndexOf("/"),o=a,i=0;continue}}else if(2===r.length||1===r.length){r="",s=0,o=a,i=0;continue}t&&(r.length>0?r+="/..":r="..",s=2)}else r.length>0?r+="/"+e.slice(o+1,a):r=e.slice(o+1,a),s=a-o-1;o=a,i=0}else 46===n&&-1!==i?++i:i=-1}return r}var r={resolve:function(){for(var e,r="",s=!1,o=arguments.length-1;o>=-1&&!s;o--){var i;o>=0?i=arguments[o]:(void 0===e&&(e=process.cwd()),i=e),t(i),0!==i.length&&(r=i+"/"+r,s=47===i.charCodeAt(0))}return r=n(r,!s),s?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(e){if(t(e),0===e.length)return".";var r=47===e.charCodeAt(0),s=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!r)).length||r||(e="."),e.length>0&&s&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var s=arguments[n];t(s),s.length>0&&(void 0===e?e=s:e+="/"+s)}return void 0===e?".":r.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n)return"";if((e=r.resolve(e))===(n=r.resolve(n)))return"";for(var s=1;s<e.length&&47===e.charCodeAt(s);++s);for(var o=e.length,i=o-s,a=1;a<n.length&&47===n.charCodeAt(a);++a);for(var c=n.length-a,l=i<c?i:c,u=-1,d=0;d<=l;++d){if(d===l){if(c>l){if(47===n.charCodeAt(a+d))return n.slice(a+d+1);if(0===d)return n.slice(a+d)}else i>l&&(47===e.charCodeAt(s+d)?u=d:0===d&&(u=0));break}var h=e.charCodeAt(s+d);if(h!==n.charCodeAt(a+d))break;47===h&&(u=d)}var f="";for(d=s+u+1;d<=o;++d)d!==o&&47!==e.charCodeAt(d)||(0===f.length?f+="..":f+="/..");return f.length>0?f+n.slice(a+u):(a+=u,47===n.charCodeAt(a)&&++a,n.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var n=e.charCodeAt(0),r=47===n,s=-1,o=!0,i=e.length-1;i>=1;--i)if(47===(n=e.charCodeAt(i))){if(!o){s=i;break}}else o=!1;return-1===s?r?"/":".":r&&1===s?"//":e.slice(0,s)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var r,s=0,o=-1,i=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var a=n.length-1,c=-1;for(r=e.length-1;r>=0;--r){var l=e.charCodeAt(r);if(47===l){if(!i){s=r+1;break}}else-1===c&&(i=!1,c=r+1),a>=0&&(l===n.charCodeAt(a)?-1==--a&&(o=r):(a=-1,o=c))}return s===o?o=c:-1===o&&(o=e.length),e.slice(s,o)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!i){s=r+1;break}}else-1===o&&(i=!1,o=r+1);return-1===o?"":e.slice(s,o)},extname:function(e){t(e);for(var n=-1,r=0,s=-1,o=!0,i=0,a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(47!==c)-1===s&&(o=!1,s=a+1),46===c?-1===n?n=a:1!==i&&(i=1):-1!==n&&(i=-1);else if(!o){r=a+1;break}}return-1===n||-1===s||0===i||1===i&&n===s-1&&n===r+1?"":e.slice(n,s)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+r:n+e+r:r}("/",e)},parse:function(e){t(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var r,s=e.charCodeAt(0),o=47===s;o?(n.root="/",r=1):r=0;for(var i=-1,a=0,c=-1,l=!0,u=e.length-1,d=0;u>=r;--u)if(47!==(s=e.charCodeAt(u)))-1===c&&(l=!1,c=u+1),46===s?-1===i?i=u:1!==d&&(d=1):-1!==i&&(d=-1);else if(!l){a=u+1;break}return-1===i||-1===c||0===d||1===d&&i===c-1&&i===a+1?-1!==c&&(n.base=n.name=0===a&&o?e.slice(1,c):e.slice(a,c)):(0===a&&o?(n.name=e.slice(1,i),n.base=e.slice(1,c)):(n.name=e.slice(a,i),n.base=e.slice(a,c)),n.ext=e.slice(i,c)),a>0?n.dir=e.slice(0,a-1):o&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,e.exports=r},94631:(e,t,n)=>{n.d(t,{d:()=>ue});var r=n(57975);function s(e){let t;try{t=new URL(e,"http://fakehost.com/")}catch(e){return null}const n=t.pathname.split("/").pop(),r=n.lastIndexOf(".");if(-1===r||r===n.length-1)return null;return n.substring(r+1)}class o{constructor(){this.maxSize=800,this.minSize=600,this.unloadPercent=.05,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadPriorityCallback=null;const e=this.itemSet;this.defaultPriorityCallback=t=>e.get(t)}isFull(){return this.itemSet.size>=this.maxSize}add(e,t){const n=this.itemSet;if(n.has(e))return!1;if(this.isFull())return!1;const r=this.usedSet,s=this.itemList,o=this.callbacks;return s.push(e),r.add(e),n.set(e,Date.now()),o.set(e,t),!0}remove(e){const t=this.usedSet,n=this.itemSet,r=this.itemList,s=this.callbacks;if(n.has(e)){s.get(e)(e);const o=r.indexOf(e);return r.splice(o,1),t.delete(e),n.delete(e),s.delete(e),!0}return!1}markUsed(e){const t=this.itemSet,n=this.usedSet;t.has(e)&&!n.has(e)&&(t.set(e,Date.now()),n.add(e))}markAllUnused(){this.usedSet.clear()}unloadUnusedContent(){const e=this.unloadPercent,t=this.minSize,n=this.itemList,r=this.itemSet,s=this.usedSet,o=this.callbacks,i=n.length-s.size,a=n.length-t,c=this.unloadPriorityCallback||this.defaultPriorityCallback;if(a>0&&i>0){n.sort(((e,t)=>{const n=s.has(e),r=s.has(t);return n&&r?0:n||r?n?1:-1:c(t)-c(e)}));const l=Math.min(a,i),u=Math.max(t*e,l*e);let d=Math.min(u,i);d=Math.ceil(d);const h=n.splice(0,d);for(let e=0,t=h.length;e<t;e++){const t=h[e];o.get(t)(t),r.delete(t),o.delete(t)}}}scheduleUnload(e=!0){var t;this.scheduled||(this.scheduled=!0,t=()=>{this.scheduled=!1,this.unloadUnusedContent(),e&&this.markAllUnused()},Promise.resolve().then(t))}}var i=n(3812);function a(e){return 3===e||4===e}function c(e,t){return e.__lastFrameVisited===t&&e.__used}function l(e,t){e.__lastFrameVisited!==t&&(e.__lastFrameVisited=t,e.__used=!1,e.__inFrustum=!1,e.__isLeaf=!1,e.__visible=!1,e.__active=!1,e.__error=1/0,e.__distanceFromCamera=1/0,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1)}function u(e,t,n){if(l(e,t),e.__used=!0,n.markUsed(e),e.__contentEmpty){const r=e.children;for(let e=0,s=r.length;e<s;e++)u(r[e],t,n)}}function d(e,t,n){if(e.__contentEmpty&&(!e.__externalTileSet||a(e.__loadingState))){const r=e.children;for(let e=0,s=r.length;e<s;e++){const s=r[e];s.__depthFromRenderedParent=t,d(s,t,n)}}else n.requestTileContents(e)}function h(e,t=null,n=null,r=null,s=0){if(t&&t(e,r,s))return void(n&&n(e,r,s));const o=e.children;for(let r=0,i=o.length;r<i;r++)h(o[r],t,n,e,s+1);n&&n(e,r,s)}function f(e,t){const n=t.stats,r=t.frameCount,s=t.errorTarget,o=t.maxDepth,i=t.loadSiblings,a=t.lruCache,c=t.stopAtEmptyTiles;l(e,r);if(!1===t.tileInView(e))return!1;if(e.__used=!0,a.markUsed(e),e.__inFrustum=!0,n.inFrustum++,(c||!e.__contentEmpty)&&!e.__externalTileSet){t.calculateError(e);if(e.__error<=s)return!0;if(t.maxDepth>0&&e.__depth+1>=o)return!0}let d=!1;const h=e.children;for(let e=0,n=h.length;e<n;e++){const n=f(h[e],t);d=d||n}if(d&&i)for(let e=0,t=h.length;e<t;e++){u(h[e],r,a)}return!0}function p(e,t){const n=t.stats,r=t.frameCount;if(!c(e,r))return;n.used++;const s=e.children;let o=!1;for(let e=0,t=s.length;e<t;e++){const t=s[e];o=o||c(t,r)}if(o){let n=!1,o=!0;for(let e=0,i=s.length;e<i;e++){const i=s[e];if(p(i,t),n=n||i.__wasSetVisible||i.__childrenWereVisible,c(i,r)){const e=i.__allChildrenLoaded||!i.__contentEmpty&&a(i.__loadingState)||i.__externalTileSet&&4===i.__loadingState;o=o&&e}}e.__childrenWereVisible=n,e.__allChildrenLoaded=o}else e.__isLeaf=!0}function g(e,t){const n=t.stats,r=t.frameCount;if(!c(e,r))return;const s=e.parent,o=s?s.__depthFromRenderedParent:-1;e.__depthFromRenderedParent=o;const i=t.lruCache;if(e.__isLeaf)return e.__depthFromRenderedParent++,void(3===e.__loadingState?(e.__inFrustum&&(e.__visible=!0,n.visible++),e.__active=!0,n.active++):i.isFull()||e.__contentEmpty&&!e.__externalTileSet||t.requestTileContents(e));const l=(t.errorTarget+1)*t.errorThreshold,u=e.__error<=l,h=u||"ADD"===e.refine,f=!e.__contentEmpty,p=f||e.__externalTileSet,m=a(e.__loadingState)&&p,y=e.__childrenWereVisible,x=e.children;let w=e.__allChildrenLoaded;if(h&&f&&e.__depthFromRenderedParent++,h&&!m&&!i.isFull()&&p&&t.requestTileContents(e),(u&&!w&&!y&&m||"ADD"===e.refine&&m)&&(e.__inFrustum&&(e.__visible=!0,n.visible++),e.__active=!0,n.active++),"ADD"!==e.refine&&u&&!w&&m)for(let n=0,s=x.length;n<s;n++){const s=x[n];c(s,r)&&!i.isFull()&&(s.__depthFromRenderedParent=e.__depthFromRenderedParent+1,d(s,s.__depthFromRenderedParent,t))}else for(let e=0,n=x.length;e<n;e++){const n=x[e];c(n,r)&&g(n,t)}}function m(e,t){const n=c(e,t.frameCount);if(n||e.__usedLastFrame){let r=!1,s=!1;n&&(r=e.__active,s=t.displayActiveTiles&&e.__active||e.__visible),e.__contentEmpty||3!==e.__loadingState||(e.__wasSetActive!==r&&t.setTileActive(e,r),e.__wasSetVisible!==s&&t.setTileVisible(e,s)),e.__wasSetActive=r,e.__wasSetVisible=s,e.__usedLastFrame=n;const o=e.children;for(let e=0,n=o.length;e<n;e++){m(o[e],t)}}}const y=(e,t)=>e.__depth!==t.__depth?e.__depth>t.__depth?-1:1:e.__inFrustum!==t.__inFrustum?e.__inFrustum?1:-1:e.__used!==t.__used?e.__used?1:-1:e.__error!==t.__error?e.__error>t.__error?1:-1:e.__distanceFromCamera!==t.__distanceFromCamera?e.__distanceFromCamera>t.__distanceFromCamera?-1:1:0,x=e=>1/(e.__depthFromRenderedParent+1);class w{get rootTileSet(){const e=this.tileSets[this.rootURL];return!e||e instanceof Promise?null:e}get root(){const e=this.rootTileSet;return e?e.root:null}constructor(e){this.tileSets={},this.rootURL=e,this.fetchOptions={},this.preprocessURL=null;const t=new o;t.unloadPriorityCallback=x;const n=new i.M;n.maxJobs=4,n.priorityCallback=y;const r=new i.M;r.maxJobs=1,r.priorityCallback=y,this.lruCache=t,this.downloadQueue=n,this.parseQueue=r,this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this.errorTarget=6,this.errorThreshold=1/0,this.loadSiblings=!0,this.displayActiveTiles=!1,this.maxDepth=1/0,this.stopAtEmptyTiles=!0}traverse(e,t){const n=this.tileSets[this.rootURL];n&&n.root&&h(n.root,e,t)}update(){const e=this.stats,t=this.lruCache,n=this.tileSets,r=n[this.rootURL];if(!(this.rootURL in n))return void this.loadRootTileSet(this.rootURL);if(!r||!r.root)return;const s=r.root;e.inFrustum=0,e.used=0,e.active=0,e.visible=0,this.frameCount++,f(s,this),p(s,this),g(s,this),m(s,this),t.scheduleUnload()}parseTile(e,t,n){return null}disposeTile(e){}preprocessNode(e,t,n){e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.uri&&(e.content.uri=function(...e){const t=/^[a-zA-Z]+:\/\//;let n=-1;for(let r=0,s=e.length;r<s;r++)t.test(e[r])&&(n=r);if(-1===n)return r.join(...e).replace(/\\/g,"/");{const s=n<=0?e:e.slice(n),o=s[0].match(t)[0];return s[0]=s[0].substring(o.length),(o+r.join(...s)).replace(/\\/g,"/")}}(n,e.content.uri)),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=t,e.children=e.children||[];if(e.content&&e.content.uri){const t=s(e.content.uri),n=Boolean(t&&"json"===t.toLowerCase());e.__externalTileSet=n,e.__contentEmpty=n}else e.__externalTileSet=!1,e.__contentEmpty=!0;e.__distanceFromCamera=1/0,e.__error=1/0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=0,e.__loadIndex=0,e.__loadAbort=null,e.__depthFromRenderedParent=-1,null===t?(e.__depth=0,e.refine=e.refine||"REPLACE"):(e.__depth=t.__depth+1,e.refine=e.refine||t.refine)}setTileActive(e,t){}setTileVisible(e,t){}calculateError(e){return 0}tileInView(e){return!0}fetchTileSet(e,t,n=null){return fetch(e,t).then((t=>{if(t.ok)return t.json();throw new Error(`TilesRenderer: Failed to load tileset "${e}" with status ${t.status} : ${t.statusText}`)})).then((t=>{const s=t.asset.version;console.assert("1.0"===s||"0.0"===s,'asset.version is expected to be a string of "1.0" or "0.0"');const o=r.dirname(e);return h(t.root,((e,t)=>this.preprocessNode(e,t,o)),null,n,n?n.__depth:0),t}))}loadRootTileSet(e){const t=this.tileSets;if(e in t)return t[e]instanceof Error?Promise.reject(t[e]):Promise.resolve(t[e]);{const n=this.fetchTileSet(this.preprocessURL?this.preprocessURL(e):e,this.fetchOptions).then((n=>{t[e]=n}));return n.catch((n=>{console.error(n),t[e]=n})),t[e]=n,n}}requestTileContents(e){if(0!==e.__loadingState)return;const t=this.stats,n=this.lruCache,r=this.downloadQueue,o=this.parseQueue,i=e.__externalTileSet;n.add(e,(e=>{1===e.__loadingState?(e.__loadAbort.abort(),e.__loadAbort=null):i?e.children.length=0:this.disposeTile(e),1===e.__loadingState?t.downloading--:2===e.__loadingState&&t.parsing--,e.__loadingState=0,e.__loadIndex++,o.remove(e),r.remove(e)})),e.__loadIndex++;const a=e.__loadIndex,c=new AbortController,l=c.signal;t.downloading++,e.__loadAbort=c,e.__loadingState=1;const u=s=>{e.__loadIndex===a&&("AbortError"!==s.name?(o.remove(e),r.remove(e),2===e.__loadingState?t.parsing--:1===e.__loadingState&&t.downloading--,t.failed++,console.error(`TilesRenderer : Failed to load tile at url "${e.content.uri}".`),console.error(s),e.__loadingState=4):n.remove(e))};i?r.add(e,(e=>{if(e.__loadIndex!==a)return Promise.resolve();const t=this.preprocessURL?this.preprocessURL(e.content.uri):e.content.uri;return this.fetchTileSet(t,Object.assign({signal:l},this.fetchOptions),e)})).then((n=>{e.__loadIndex===a&&(t.downloading--,e.__loadAbort=null,e.__loadingState=3,e.children.push(n.root))})).catch(u):r.add(e,(e=>{if(e.__loadIndex!==a)return Promise.resolve();const t=this.preprocessURL?this.preprocessURL(e.content.uri):e.content.uri;return fetch(t,Object.assign({signal:l},this.fetchOptions))})).then((t=>{if(e.__loadIndex===a){if(t.ok)return t.arrayBuffer();throw new Error(`Failed to load model with error code ${t.status}`)}})).then((n=>{if(e.__loadIndex===a)return t.downloading--,t.parsing++,e.__loadAbort=null,e.__loadingState=2,o.add(e,(e=>{if(e.__loadIndex!==a)return Promise.resolve();const t=s(e.content.uri);return this.parseTile(n,e,t)}))})).then((()=>{e.__loadIndex===a&&(t.parsing--,e.__loadingState=3,e.__wasSetVisible&&this.setTileVisible(e,!0),e.__wasSetActive&&this.setTileActive(e,!0))})).catch(u)}dispose(){const e=this.lruCache;this.traverse((t=>{e.remove(t)}))}}function _(e){return(new TextDecoder).decode(e)}class b{constructor(e,t,n,r){this.buffer=e,this.binOffset=t+n,this.binLength=r;let s=null;if(0!==n){const r=new Uint8Array(e,t,n);s=JSON.parse(_(r))}else s={};this.header=s}getKeys(){return Object.keys(this.header)}getData(e,t,n=null,r=null){const s=this.header;if(!(e in s))return null;const o=s[e];if(o instanceof Object){if(Array.isArray(o))return o;{const{buffer:s,binOffset:i,binLength:a}=this,c=o.byteOffset||0,l=o.type||r,u=o.componentType||n;if("type"in o&&r&&o.type!==r)throw new Error("FeatureTable: Specified type does not match expected type.");let d,h;switch(l){case"SCALAR":d=1;break;case"VEC2":d=2;break;case"VEC3":d=3;break;case"VEC4":d=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${e}".`)}const f=i+c,p=t*d;switch(u){case"BYTE":h=new Int8Array(s,f,p);break;case"UNSIGNED_BYTE":h=new Uint8Array(s,f,p);break;case"SHORT":h=new Int16Array(s,f,p);break;case"UNSIGNED_SHORT":h=new Uint16Array(s,f,p);break;case"INT":h=new Int32Array(s,f,p);break;case"UNSIGNED_INT":h=new Uint32Array(s,f,p);break;case"FLOAT":h=new Float32Array(s,f,p);break;case"DOUBLE":h=new Float64Array(s,f,p);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${e}".`)}if(f+p*h.BYTES_PER_ELEMENT>i+a)throw new Error("FeatureTable: Feature data read outside binary body length.");return h}}return o}}class T extends b{constructor(e,t,n,r,s){super(e,n,r,s),this.batchSize=t}getData(e,t=null,n=null){return super.getData(e,this.batchSize,t,n)}}class S{constructor(){this.fetchOptions={},this.workingPath=""}load(e){return fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((t=>(""===this.workingPath&&(this.workingPath=this.workingPathForURL(e)),this.parse(t))))}resolveExternalURL(e){return/^[^\\/]/.test(e)?this.workingPath+"/"+e:e}workingPathForURL(e){const t=e.split(/[\\/]/g);t.pop();return t.join("/")+"/"}parse(e){throw new Error("LoaderBase: Parse not implemented.")}}class v extends S{parse(e){const t=new DataView(e),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3));console.assert("b3dm"===n);const r=t.getUint32(4,!0);console.assert(1===r);const s=t.getUint32(8,!0);console.assert(s===e.byteLength);const o=t.getUint32(12,!0),i=t.getUint32(16,!0),a=t.getUint32(20,!0),c=t.getUint32(24,!0),l=e.slice(28,28+o+i),u=new b(l,0,o,i),d=28+o+i,h=e.slice(d,d+a+c),f=new T(h,u.getData("BATCH_LENGTH"),0,a,c),p=d+a+c;return{version:r,featureTable:u,batchTable:f,glbBytes:new Uint8Array(e,p,s-p)}}}var A=n(68909),C=n(17888);class P extends v{constructor(e=A.DefaultLoadingManager){super(),this.manager=e}parse(e){const t=super.parse(e),n=t.glbBytes.slice().buffer;return new Promise(((e,r)=>{const s=this.manager,o=this.fetchOptions,i=s.getHandler("path.gltf")||new C.GLTFLoader(s);"include"===o.credentials&&"cors"===o.mode&&i.setCrossOrigin("use-credentials"),"credentials"in o&&i.setWithCredentials("include"===o.credentials),o.headers&&i.setRequestHeader(o.headers);let a=this.workingPath;!/[\\/]$/.test(a)&&a.length&&(a+="/"),i.parse(n,a,(n=>{const{batchTable:r,featureTable:s}=t,{scene:o}=n,i=s.getData("RTC_CENTER");i&&(o.position.x+=i[0],o.position.y+=i[1],o.position.z+=i[2]),n.batchTable=r,n.featureTable=s,o.batchTable=r,o.featureTable=s,e(n)}),r)}))}}class B extends S{parse(e){const t=new DataView(e),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3));console.assert("pnts"===n);const r=t.getUint32(4,!0);console.assert(1===r);const s=t.getUint32(8,!0);console.assert(s===e.byteLength);const o=t.getUint32(12,!0),i=t.getUint32(16,!0),a=t.getUint32(20,!0),c=t.getUint32(24,!0),l=e.slice(28,28+o+i),u=new b(l,0,o,i),d=28+o+i,h=e.slice(d,d+a+c),f=new T(h,u.getData("BATCH_LENGTH")||u.getData("POINTS_LENGTH"),0,a,c);return Promise.resolve({version:r,featureTable:u,batchTable:f})}}class M extends B{constructor(e=A.DefaultLoadingManager){super(),this.manager=e}parse(e){return super.parse(e).then((e=>{const{featureTable:t}=e,n=t.getData("POINTS_LENGTH"),r=t.getData("POSITION",n,"FLOAT","VEC3"),s=t.getData("RGB",n,"UNSIGNED_BYTE","VEC3");["RTC_CENTER","QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","CONSTANT_RGBA","BATCH_LENGTH","POSITION_QUANTIZED","RGBA","RGB565","NORMAL","NORMAL_OCT16P"].forEach((e=>{e in t.header&&console.warn(`PNTSLoader: Unsupported FeatureTable feature "${e}" detected.`)}));const o=new A.BufferGeometry;o.setAttribute("position",new A.BufferAttribute(r,3,!1));const i=new A.PointsMaterial;i.size=2,i.sizeAttenuation=!1,null!==s&&(o.setAttribute("color",new A.BufferAttribute(s,3,!0)),i.vertexColors=!0);const a=new A.Points(o,i);e.scene=a,e.scene.featureTable=t;const c=t.getData("RTC_CENTER");return c&&(e.scene.position.x+=c[0],e.scene.position.y+=c[1],e.scene.position.z+=c[2]),e}))}}class U extends S{parse(e){const t=new DataView(e),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3));console.assert("i3dm"===n);const r=t.getUint32(4,!0);console.assert(1===r);const s=t.getUint32(8,!0);console.assert(s===e.byteLength);const o=t.getUint32(12,!0),i=t.getUint32(16,!0),a=t.getUint32(20,!0),c=t.getUint32(24,!0),l=t.getUint32(28,!0),u=e.slice(32,32+o+i),d=new b(u,0,o,i),h=32+o+i,f=e.slice(h,h+a+c),p=new T(f,d.getData("INSTANCES_LENGTH"),0,a,c),g=h+a+c,m=new Uint8Array(e,g,s-g);let y=null,x=null;if(l)y=m,x=Promise.resolve();else{const e=this.resolveExternalURL(_(m));x=fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`I3DMLoaderBase : Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((e=>{y=new Uint8Array(e)}))}return x.then((()=>({version:r,featureTable:d,batchTable:p,glbBytes:y})))}}const V=new A.Vector3,F=new A.Vector3,L=new A.Vector3,R=new A.Vector3,E=new A.Quaternion,k=new A.Vector3,O=new A.Matrix4;class I extends U{constructor(e=A.DefaultLoadingManager){super(),this.manager=e}resolveExternalURL(e){return this.manager.resolveURL(super.resolveExternalURL(e))}parse(e){return super.parse(e).then((e=>{const{featureTable:t,batchTable:n}=e,r=e.glbBytes.slice().buffer;return new Promise(((e,s)=>{const o=this.fetchOptions,i=this.manager,a=i.getHandler("path.gltf")||new C.GLTFLoader(i);"include"===o.credentials&&"cors"===o.mode&&a.setCrossOrigin("use-credentials"),"credentials"in o&&a.setWithCredentials("include"===o.credentials),o.headers&&a.setRequestHeader(o.headers);let c=this.workingPath;/[\\/]$/.test(c)||(c+="/"),a.parse(r,c,(r=>{const s=t.getData("INSTANCES_LENGTH"),o=t.getData("POSITION",s,"FLOAT","VEC3"),i=t.getData("NORMAL_UP",s,"FLOAT","VEC3"),a=t.getData("NORMAL_RIGHT",s,"FLOAT","VEC3"),c=t.getData("SCALE_NON_UNIFORM",s,"FLOAT","VEC3"),l=t.getData("SCALE",s,"FLOAT","SCALAR");["RTC_CENTER","QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","EAST_NORTH_UP","POSITION_QUANTIZED","NORMAL_UP_OCT32P","NORMAL_RIGHT_OCT32P"].forEach((e=>{e in t.header&&console.warn(`I3DMLoader: Unsupported FeatureTable feature "${e}" detected.`)}));const u=new Map,d=[];r.scene.traverse((e=>{if(e.isMesh){const{geometry:t,material:n}=e,r=new A.InstancedMesh(t,n,s);r.position.copy(e.position),r.rotation.copy(e.rotation),r.scale.copy(e.scale),d.push(r),u.set(e,r)}}));const h=new A.Vector3;for(let e=0;e<s;e++)h.x+=o[3*e+0]/s,h.y+=o[3*e+1]/s,h.z+=o[3*e+2]/s;u.forEach(((e,t)=>{const n=t.parent;n&&(n.remove(t),n.add(e),e.updateMatrixWorld(),e.position.copy(h).applyMatrix4(e.matrixWorld))}));for(let e=0;e<s;e++){R.set(o[3*e+0]-h.x,o[3*e+1]-h.y,o[3*e+2]-h.z),i?(F.set(i[3*e+0],i[3*e+1],i[3*e+2]),L.set(a[3*e+0],a[3*e+1],a[3*e+2]),V.crossVectors(L,F).normalize(),O.makeBasis(L,F,V),E.setFromRotationMatrix(O)):E.set(0,0,0,1),l?k.setScalar(l[e]):c?k.set(c[3*e+0],c[3*e+1],c[3*e+2]):k.set(1,1,1),O.compose(R,E,k);for(let t=0,n=d.length;t<n;t++){d[t].setMatrixAt(e,O)}}r.batchTable=n,r.featureTable=t,r.scene.batchTable=n,r.scene.featureTable=t,e(r)}),s)}))}))}}class D extends S{parse(e){const t=new DataView(e),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3));console.assert("cmpt"===n,'CMPTLoader: The magic bytes equal "cmpt".');const r=t.getUint32(4,!0);console.assert(1===r,'CMPTLoader: The version listed in the header is "1".');const s=t.getUint32(8,!0);console.assert(s===e.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");const o=t.getUint32(12,!0),i=[];let a=16;for(let t=0;t<o;t++){const t=new DataView(e,a,12),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3)),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=new Uint8Array(e,a,s);i.push({type:n,buffer:o,version:r}),a+=s}return{version:r,tiles:i}}}class N extends D{constructor(e=A.DefaultLoadingManager){super(),this.manager=e}parse(e){const t=super.parse(e),n=this.manager,r=[];for(const e in t.tiles){const{type:s,buffer:o}=t.tiles[e];switch(s){case"b3dm":{const e=o.slice(),t=new P(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions;const s=t.parse(e.buffer);r.push(s);break}case"pnts":{const e=o.slice(),t=new M(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions;const s=t.parse(e.buffer);r.push(s);break}case"i3dm":{const e=o.slice(),t=new I(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions;const s=t.parse(e.buffer);r.push(s);break}}}return Promise.all(r).then((e=>{const t=new A.Group;return e.forEach((e=>{t.add(e.scene)})),{tiles:e,scene:t}}))}}class z extends S{constructor(e=A.DefaultLoadingManager){super(),this.manager=e}parse(e){return new Promise(((t,n)=>{const r=this.manager,s=this.fetchOptions;let o=r.getHandler("path.gltf")||r.getHandler("path.glb");o||(o=new C.GLTFLoader(r),"include"===s.credentials&&"cors"===s.mode&&o.setCrossOrigin("use-credentials"),"credentials"in s&&o.setWithCredentials("include"===s.credentials),s.headers&&o.setRequestHeader(s.headers));let i=o.resourcePath||o.path||this.workingPath;!/[\\/]$/.test(i)&&i.length&&(i+="/"),o.parse(e,i,(e=>{t(e)}),n)}))}}const H=new A.Matrix4;class G extends A.Group{constructor(e){super(),this.name="TilesRenderer.TilesGroup",this.tilesRenderer=e}raycast(e,t){this.tilesRenderer.optimizeRaycast&&this.tilesRenderer.raycast(e,t)}updateMatrixWorld(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){null===this.parent?H.copy(this.matrix):H.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;const e=H.elements,t=this.matrixWorld.elements;let n=!1;for(let r=0;r<16;r++){const s=e[r],o=t[r];if(Math.abs(s-o)>Number.EPSILON){n=!0;break}}if(n){this.matrixWorld.copy(H);const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateMatrixWorld()}}}}const q=new A.Sphere,j=new A.Matrix4,W=new A.Vector3,$=new A.Vector3,J=new A.Ray,Q=[];function X(e,t){return e.distance-t.distance}function Z(e,t,n){e.traverse((e=>{Object.getPrototypeOf(e).raycast.call(e,t,n)}))}function Y(e,t,n,r){if(n.has(e)){if(Z(e.cached.scene,r,Q),Q.length>0){Q.length>1&&Q.sort(X);const e=Q[0];return Q.length=0,e}return null}const s=[],o=e.children;for(let e=0,n=o.length;e<n;e++){const n=o[e],i=n.cached,a=t.matrixWorld;j.copy(a);const c=i.sphere;if(c&&(q.copy(c),q.applyMatrix4(j),!r.ray.intersectsSphere(q)))continue;const l=i.box,u=i.boxTransform;if(l){if(j.multiply(u).invert(),J.copy(r.ray),J.applyMatrix4(j),!J.intersectBox(l,W))continue;{let e;$.setFromMatrixScale(j),e=$.x,Math.abs(Math.max($.x-$.y,$.x-$.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when raycasting.");let t={distance:1/0,tile:null};s.push(t),t.distance=W.distanceToSquared(J.origin)*e*e,t.tile=n}}}s.sort(X);let i=1/0,a=null;for(let e=0,o=s.length;e<o;e++){const o=s[e];if(o.distance>i)break;{const e=o.tile,s=e.cached.scene;let c=null;if(n.has(e)?(Z(s,r,Q),Q.length>0&&(Q.length>1&&Q.sort(X),c=Q[0])):c=Y(e,t,n,r),c){const e=c.distance*c.distance;e<i&&(i=e,a=c),Q.length=0}}}return a}function K(e,t,n,r,s){const o=e.cached,i=t.matrixWorld;j.copy(i);const a=o.sphere;if(a&&(q.copy(a),q.applyMatrix4(j),!r.ray.intersectsSphere(q)))return;const c=o.box,l=o.boxTransform;if(c&&(j.multiply(l).invert(),J.copy(r.ray).applyMatrix4(j),!J.intersectsBox(c)))return;const u=o.scene;if(n.has(e))return void Z(u,r,s);const d=e.children;for(let e=0,o=d.length;e<o;e++)K(d[e],t,n,r,s)}const ee=Symbol("INITIAL_FRUSTUM_CULLED"),te=new A.Matrix4,ne=new A.Matrix4,re=new A.Vector3,se=new A.Vector3,oe=new A.Vector3,ie=new A.Vector3,ae=new A.Vector3(1,0,0),ce=new A.Vector3(0,1,0);function le(e,t){e.traverse((e=>{e.frustumCulled=e[ee]&&t}))}class ue extends w{get autoDisableRendererCulling(){return this._autoDisableRendererCulling}set autoDisableRendererCulling(e){this._autoDisableRendererCulling!==e&&(super._autoDisableRendererCulling=e,this.forEachLoadedModel((t=>{le(t,!e)})))}constructor(...e){super(...e),this.group=new G(this),this.cameras=[],this.cameraMap=new Map,this.cameraInfo=[],this.activeTiles=new Set,this.visibleTiles=new Set,this._autoDisableRendererCulling=!0,this.optimizeRaycast=!0,this.onLoadTileSet=null,this.onLoadModel=null,this.onDisposeModel=null,this.onTileVisibilityChange=null;const t=new A.LoadingManager;t.setURLModifier((e=>this.preprocessURL?this.preprocessURL(e):e)),this.manager=t;const n=this;this._overridenRaycast=function(e,t){n.optimizeRaycast||Object.getPrototypeOf(this).raycast.call(this,e,t)}}getBounds(e){if(!this.root)return!1;const t=this.root.cached,n=t.box,r=t.boxTransform;return!!n&&(e.copy(n),e.applyMatrix4(r),!0)}getOrientedBounds(e,t){if(!this.root)return!1;const n=this.root.cached,r=n.box,s=n.boxTransform;return!!r&&(e.copy(r),t.copy(s),!0)}getBoundingSphere(e){if(!this.root)return!1;const t=this.root.cached.sphere;return!!t&&(e.copy(t),!0)}forEachLoadedModel(e){this.traverse((t=>{const n=t.cached.scene;n&&e(n,t)}))}raycast(e,t){if(this.root)if(e.firstHitOnly){const n=Y(this.root,this.group,this.activeTiles,e);n&&t.push(n)}else K(this.root,this.group,this.activeTiles,e,t)}hasCamera(e){return this.cameraMap.has(e)}setCamera(e){const t=this.cameras,n=this.cameraMap;return!n.has(e)&&(n.set(e,new A.Vector2),t.push(e),!0)}setResolution(e,t,n){const r=this.cameraMap;return!!r.has(e)&&(t instanceof A.Vector2?r.get(e).copy(t):r.get(e).set(t,n),!0)}setResolutionFromRenderer(e,t){const n=this.cameraMap;if(!n.has(e))return!1;const r=n.get(e);return t.getSize(r),r.multiplyScalar(t.getPixelRatio()),!0}deleteCamera(e){const t=this.cameras,n=this.cameraMap;if(n.has(e)){const r=t.indexOf(e);return t.splice(r,1),n.delete(e),!0}return!1}fetchTileSet(e,...t){const n=super.fetchTileSet(e,...t);return n.then((t=>{this.onLoadTileSet&&Promise.resolve().then((()=>{this.onLoadTileSet(t,e)}))})),n}update(){const e=this.group,t=this.cameras,n=this.cameraMap,r=this.cameraInfo;if(0===t.length)return void console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.");for(;r.length>t.length;)r.pop();for(;r.length<t.length;)r.push({frustum:new A.Frustum,isOrthographic:!1,sseDenominator:-1,position:new A.Vector3,invScale:-1,pixelSize:0});let s;ne.copy(e.matrixWorld).invert(),re.setFromMatrixScale(ne),s=re.x,Math.abs(Math.max(re.x-re.y,re.x-re.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(let o=0,i=r.length;o<i;o++){const i=t[o],a=r[o],c=a.frustum,l=a.position,u=n.get(i);0!==u.width&&0!==u.height||console.warn("TilesRenderer: resolution for camera error calculation is not set.");const d=i.projectionMatrix.elements;if(a.isOrthographic=1===d[15],a.isOrthographic){const e=2/d[0],t=2/d[5];a.pixelSize=Math.max(t/u.height,e/u.width)}else a.sseDenominator=2/d[5]/u.height;a.invScale=s,te.copy(e.matrixWorld),te.premultiply(i.matrixWorldInverse),te.premultiply(i.projectionMatrix),c.setFromProjectionMatrix(te),l.set(0,0,0),l.applyMatrix4(i.matrixWorld),l.applyMatrix4(ne)}super.update()}preprocessNode(e,t,n){super.preprocessNode(e,t,n);const r=new A.Matrix4;if(e.transform){const t=e.transform;for(let e=0;e<16;e++)r.elements[e]=t[e]}else r.identity();t&&r.premultiply(t.cached.transform);const s=(new A.Matrix4).copy(r).invert();let o=null,i=null,a=null;if("box"in e.boundingVolume){const t=e.boundingVolume.box;o=new A.Box3,i=new A.Matrix4,a=new A.Matrix4,se.set(t[3],t[4],t[5]),oe.set(t[6],t[7],t[8]),ie.set(t[9],t[10],t[11]);const n=se.length(),s=oe.length(),c=ie.length();se.normalize(),oe.normalize(),ie.normalize(),0===n&&se.crossVectors(oe,ie),0===s&&oe.crossVectors(se,ie),0===c&&ie.crossVectors(se,oe),i.set(se.x,oe.x,ie.x,t[0],se.y,oe.y,ie.y,t[1],se.z,oe.z,ie.z,t[2],0,0,0,1),i.premultiply(r),a.copy(i).invert(),o.min.set(-n,-s,-c),o.max.set(n,s,c)}let c=null;if("sphere"in e.boundingVolume){const t=e.boundingVolume.sphere;c=new A.Sphere,c.center.set(t[0],t[1],t[2]),c.radius=t[3],c.applyMatrix4(r)}else if("box"in e.boundingVolume){const t=e.boundingVolume.box;c=new A.Sphere,o.getBoundingSphere(c),c.center.set(t[0],t[1],t[2]),c.applyMatrix4(r)}"region"in e.boundingVolume&&console.warn("ThreeTilesRenderer: region bounding volume not supported."),e.cached={loadIndex:0,transform:r,transformInverse:s,active:!1,inFrustum:[],box:o,boxTransform:i,boxTransformInverse:a,sphere:c,region:null,scene:null,geometry:null,material:null}}parseTile(e,t,n){t._loadIndex=t._loadIndex||0,t._loadIndex++;const r=t.content.uri.split(/[\\\/]/g);r.pop();const s=r.join("/"),o=this.fetchOptions,i=this.manager,a=t._loadIndex;let c=null;switch(n){case"b3dm":{const t=new P(i);t.workingPath=s,t.fetchOptions=o,c=t.parse(e).then((e=>e.scene));break}case"pnts":{const t=new M(i);t.workingPath=s,t.fetchOptions=o,c=t.parse(e).then((e=>e.scene));break}case"i3dm":{const t=new I(i);t.workingPath=s,t.fetchOptions=o,c=t.parse(e).then((e=>e.scene));break}case"cmpt":{const t=new N(i);t.workingPath=s,t.fetchOptions=o,c=t.parse(e).then((e=>e.scene));break}case"gltf":case"glb":const t=new z(i);t.workingPath=s,t.fetchOptions=o,c=t.parse(e).then((e=>e.scene));break;default:console.warn(`TilesRenderer: Content type "${n}" not supported.`),c=Promise.resolve(null)}return c.then((e=>{if(t._loadIndex!==a)return;const r=this.rootTileSet.asset&&this.rootTileSet.asset.gltfUpAxis||"y",s=t.cached,o=s.transform;switch(r.toLowerCase()){case"x":te.makeRotationAxis(ce,-Math.PI/2);break;case"y":te.makeRotationAxis(ae,Math.PI/2);break;case"z":te.identity()}e.updateMatrix(),"pnts"!==n&&e.matrix.multiply(te),e.matrix.premultiply(o),e.matrix.decompose(e.position,e.quaternion,e.scale),e.traverse((e=>{e[ee]=e.frustumCulled})),le(e,!this.autoDisableRendererCulling),s.scene=e,e.traverse((e=>{e.raycast=this._overridenRaycast}));const i=[],c=[],l=[];e.traverse((e=>{if(e.geometry&&c.push(e.geometry),e.material){const t=e.material;i.push(e.material);for(const e in t){const n=t[e];n&&n.isTexture&&l.push(n)}}})),s.materials=i,s.geometry=c,s.textures=l,this.onLoadModel&&this.onLoadModel(e,t)}))}disposeTile(e){const t=e.cached;if(t.scene){const n=t.materials,r=t.geometry,s=t.textures;for(let e=0,t=r.length;e<t;e++)r[e].dispose();for(let e=0,t=n.length;e<t;e++)n[e].dispose();for(let e=0,t=s.length;e<t;e++){s[e].dispose()}this.onDisposeModel&&this.onDisposeModel(t.scene,e),t.scene=null,t.materials=null,t.textures=null,t.geometry=null}e._loadIndex++}setTileVisible(e,t){const n=e.cached.scene,r=this.visibleTiles,s=this.group;t?(s.add(n),r.add(e),n.updateMatrixWorld(!0)):(s.remove(n),r.delete(e)),this.onTileVisibilityChange&&this.onTileVisibilityChange(n,e,t)}setTileActive(e,t){const n=this.activeTiles;t?n.add(e):n.delete(e)}calculateError(e){const t=e.cached,n=t.inFrustum,r=this.cameras,s=this.cameraInfo,o=e.boundingVolume;if("box"in o||"sphere"in o){const o=t.sphere,i=t.box,a=t.boxTransformInverse,c=t.transformInverse,l=i&&a;let u=-1/0,d=1/0;for(let t=0,h=r.length;t<h;t++){if(!n[t])continue;const r=s[t],h=r.invScale;let f;if(r.isOrthographic){const t=r.pixelSize;f=e.geometricError/(t*h)}else{let t;re.copy(r.position),l?(re.applyMatrix4(a),t=i.distanceToPoint(re)):(re.applyMatrix4(c),t=Math.max(o.distanceToPoint(re),0));const n=t*h,s=r.sseDenominator;f=e.geometricError/(n*s),d=Math.min(d,n)}u=Math.max(u,f)}e.__distanceFromCamera=d,e.__error=u}else"region"in o&&console.warn("ThreeTilesRenderer : Region bounds not supported.")}tileInView(e){const t=e.cached,n=t.sphere,r=t.inFrustum;if(n){const e=this.cameraInfo;let t=!1;for(let s=0,o=e.length;s<o;s++){e[s].frustum.intersectsSphere(n)?(t=!0,r[s]=!0):r[s]=!1}return t}return!0}}},3812:(e,t,n)=>{n.d(t,{M:()=>r});class r{constructor(){this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=()=>{throw new Error("PriorityQueue: PriorityCallback function not defined.")},this.schedulingCallback=e=>{requestAnimationFrame(e)},this._runjobs=()=>{this.tryRunJobs(),this.scheduled=!1}}sort(){const e=this.priorityCallback;this.items.sort(e)}add(e,t){return new Promise(((n,r)=>{const s=this.items,o=this.callbacks;s.push(e),o.set(e,((...e)=>t(...e).then(n).catch(r))),this.autoUpdate&&this.scheduleJobRun()}))}remove(e){const t=this.items,n=this.callbacks,r=t.indexOf(e);-1!==r&&(t.splice(r,1),n.delete(e))}tryRunJobs(){this.sort();const e=this.items,t=this.callbacks,n=this.maxJobs;let r=this.currJobs;for(;n>r&&e.length>0;){r++;const n=e.pop(),s=t.get(n);t.delete(n),s(n).then((()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()})).catch((()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()}))}this.currJobs=r}scheduleJobRun(){this.scheduled||(this.schedulingCallback(this._runjobs),this.scheduled=!0)}}},74025:(e,t,n)=>{n.d(t,{$J:()=>l,BE:()=>h,Bw:()=>i,Gm:()=>s,Ne:()=>d,Q7:()=>r,Xe:()=>o,b_:()=>a,bf:()=>f,nw:()=>u,yj:()=>c});const r=0,s=1,o=2,i=0,a=1,c=2,l=1.25,u=1,d=32,h=65535,f=Math.pow(2,-24)},79545:(e,t,n)=>{n.d(t,{G:()=>ce});var r=n(68909),s=n(74025);class o{constructor(){}}function i(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function a(e){let t=-1,n=-1/0;for(let r=0;r<3;r++){const s=e[r+3]-e[r];s>n&&(n=s,t=r)}return t}function c(e,t){t.set(e)}function l(e,t,n){let r,s;for(let o=0;o<3;o++){const i=o+3;r=e[o],s=t[o],n[o]=r<s?r:s,r=e[i],s=t[i],n[i]=r>s?r:s}}function u(e,t,n){for(let r=0;r<3;r++){const s=t[e+2*r],o=t[e+2*r+1],i=s-o,a=s+o;i<n[r]&&(n[r]=i),a>n[r+3]&&(n[r+3]=a)}}function d(e){const t=e[3]-e[0],n=e[4]-e[1],r=e[5]-e[2];return 2*(t*n+n*r+r*t)}function h(e,t,n,r,s=null){let o=1/0,i=1/0,a=1/0,c=-1/0,l=-1/0,u=-1/0,d=1/0,h=1/0,f=1/0,p=-1/0,g=-1/0,m=-1/0;const y=null!==s;for(let r=6*t,s=6*(t+n);r<s;r+=6){const t=e[r+0],n=e[r+1],s=t-n,x=t+n;s<o&&(o=s),x>c&&(c=x),y&&t<d&&(d=t),y&&t>p&&(p=t);const w=e[r+2],_=e[r+3],b=w-_,T=w+_;b<i&&(i=b),T>l&&(l=T),y&&w<h&&(h=w),y&&w>g&&(g=w);const S=e[r+4],v=e[r+5],A=S-v,C=S+v;A<a&&(a=A),C>u&&(u=C),y&&S<f&&(f=S),y&&S>m&&(m=S)}r[0]=o,r[1]=i,r[2]=a,r[3]=c,r[4]=l,r[5]=u,y&&(s[0]=d,s[1]=h,s[2]=f,s[3]=p,s[4]=g,s[5]=m)}const f=32,p=(e,t)=>e.candidate-t.candidate,g=new Array(f).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),m=new Float32Array(6);function y(e,t){function n(e){A&&A(e/C)}function i(t,r,y,A=null,C=0){if(!P&&C>=b&&(P=!0,T&&(console.warn(`MeshBVH: Max depth of ${b} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),y<=S||C>=b)return n(r+y),t.offset=r,t.count=y,t;const B=function(e,t,n,r,o,i){let h=-1,y=0;if(i===s.Q7)h=a(t),-1!==h&&(y=(t[h]+t[h+3])/2);else if(i===s.Gm)h=a(e),-1!==h&&(y=function(e,t,n,r){let s=0;for(let o=t,i=t+n;o<i;o++)s+=e[6*o+2*r];return s/n}(n,r,o,h));else if(i===s.Xe){const i=d(e);let a=s.$J*o;const x=6*r,w=6*(r+o);for(let e=0;e<3;e++){const r=t[e],_=(t[e+3]-r)/f;if(o<8){const t=[...g];t.length=o;let r=0;for(let s=x;s<w;s+=6,r++){const o=t[r];o.candidate=n[s+2*e],o.count=0;const{bounds:i,leftCacheBounds:a,rightCacheBounds:c}=o;for(let e=0;e<3;e++)c[e]=1/0,c[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0,i[e]=1/0,i[e+3]=-1/0;u(s,n,i)}t.sort(p);let c=o;for(let e=0;e<c;e++){const n=t[e];for(;e+1<c&&t[e+1].candidate===n.candidate;)t.splice(e+1,1),c--}for(let r=x;r<w;r+=6){const s=n[r+2*e];for(let e=0;e<c;e++){const o=t[e];s>=o.candidate?u(r,n,o.rightCacheBounds):(u(r,n,o.leftCacheBounds),o.count++)}}for(let n=0;n<c;n++){const r=t[n],c=r.count,l=o-r.count,u=r.leftCacheBounds,f=r.rightCacheBounds;let p=0;0!==c&&(p=d(u)/i);let g=0;0!==l&&(g=d(f)/i);const m=s.nw+s.$J*(p*c+g*l);m<a&&(h=e,a=m,y=r.candidate)}}else{for(let e=0;e<f;e++){const t=g[e];t.count=0,t.candidate=r+_+e*_;const n=t.bounds;for(let e=0;e<3;e++)n[e]=1/0,n[e+3]=-1/0}for(let t=x;t<w;t+=6){let s=~~((n[t+2*e]-r)/_);s>=f&&(s=31);const o=g[s];o.count++,u(t,n,o.bounds)}const t=g[31];c(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=g[e],n=g[e+1];l(t.bounds,n.rightCacheBounds,t.rightCacheBounds)}let p=0;for(let t=0;t<31;t++){const n=g[t],r=n.count,u=n.bounds,f=g[t+1].rightCacheBounds;0!==r&&(0===p?c(u,m):l(u,m,m)),p+=r;let x=0,w=0;0!==p&&(x=d(m)/i);const _=o-p;0!==_&&(w=d(f)/i);const b=s.nw+s.$J*(x*p+w*_);b<a&&(h=e,a=b,y=n.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${i} used.`);return{axis:h,pos:y}}(t.boundingData,A,w,r,y,v);if(-1===B.axis)return n(r+y),t.offset=r,t.count=y,t;const M=function(e,t,n,r,s){let o=n,i=n+r-1;const a=s.pos,c=2*s.axis;for(;;){for(;o<=i&&t[6*o+c]<a;)o++;for(;o<=i&&t[6*i+c]>=a;)i--;if(!(o<i))return o;for(let n=0;n<3;n++){let r=e[3*o+n];e[3*o+n]=e[3*i+n],e[3*i+n]=r;let s=t[6*o+2*n+0];t[6*o+2*n+0]=t[6*i+2*n+0],t[6*i+2*n+0]=s;let a=t[6*o+2*n+1];t[6*o+2*n+1]=t[6*i+2*n+1],t[6*i+2*n+1]=a}o++,i--}}(_,w,r,y,B);if(M===r||M===r+y)n(r+y),t.offset=r,t.count=y;else{t.splitAxis=B.axis;const e=new o,n=r,s=M-r;t.left=e,e.boundingData=new Float32Array(6),h(w,n,s,e.boundingData,x),i(e,n,s,x,C+1);const a=new o,c=M,l=y-s;t.right=a,a.boundingData=new Float32Array(6),h(w,c,l,a.boundingData,x),i(a,c,l,x,C+1)}return t}!function(e,t){if(!e.index){const n=e.attributes.position.count,s=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let o;o=n>65535?new Uint32Array(new s(4*n)):new Uint16Array(new s(2*n)),e.setIndex(new r.BufferAttribute(o,1));for(let e=0;e<n;e++)o[e]=e}}(e,t);const y=new Float32Array(6),x=new Float32Array(6),w=function(e,t){const n=e.attributes.position,r=e.index.array,o=r.length/3,i=new Float32Array(6*o),a=n.normalized,c=n.array,l=n.offset||0;let u=3;n.isInterleavedBufferAttribute&&(u=n.data.stride);const d=["getX","getY","getZ"];for(let e=0;e<o;e++){const o=3*e,h=6*e;let f,p,g;a?(f=r[o+0],p=r[o+1],g=r[o+2]):(f=r[o+0]*u+l,p=r[o+1]*u+l,g=r[o+2]*u+l);for(let e=0;e<3;e++){let r,o,l;a?(r=n[d[e]](f),o=n[d[e]](p),l=n[d[e]](g)):(r=c[f+e],o=c[p+e],l=c[g+e]);let u=r;o<u&&(u=o),l<u&&(u=l);let m=r;o>m&&(m=o),l>m&&(m=l);const y=(m-u)/2,x=2*e;i[h+x+0]=u+y,i[h+x+1]=y+(Math.abs(u)+y)*s.bf,u<t[e]&&(t[e]=u),m>t[e+3]&&(t[e+3]=m)}}return i}(e,y),_=e.index.array,b=t.maxDepth,T=t.verbose,S=t.maxLeafTris,v=t.strategy,A=t.onProgress,C=e.index.count/3;let P=!1;const B=[],M=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];const t=[],n=new Set;for(const t of e.groups)n.add(t.start),n.add(t.start+t.count);const r=Array.from(n.values()).sort(((e,t)=>e-t));for(let e=0;e<r.length-1;e++){const n=r[e],s=r[e+1];t.push({offset:n/3,count:(s-n)/3})}return t}(e);if(1===M.length){const e=M[0],t=new o;t.boundingData=y,function(e,t,n,r){let s=1/0,o=1/0,i=1/0,a=-1/0,c=-1/0,l=-1/0;for(let r=6*t,u=6*(t+n);r<u;r+=6){const t=e[r+0];t<s&&(s=t),t>a&&(a=t);const n=e[r+2];n<o&&(o=n),n>c&&(c=n);const u=e[r+4];u<i&&(i=u),u>l&&(l=u)}r[0]=s,r[1]=o,r[2]=i,r[3]=a,r[4]=c,r[5]=l}(w,e.offset,e.count,x),i(t,e.offset,e.count,x),B.push(t)}else for(let e of M){const t=new o;t.boundingData=new Float32Array(6),h(w,e.offset,e.count,t.boundingData,x),i(t,e.offset,e.count,x),B.push(t)}return B}class x{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let s=0,o=e.length;s<o;s++){const o=e[s][t];n=o<n?o:n,r=o>r?o:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let s=0,o=t.length;s<o;s++){const o=t[s],i=e.dot(o);n=i<n?i:n,r=i>r?i:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}x.prototype.setFromBox=function(){const e=new r.Vector3;return function(t,n){const r=n.min,s=n.max;let o=1/0,i=-1/0;for(let n=0;n<=1;n++)for(let a=0;a<=1;a++)for(let c=0;c<=1;c++){e.x=r.x*n+s.x*(1-n),e.y=r.y*a+s.y*(1-a),e.z=r.z*c+s.z*(1-c);const l=t.dot(e);o=Math.min(l,o),i=Math.max(l,i)}this.min=o,this.max=i}}();!function(){const e=new x}();const w=function(){const e=new r.Vector3,t=new r.Vector3,n=new r.Vector3;return function(r,s,o){const i=r.start,a=e,c=s.start,l=t;n.subVectors(i,c),e.subVectors(r.end,r.start),t.subVectors(s.end,s.start);const u=n.dot(l),d=l.dot(a),h=l.dot(l),f=n.dot(a),p=a.dot(a)*h-d*d;let g,m;g=0!==p?(u*d-f*h)/p:0,m=(u+g*d)/h,o.x=g,o.y=m}}(),_=function(){const e=new r.Vector2,t=new r.Vector3,n=new r.Vector3;return function(r,s,o,i){w(r,s,e);let a=e.x,c=e.y;if(a>=0&&a<=1&&c>=0&&c<=1)return r.at(a,o),void s.at(c,i);if(a>=0&&a<=1)return c<0?s.at(0,i):s.at(1,i),void r.closestPointToPoint(i,!0,o);if(c>=0&&c<=1)return a<0?r.at(0,o):r.at(1,o),void s.closestPointToPoint(o,!0,i);{let e,l;e=a<0?r.start:r.end,l=c<0?s.start:s.end;const u=t,d=n;return r.closestPointToPoint(l,!0,t),s.closestPointToPoint(e,!0,n),u.distanceToSquared(l)<=d.distanceToSquared(e)?(o.copy(u),void i.copy(l)):(o.copy(e),void i.copy(d))}}}(),b=function(){const e=new r.Vector3,t=new r.Vector3,n=new r.Plane,s=new r.Line3;return function(r,o){const{radius:i,center:a}=r,{a:c,b:l,c:u}=o;s.start=c,s.end=l;if(s.closestPointToPoint(a,!0,e).distanceTo(a)<=i)return!0;s.start=c,s.end=u;if(s.closestPointToPoint(a,!0,e).distanceTo(a)<=i)return!0;s.start=l,s.end=u;if(s.closestPointToPoint(a,!0,e).distanceTo(a)<=i)return!0;const d=o.getPlane(n);if(Math.abs(d.distanceToPoint(a))<=i){const e=d.projectPoint(a,t);if(o.containsPoint(e))return!0}return!1}}();function T(e){return Math.abs(e)<1e-15}class S extends r.Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new r.Vector3)),this.satBounds=new Array(4).fill().map((()=>new x)),this.points=[this.a,this.b,this.c],this.sphere=new r.Sphere,this.plane=new r.Plane,this.needsUpdate=!0}intersectsSphere(e){return b(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,s=this.satAxes,o=this.satBounds,i=s[0],a=o[0];this.getNormal(i),a.setFromPoints(i,r);const c=s[1],l=o[1];c.subVectors(e,t),l.setFromPoints(c,r);const u=s[2],d=o[2];u.subVectors(t,n),d.setFromPoints(u,r);const h=s[3],f=o[3];h.subVectors(n,e),f.setFromPoints(h,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(i,e),this.needsUpdate=!1}}S.prototype.closestPointToSegment=function(){const e=new r.Vector3,t=new r.Vector3,n=new r.Line3;return function(r,s=null,o=null){const{start:i,end:a}=r,c=this.points;let l,u=1/0;for(let i=0;i<3;i++){const a=(i+1)%3;n.start.copy(c[i]),n.end.copy(c[a]),_(n,r,e,t),l=e.distanceToSquared(t),l<u&&(u=l,s&&s.copy(e),o&&o.copy(t))}return this.closestPointToPoint(i,e),l=i.distanceToSquared(e),l<u&&(u=l,s&&s.copy(e),o&&o.copy(i)),this.closestPointToPoint(a,e),l=a.distanceToSquared(e),l<u&&(u=l,s&&s.copy(e),o&&o.copy(a)),Math.sqrt(u)}}(),S.prototype.intersectsTriangle=function(){const e=new S,t=new Array(3),n=new Array(3),s=new x,o=new x,i=new r.Vector3,a=new r.Vector3,c=new r.Vector3,l=new r.Vector3,u=new r.Line3,d=new r.Line3,h=new r.Line3;return function(r,f=null,p=!1){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(e.copy(r),e.update(),r=e);const g=this.plane,m=r.plane;if(Math.abs(g.normal.dot(m.normal))>1-1e-10){const e=this.satBounds,a=this.satAxes;n[0]=r.a,n[1]=r.b,n[2]=r.c;for(let t=0;t<4;t++){const r=e[t],o=a[t];if(s.setFromPoints(o,n),r.isSeparated(s))return!1}const c=r.satBounds,l=r.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){const n=c[e],r=l[e];if(s.setFromPoints(r,t),n.isSeparated(s))return!1}for(let e=0;e<4;e++){const r=a[e];for(let e=0;e<4;e++){const a=l[e];if(i.crossVectors(r,a),s.setFromPoints(i,t),o.setFromPoints(i,n),s.isSeparated(o))return!1}}return f&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}{const e=this.points;let t=!1,n=0;for(let r=0;r<3;r++){const s=e[r],o=e[(r+1)%3];u.start.copy(s),u.end.copy(o),u.delta(a);const i=t?d.start:d.end,c=T(m.distanceToPoint(s));if(T(m.normal.dot(a))&&c){d.copy(u),n=2;break}if((m.intersectLine(u,i)||c)&&!T(i.distanceTo(o))){if(n++,t)break;t=!0}}if(1===n&&r.containsPoint(d.end))return f&&(f.start.copy(d.end),f.end.copy(d.end)),!0;if(2!==n)return!1;const s=r.points;let o=!1,i=0;for(let e=0;e<3;e++){const t=s[e],n=s[(e+1)%3];u.start.copy(t),u.end.copy(n),u.delta(c);const r=o?h.start:h.end,a=T(g.distanceToPoint(t));if(T(g.normal.dot(c))&&a){h.copy(u),i=2;break}if((g.intersectLine(u,r)||a)&&!T(r.distanceTo(n))){if(i++,o)break;o=!0}}if(1===i&&this.containsPoint(h.end))return f&&(f.start.copy(h.end),f.end.copy(h.end)),!0;if(2!==i)return!1;if(d.delta(a),h.delta(c),a.dot(c)<0){let e=h.start;h.start=h.end,h.end=e}const p=d.start.dot(a),y=d.end.dot(a),x=h.start.dot(a),w=h.end.dot(a);return(p===w||x===y||y<x!==p<w)&&(f&&(l.subVectors(d.start,h.start),l.dot(a)>0?f.start.copy(d.start):f.start.copy(h.start),l.subVectors(d.end,h.end),l.dot(a)<0?f.end.copy(d.end):f.end.copy(h.end)),!0)}}}(),S.prototype.distanceToPoint=function(){const e=new r.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),S.prototype.distanceToTriangle=function(){const e=new r.Vector3,t=new r.Vector3,n=["a","b","c"],s=new r.Line3,o=new r.Line3;return function(r,i=null,a=null){const c=i||a?s:null;if(this.intersectsTriangle(r,c))return(i||a)&&(i&&c.getCenter(i),a&&c.getCenter(a)),0;let l=1/0;for(let t=0;t<3;t++){let s;const o=n[t],c=r[o];this.closestPointToPoint(c,e),s=c.distanceToSquared(e),s<l&&(l=s,i&&i.copy(e),a&&a.copy(c));const u=this[o];r.closestPointToPoint(u,e),s=u.distanceToSquared(e),s<l&&(l=s,i&&i.copy(u),a&&a.copy(e))}for(let c=0;c<3;c++){const u=n[c],d=n[(c+1)%3];s.set(this[u],this[d]);for(let c=0;c<3;c++){const u=n[c],d=n[(c+1)%3];o.set(r[u],r[d]),_(s,o,e,t);const h=e.distanceToSquared(t);h<l&&(l=h,i&&i.copy(e),a&&a.copy(t))}}return Math.sqrt(l)}}();class v{constructor(e,t,n){this.isOrientedBox=!0,this.min=new r.Vector3,this.max=new r.Vector3,this.matrix=new r.Matrix4,this.invMatrix=new r.Matrix4,this.points=new Array(8).fill().map((()=>new r.Vector3)),this.satAxes=new Array(3).fill().map((()=>new r.Vector3)),this.satBounds=new Array(3).fill().map((()=>new x)),this.alignedSatBounds=new Array(3).fill().map((()=>new x)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}v.prototype.update=function(){const e=this.matrix,t=this.min,n=this.max,r=this.points;for(let s=0;s<=1;s++)for(let o=0;o<=1;o++)for(let i=0;i<=1;i++){const a=r[1*s|2*o|4*i];a.x=s?n.x:t.x,a.y=o?n.y:t.y,a.z=i?n.z:t.z,a.applyMatrix4(e)}const s=this.satBounds,o=this.satAxes,i=r[0];for(let e=0;e<3;e++){const t=o[e],n=s[e],a=r[1<<e];t.subVectors(i,a),n.setFromPoints(t,r)}const a=this.alignedSatBounds;a[0].setFromPointsField(r,"x"),a[1].setFromPointsField(r,"y"),a[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},v.prototype.intersectsBox=function(){const e=new x;return function(t){this.needsUpdate&&this.update();const n=t.min,r=t.max,s=this.satBounds,o=this.satAxes,i=this.alignedSatBounds;if(e.min=n.x,e.max=r.x,i[0].isSeparated(e))return!1;if(e.min=n.y,e.max=r.y,i[1].isSeparated(e))return!1;if(e.min=n.z,e.max=r.z,i[2].isSeparated(e))return!1;for(let n=0;n<3;n++){const r=o[n],i=s[n];if(e.setFromBox(r,t),i.isSeparated(e))return!1}return!0}}(),v.prototype.intersectsTriangle=function(){const e=new S,t=new Array(3),n=new x,s=new x,o=new r.Vector3;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(e.copy(r),e.update(),r=e);const i=this.satBounds,a=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let e=0;e<3;e++){const r=i[e],s=a[e];if(n.setFromPoints(s,t),r.isSeparated(n))return!1}const c=r.satBounds,l=r.satAxes,u=this.points;for(let e=0;e<3;e++){const t=c[e],r=l[e];if(n.setFromPoints(r,u),t.isSeparated(n))return!1}for(let e=0;e<3;e++){const r=a[e];for(let e=0;e<4;e++){const i=l[e];if(o.crossVectors(r,i),n.setFromPoints(o,t),s.setFromPoints(o,u),n.isSeparated(s))return!1}}return!0}}(),v.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},v.prototype.distanceToPoint=function(){const e=new r.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),v.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map((()=>new r.Line3)),n=new Array(12).fill().map((()=>new r.Line3)),s=new r.Vector3,o=new r.Vector3;return function(r,i=0,a=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||c)&&(r.getCenter(o),this.closestPointToPoint(o,s),r.closestPointToPoint(s,o),a&&a.copy(s),c&&c.copy(o)),0;const l=i*i,u=r.min,d=r.max,h=this.points;let f=1/0;for(let e=0;e<8;e++){const t=h[e];o.copy(t).clamp(u,d);const n=t.distanceToSquared(o);if(n<f&&(f=n,a&&a.copy(t),c&&c.copy(o),n<l))return Math.sqrt(n)}let p=0;for(let r=0;r<3;r++)for(let s=0;s<=1;s++)for(let o=0;o<=1;o++){const i=(r+1)%3,a=(r+2)%3,c=1<<r|s<<i|o<<a,l=h[s<<i|o<<a],f=h[c];t[p].set(l,f);const g=e[r],m=e[i],y=e[a],x=n[p],w=x.start,_=x.end;w[g]=u[g],w[m]=s?u[m]:d[m],w[y]=o?u[y]:d[m],_[g]=d[g],_[m]=s?u[m]:d[m],_[y]=o?u[y]:d[m],p++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){o.x=e?d.x:u.x,o.y=t?d.y:u.y,o.z=n?d.z:u.z,this.closestPointToPoint(o,s);const r=o.distanceToSquared(s);if(r<f&&(f=r,a&&a.copy(s),c&&c.copy(o),r<l))return Math.sqrt(r)}for(let e=0;e<12;e++){const r=t[e];for(let e=0;e<12;e++){const t=n[e];_(r,t,s,o);const i=s.distanceToSquared(o);if(i<f&&(f=i,a&&a.copy(s),c&&c.copy(o),i<l))return Math.sqrt(i)}}return Math.sqrt(f)}}();var A=n(7662);function C(e,t,n,r){const s=e.a,o=e.b,i=e.c;let a=t,c=t+1,l=t+2;n&&(a=n.getX(t),c=n.getX(t+1),l=n.getX(t+2)),s.x=r.getX(a),s.y=r.getY(a),s.z=r.getZ(a),o.x=r.getX(c),o.y=r.getY(c),o.z=r.getZ(c),i.x=r.getX(l),i.y=r.getY(l),i.z=r.getZ(l)}function P(e,t,n,r,s,o,i){const a=n.index,c=n.attributes.position;for(let n=e,l=t+e;n<l;n++)if(C(i,3*n,a,c),i.needsUpdate=!0,r(i,n,s,o))return!0;return!1}class B{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function M(e,t){return 65535===t[e+15]}function U(e,t){return t[e+6]}function V(e,t){return t[e+14]}function F(e){return e+8}function L(e,t){return t[e+6]}const R=new r.Box3,E=new r.Vector3,k=["x","y","z"];function O(e,t,n,r,s){let o=2*e,i=q,a=j,c=W;if(M(o,a)){const i=U(e,c),l=V(o,a);(0,A._m)(t,n,r,i,l,s)}else{const o=F(e);z(o,i,r,E)&&O(o,t,n,r,s);const a=L(e,c);z(a,i,r,E)&&O(a,t,n,r,s)}}function I(e,t,n,r){let s=2*e,o=q,i=j,a=W;if(M(s,i)){const o=U(e,a),c=V(s,i);return(0,A.k4)(t,n,r,o,c)}{const s=function(e,t){return t[e+7]}(e,a),i=k[s],c=r.direction[i]>=0;let l,u;c?(l=F(e),u=L(e,a)):(l=L(e,a),u=F(e));const d=z(l,o,r,E)?I(l,t,n,r):null;if(d){const e=d.point[i];if(c?e<=o[u+s]:e>=o[u+s+3])return d}const h=z(u,o,r,E)?I(u,t,n,r):null;return d&&h?d.distance<=h.distance?d:h:d||h||null}}const D=function(){let e,t;const n=[],o=new B((()=>new r.Box3));return function(...r){e=o.getPrimitive(),t=o.getPrimitive(),n.push(e,t);const s=a(...r);o.releasePrimitive(e),o.releasePrimitive(t),n.pop(),n.pop();const i=n.length;return i>0&&(t=n[i-1],e=n[i-2]),s};function a(n,r,o,c,l=null,u=0,d=0){function h(e){let t=2*e,n=j,r=W;for(;!M(t,n);)t=2*(e=F(e));return U(e,r)}function f(e){let t=2*e,n=j,r=W;for(;!M(t,n);)t=2*(e=L(e,r));return U(e,r)+V(t,n)}let p=2*n,g=q,m=j,y=W;if(M(p,m)){const t=U(n,y),r=V(p,m);return i(n,g,e),c(t,r,!1,d,u+n,e)}{const p=F(n),x=L(n,y);let w,_,b,T,S=p,v=x;if(l&&(b=e,T=t,i(S,g,b),i(v,g,T),w=l(b),_=l(T),_<w)){S=x,v=p;const e=w;w=_,_=e,b=T}b||(b=e,i(S,g,b));const A=o(b,M(2*S,m),w,d+1,u+S);let C;if(A===s.yj){const e=h(S);C=c(e,f(S)-e,!0,d+1,u+S,b)}else C=A&&a(S,r,o,c,l,u,d+1);if(C)return!0;T=t,i(v,g,T);const P=o(T,M(2*v,m),_,d+1,u+v);let B;if(P===s.yj){const e=h(v);B=c(e,f(v)-e,!0,d+1,u+v,T)}else B=P&&a(v,r,o,c,l,u,d+1);return!!B}}}(),N=function(){const e=new S,t=new S,n=new r.Matrix4,s=new v,o=new v;return function r(a,c,l,u,d=null){let h=2*a,f=q,p=j,g=W;null===d&&(l.boundingBox||l.computeBoundingBox(),s.set(l.boundingBox.min,l.boundingBox.max,u),d=s);if(!M(h,p)){const e=a+8,t=g[a+6];i(e,f,R);if(d.intersectsBox(R)&&r(e,c,l,u,d))return!0;i(t,f,R);return!!(d.intersectsBox(R)&&r(t,c,l,u,d))}{const r=c,s=r.index,d=r.attributes.position,m=l.index,y=l.attributes.position,x=U(a,g),w=V(h,p);if(n.copy(u).invert(),l.boundsTree){i(a,f,o),o.matrix.copy(n),o.needsUpdate=!0;return l.boundsTree.shapecast({intersectsBounds:e=>o.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(u),e.b.applyMatrix4(u),e.c.applyMatrix4(u),e.needsUpdate=!0;for(let n=3*x,r=3*(w+x);n<r;n+=3)if(C(t,n,s,d),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}})}for(let r=3*x,o=w+3*x;r<o;r+=3){C(e,r,s,d),e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let n=0,r=m.count;n<r;n+=3)if(C(t,n,m,y),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function z(e,t,n,r){return i(e,t,R),n.intersectBox(R,r)}const H=[];let G,q,j,W;function $(e){G&&H.push(G),G=e,q=new Float32Array(e),j=new Uint16Array(e),W=new Uint32Array(e)}function J(){G=null,q=null,j=null,W=null,H.length&&$(H.pop())}const Q=Symbol("skip tree generation"),X=new r.Box3,Z=new r.Box3,Y=new r.Matrix4,K=new v,ee=new v,te=new r.Vector3,ne=new r.Vector3,re=new r.Vector3,se=new r.Vector3,oe=new r.Vector3,ie=new r.Box3,ae=new B((()=>new S));class ce{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),ce.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,s=n.getIndex();let o;return o=t.cloneBuffers?{roots:r.map((e=>e.slice())),index:s.array.slice()}:{roots:r,index:s.array},o}static deserialize(e,t,n={}){if("boolean"==typeof n)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),ce.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});n={setIndex:!0,...n};const{index:s,roots:o}=e,i=new ce(t,{...n,[Q]:!0});if(i._roots=o,n.setIndex){const n=t.getIndex();if(null===n){const n=new r.BufferAttribute(e.index,1,!1);t.setIndex(n)}else n.array!==s&&(n.array.set(s),n.needsUpdate=!0)}return i}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:s.Q7,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[Q]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[Q]||(this._roots=function(e,t){const n=y(e,t);let r,o,i;const a=[],c=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let e=0;e<n.length;e++){const t=n[e];let d=l(t);const h=new c(s.Ne*d);r=new Float32Array(h),o=new Uint32Array(h),i=new Uint16Array(h),u(0,t),a.push(h)}return a;function l(e){return e.count?1:1+l(e.left)+l(e.right)}function u(e,t){const n=e/4,a=e/2,c=!!t.count,l=t.boundingData;for(let e=0;e<6;e++)r[n+e]=l[e];if(c){const r=t.offset,c=t.count;return o[n+6]=r,i[a+14]=c,i[a+15]=s.BE,e+s.Ne}{const r=t.left,i=t.right,a=t.splitAxis;let c;if(c=u(e+s.Ne,r),c/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return o[n+6]=c/4,c=u(c,i),o[n+7]=a,c}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new r.Box3))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,r=t.attributes.position;let o,i,a,c,l=0;const u=this._roots;for(let e=0,t=u.length;e<t;e++)o=u[e],i=new Uint32Array(o),a=new Uint16Array(o),c=new Float32Array(o),d(0,l),l+=o.byteLength;function d(t,o,l=!1){const u=2*t;if(a[u+15]===s.BE){const e=i[t+6];let s=1/0,o=1/0,l=1/0,d=-1/0,h=-1/0,f=-1/0;for(let t=3*e,i=3*(e+a[u+14]);t<i;t++){const e=n[t],i=r.getX(e),a=r.getY(e),c=r.getZ(e);i<s&&(s=i),i>d&&(d=i),a<o&&(o=a),a>h&&(h=a),c<l&&(l=c),c>f&&(f=c)}return(c[t+0]!==s||c[t+1]!==o||c[t+2]!==l||c[t+3]!==d||c[t+4]!==h||c[t+5]!==f)&&(c[t+0]=s,c[t+1]=o,c[t+2]=l,c[t+3]=d,c[t+4]=h,c[t+5]=f,!0)}{const n=t+8,r=i[t+6],s=n+o,a=r+o;let u=l,h=!1,f=!1;e?u||(h=e.has(s),f=e.has(a),u=!h&&!f):(h=!0,f=!0);const p=u||f;let g=!1;(u||h)&&(g=d(n,o,u));let m=!1;p&&(m=d(r,o,u));const y=g||m;if(y)for(let e=0;e<3;e++){const s=n+e,o=r+e,i=c[s],a=c[s+3],l=c[o],u=c[o+3];c[t+e]=i<l?i:l,c[t+e+3]=a>u?a:u}return y}}}traverse(e,t=0){const n=this._roots[t],r=new Uint32Array(n),o=new Uint16Array(n);!function t(i,a=0){const c=2*i,l=o[c+15]===s.BE;if(l){const t=r[i+6],s=o[c+14];e(a,l,new Float32Array(n,4*i,6),t,s)}else{const o=i+s.Ne/4,c=r[i+6],u=r[i+7];e(a,l,new Float32Array(n,4*i,6),u)||(t(o,a+1),t(c,a+1))}}(0)}raycast(e,t=r.FrontSide){const n=this._roots,s=this.geometry,o=[],i=t.isMaterial,a=Array.isArray(t),c=s.groups,l=i?t.side:t;for(let r=0,i=n.length;r<i;r++){const i=a?t[c[r].materialIndex].side:l,u=o.length;if($(n[r]),O(0,s,i,e,o),J(),a){const e=c[r].materialIndex;for(let t=u,n=o.length;t<n;t++)o[t].face.materialIndex=e}}return o}raycastFirst(e,t=r.FrontSide){const n=this._roots,s=this.geometry,o=t.isMaterial,i=Array.isArray(t);let a=null;const c=s.groups,l=o?t.side:t;for(let r=0,o=n.length;r<o;r++){const o=i?t[c[r].materialIndex].side:l;$(n[r]);const u=I(0,s,o,e);J(),null!=u&&(null==a||u.distance<a.distance)&&(a=u,i&&(u.face.materialIndex=c[r].materialIndex))}return a}intersectsGeometry(e,t){const n=this.geometry;let r=!1;for(const s of this._roots)if($(s),r=N(0,n,e,t),J(),r)break;return r}shapecast(e,t,n){const r=this.geometry;if(e instanceof Function){if(t){const e=t;t=(t,n,r,s)=>{const o=3*n;return e(t,o,o+1,o+2,r,s)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const s=ae.getPrimitive();let{boundsTraverseOrder:o,intersectsBounds:i,intersectsRange:a,intersectsTriangle:c}=e;if(a&&c){const e=a;a=(t,n,o,i,a)=>!!e(t,n,o,i,a)||P(t,n,r,c,o,i,s)}else a||(a=c?(e,t,n,o)=>P(e,t,r,c,n,o,s):(e,t,n)=>n);let l=!1,u=0;for(const e of this._roots){if($(e),l=D(0,r,i,a,o,u),J(),l)break;u+=e.byteLength}return ae.releasePrimitive(s),l}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:s}=n;const o=this.geometry.index,i=this.geometry.attributes.position,a=e.geometry.index,c=e.geometry.attributes.position;Y.copy(t).invert();const l=ae.getPrimitive(),u=ae.getPrimitive();if(s){function h(e,n,r,d,h,f,p,g){for(let m=r,y=r+d;m<y;m++){C(u,3*m,a,c),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,r=e+n;t<r;t++)if(C(l,3*t,o,i),l.needsUpdate=!0,s(l,u,t,m,h,f,p,g))return!0}return!1}if(r){const f=r;r=function(e,t,n,r,s,o,i,a){return!!f(e,t,n,r,s,o,i,a)||h(e,t,n,r,s,o,i,a)}}else r=h}e.getBoundingBox(Z),Z.applyMatrix4(t);const d=this.shapecast({intersectsBounds:e=>Z.intersectsBox(e),intersectsRange:(t,n,s,o,i,a)=>(X.copy(a),X.applyMatrix4(Y),e.shapecast({intersectsBounds:e=>X.intersectsBox(e),intersectsRange:(e,s,a,c,l)=>r(t,n,e,s,o,i,c,l)}))});return ae.releasePrimitive(l),ae.releasePrimitive(u),d}intersectsBox(e,t){return K.set(e.min,e.max,t),K.needsUpdate=!0,this.shapecast({intersectsBounds:e=>K.intersectsBox(e),intersectsTriangle:e=>K.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),K.set(e.boundingBox.min,e.boundingBox.max,t),K.needsUpdate=!0;const i=this.geometry,a=i.attributes.position,c=i.index,l=e.attributes.position,u=e.index,d=ae.getPrimitive(),h=ae.getPrimitive();let f=ne,p=re,g=null,m=null;r&&(g=se,m=oe);let y=1/0,x=null,w=null;return Y.copy(t).invert(),ee.matrix.copy(Y),this.shapecast({boundsTraverseOrder:e=>K.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<o&&(t&&(ee.min.copy(e.min),ee.max.copy(e.max),ee.needsUpdate=!0),!0),intersectsRange:(n,r)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>ee.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<o,intersectsRange:(e,o)=>{for(let i=3*e,_=3*(e+o);i<_;i+=3){C(h,i,u,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let e=3*n,t=3*(n+r);e<t;e+=3){C(d,e,c,a),d.needsUpdate=!0;const t=d.distanceToTriangle(h,f,g);if(t<y&&(p.copy(f),m&&m.copy(g),y=t,x=e/3,w=i/3),t<s)return!0}}}});for(let e=0,o=u?u.count:l.count;e<o;e+=3){C(h,e,u,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let t=3*n,o=3*(n+r);t<o;t+=3){C(d,t,c,a),d.needsUpdate=!0;const n=d.distanceToTriangle(h,f,g);if(n<y&&(p.copy(f),m&&m.copy(g),y=n,x=t/3,w=e/3),n<s)return!0}}}}),ae.releasePrimitive(d),ae.releasePrimitive(h),y===1/0?null:(n.point?n.point.copy(p):n.point=p.clone(),n.distance=y,n.faceIndex=x,r&&(r.point?r.point.copy(m):r.point=m.clone(),r.point.applyMatrix4(Y),p.applyMatrix4(Y),r.distance=p.sub(r.point).length(),r.faceIndex=w),n)}closestPointToPoint(e,t={},n=0,r=1/0){const s=n*n,o=r*r;let i=1/0,a=null;if(this.shapecast({boundsTraverseOrder:t=>(te.copy(e).clamp(t.min,t.max),te.distanceToSquared(e)),intersectsBounds:(e,t,n)=>n<i&&n<o,intersectsTriangle:(t,n)=>{t.closestPointToPoint(e,te);const r=e.distanceToSquared(te);return r<i&&(ne.copy(te),i=r,a=n),r<s}}),i===1/0)return null;const c=Math.sqrt(i);return t.point?t.point.copy(ne):t.point=ne.clone(),t.distance=c,t.faceIndex=a,t}getBoundingBox(e){e.makeEmpty();return this._roots.forEach((t=>{i(0,new Float32Array(t),ie),e.union(ie)})),e}}},7662:(e,t,n)=>{n.d(t,{sP:()=>x,k4:()=>y,_m:()=>m});var r=n(68909);const s=new r.Vector3,o=new r.Vector3,i=new r.Vector3,a=new r.Vector2,c=new r.Vector2,l=new r.Vector2,u=new r.Vector3,d=new r.Vector3,h=new r.Vector3,f=new r.Vector3;function p(e,t,n,p,g,m,y,x,w){s.fromBufferAttribute(t,m),o.fromBufferAttribute(t,y),i.fromBufferAttribute(t,x);const _=function(e,t,n,s,o,i){let a;return a=i===r.BackSide?e.intersectTriangle(s,n,t,!0,o):e.intersectTriangle(t,n,s,i!==r.DoubleSide,o),null===a?null:{distance:e.origin.distanceTo(o),point:o.clone()}}(e,s,o,i,f,w);if(_){p&&(a.fromBufferAttribute(p,m),c.fromBufferAttribute(p,y),l.fromBufferAttribute(p,x),_.uv=r.Triangle.getInterpolation(f,s,o,i,a,c,l,new r.Vector2)),g&&(a.fromBufferAttribute(g,m),c.fromBufferAttribute(g,y),l.fromBufferAttribute(g,x),_.uv1=r.Triangle.getInterpolation(f,s,o,i,a,c,l,new r.Vector2)),n&&(u.fromBufferAttribute(n,m),d.fromBufferAttribute(n,y),h.fromBufferAttribute(n,x),_.normal=r.Triangle.getInterpolation(f,s,o,i,u,d,h,new r.Vector3),_.normal.dot(e.direction)>0&&_.normal.multiplyScalar(-1));const t={a:m,b:y,c:x,normal:new r.Vector3,materialIndex:0};r.Triangle.getNormal(s,o,i,t.normal),_.face=t,_.faceIndex=m}return _}function g(e,t,n,r,s){const o=3*r,i=e.index.getX(o),a=e.index.getX(o+1),c=e.index.getX(o+2),{position:l,normal:u,uv:d,uv1:h}=e.attributes,f=p(n,l,u,d,h,i,a,c,t);return f?(f.faceIndex=r,s&&s.push(f),f):null}function m(e,t,n,r,s,o){for(let i=r,a=r+s;i<a;i++)g(e,t,n,i,o)}function y(e,t,n,r,s){let o=1/0,i=null;for(let a=r,c=r+s;a<c;a++){const r=g(e,t,n,a);r&&r.distance<o&&(i=r,o=r.distance)}return i}function x(e,t,n){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(n.ray.origin),e.object=t,e.distance<n.near||e.distance>n.far?null:e)}}}]);