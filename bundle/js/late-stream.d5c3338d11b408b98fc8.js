/*! For license information please see late-stream.d5c3338d11b408b98fc8.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[276],{73927:(e,t,n)=>{n.d(t,{h:()=>a});var r=n(89103);class a extends r.QB{constructor(e,t){super(),this.width=e,this.height=t}}},12850:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var r=n(15564),a=n(6539),i=n(32484),o=n(14907),s=n(45832);const{TEXTURE_SETTINGS:l,clearRaycastHits:u}=i.yJ;const d=async function(e){const t=await e.getModuleBySymbol(a.ZF),n=await e.getModuleBySymbol(s.GR),i=t.addPanel(r.F.TITLE,r.F.HOTKEYS,{width:350});await t.loadPromise.then((()=>{const r="meshtextures";[{panel:i,header:r,setting:"disableTextureStreamBelowLod",initialValue:()=>-1,onChange:e=>{e>-1&&n.textureQualityMap.limitStreamingBelow(e)},urlParam:!0,rangePrecision:0,range:[-1,7]},{panel:i,header:r,setting:"textureStreamPause",initialValue:()=>l.debugPauseTexStream,onChange:e=>{l.debugPauseTexStream=e},urlParam:!0},{panel:i,header:r,setting:"textureStreamRaycastHits",initialValue:()=>l.debugLOD,onChange:e=>{l.debugLOD=e,e||u()},urlParam:!0},{panel:i,header:r,setting:"debugRTTQuality",initialValue:()=>l.debugRttQuality,onChange:t=>{l.debugRttQuality=t,t||e.commandBinder.issueCommand(new o.T({color:null},{style:o.T.selectBy.all}))},urlParam:!0},{panel:i,header:r,setting:"debugRTTScores",initialValue:()=>l.debugRttScores,onChange:t=>{l.debugRttScores=t,t||e.commandBinder.issueCommand(new o.T({color:null},{style:o.T.selectBy.all}))},urlParam:!0}].forEach((e=>t.registerMenuEntry(e)))}))}},86465:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var r=n(68909),a=n(84440),i=n(25316),o=n(6539),s=n(98239),l=n(45832),u=n(32502),d=n(47299),g=n(50839),c=n(39034),h=n(2593);async function m(e){const t=await e.getModuleBySymbol(l.GR),[n,m]=await Promise.all([e.market.waitForData(i.o),e.getModuleBySymbol(o.ZF)]),f=t.commands,p=!0===Boolean(new URLSearchParams(window.location.search).get("flat"));await m.loadPromise.then((()=>{m.registerButton("Mesh","Toggle visible",(()=>{t.meshes.forEach((e=>{e.modelMesh.visible=!e.modelMesh.visible}))})),m.registerButton("Mesh","Toggle UV debug",(()=>{t.meshes.forEach((t=>{const n=t.renderer.chunkRenderingModeOverride?null:u.f.UV;e.commandBinder.issueCommand(new f.SetChunkRenderModeCommand(n))}))})),m.registerButton("Mesh","Toggle depth",(()=>{t.meshes.forEach((t=>{const n=t.renderer.chunkRenderingModeOverride?null:u.f.Depth;e.commandBinder.issueCommand(new f.SetChunkRenderModeCommand(n))}))})),m.registerButton("Mesh","Toggle transparent",(()=>{t.meshes.forEach((t=>{const n=t.renderer.chunkRenderingModeOverride?null:u.f.Transparent;e.commandBinder.issueCommand(new f.SetChunkRenderModeCommand(n))}))})),m.registerButton("Mesh","Toggle wireframe",(()=>{t.meshes.forEach((t=>{const n=t.renderer.chunkRenderingModeOverride?null:u.f.Wireframe;e.commandBinder.issueCommand(new f.SetChunkRenderModeCommand(n))}))}));let i=p;const o=()=>{t.meshes.forEach((e=>{e.modelMesh instanceof c.f&&e.modelMesh.notifyOnChunksLoaded((e=>{for(const t of e)t.setFlatShading(i)}));for(const t of e.modelMesh.chunks)t.setFlatShading(i)}))};o(),m.registerButton("Mesh","Toggle flat shading",(()=>{i=!i,o()}));const l=(()=>{let e=!1;return(n,i)=>{const o=new r.Vector4(1,1,1,0);var s;e=!e,s=n||e,t.meshes.forEach((e=>{for(const t of e.modelMesh.chunks){const e=i?100*t.id:100*t.meshSubgroup,n=s?(0,a.Zd)(.5,e):o;t.setColorOverlay(n)}}))}})();m.registerButton("Mesh","Highlight Rooms",l),m.registerButton("Mesh","Highlight Chunks",(()=>l(!0,!0))),n.onPropertyChanged(d.Vp,(e=>{t.meshes.forEach((t=>{for(const n of t.modelMesh.chunks){const r=t.meshData.meshGroups.floors.get(n.meshGroup);r&&n.setMaterialsUniform({floorTrimHeight:1-e/100,floorHeightMin:r.boundingBox.min.y,floorHeightMax:r.boundingBox.max.y})}}))}));const y=(e,t,r,a,i)=>{m.registerSetting(e,t,r,!0,s.SettingPersistence.NONE,i),n.onPropertyChanged(t,a)};y("Wireframe",d._Z,!1,(e=>{t.meshes.forEach((t=>{for(const n of t.modelMesh.chunks)n.setWireframe(e)}))}));const M={[g.d.Wireframe]:{Wireframe:["thickness","wireframeOpacity","stroke","fillEnabled","fill","insideAltColor","dualStroke","secondThickness"],"Wireframe Dashes":["dashEnabled","dashLength","dashAnimate","dashOverlap"],"Wireframe Advanced":["squeeze","squeezeMin","squeezeMax"]}};for(const e in M){const n=h.fu.uniforms[e];for(const r in M[e])for(const a of M[e][r])y(r,a,n[a].value,(e=>{t.meshes.forEach((t=>{for(const n of t.modelMesh.chunks)n.setMaterialsUniform({[a]:e})}))}),n[a].range)}}))}},8072:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L,tiledMeshDebugMenu:()=>P});var r=n(68909),a=n(6539),i=n(3066);function o(e,t=16){let n;const r=(0,i.Sh)((()=>n=window.setInterval((()=>e()),t)),(()=>{n&&clearInterval(n)}));return r.cancel(),r}var s=n(244),l=n(24241),u=n(75778),d=n(45832),g=n(48539),c=n(84440),h=n(25712),m=n(32484),f=n(47299),p=n(15564);const y=new l.Vy("tiled-mesh"),{TILEDMESH_SETTINGS:M}=m.yJ,x={hideMenu:"1"!==(0,u.P3)("dmenu","0"),debug:"1"===(0,u.P3)("debugTiles","0")||"1"===(0,u.P3)("debug-tiles","0"),statsTiles:!1,statsTileset:!0,statsTextures:!0,statsTextureStream:!0};let b=null;function T(e,t,n){b||(b=document.createElement("div"),b.style.color="#FFFFFF",b.style.fontFamily="Roboto",b.style.fontWeight="300",b.style.fontSize="12px",b.style.position="absolute",b.style.top="85px",b.style.width="500px",b.style.pointerEvents="none",b.style.whiteSpace="pre",b.style.zIndex="99999",b.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(b));let r="\n\n";r+=function(e){const t=e.threeRenderer.info,n=`three:\n  drawCalls: ${t.render.calls}\n  geometries: ${t.memory.geometries}\n  textures: ${t.memory.textures}\n  triangles: ${t.render.triangles}\n  memory allocated (megs): ${Math.floor(e.estimatedGPUMemoryAllocated()/2**20)}`;return n}(e),r+=x.statsTextureStream?function(e){const t=`\ntextureStreaming:\n  downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n  downloadingTextures: ${e.loadingTextures}\n`,n="  downloaded:\n"+Object.keys(e.totalTextures).map((t=>`    ${t}: ${e.totalTextures[t]} `)).join("\n")+"\n";return t+n}(n):"",t.forEach(((e,t)=>{const n=e.modelMesh;r+=`\n\n<mesh: id:${t}>`,r+=x.statsTileset?function(e,t){var n,r,a;const i=e.tilesRenderer,o=Object.values(null!==(n=i.tileSets)&&void 0!==n?n:[])[0];return`\n  tileset: preset: ${null===(r=null==o?void 0:o.asset.extras)||void 0===r?void 0:r.preset}, depth: ${null===(a=null==o?void 0:o.asset.extras)||void 0===a?void 0:a.depth}, version: ${null==o?void 0:o.asset.tilesetVersion}\n  view: errorTarget: ${t.settings.errorTarget}, maxLOD: ${t.settings.maxLOD}, detail: '${t.detail}'\n`}(n.tileLoader,n):"",r+=x.statsTiles?function(e){const t=e.tilesRenderer,n=t.visibleTiles,r={};n.forEach((e=>{var t;const n=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,a=r[n]||0;r[n]=a+1}));const{stats:a,downloadQueue:i,parseQueue:o,lruCache:s}=t,{active:l,downloading:u,inFrustum:d,parsing:g,used:c,visible:h}=a,m=`  tiles:\n    tiles in frustum: ${d}\n    visible: ${h}`+Object.keys(r).sort().map((e=>`\n     ${e} tiles: ${r[e]||0}`)).join()+`\n    downloading gltf: ${u}\n    parsing gltf: ${g}\n    active: ${l}\n    used: ${c}\n    queues:\n      download: ${i.currJobs} running, ${i.items.length} waiting\n      parse: ${o.currJobs} running, ${o.items.length} waiting\n    lruCache: ${s.itemSet.size}\n`;return m}(n.tileLoader):"",r+=`</mesh: id:${t}>`})),b.textContent=r}function w(e,t,n,a,i,s){C&&(e.forEach(((e,n)=>{E.has(e.modelMesh)||(E.add(e.modelMesh),v.push(...function(e,t,n,a){const i=[{panel:e,header:t.tile+": "+n,setting:"maxLOD: "+n,initialValue:()=>a.settings.maxLOD,onChange:e=>{a.settings.maxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"nonMeshMaxLOD: "+n,initialValue:()=>a.settings.nonMeshMaxLOD,onChange:e=>{a.settings.nonMeshMaxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"minLOD: "+n,initialValue:()=>a.settings.minLOD,onChange:e=>{a.settings.minLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"errorTarget:"+n,initialValue:()=>a.settings.errorTarget,onChange:e=>{a.settings.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile+": "+n,setting:"disableTileUpdates:"+n,initialValue:()=>a.settings.disableTileUpdates,onChange:e=>{a.settings.disableTileUpdates=e}},{panel:e,header:t.tile+": "+n,setting:"disposeModel: "+n,initialValue:()=>a.settings.disposeModel,onChange:e=>{a.settings.disposeModel=e}},{panel:e,header:t.tile+": "+n,setting:"pos on z axis: "+n,initialValue:()=>0,onChange:e=>{a.position.copy(new r.Vector3(0,0,e)),a.updateMatrixWorld(!0)},range:[-100,100],rangePrecision:0}];return i}(t,a,n,e.modelMesh)),v.push(...function(e,t,n,r,a,i){const s=r.tileLoader,l=V(s,i,((e,t)=>e.setWireframe(t))),u=function(e,t){const n={scale:1},r=(t,r)=>{if(!t)return;const a=e.container.tilesByChunkId.get(t.id),i=(null==a?void 0:a.__error)||1e-4,o=t.lod!==M.maxLOD&&i>M.errorTarget?1:.5,s=Math.max(0,Math.min(1,1-n.scale/i)),l=r?O(t.lod,s,o):null;t.setColorOverlay(l)},a=V(e,t,r),i=o((()=>a.colorize(e.container.chunks)));return{toggle:e=>{e?i.renew():i.cancel(),a.toggle(e)},colorize:a.colorize,subscription:i,config:n}}(s,i),d=V(s,i,((e,t)=>{e.setColorOverlay(t?O(e.lod,1,.5):null)})),g=V(s,i,((e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,e.id||0):null)})),m=V(s,i,((e,t)=>{var n;const r=s.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,c.Zd)(.5,(0,h.s5)((null===(n=null==r?void 0:r.content)||void 0===n?void 0:n.uri)||"missing")||0):null)})),f=V(s,i,((e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)})),p=V(s,i,((e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,e.meshSubgroup||0):null)})),x=V(s,i,((e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,e.meshGroup||0):null)})),b=V(s,i,((e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,(0,h.s5)(e.textureName)||0):null)})),T=V(s,i,((e,t)=>{const n=s.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,c.Zd)(.5,(null==n?void 0:n.geometricError)||0):null)})),w=a.slots,v=r.textureQualityMap,E=V(s,i,((e,t)=>{const n=w.find((t=>t.textureName===e.textureName));if(n){const r=n.loading?1:n.quality>v.min(e.lod)?.7:.3,a=v.maxTexelSize/v.get(n.quality).texelSize;e.setColorOverlay(t?O(e.lod,a,r):null)}})),C=o((()=>E.colorize(s.container.chunks)));let S="none";const P={none:void 0,byError:u,byGeometricError:T,byTile:m,bySubgroup:p,byMeshgroup:x,bySubAndMeshgroup:f,byTexture:b,byStreamedTextures:{subscription:C,toggle:e=>{e?C.renew():C.cancel(),e&&y.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),E.toggle(e)}},byChunk:g,byLod:d},B=[{panel:e,header:`${t.viz}: ${n}`,setting:"disableTileUpdates:"+n,initialValue:()=>r.settings.disableTileUpdates,onChange:e=>{r.settings.disableTileUpdates=e},urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"wireframe:"+n,initialValue:()=>!1,onChange:l.toggle,urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorize:"+n,initialValue:()=>"none",onChange:e=>{var t,n;null===(t=P[S])||void 0===t||t.toggle(!1),null===(n=P[e])||void 0===n||n.toggle(!0),S=e},options:Object.keys(P),urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorizeByErrorScale:"+n,initialValue:()=>1,onChange:e=>{u.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}];return B}(t,a,n,e.modelMesh,i,s)))})),v.length&&(v.forEach((e=>n.registerMenuEntry(e))),v.length=0))}const v=[],E=new Set;let C=!1,S=null;async function P(e){if(!x.debug)return;const t=await e.getModuleBySymbol(a.ZF),n=await e.getModuleBySymbol(d.mL),r=await e.getModuleBySymbol(d.M7),i=r.getScene(),o=await e.getModuleBySymbol(d.GR);await o.firstMeshLoadPromise,await(0,g.cb)(100);const s=o.meshes,l=o.meshTextureLoader,u=t.tryGetProperty(f.sz,!1),c=t.addPanel(p.F.TITLE,p.F.HOTKEYS,{width:350}),h={viz:"visualize",stats:"stats",tile:"tileset",log:"log"};function m(){S||(S=setInterval((()=>{T(r,s,l),w(s,c,t,h,l,e)}),150))}const b=[{panel:c,header:h.stats,setting:"tilesetStatsOverlay",initialValue:()=>x.statsTileset,onChange:e=>{x.statsTileset=e,e&&m()},urlParam:!0},{panel:c,header:h.stats,setting:"tileStatsOverlay",initialValue:()=>x.statsTiles,onChange:e=>{x.statsTiles=e,e&&m()},urlParam:!0},{panel:c,header:h.stats,setting:"textureStatsOverlay",initialValue:()=>x.statsTextures,onChange:e=>{x.statsTextures=e,e&&m()},urlParam:!0},{panel:c,header:h.stats,setting:"textureStreamingOverlay",initialValue:()=>x.statsTextureStream,onChange:e=>{x.statsTextureStream=e,e&&m()},urlParam:!0}],v=[{panel:c,header:h.log,buttonName:"Log: App State",callback:()=>{y.warn(s),y.warn(n),y.warn(i),y.warn(t)}}];u&&(x.hideMenu||await(0,g.cb)(1e3).then((()=>{t.getSettingsGui().loadGuiPackage().then((()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())}))})),await(0,g.cb)(16),C||(await(0,g.cb)(16),C=!0,function(e,t,n,r){const a=[{panel:e,header:t.tile,setting:"smallMeshThreshold",initialValue:()=>M.smallMeshThreshold,onChange:e=>{M.smallMeshThreshold=e,r.forEach((t=>{t.modelMesh.settings.smallMeshThreshold=e}))},range:[0,100],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"smallMeshErrorMultiplier",initialValue:()=>M.smallMeshErrorMultiplier,onChange:e=>{M.smallMeshErrorMultiplier=e,r.forEach((t=>{t.modelMesh.settings.smallMeshErrorMultiplier=e}))},range:[.01,2],rangePrecision:2,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>M.displayActiveTiles,onChange:e=>{M.displayActiveTiles=e,r.forEach((t=>{t.modelMesh.settings.displayActiveTiles=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>M.loadSiblings,onChange:e=>{M.loadSiblings=e,r.forEach((t=>{t.modelMesh.settings.loadSiblings=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>M.autoDisableRendererCulling,onChange:e=>{M.autoDisableRendererCulling=e,r.forEach((t=>{t.modelMesh.settings.autoDisableRendererCulling=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>M.stopAtEmptyTiles,onChange:e=>{M.stopAtEmptyTiles=e,r.forEach((t=>{t.modelMesh.settings.stopAtEmptyTiles=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"limitMemoryUsage",initialValue:()=>M.limitMemoryUsage,onChange:e=>{M.limitMemoryUsage=e,r.forEach((t=>{t.modelMesh.settings.limitMemoryUsage=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>M.allocatedMegsBeforeLimitingLod,onChange:e=>{M.allocatedMegsBeforeLimitingLod=e,r.forEach((t=>{t.modelMesh.settings.allocatedMegsBeforeLimitingLod=e}))},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"lruMinExtraTiles",initialValue:()=>M.lruMinExtraTiles,onChange:e=>{M.lruMinExtraTiles=e,r.forEach((t=>{t.modelMesh.settings.lruMinExtraTiles=e}))},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxTiles",initialValue:()=>M.lruMaxTiles,onChange:e=>{M.lruMaxTiles=e,r.forEach((t=>{t.modelMesh.settings.lruMaxTiles=e}))},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>M.lruUnloadPercent,onChange:e=>{M.lruUnloadPercent=e,r.forEach((t=>{t.modelMesh.settings.lruUnloadPercent=e}))},urlParam:!0,range:[0,1]},{panel:e,header:"Priority",setting:"errorMultiplierRaycastOcclusion",initialValue:()=>M.errorMultiplierRaycastOcclusion,onChange:e=>{M.errorMultiplierRaycastOcclusion=e,r.forEach((t=>{t.modelMesh.settings.errorMultiplierRaycastOcclusion=e}))},range:[.001,1],rangePrecision:2},{panel:e,header:"Priority",setting:"errorMultiplierHiddenFloors",initialValue:()=>M.errorMultiplierHiddenFloors,onChange:e=>{M.errorMultiplierHiddenFloors=e,r.forEach((t=>{t.modelMesh.settings.errorMultiplierHiddenFloors=e}))},range:[.001,1],rangePrecision:2}];return a}(c,h,0,s).forEach((e=>t.registerMenuEntry(e))),b.forEach((e=>t.registerMenuEntry(e))),v.forEach((e=>t.registerMenuButton(e)))))}function V(e,t,n){let r=!1;const a=e=>{t.after(s.R.End).then((()=>{e.forEach((e=>{e&&n(e,r)}))}))},i=e.notifyOnChunksLoaded(a);i.cancel();return{toggle:t=>{t?i.renew():i.cancel(),t!==r&&(r=t,a([...e.container.chunks]))},colorize:a,subscription:i}}const B={0:new r.Vector4(1,0,0,1),1:new r.Vector4(0,1,0,1),2:new r.Vector4(0,0,1,1),3:new r.Vector4(1,1,1,1),4:new r.Vector4(1,0,1,1),5:new r.Vector4(0,1,1,1),6:new r.Vector4(1,1,0,1),7:new r.Vector4(0,0,0,1)};function O(e,t,n){var a,i;const o=null!==(i=null===(a=B[e])||void 0===a?void 0:a.clone())&&void 0!==i?i:new r.Vector4;return o.multiplyScalar(t),o.setW(n),o}const L=P},15564:(e,t,n)=>{n.d(t,{F:()=>r});const r={TITLE:"streamed-mesh (T)",HOTKEYS:[n(71397).D.T]}},32484:(e,t,n)=>{n.d(t,{yJ:()=>o});var r=n(80112),a=n(47299),i=n(14971);const o={TEXTURE_SETTINGS:a.Ay,TILEDMESH_SETTINGS:r.W,clearRaycastHits:i.Jn}},30443:(e,t,n)=>{n.d(t,{U7:()=>u,UX:()=>l,Wi:()=>g,h0:()=>i,jF:()=>c,nD:()=>h});var r=n(68909),a=n(81662);function i(e){if(0===e.length)throw Error("Can't merge empty list of geometries");if(1===e.length)return e[0];let t=0,n=0,a=0,i=0;const s=new r.Box3;for(const r of e)r.index&&(t+=r.index.count,n+=r.getAttribute("position").count,r.getAttribute("uv")&&(a+=r.getAttribute("uv").count),r.boundingBox&&(s.union(r.boundingBox),i++));const u=new r.BufferGeometry;i!==e.length||s.isEmpty()?u.computeBoundingBox():u.boundingBox=s,s.copy(l(u)),u.boundingSphere=s.getBoundingSphere(new r.Sphere);const d=o(new Float32Array(3*n),"position",e);u.setAttribute("position",new r.BufferAttribute(d,3));const g=function(e,t){let n=0,r=0;for(const a of t){const t=a.index;for(let a=0;a<t.array.length;a++)e[n+a]=t.array[a]+r;n+=t.array.length,r+=a.getAttribute("position").count}return e}(new Uint32Array(t),e);if(u.setIndex(new r.BufferAttribute(g,1)),a){const t=o(new Float32Array(2*a),"uv",e);u.setAttribute("uv",new r.BufferAttribute(t,2))}return u}function o(e,t,n){let r=0;for(const a of n){const n=a.getAttribute(t);e.set(n.array,r),r+=n.array.length}return e}const s=new r.Box3(a.B1.ZERO,a.B1.UNIT);function l(e){return e.boundingBox||e.computeBoundingBox(),e.boundingBox||s}function u(e,t){let n=1/0;const a=t.clone(),i=new r.Vector3,o=new r.Vector3(1/0,1/0,1/0);let s=-1;const l=new r.Triangle;return function(e,t){var n;const r=null===(n=e.index)||void 0===n?void 0:n.array,a=e.getAttribute("position");if(!a)return;const i=e.groups.length>0?e.groups:[{start:0,count:r?r.length:a.count,materialIndex:0}];let o=0;for(const e of i)for(let n=e.start;n<e.start+e.count;n+=3){let i=n,s=n+1,l=n+2;r&&(i=r[i],s=r[s],l=r[l]),t(a.getX(i),a.getY(i),a.getZ(i),a.getX(s),a.getY(s),a.getZ(s),a.getX(l),a.getY(l),a.getZ(l),o++,e.materialIndex||0)}}(e,((e,t,r,u,d,g,c,h,m,f)=>{l.a.set(e,t,r),l.b.set(u,d,g),l.c.set(c,h,m),l.closestPointToPoint(a,i);const p=a.distanceToSquared(i);p<n&&(o.copy(i),n=p,s=f)})),{point:o,distance:Math.sqrt(n),faceIndex:s}}const d=new r.PlaneGeometry(1,1);function g(){return d}const c=(e,t)=>{t=t||[];for(let e=0;e<8;e++)t[e]=t[e]||new r.Vector3;return t[0].set(e.min.x,e.min.y,e.min.z),t[1].set(e.min.x,e.max.y,e.min.z),t[2].set(e.max.x,e.max.y,e.min.z),t[3].set(e.max.x,e.min.y,e.min.z),t[4].set(e.min.x,e.min.y,e.max.z),t[5].set(e.min.x,e.max.y,e.max.z),t[6].set(e.max.x,e.max.y,e.max.z),t[7].set(e.max.x,e.min.y,e.max.z),t},h=(()=>{const e=new r.Vector3,t=new r.Vector3;return(n,a,i)=>{a=a||new r.Box3,e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(const r of n)i&&r.applyMatrix4(i),e.x=Math.min(e.x,r.x),e.y=Math.min(e.y,r.y),e.z=Math.min(e.z,r.z),t.x=Math.max(t.x,r.x),t.y=Math.max(t.y,r.y),t.z=Math.max(t.z,r.z);return a.min.copy(e),a.max.copy(t),a}})()}}]);