/*! For license information please see scene.a7b92aa4626b6c53a596.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[1],{78671:(e,t,i)=>{i.d(t,{I:()=>n});const n="spaces.sdk.qa"},41122:(e,t,i)=>{i.d(t,{My:()=>l,W:()=>d,YB:()=>o,ho:()=>s,nq:()=>a,u3:()=>r});var n=i(55141);class s extends n.u{constructor(e){super(),this.payload={exclude:e||[]}}}s.id="PLUGIN_RESET_ALL";class o extends n.u{constructor(e,t,i,n){super(),this.payload={name:e,config:t,configMeta:i,permissions:n||{}}}}o.id="PLUGIN_RELOAD";class a extends n.u{constructor(e,t,i,n){super(),this.payload={name:e,config:t,configMeta:i,permissions:n||{}}}}a.id="PLUGIN_LOAD";class r extends n.u{constructor(e){super(),this.payload={name:e}}}r.id="PLUGIN_UNLOAD";class l extends n.u{constructor(e,t){super(),this.payload={operation:e,callback:t}}}l.id="PLUGIN_CONFIG_FETCH_DATA";class d extends n.u{constructor(e,t){super(),this.payload={attachmentId:e,pluginId:t}}}d.id="ATTACHMENT_ASSOCIATE_WITH_PLUGIN";class c extends n.u{constructor(e,t){super(),this.payload={attachmentId:e,pluginId:t}}}c.id="ATTACHMENT_DISSOCIATE_FROM_PLUGIN"},99460:(e,t,i)=>{i.r(t),i.d(t,{LIST_EDIT_ONLY:()=>n.L$,PluginConfigData:()=>n.Y7,default:()=>T,getPluginMetadataUrl:()=>m,getPluginUrl:()=>v,manifestEndpoint:()=>n.TR});var n=i(56846),s=i(27947),o=i(75578),a=i(45832),r=i(13586),l=i(85846);const d="0.0";function c(e){if(!e)return[];const t={[d]:u}[d];if(!t)throw new Error(`[PluginConfigDeserializer] Data with version "${e.version}": not recognized.`);return t(e)}function u(e){return e[d]}const h="0.0";function g(e){const t={[h]:p};if(!e)throw new Error("[PluginConfigSerializer] no data to serialize.");const i=t[h];if(!i)throw new Error(`[PluginConfigSerializer] Version "${h}" not recognized.`);return i(e)}function p(e){return{[h]:e}}class f extends l.xO{constructor(e,t,i){super({queue:e,path:`${t}/api/v1/jsonstore/model/plugins/${i}`,batchUpdate:!0,deserialize:c,serialize:g}),this.config.cachedData={data:null}}}function v(e,t,i){return i+`${e}/${t}/${e}.js`}function m(e,t,i){return i+`${e}/${t}/plugin.json`}const y=e=>{var t,i,n;return null!==(n=null===(i=null===(t=null==e?void 0:e.src)||void 0===t?void 0:t.match(/(\d+\.\d+\.\d+)\/[^\/]*\.js$/))||void 0===i?void 0:i[1])&&void 0!==n?n:null};var w=i(66726),b=i(49953),E=i(83375),O=i(99589),D=i(47737),R=i(41122),P=i(75778),C=i(95330);const L="unknown-app-key",A="manifest";class T extends o.n{constructor(){super(...arguments),this.name="plugin-config",this._registryLoaded=new C.L(!1)}get serviceSdkKey(){if(!this._applicationKey)throw new Error("[PluginConfigData] service key has not yet been set.");return this._applicationKey}get canOverrideStrict(){var e,t;return null===(t=null===(e=this._config)||void 0===e?void 0:e.pluginPolicies)||void 0===t?void 0:t.canDebug}get registryLoadedObservable(){return this._registryLoaded}get registryLoaded(){return this._registryLoaded.value}async init(e,t){this.queue=e.queue,this.pluginConfigData=new n.Y7,this._config=e;if([this._policyData,this._layersData]=await Promise.all([t.market.waitForData(b.L),t.market.waitForData(D.P)]),e.pluginPolicies.enabled){const i=(await t.getModuleBySymbol(a.qL)).getApi(),n=await i.getAppKey("showcase","plugin");if(n instanceof Object){const t=n;this.initializePluginRegistry(t,e).then((async()=>{await this.setupConfigStore(e.apiHostBaseUrl,e.modelId,false),this._registryLoaded.value=!0})).catch((e=>{this.log.error(e)}))}}t.commandBinder.addBinding(R.W,(async e=>{var t,i;const n=(await this.pluginConfigData.getMdsResult()).find((t=>t.name===e.pluginId)),s=null!==(i=null===(t=null==n?void 0:n.attachments)||void 0===t?void 0:t.map((e=>e.id)))&&void 0!==i?i:[];this.pluginConfigData.updateMds({name:e.pluginId,attachments:[...s,e.attachmentId]})})),t.market.register(n.Y7,this.pluginConfigData)}async saveToMds(e){var t;if(!this.pluginConfigData.mdsIsSetup)return void this.log.warn("Plugin changes will NOT be saved");const i=null!==(t=y(e))&&void 0!==t?t:"0.0.0";if(!this._manifest.find((t=>t.name===e.id&&t.versions[i])))return void this.log.warn(`Version ${i} does not exist in registry. Changes not saved to MDS.`);const n=[];e.config.photoUrl&&n.push(e.config.photoUrl),e.config.logoUrl&&n.push(e.config.logoUrl);const s={name:e.id,version:i};n.length>0&&(s.attachments=n),this.pluginConfigData.updateMds(s)}deleteFromMds(e){this.pluginConfigData.mdsIsSetup?this.pluginConfigData.deleteMdsById(e.id):this.log.warn("Plugin changes will NOT be saved")}saveConfig(e,t){const i=this.pluginConfigData.lastSavedConfiguration.values();this.log.debugInfo(`configuration for ${e.id} updated. ${JSON.stringify(i,void 0,2)}`),e.enabled?this.saveToMds(e):this.deleteFromMds(e),this.currentStore.update(i)}async setupConfigStore(e,t,i){let n;this.currentStore=new f(this.queue,e,t),this.pluginConfigData.setupConfigStore(this._layersData.mdsContext,i,e);try{n=await this.currentStore.read()||[],this.log.debugWarn(`Saved configuration data loaded for ${n.length} plugin(s).`),this.log.debugInfo(JSON.stringify(n,void 0,2))}catch(e){n=[],this.log.error("Failed to load configured plugins: ",e)}this.pluginConfigData.lastSavedConfiguration.replace(n),this.pluginConfigData.lastSavedConfiguration.onElementChanged({onAdded:this.saveConfig.bind(this),onUpdated:this.saveConfig.bind(this),onRemoved:this.deleteFromMds.bind(this)}),this.pluginConfigData.pluginConfigReady.resolve()}getAutoUpgradedVersion(e,t){var i;const n=Object.keys(t.versions).sort(((e,t)=>E.h.compare(t,e))).filter((e=>this.hasRequiredPolicies(t.versions[e].requiredPolicies))),s=null!==(i=O.maxSatisfying(n,`~${e}`))&&void 0!==i?i:e,o=t.currentVersion;let a=s;return O.gt(s,o)&&(a=o),a}dispose(e){super.dispose(e),e.market.unregister(n.Y7),this.pluginConfigData=void 0}async initializePluginRegistry(e,t){const{manifestUrl:i,applicationKey:n}=this.getManifestUrl(e,t);this._applicationKey=n;const s=await this.queue.get(i,{responseType:"json"}).catch((e=>(this.log.error(e),null)));null!==s?(this._manifest=s,await this.populateFromManifest(s,e,n)):this.log.error("Plugin manifest could not be found, please contact support.")}getManifestUrl(e,t,i=!0){var s;let o=this._config.apiHostBaseUrl+n.TR,a=e.applicationKey;if(this.pluginConfigData.pluginVersion){const e=this.pluginConfigData.pluginVersion.match(/^(https?:\/\/)?(localhost|127.0.0.1)(:\d*)?(\/(\w+-)?manifest.json)?$/)||this.pluginConfigData.pluginVersion.match(/^(draft|edge|local)$/);if(e){const t=["draft","edge","local"].includes(e[1]),i="edge"===e[1],n=window.location.protocol+"//",a=t?n:e[1]||n,r=t?"localhost":e[2]||"localhost",l=e[3]||":8800",d=i?"/edge-manifest.json":e[4]||"/draft-manifest.json",c=null===(s=e[5])||void 0===s?void 0:s.slice(0,-1);o=`${a}${r}${l}${d}?${A}=${c||"true"}`,this.log.devInfo(`Using local manifest override: ${o}`),e[5]&&this.log.devInfo("with specified plugin name",c)}else{const e=this.pluginConfigData.pluginVersion.match(/^(?:([a-zA-Z-]+)-)?\d+\.\d+\.\d+-\d+-g[0-9a-f]{7}/);o+=e?`?v=${e[0]}&${A}=${e[1]||"true"}`:`?v=${this.pluginConfigData.pluginVersion}&${A}=true`}}else this.pluginConfigData.manifestUrl&&((0,w.Jt)(this.pluginConfigData.manifestUrl)||t.pluginPolicies.canDebug)?o=this.pluginConfigData.manifestUrl:o+=`?${A}=true`;return this.log.devInfo(`Using manifest URL: ${o}`),(o.match(/localhost/)||o.match(/127.0.0.1/))&&i&&!t.pluginPolicies.canDebug&&(a=L),{manifestUrl:o,applicationKey:a}}async populateFromManifest(e,t,i){const n=[];for(const s of e)n.push(this.registerManifestEntry(s,t,i));await Promise.all(n)}async registerManifestEntry(e,t,i){var n,s,o;const a=this.findLatestPermittedVersion(e.versions,e.currentVersion);if(!a)return;e.currentVersion=a;const r=Object.assign(Object.assign({},e),{src:e.src||v(e.name,e.currentVersion,t.baseUrl),meta:e.meta||m(e.name,e.currentVersion,t.baseUrl),icon:e.icon||"",applicationKey:e.applicationKey||i||L,fetchLevel:null!==(n=e.fetchLevel)&&void 0!==n?n:this.pluginConfigData.defaultFetchLevel});if(!(0,w.Jt)(r.src)||!(0,w.Jt)(r.meta))return;const l=await this.queue.get(r.meta,{responseType:"json"}).catch((e=>{this.log.error(e)}));var d,c,u;l&&this.pluginConfigData.add({name:r.name,description:l.description,version:r.currentVersion,config:l.config||{},outputs:l.outputs||{},applicationKey:r.applicationKey||L,src:r.src,meta:r.meta,icon:(null===(s=l.options)||void 0===s?void 0:s.icon)?r.icon||(d=e.name,c=e.currentVersion,u=t.baseUrl,u+`${d}/${c}/${d}.svg`):void 0,enabled:!1,strict:this.canOverrideStrict&&null!==this.pluginConfigData.defaultStrict?this.pluginConfigData.defaultStrict:r.sesStrict,fetchLevel:null!==(o=r.fetchLevel)&&void 0!==o?o:this.pluginConfigData.defaultFetchLevel,options:l.options,peerDependencies:l.peerDependencies})}findLatestPermittedVersion(e,t){const i=Object.keys(e).sort(((e,t)=>E.h.compare(t,e)));for(const n of i){const i=e[n].requiredPolicies;if(!E.h.gt(n,t)&&this.hasRequiredPolicies(i))return n}return null}hasRequiredPolicies(e){if(!e||0===e.length)return!0;const t=this._config.pluginPolicies.groups||[],i=e=>-1===e.indexOf(".")?-1!==t.indexOf(e):this._policyData.hasPolicy(e);return e.reduce(((e,t)=>{if(!e)return e;if(t instanceof Object){if("or"===t.operator)return t.policies.some((e=>i(e)));if("xor"===t.operator){let e=0;return t.policies.forEach((t=>{e+=i(t)?1:0})),1===e}return this.log.warn(`unrecognized required policy entry, operator: <${t.operator}> - plugin disabled`),!1}return i(t)}),!0)}checkMLSMode(e,t,i,n){var s;if(e){if(!t.meta)return this.log.warn(`MLS mode requires plugin meta. Plugin meta URL missing from plugin "${null==n?void 0:n.id}"`),!1;if(!(null===(s=null==i?void 0:i.options)||void 0===s?void 0:s.mlsEnabled))return this.log.info(`Plugin "${null==n?void 0:n.id}" not allowed in MLS mode.`),!1}return!0}checkEditOnly(e,t,i){var n;return!(null===(n=null==t?void 0:t.options)||void 0===n?void 0:n.editOnly)||e===s.lg.WORKSHOP||(this.log.info(`Plugin "${null==i?void 0:i.id}" is edit-only and cannot be loaded in Showcase.`),!1)}updatePatchInProduction(e){var t;const i=y(e),n=this._manifest.find((t=>t.name===e.id));if(i&&n){const s=this.getAutoUpgradedVersion(i,n);null!==s&&s!==i&&(this.log.debugInfo(`Replacing ${n.name} version ${i} with version ${s}`),e.src=e.src.replace(i,s),e.meta=null===(t=e.meta)||void 0===t?void 0:t.replace(i,s))}else this.log.debugInfo(`Missing config version or manifest entry for ${e.id}. Not auto-updating patch for this plugin.`)}async getConfiguredPlugins(e){const t=await this.currentStore.read()||[],i=[],n=(0,P.P3)("mls",0);return t.forEach((t=>{var s,o,a,l;if(t.enabled){const d=this.pluginConfigData.availablePlugins.get(t.id);let c=!(d&&(!d||void 0!==d.strict))||d.strict;if(!d)return this.log.warn(`"${t.id}" plugin not found in current plugin manifest -- was it configured with a different one?`),void this.log.warn(`Unrecognized plugin disallowed "${null==t?void 0:t.id}" cannot load from ${null==t?void 0:t.src}`);const u={config:t.config||{},src:t.src||d.src,meta:t.meta||d.meta,id:t.id||d.name,strict:c,applicationKey:null==d?void 0:d.applicationKey,fetchLevel:null!==(s=null==d?void 0:d.fetchLevel)&&void 0!==s?s:r.D.None,peerDependencies:null!==(o=null==d?void 0:d.peerDependencies)&&void 0!==o?o:{}};if(!this.checkMLSMode(n,u,d,t))return;if(!this.checkEditOnly(e,d,t))return;this.updatePatchInProduction(u),u.canPlaceInGrid=(null===(a=null==d?void 0:d.options)||void 0===a?void 0:a.canPlaceInGrid)||!1,u.hideViewToggle=(null===(l=null==d?void 0:d.options)||void 0===l?void 0:l.hideViewToggle)||!1,i.push(u)}})),this.log.debugWarn(`Readied configuration data for ${i.length} plugin(s).`),this.log.debugInfo(JSON.stringify(i,void 0,2)),i}}},31809:(e,t,i)=>{i.d(t,{kR:()=>f,nT:()=>h});var n=i(84710),s=i(56413),o=i(10843),a=i(43591),r=i(65746),l=i(64491),d=i(96540),c=i(40961);const u=new o.Ay("plugin-ui-data");var h;!function(e){e.OVERLAY="overlay",e.TAG_PANEL="tag-panel",e.TAG_HEADER="tag-header",e.TAG_OVERLAY="tag-overlay"}(h||(h={}));function g(e,t){return(0,d.createElement)("span",{className:e+"-slot-wrapper",ref:e=>null==e?void 0:e.appendChild(t),key:e})}class p{constructor(e,t="closed",i=document.createElement("div"),n=g(e,i),s=null){this.slotType=e,this.shadowRootMode=t,this.rawNode=i,this.reactNode=n,this.shadowRoot=s}getOrCreateShadowRoot(){return this.shadowRoot||(this.shadowRoot=this.rawNode.attachShadow({mode:this.shadowRootMode})),this.shadowRoot}hasShadowRoot(){return!!this.shadowRoot}clear(){return(0,c.unmountComponentAtNode)(this.rawNode),this.rawNode.remove(),this.rawNode=document.createElement("div"),this.shadowRoot=null,this.reactNode=g(this.slotType,this.rawNode),this}}class f extends n.B{constructor(e,t="closed"){var i;super(),this.parentMainDiv=e,this.shadowRootMode=t,this.name="plugin-ui-data",this.separator="Â¦",this.overlayRoot=document.createElement("div"),this.testSet=new Set,this.overlayRootAppended=!1,this.pluginOverlayElements=new s.E,this.pluginEmbeddedElements={[h.TAG_OVERLAY]:{},[h.TAG_PANEL]:{},[h.TAG_HEADER]:{},[h.OVERLAY]:{}},this.subs=[],this.mobile=(0,l.Fr)(),this.watchedElement=null!==(i=this.parentMainDiv.getElementsByTagName("canvas")[0])&&void 0!==i?i:this.parentMainDiv,this.initOverlayRoot=()=>{this.overlayRootAppended||(this.parentMainDiv.appendChild(this.overlayRoot),this.overlayRootAppended=!0,this.grid=r.dn.init({column:16,margin:0,float:!0,animate:!1,row:16,alwaysShowResizeHandle:!0,resizable:{handles:"se, sw"},children:[{x:0,y:0,w:4,h:2,locked:!0,noMove:!0,noResize:!0}]},this.overlayRoot),this.resizeObserver=new a.A(this.resizeHandler),this.resizeObserver.observe(this.watchedElement))},u.debug("PluginUIData loaded"),this.overlayRoot.classList.add("plugin-root-element","grid-stack"),this.initOverlayListeners(),this.resizeHandler=this.handleResize.bind(this)}getEmbeddable(e){const t=this.pluginEmbeddedElements[e];return Object.values(t).filter((e=>e.hasShadowRoot())).map((e=>e.reactNode))}handleResize(e=[]){if(!e.length)return;const t=Math.floor(this.overlayRoot.clientHeight/16);this.grid.cellHeight(t),this.overlayRoot.style.width=`${this.watchedElement.clientWidth}px`}registerOverlay(e,t,i){this.pluginOverlayElements.set(e,t),i&&(this.grid?this.grid.addWidget(t):u.warn("tried to register an overlay, but gridstack not initialized yet"))}createEmbeddedUi(e,t){return this.pluginEmbeddedElements[t][e]=new p(t,this.shadowRootMode)}getOrCreateEmbeddedUi(e,t,i){let n=this.pluginEmbeddedElements[t][e];return n||(n=this.createEmbeddedUi(e,t)),n.rawNode.classList.add(e),i||n.rawNode.classList.add("constrain-height"),n}createOverlay(e,t=!1){const i=document.createElement("div");return i.classList.add("plugin-overlay"),i.classList.add(e),t&&(i.classList.add("grid-stack-item"),i.setAttribute("gs-min-w",this.mobile?"2":"1"),i.setAttribute("gs-min-h",this.mobile?"2":"1")),this.registerOverlay(e,i,t),i}replaceOrCreateOverlay(e,t){let i=this.pluginOverlayElements.get(e);if(i&&(i.remove(),this.grid?this.grid.removeWidget(i):u.warn("[replaceOrCreate] tried to remove an overlay, but gridstack not initialized yet")),i=this.createOverlay(e,t),t){const e=document.createElement("span");return e.classList.add("grid-stack-item-content"),i.appendChild(e),e}return i}createRoots(e,t){return{[h.OVERLAY]:this.createOverlayRoot(e,t),[h.TAG_PANEL]:this.createRoot(e,h.TAG_PANEL),[h.TAG_HEADER]:this.createRoot(e,h.TAG_HEADER),[h.TAG_OVERLAY]:this.createRoot(e,h.TAG_OVERLAY,{expandOverlay:!0})}}createRoot(e,t,{expandOverlay:i=!1}={}){return this.getOrCreateEmbeddedUi(e,t,i)}createOverlayRoot(e,t){const i=this.replaceOrCreateOverlay(e,t.canPlaceInGrid);return new p(h.OVERLAY,this.shadowRootMode,i)}initOverlayListeners(){u.info("init plugin UI overlay"),this.subs.push(this.pluginOverlayElements.onElementChanged({onAdded:(e,t)=>{u.debug("added plugin overlay",t),this.initOverlayRoot(),e&&this.overlayRoot.appendChild(e)},onRemoved:(e,t)=>{u.debug("removed plugin overlay",t),e&&e.remove()}}))}disposeByKey(e){this.pluginOverlayElements.delete(e),Object.values(this.pluginEmbeddedElements).forEach((t=>{var i;null===(i=t[e])||void 0===i||i.clear()}))}dispose(){this.pluginOverlayElements.forEach(((e,t)=>{this.disposeByKey(t)})),this.subs.forEach((e=>e.cancel())),this.subs=[],this.grid.destroy(),this.resizeObserver.disconnect(),this.overlayRootAppended=!1,this.overlayRoot.remove()}}},31841:(e,t,i)=>{i.r(t),i.d(t,{PluginUIData:()=>n.kR,SlotType:()=>n.nT,default:()=>r,usePluginUI:()=>d,usePluginUiData:()=>l});var n=i(31809),s=i(75578),o=i(49953),a=i(78671);class r extends s.n{constructor(){super(...arguments),this.name="plugin-ui"}async init(e,t){this.engine=t,[this.policyData]=await Promise.all([t.market.waitForData(o.L)]);const i=this.policyData.hasPolicy(a.I)?"open":"closed";this.pluginUiData=new n.kR(e.mainDiv,i),this.engine.market.register(n.kR,this.pluginUiData)}dispose(e){this.pluginUiData.dispose(),this.engine.market.unregister(n.kR),super.dispose(e)}}const l=(0,i(50200).v)(n.kR),d=e=>{const t=l();return(null==t?void 0:t.getEmbeddable(e))||[]}},85846:(e,t,i)=>{i.d(t,{xO:()=>l});var n,s=i(48539),o=i(50380);!function(e){e.GET="GET",e.POST="POST",e.PATCH="PATCH",e.PUT="PUT",e.DELETE="DELETE",e.OPTIONS="OPTIONS"}(n||(n={}));class a{constructor(){this._options={responseType:"json"}}get options(){const e=this._options;return e.headers=(0,o.v)(this.url,this._options.headers||{}),e}}class r extends a{constructor(e){super(),this.config=e,this.url=e.path}async read(){const{deserialize:e}=this.config;let t=null;return this.config.cachedData&&this.config.cachedData.data?t=this.config.cachedData.data:(t=await this.config.queue.get(this.config.path,this.options),this.config.cachedData&&(this.config.cachedData.data=t)),e(t)}clearCache(){this.config.cachedData&&(this.config.cachedData.data=null)}}class l extends r{constructor(e){super(e),this.config=e,this.acceptsPartial=!1,this.config.batchUpdate="batchUpdate"in this.config&&this.config.batchUpdate}async create(e){throw Error("Not implemented")}updateBatch(e,t){const{serialize:i}=this.config,s=[],o=[...new Set([...Object.keys(e),...Object.keys(t)])];for(const i of o){e[i]||t[i]||s.push(this.config.queue.delete(`${this.config.path}/${i}`,this.options))}const a=i(e,t),r=Object.assign(Object.assign({},this.options),{body:a});return s.push(this.config.queue.request(this.config.httpMethod||n.POST,this.config.path,r)),Promise.all(s)}updateInternal(e,t){const{serialize:i}=this.config,o=[],a=Object.assign({},this.options),r=Object.keys(e),l=Object.keys(t),d=(0,s.ij)(r.concat(l));for(const s in d){const r=d[s],l=e[r]||t[r];if(l){const e={};e[r]=l;const s={},d=t[r];d&&(s[r]=d);const c=i(e,s);a.body=c,o.push(this.config.queue.request(this.config.httpMethod||n.POST,this.config.path,a))}else o.push(this.config.queue.delete(`${this.config.path}/${r}`,this.options))}return Promise.all(o)}async update(e,t){this.clearCache(),await(this.config.batchUpdate?this.updateBatch(e,t||{}):this.updateInternal(e,t||{}))}async delete(e){throw Error("Not implemented")}}},83375:(e,t,i)=>{var n;i.d(t,{h:()=>n}),function(e){function t(e){return e.split(".").reduce(((e,t)=>{const i=parseInt(t,10);return isNaN(i)||e.push(i),e}),[])}function i(e,i){const n=t(e),s=t(i);for(let e=0;e<n.length;e++){if(e>=s.length)return 1;if(n[e]!==s[e])return n[e]>s[e]?1:-1}return s.length>n.length?-1:0}e.parse=t,e.gt=function(e,t){return 1===i(e,t)},e.gte=function(e,t){const n=i(e,t);return 0===n||1===n},e.lt=function(e,t){return-1===i(e,t)},e.eq=function(e,t){return 0===i(e,t)},e.compare=i}(n||(n={}))}}]);