/*! For license information please see menus.2f0a2f7d263964aa547d.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[745],{50857:(e,t,i)=>{i.r(t),i.d(t,{NavigationVisuals:()=>g,default:()=>y,visDollhouseNavigation:()=>w,visPanoNavigation:()=>m});var o=i(6539),n=i(45832),s=i(82240),r=i(86866),a=i(52026),h=i(65882),c=i(20599),l=i(5243),u=i(62372),p=i(99583),d=i(25316);class g{constructor(e,t,i){this.engine=e,this.dynamicNumber=t,this.smoothWalk=i,this.active=!1,this.draw=new s.U,Promise.all([this.engine.getModuleBySymbol(n.M7),this.engine.market.waitForData(l.$),this.engine.getModuleBySymbol(n.PM),this.engine.market.waitForData(d.o)]).then((([e,t,i,o])=>{var n;this.meshQuery=i,this.draw.setStyle({assetBasePath:null!==(n=o.getProperty("assetBasePath"))&&void 0!==n?n:""}),this.draw.addToScene(e.getScene()),this.subscription=t.onChanged((()=>this.update(this.draw,t))),this.subscription.cancel()})),this.engine.getModuleBySymbol(o.ZF).then((e=>{const t="Navigation";[{header:t,setting:"navDebugEnabled",initialValue:()=>this.active,onChange:e=>this.toggle(e),urlParam:!0},{header:t,setting:"Max transition dist",initialValue:()=>h.U.longerTransitionMaxDist,range:[3,50],rangePrecision:1,onChange:e=>h.U.longerTransitionMaxDist=e},{header:t,setting:"accel",initialValue:()=>this.dynamicNumber.acceleration,range:[1,60],rangePrecision:.5,onChange:e=>{this.dynamicNumber.setAccel(e)}},{header:t,setting:"top speed",initialValue:()=>this.dynamicNumber.maxSpeed,range:[1,40],rangePrecision:.5,onChange:e=>this.dynamicNumber.setMaxSpeed(e)},{header:t,setting:"queue ms",initialValue:()=>this.smoothWalk.repeatedQueueDelayMS,range:[0,1e3],onChange:e=>this.smoothWalk.repeatedQueueDelayMS=e}].forEach((t=>e.registerMenuEntry(t)))}))}toggle(e){this.active!==e&&(e||this.draw.toggleAll(!1),e||this.subscription.cancel(),e&&this.subscription.renew(),this.active=e)}update(e,t){const i=this.engine.market.tryGetData(u.A),o=this.engine.market.tryGetData(c.M),n=this.engine.market.tryGetData(p.X);e&&i&&o&&n&&(e.toggleAll(!1),t.hit&&this.meshQuery.floorIdFromObject(t.hit.object)&&(n.isInside()?m(e,i,o,t.hit.intersection):w(e,i,t.hit.intersection,this.meshQuery)))}}const m=(e,t,i,o)=>{let n=0;const s=o.point.clone().sub(i.pose.position),h=(0,a.LX)(t,s),c=Math.max(...h.map((e=>e.score))),l=c-5;for(const{sweep:t,score:i}of h)if(t){const s=0===n?"cyan":"orange",a=(0,r.m9)(i,l,c,0,.6);e.line("panosphere"+n++,s).toggle(!0).updatePositions(o.point,t.position).opacity(a);const h=(0,r.m9)(a,0,.6,0,.1);e.sphere("panosphere"+n++,{color:s,opacity:.8}).toggle(!0).update(t.position,h)}},w=(e,t,i,o)=>{let n=0;const s=(0,a.I9)(t,!1,i,o),h=Math.max(...s.map((e=>e.score))),c=h-15;for(const{sweep:t,score:o}of s)if(t){const s=0===n?"cyan":"orange",a=(0,r.m9)(o,c,h,0,1);e.line("panosphere"+n++,s).toggle(!0).updatePositions(i.point,t.position).opacity(a);const l=(0,r.m9)(a,0,1,0,.3);e.sphere("panosphere"+n++,{color:s}).toggle(!0).update(t.position,l)}};function y(e){e.getModuleBySymbol(n.Kv).then((t=>{const i=t.navigationWalk,o=i.positionTracker;new g(e,o,i)}))}},46317:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var o=i(84440),n=i(10843),s=i(6539),r=i(45832);const a=new n.Ay("raycaster-debug");class h{constructor(e){Promise.all([e.getModuleBySymbol(s.ZF),e.getModuleBySymbol(r.M7),e.getModuleBySymbol(r.sA)]).then((([e,t,i])=>{const n=t.getScene(),s=[];let r=!1;const h=()=>{s&&s.forEach((e=>{e.geometry.dispose(),e.material.dispose(),n.remove(e)}))},c=(e,t,r)=>{a.info("draw",{from:e,to:t,faces:r});const h=i.getOctree().getDebugBoundsMesh((0,o.Mq)().getHex(),e,t,r);h.frustumCulled=!1,h.updateMatrixWorld(!0),n.add(h),s.push(h)};e.registerMenuButton({header:"Raycaster",buttonName:"Add Octree Level Buttons",callback:()=>{if(!r){for(let t=0;t<=i.getOctree().depth;t++)e.registerMenuButton({header:"Octree Levels",buttonName:`Anything on Level: ${t}`,callback:()=>{h(),c(t,t,!1)}});for(let t=0;t<=i.getOctree().depth;t++)e.registerMenuButton({header:"Octree Faces",buttonName:`Faces on Level: ${t}`,callback:()=>{h(),c(t,t,!0)}});r=!0}}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - All",callback:()=>{h();for(let e=0;e<=i.getOctree().depth;e++)c(e,e,!1)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - Faces",callback:()=>{h();for(let e=0;e<=i.getOctree().depth;e++)c(e,e,!0)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Clear Octree Visuals",callback:h})}))}}function c(e){new h(e)}},12655:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});var o=i(6539),n=i(45832),s=i(68909),r=i(82240),a=i(86866),h=i(30443),c=i(81662),l=i(20599),u=i(5243),p=i(3694),d=i(38069);const g=new(i(10843).Ay)("raycaster-debug");var m;!function(e){e.normal="normal",e.hitClass="hitClass",e.hitBounds="hitBounds"}(m||(m={}));const w={color:"yellow"};class y{get draw(){return this._draw||(this._draw=new r.U({background:!1,color:d.V.RED.clone()}),this.engine.getModuleBySymbol(n.M7).then((e=>this._draw.addToScene(e.getScene())))),this._draw}constructor(e){this.engine=e,this.cached={v1:new s.Vector3,v2:new s.Vector3,quat:new s.Quaternion},this.showClass=!1,this.showName=!0,this.showNormal=!1,this.showBounds=!1,this.drawRaycastHitNormal=e=>{const t=this.draw.line(m.normal,"red",4);e&&t.updatePositions(e.point,this.cached.v1.copy(e.point).addScaledVector(e.normal,.2)),t.toggle(null!==e)},this.drawRaycastObjectInfo=(e,t,i,o)=>{const n=this.draw.label(m.hitClass,"X",this.cached.v1,1);if(n.visible=!1,e&&t&&(i||o)){const{position:s,rotation:r}=t.pose,{point:h,object:l}=e,u=i?l.__proto__.constructor.name:"",p=o?""!==l.name?l.name:l.id:"";n.text=`${u} - ${p}`,n.setPosition(h,(e=>t.isOrtho()?e.addScaledVector(c.B1.UP,10):(0,a.jS)(s,e,1,e))),n.scaleBillboard(s,r,t.pose.projection,t.zoom(),t.height,t.aspect(),.1),n.setOrientation(r),n.visible=!0}},this.drawRaycastHitBounds=e=>{const t=this.draw.boxWire(m.hitBounds,w).toggle(!1);if(e&&e.object&&!(e.object instanceof p.W)&&e.object instanceof s.Mesh){const i=(0,h.UX)(e.object.geometry),o=i.getCenter(this.cached.v1).applyMatrix4(e.object.matrixWorld),n=i.getSize(this.cached.v2).multiply(e.object.scale).multiplyScalar(.5);t.mesh.quaternion.copy(e.object.quaternion),t.toggle(!0).update(o,n)}},this.onPointerDown=()=>{const e=this.data.hit;e&&e.object&&g.warn(e.object,e)},Promise.all([e.getModuleBySymbol(o.ZF),e.market.waitForData(u.$)]).then((([e,t])=>{this.data=t;const i=t.onChanged((()=>this.update(t)));i.cancel();const o=e=>{e?(window.addEventListener("pointerdown",this.onPointerDown),i.renew()):(window.removeEventListener("pointerdown",this.onPointerDown),i.cancel(),this.draw.toggleAll(!1))};e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitDebugging",initialValue:()=>!1,onChange:e=>{o(e)},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitClass",initialValue:()=>this.showClass,onChange:e=>{this.showClass=e},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitName",initialValue:()=>this.showName,onChange:e=>{this.showName=e},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitNormal",initialValue:()=>this.showNormal,onChange:e=>{this.showNormal=e},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitBounds",initialValue:()=>this.showBounds,onChange:e=>{this.showBounds=e},urlParam:!0})}))}update(e){const t=this.engine.market.tryGetData(l.M);this.showNormal&&this.drawRaycastHitNormal(e.hit),this.showBounds&&this.drawRaycastHitBounds(e.hit),this.drawRaycastObjectInfo(e.hit,t,this.showClass,this.showName)}}function f(e){new y(e)}},9831:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var o=i(6539),n=i(45832),s=i(68909),r=i(52947),a=i(43543),h=i(32484);const{TILEDMESH_SETTINGS:c}=h.yJ,l="Snapping";async function u(e){const[t,i,h]=await Promise.all([e.getModuleBySymbol(o.ZF),await e.getModuleBySymbol(n.sA),e.getModuleBySymbol(n.M7)]),u=i.snapping,p=h.getScene().scene;t.registerMenuEntry({header:l,setting:"snappingMaxLOD",initialValue:()=>c.snappingMaxLOD,onChange:e=>{c.snappingMaxLOD=e},urlParam:!0,rangePrecision:0,range:[0,3]}),function(e,t,i){const o=new s.BufferGeometry,n=new s.LineSegments(o,new s.LineBasicMaterial({vertexColors:!0}));n.frustumCulled=!1;const a=new s.SphereGeometry(.02,5,5);let h;const c=[16711680,65280,255,16777215],u=new s.Color,p=(new s.Matrix4).identity(),d=new s.Group;let g;function m(){const e=[],i=[],l=[],g=[];t.forEachSnapFeature((t=>{var o,n,s;if(u.setHex(c[(null===(s=null===(n=null===(o=t.meta)||void 0===o?void 0:o.tile)||void 0===n?void 0:n.extras)||void 0===s?void 0:s.level)||0]),t instanceof r.cF){const{start:o,end:n}=t;e.push(o.x,o.y,o.z,n.x,n.y,n.z),i.push(u.r,u.g,u.b,u.r,u.g,u.b)}else t instanceof r.F7&&(l.push(t.x,t.y,t.z),g.push(u.r,u.g,u.b))}),!0),o.dispose(),o.setAttribute("position",new s.Float32BufferAttribute(e,3)),o.setAttribute("color",new s.Float32BufferAttribute(i,3)),h&&3*h.count===l.length||(h&&(d.remove(h),null==h||h.dispose()),h=new s.InstancedMesh(a,new s.MeshBasicMaterial,l.length/3));for(let e=0;e<l.length;e+=3)h.setMatrixAt(e/3,p.setPosition(l[e],l[e+1],l[e+2])),h.setColorAt(e/3,u.setRGB(g[e],g[e+1],g[e+2]));d.add(n,h)}e.registerMenuEntry({header:l,setting:"Show Snapping Features",initialValue:()=>!1,onChange(e){e?(i.add(d),g=setInterval(m,300)):(null==h||h.dispose(),a.dispose(),o.dispose(),i.remove(d),clearInterval(g))}})}(t,u,p),function(e,t,i,o){const n=[];let r,h;function c(){h||(h=new s.Mesh(new s.BufferGeometry,new s.MeshBasicMaterial({vertexColors:!0})),h.frustumCulled=!1,i.add(h));const e=[],t=[];for(const i of n){let o=0;for(const n of i.surfaces){const i=n.area>.1,s=Math.sin(o++)/2+.5,r=i?0:.2+.8*s,a=i?.2+.8*s:0,h=0;for(const i of n.faces){const o=i.va.vector,n=i.vb.vector,s=i.vc.vector;e.push(o.x,o.y,o.z),e.push(n.x,n.y,n.z),e.push(s.x,s.y,s.z),t.push(r,a,h,r,a,h,r,a,h)}}}h.geometry.dispose(),h.geometry.setAttribute("position",new s.Float32BufferAttribute(e,3)),h.geometry.setAttribute("color",new s.Float32BufferAttribute(t,3))}function u(e){n.push(e.edgeFinder)}[{header:l,setting:"Collect Snapping Surfaces",initialValue:()=>!1,onChange(e){e?o.subscribe(a.X,u):(o.unsubscribe(a.X,u),n.length=0)}},{header:"Snapping",setting:"Show Snapping Surfaces",initialValue:()=>!1,onChange(e){clearInterval(r),e?r=setInterval((()=>{t.preloadMeshSnapping(),c()}),1e3):h&&(h.geometry.dispose(),i.remove(h),h=null)}}].forEach((t=>e.registerMenuEntry(t)))}(t,u,p,e)}},2942:(e,t,i)=>{i.r(t),i.d(t,{PanoPreloadVisualizer:()=>x,default:()=>M});var o=i(10843),n=i(6539),s=i(45832),r=i(82240),a=i(23870),h=i(20599),c=i(5243),l=i(62372),u=i(99583),p=i(50018),d=i(68909),g=i(81662),m=i(9997),w=i(68062),y=i(13893),f=i(38069);const b=new o.Ay("previs");class x{constructor(e,t,i){this.engine=e,this.downloadDescriptorGetter=t,this.prioritizer=i,this.allPreloadedSweeps=new Set,this.active=!1,this.freezeCameraRotation=!1,this.sweepIndex=50,this.useCurrentCriteria=!0,this.showPreloadIds=!0,this.visualTour=!1,this.showSweepLabels=!1,this.draw=new r.U,this.engine.getModuleBySymbol(s.M7).then((e=>this.draw.addToScene(e.getScene()))),this.engine.market.waitForData(c.$).then((e=>{this.subscription=e.onChanged((()=>this.update(this.draw))),this.subscription.cancel()}));const o=this.engine.market.tryGetData(l.A);if(o){this.sweepData=o;const e=o.getSweepList(),t=new a.A((e=>e.id));for(let i of e)i.isObservableProxy&&(i=new p.Ay({platformId:i.platformId}).copy(i)),t.add(i);this.sweepMap=t}this.engine.getModuleBySymbol(n.ZF).then((e=>{const t="Pano Preload",i=[{header:t,setting:"ShowVis",initialValue:()=>this.active,onChange:e=>this.toggle(e)},{header:t,setting:"Use Camera",initialValue:()=>this.useCurrentCriteria,onChange:e=>{this.useCurrentCriteria=e,this.update(this.draw)}},{header:t,setting:"Freeze Rotation",initialValue:()=>this.freezeCameraRotation,onChange:e=>{this.freezeCameraRotation=e,this.update(this.draw)}},{header:t,setting:"Show preload ids",initialValue:()=>this.showPreloadIds,onChange:e=>{this.showPreloadIds=e,this.update(this.draw)}},{header:t,setting:"Visual tour",initialValue:()=>this.visualTour,onChange:e=>{this.visualTour=e,this.update(this.draw)}},{header:t,setting:"Pano labels",initialValue:()=>this.showSweepLabels,onChange:e=>{this.showSweepLabels=e,this.update(this.draw)}},{header:t,setting:"Override Sweep",initialValue:()=>0,onChange:e=>this.updateSweepIndex(e),range:[0,this.sweepMap.count()]}];e.registerMenuButton({header:"Pano Preload tour",buttonName:"Tour",callback:()=>{this.activateTourMode()}}),i.forEach((t=>e.registerMenuEntry(t)))}))}updateSweepIndex(e){const t=Math.round(e);this.sweepIndex=t,this.update(this.draw)}toggle(e){this.active!==e&&(e&&this.subscription.renew(),e||(this.subscription.cancel(),this.draw.toggleAll(!1)),this.active=e)}update(e){const t=this.engine.market.tryGetData(l.A),i=this.engine.market.tryGetData(h.M),o=this.engine.market.tryGetData(u.X);if(!(e&&t&&i&&o))return;if(!this.active||!this.sweepMap)return;if(this.tourMode&&!this.visualTour)return;const n=t.getSweepList(),s=this.useCurrentCriteria?this.prioritizer.priorityCriteria:this.criteria;if(this.useCurrentCriteria){if(this.freezeCameraRotation){if(!s.sweep)return;s.set({position:s.sweep.position,rotation:this.lastCriteria.rotation,direction:g.B1.FORWARD.clone().applyQuaternion(this.lastCriteria.rotation)})}}else if(s.set({sweep:this.sweepData.getSweepByIndex(this.sweepIndex)||null}),!this.freezeCameraRotation){if(!s.sweep)return;s.set({position:s.sweep.position,rotation:i.pose.rotation,direction:g.B1.FORWARD.clone().applyQuaternion(i.pose.rotation)})}if(this.lastCriteria=s.clone(),!s.sweep)return;this.tourMode||this.wipePreloadedData();const r=[];this.prioritizer.priorityCriteria=s,this.prioritizer.filterAndPrioritize(r,this.downloadDescriptorGetter);const a=new Set;let c="";for(const e of r)e&&e.sweep&&(a.has(e.sweep.id)||(a.add(e.sweep.id),c+=`${e.sweep.index}, `),this.allPreloadedSweeps.has(e.sweep.id)||this.allPreloadedSweeps.add(e.sweep.id));const p=new d.Vector3(0,0,-1.5).applyQuaternion(i.pose.rotation),m=(new d.Vector3).copy(i.pose.position).add(p),w=`Current Pano: ${s.sweep.index}\n    ${this.showPreloadIds?`Panos: ${c}`:""}\n    Preload Count (this pano): ${a.size}\n    Total Preloaded: ${this.allPreloadedSweeps.size}`,y=e.label("infoLabel",w,m,.1);if(y.lookAt(i.pose.position),y.setPosition(m),y.text=w,this.drawSweepSpheres(a,s),this.showSweepLabels)for(const t of n){const o=`${t.index}`,n=e.label(t.id,o,t.position,.1);n.text=o,n.setColor(f.V.RED),n.lookAt(i.pose.position)}}drawSweepSpheres(e,t){const i=t.sweep;if(!i)return;this.draw.toggleAll(!1);const o=(new d.Vector3).copy(i.position);o.y+=-.5;for(const t of e){const e=this.sweepData.getSweep(t),n=i===e,s=n?"green":"white",r=(new d.Vector3).copy(e.position);if(r.y+=-.5,this.draw.sphere(e.id+"sphere"+(n&&"source"),{color:s,opacity:1}).update(r,.2).toggle(!0),!n){const t=this.draw.line(`${e.id}-${i.id}`,new d.Color("white"),.05);t.updatePositions(r,o),t.toggle(!0)}}}activateTourMode(){this.tourMode=!0;const e={},t=Math.round(this.sweepIndex),i=this.sweepData.getSweepByIndex(t);i&&this.engine.commandBinder.issueCommand(new m.aj({sweep:i.id})).then((()=>{this.wipePreloadedData(),this.allPreloadedSweeps.clear();const t=this.sweepData.getSweepList(),o=Math.round(.05*t.length);i&&this.tourStep(i,e,o)}))}tourStep(e,t,i,o=0,n=""){const s=e,r=this.sweepData.getSweepList();let a=e;if(!s||s.neighbours.length<=0)return;t[s.id]=!0,n+=`Sweep: ${s.index} Loaded: ${this.allPreloadedSweeps.size}\n`;let h=0;for(;h<r.length;){const e=(s.index+1+h)%r.length,i=this.sweepData.getSweepByIndex(e);if(h++,i&&(a=i,!t[a.id]&&a.id!==s.id&&a))break}if(++o<=i)if(this.visualTour)this.engine.commandBinder.issueCommand(new m.aj({sweep:s.id,rotation:(0,w.kf)(s.position,a.position),transition:y.fl.Interpolate})).then((()=>{setTimeout((()=>{this.tourStep(a,t,i,o,n)}),500)}));else{const e=(0,w.kf)(s.position,a.position),r=(new d.Vector3).copy(g.B1.FORWARD).applyQuaternion(e),h=this.prioritizer.priorityCriteria.clone();h.set({direction:r,rotation:e,sweep:s,position:s.position});const c=[];this.prioritizer.priorityCriteria=h,this.prioritizer.filterAndPrioritize(c,this.downloadDescriptorGetter);this.queueToPanoSet(c).forEach((e=>this.allPreloadedSweeps.add(e))),this.tourStep(a,t,i,o,n)}else b.info(`TOUR END\n      Sweeps visited: ${o}\n      Visual: ${this.visualTour}\n      Sweeps preloaded: ${this.allPreloadedSweeps.size}`),b.info(`TOUR INFO\n      ${n}`),this.tourMode=!1}queueToPanoSet(e){const t=new Set;for(const i of e)i&&i.sweep&&(t.has(i.sweep.id)||t.add(i.sweep.id));return t}wipePreloadedData(){const e=this.sweepData.getSweepList();for(const t of e)this.downloadDescriptorGetter.deleteAllTileDownloadDescriptors(t.id)}}function M(e){e.getModuleBySymbol(s.qD).then((t=>{const i=t;"tileDownloader"in i&&new x(e,i.tileDownloader,i.tilePrioritizer)}))}},33796:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});var o=i(6539),n=i(45832);async function s(e){const[t,i]=await Promise.all([e.getModuleBySymbol(o.ZF),e.getModuleBySymbol(n.M7)]),s="WebGL Renderer";let r=null;function a(e){i.threeRenderer.forceContextLoss(),setTimeout((()=>{i.threeRenderer.forceContextRestore()}),e)}t.registerMenuButton({header:s,buttonName:"Lose Context for 0.1 sec",callback:()=>{a(100)}}),t.registerMenuButton({header:s,buttonName:"Lose Context for 5 sec",callback:()=>{a(5e3)}}),t.registerMenuEntry({header:s,setting:"autoLoseContext",initialValue:()=>!1,urlParam:!0,onChange(e){if(e){const e=()=>a(100);e(),r=setInterval(e,1e4)}else clearInterval(r)}})}},82240:(e,t,i)=>{i.d(t,{U:()=>v});var o=i(81662),n=i(68909);class s{constructor(e,t,i){return this.thisType=e,this.container=t,this.mesh=i(),this.mesh.name=`${e.name}`,this.material=this.mesh.material,this.geometry=this.mesh.geometry,this}opacity(e){return this.material.opacity=e,this}}function r(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{e.prototype[i]=t.prototype[i]}))}))}class a{constructor(){this.animationInit=!1}initAnimationMixin(e,t){this.animState={scale:t?t.clone():new n.Vector3(1,1,1),position:e?e.clone():new n.Vector3,target:{scale:t?t.clone():new n.Vector3(1,1,1),position:e?e.clone():new n.Vector3},temp:{pos:new n.Vector3,scale:new n.Vector3,makeScale:new n.Vector3}},this.animationInit=!0}update(e,t){if(!this.animationInit)throw Error(`${a.name} call this.initAnimationMixin() in ${this.style} constructor to enable update, because I said so.`);this.mesh.position.copy(e);const i=this.vector3From(t);return i.equals(this.mesh.scale)||this.mesh.scale.copy(i),this.animState.scale.copy(this.mesh.scale),this.animState.position.copy(this.mesh.position),this.mesh.updateMatrixWorld(!0),this}animate(e,t,i){if(!this.animationInit)throw Error(`${a.name} call this.initAnimationMixin() in ${this.style} constructor to enable animations, because I said so.`);const o=this.vector3From(i);this.animState.target.scale.copy(o),this.animState.target.position.copy(t);const n=this.animState.temp.pos.copy(this.mesh.position).lerp(t,e),s=this.animState.temp.scale.copy(this.mesh.scale).lerp(o,e);return this.update(n,s),this}vector3From(e){if(e instanceof n.Vector3)return this.animState.temp.makeScale.copy(e).clamp(c,l);if("number"==typeof e)return this.animState.temp.makeScale.set(e,e,e).clamp(c,l);throw Error("Unexpected scale input")}}const h=.01,c=new n.Vector3(h,h,h),l=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);class u{toggle(e){return e?this.container.add(this.mesh):this.container.remove(this.mesh),this.isVisible=e,this}}class p extends s{constructor(e,t){super(p,e,(()=>new n.Mesh(new n.BoxGeometry(1,1,1),new n.MeshBasicMaterial(t)))),this.container=e,this.style="Box",this.mesh.frustumCulled=!1,this.geometry.computeBoundingBox(),this.initAnimationMixin()}}r(p,[a,u]);class d extends s{constructor(e,t){super(d,e,(()=>{const e=new n.Box3Helper((new n.Box3).setFromCenterAndSize(new n.Vector3,new n.Vector3(1,1,1)));return new n.LineSegments(e.geometry,e.material)})),this.container=e,this.style="BoxWireframeMesh",t&&this.material.setValues(t),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}r(d,[u,a]);class g extends s{constructor(e,t){super(g,e,(()=>new n.CameraHelper(t))),this.container=e,this.style="CameraHelper",this.updateCamera(t)}updateCamera(e){return this.mesh.camera.copy(this.camWithSaneFarDistance(e)),this.mesh.update(),this}camWithSaneFarDistance(e){const t=e.clone();return t.far=5,t}}r(g,[u]);class m extends s{constructor(e,t){super(m,e,(()=>new n.Mesh(new n.PlaneGeometry(1),new n.MeshBasicMaterial(t)))),this.container=e,this.style="PlaneMesh",this.radius=1;const i=new n.Matrix4;i.makeRotationFromEuler(new n.Euler(-Math.PI/2,0,0,"XYZ")),this.geometry.applyMatrix4(i),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}r(m,[u,a]);class w extends s{constructor(e,t){super(w,e,(()=>new n.Mesh(new n.SphereGeometry(1),new n.MeshBasicMaterial(t)))),this.container=e,this.style="SphereMesh",this.radius=1,this.mesh.frustumCulled=!1,this.initAnimationMixin()}}r(w,[u,a]);var y=i(38069);class f extends s{constructor(e,t){return super(f,e,(()=>new n.Line(new n.BufferGeometry,new n.LineBasicMaterial(Object.assign({color:y.V.MP_BRAND,opacity:1,transparent:!0},t))))),this.container=e,this.positionsBuffer=new n.BufferAttribute(new Float32Array(150),3),this.point=new n.Vector3,this.points={start:new n.Vector3,control:new n.Vector3,end:new n.Vector3},this.updatePoints=(e,t,i)=>{this.points.start.copy(this.curve.v0.copy(e)),this.points.control.copy(this.curve.v1.copy(t)),this.points.end.copy(this.curve.v2.copy(i));for(let e=0;e<50;e++){const t=e/49;this.curve.getPoint(t,this.point),this.positionsBuffer.setXYZ(e,this.point.x,this.point.y,this.point.z)}return this.positionsBuffer.needsUpdate=!0,this},this.animatePoints=(e,t,i,o)=>{const{start:n,control:s,end:r}=this.points;return n.equals(s)&&n.equals(r)?(this.updatePoints(t,i,o),this):(n.lerp(t,e),s.lerp(i,e),r.lerp(o,e),this.updatePoints(n,s,r),this)},this.mesh.frustumCulled=!1,this.curve=new n.QuadraticBezierCurve3(new n.Vector3,new n.Vector3,new n.Vector3),this.geometry.setAttribute("position",this.positionsBuffer),this.geometry.computeBoundingBox(),this}}r(f,[u]);var b=i(52514),x=i(91994),M=i(29628);class v{constructor(e,t={}){this.cache={},this.helperCache={},this.style={},this.toggle=e=>(this.options.scene&&(e?this.options.scene.add(this.options.container):this.options.scene.remove(this.options.container)),this),this.box=(e,t)=>(this.cache[B.box][e]||(this.cache[B.box][e]=new p(this.options.container,t).toggle(!0)),this.cache[B.box][e]),this.boxWire=(e,t)=>(this.cache[B.boxWire][e]||(this.cache[B.boxWire][e]=new d(this.options.container,t).toggle(!0)),this.cache[B.boxWire][e]),this.cam=(e,t)=>(this.cache[B.cameraHelper][e]||(this.cache[B.cameraHelper][e]=new g(this.options.container,t).toggle(!0)),this.cache[B.cameraHelper][e]),this.label=(e,t,i,o=.25)=>{if(!this.labelCreator){const{color:e,backgroundColor:t,backgroundOpacity:i,background:o}=this.options;this.labelCreator=new b.Il(Object.assign({color:e,background:o,backgroundColor:t,backgroundOpacity:i,wordWrapWidth:650},this.style))}if(!this.cache[B.label][e]){const n=this.labelCreator.createLabel();this.cache[B.label][e]=n,n.position.copy(i),n.text=t,n.scaleFactor=o,this.options.container.add(n)}return this.cache[B.label][e]},this.line=(e,t=this.options.lineColor,i=this.options.linewidth)=>{if(!this.cache[B.line][e]){const n=(0,x.makeLineMaterial)(t,!1,{linewidth:i}),s={onShow:()=>this.options.container.add(...r.children),onHide:()=>this.options.container.remove(...r.children)},r=new M.e(o.B1.ZERO.clone(),o.B1.ZERO.clone(),n,s);r.updateResolution(window.innerWidth,window.innerHeight).opacity(1).toggle(!0),this.cache[B.line][e]=r}return this.cache[B.line][e]},this.plane=(e,t)=>(this.cache[B.plane][e]||(this.cache[B.plane][e]=new m(this.options.container,t).toggle(!0)),this.cache[B.plane][e]),this.setStyle=e=>{this.style=e},this.sphere=(e,t)=>(this.cache[B.sphere][e]||(this.cache[B.sphere][e]=new w(this.options.container,t).toggle(!0)),this.cache[B.sphere][e]),this.triangle=(e,t,i,o,s)=>{if(!this.cache[B.triangle][e]){const r=new Float32Array(9);t.toArray(r,0),i.toArray(r,3),o.toArray(r,6);const a=new n.BufferGeometry;a.setAttribute("position",new n.BufferAttribute(r,3));const h=new n.Mesh(a,new n.MeshBasicMaterial(s));this.options.container.add(h),this.cache[B.triangle][e]=new w(this.options.container,s).toggle(!0)}return this.cache[B.triangle][e]},this.spline=(e,t)=>(this.cache[B.spline][e]||(this.cache[B.spline][e]=new f(this.options.container,t).toggle(!0)),this.cache[B.spline][e]),this.randomColor=e=>{if(void 0!==e){if(!this.helperCache[A.color][e]){const t=new n.Color(S(),S(),S());this.helperCache[A.color][e]=t}return this.helperCache[A.color][e]}return new n.Color(S(),S(),S())},this.randomVector3=e=>{if(void 0!==e){if(!this.helperCache[A.vector3][e]){const t=new n.Vector3(2*(.5-S()),2*(.5-S()),2*(.5-S()));this.helperCache[A.vector3][e]=t}return this.helperCache[A.vector3][e]}return new n.Vector3(2*(.5-S()),2*(.5-S()),2*(.5-S()))},this.toggleAll=e=>{for(const t of Object.values(B)){const i=Object.values(this.cache[t]);for(const t of i)"toggle"in t&&t.toggle(e)}return this},this.options=Object.assign(Object.assign({},C),e),this.style=t;for(const e of Object.values(B))this.cache[e]={};for(const e of Object.values(A))this.helperCache[e]={};this.options.scene&&this.toggle(!0)}async addToScene(e){return this.options.scene=e,this.toggle(!0),this}}const S=()=>Math.random(),C={lineColor:y.V.WHITE.clone(),linewidth:2,color:y.V.WHITE.clone(),background:!0,backgroundColor:y.V.WHITE.clone(),backgroundOpacity:.5,container:new n.Group};var B,A;!function(e){e.box="box",e.boxWire="boxWire",e.label="label",e.line="line",e.plane="plane",e.sphere="sphere",e.spline="spline",e.triangle="triangle",e.cameraHelper="cameraHelper"}(B||(B={})),function(e){e.color="color",e.vector3="vector3"}(A||(A={}))},84440:(e,t,i)=>{i.d(t,{Mq:()=>a,Zd:()=>r,_o:()=>h});var o=i(68909);const n=()=>Math.random(),s={},r=(e,t=n())=>(s[t]||(s[t]=new o.Vector4(n(),n(),n(),e)),s[t]),a=()=>new o.Color(n(),n(),n()),h=e=>e instanceof Object&&"r"in e&&"g"in e&&"b"in e},30443:(e,t,i)=>{i.d(t,{U7:()=>c,UX:()=>h,Wi:()=>u,h0:()=>s,jF:()=>p,nD:()=>d});var o=i(68909),n=i(81662);function s(e){if(0===e.length)throw Error("Can't merge empty list of geometries");if(1===e.length)return e[0];let t=0,i=0,n=0,s=0;const a=new o.Box3;for(const o of e)o.index&&(t+=o.index.count,i+=o.getAttribute("position").count,o.getAttribute("uv")&&(n+=o.getAttribute("uv").count),o.boundingBox&&(a.union(o.boundingBox),s++));const c=new o.BufferGeometry;s!==e.length||a.isEmpty()?c.computeBoundingBox():c.boundingBox=a,a.copy(h(c)),c.boundingSphere=a.getBoundingSphere(new o.Sphere);const l=r(new Float32Array(3*i),"position",e);c.setAttribute("position",new o.BufferAttribute(l,3));const u=function(e,t){let i=0,o=0;for(const n of t){const t=n.index;for(let n=0;n<t.array.length;n++)e[i+n]=t.array[n]+o;i+=t.array.length,o+=n.getAttribute("position").count}return e}(new Uint32Array(t),e);if(c.setIndex(new o.BufferAttribute(u,1)),n){const t=r(new Float32Array(2*n),"uv",e);c.setAttribute("uv",new o.BufferAttribute(t,2))}return c}function r(e,t,i){let o=0;for(const n of i){const i=n.getAttribute(t);e.set(i.array,o),o+=i.array.length}return e}const a=new o.Box3(n.B1.ZERO,n.B1.UNIT);function h(e){return e.boundingBox||e.computeBoundingBox(),e.boundingBox||a}function c(e,t){let i=1/0;const n=t.clone(),s=new o.Vector3,r=new o.Vector3(1/0,1/0,1/0);let a=-1;const h=new o.Triangle;return function(e,t){var i;const o=null===(i=e.index)||void 0===i?void 0:i.array,n=e.getAttribute("position");if(!n)return;const s=e.groups.length>0?e.groups:[{start:0,count:o?o.length:n.count,materialIndex:0}];let r=0;for(const e of s)for(let i=e.start;i<e.start+e.count;i+=3){let s=i,a=i+1,h=i+2;o&&(s=o[s],a=o[a],h=o[h]),t(n.getX(s),n.getY(s),n.getZ(s),n.getX(a),n.getY(a),n.getZ(a),n.getX(h),n.getY(h),n.getZ(h),r++,e.materialIndex||0)}}(e,((e,t,o,c,l,u,p,d,g,m)=>{h.a.set(e,t,o),h.b.set(c,l,u),h.c.set(p,d,g),h.closestPointToPoint(n,s);const w=n.distanceToSquared(s);w<i&&(r.copy(s),i=w,a=m)})),{point:r,distance:Math.sqrt(i),faceIndex:a}}const l=new o.PlaneGeometry(1,1);function u(){return l}const p=(e,t)=>{t=t||[];for(let e=0;e<8;e++)t[e]=t[e]||new o.Vector3;return t[0].set(e.min.x,e.min.y,e.min.z),t[1].set(e.min.x,e.max.y,e.min.z),t[2].set(e.max.x,e.max.y,e.min.z),t[3].set(e.max.x,e.min.y,e.min.z),t[4].set(e.min.x,e.min.y,e.max.z),t[5].set(e.min.x,e.max.y,e.max.z),t[6].set(e.max.x,e.max.y,e.max.z),t[7].set(e.max.x,e.min.y,e.max.z),t},d=(()=>{const e=new o.Vector3,t=new o.Vector3;return(i,n,s)=>{n=n||new o.Box3,e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(const o of i)s&&o.applyMatrix4(s),e.x=Math.min(e.x,o.x),e.y=Math.min(e.y,o.y),e.z=Math.min(e.z,o.z),t.x=Math.max(t.x,o.x),t.y=Math.max(t.y,o.y),t.z=Math.max(t.z,o.z);return n.min.copy(e),n.max.copy(t),n}})()}}]);