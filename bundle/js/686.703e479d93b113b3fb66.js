/*! For license information please see 686.703e479d93b113b3fb66.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[686],{17986:(t,e,i)=>{i.d(e,{A:()=>s});var o=i(75578);class s extends o.n{constructor(){super(...arguments),this.name="base-controls",this.inputBindings=[]}registerActiveStateChangeBinding(){this.bindings.push(this.controls.onActiveStateChanged((()=>this.onActiveStateChanged())))}updateInputBindings(){this.controls.isActive?this.inputBindings.forEach((t=>t.renew())):this.inputBindings.forEach((t=>t.cancel()))}onActiveStateChanged(){this.controls.stop(),this.updateInputBindings()}dispose(t){super.dispose(t);for(const t of this.inputBindings)t.cancel();this.inputBindings=[]}}},4994:(t,e,i)=>{i.d(e,{A:()=>s});var o=i(95330);class s{constructor(){this.poseControllerObservable=(0,o.p)(null)}rotateBetweenOrientations(t,e,i,o,s){return console.warn("rotateBetweenOrientations(): not implemented"),Promise.resolve()}get poseController(){return this.poseControllerObservable.value}setController(t){return this.poseControllerObservable.value=t,this}get isActive(){return null!=this.poseController}onActiveStateChanged(t){return this.poseControllerObservable.onChanged(t)}}},71188:(t,e,i)=>{i.d(e,{w:()=>s});var o=i(12103);function s(t){return t.width<=o._8}},35457:(t,e,i)=>{i.d(e,{P:()=>s});var o=i(55141);class s extends o.u{constructor(t,e,i){super(),this.payload={enabled:t,previewCirclePosition:e,size:i}}}s.id="MESH_PREVIEW_POSITION"},11680:(t,e,i)=>{i.d(e,{w:()=>n});var o=i(55141),s=i(32502);class n extends o.u{constructor(t){super(),this.payload={mode:t}}}n.modes=s.f,n.id="SET_CHUNK_RENDER_MODE"},35699:(t,e,i)=>{i.d(e,{X:()=>s});var o=i(55141);class s extends o.u{constructor(t=null){super(),this.payload={cursor:t}}}s.id="SET_MOUSE_CURSOR"},77510:(t,e,i)=>{var o;i.d(e,{b:()=>o}),function(t){t.NONE="none",t.DEFAULT="default",t.MOVE="move",t.MOVE_LF="col-resize",t.MOVE_UD="row-resize",t.XHAIR="crosshair",t.PLUS="cell",t.QUESTION="help",t.NOPE="not-allowed",t.FINGER="pointer",t.TEXT="text",t.TEXT_VERT="vertical-text",t.ZOOM_IN="zoom-in",t.ZOOM_OUT="zoom-in",t.GRAB="grab",t.GRABBING="grabbing",t.ARROW_R="e-resize",t.ARROW_L="w-resize",t.ARROW_U="n-resize",t.ARROW_D="s-resize",t.ARROW_UR="ne-resize",t.ARROW_UL="nw-resize",t.ARROW_DR="se-resize",t.ARROW_DL="sw-resize",t.ARROW_LR="ew-resize",t.ARROW_UD="ns-resize",t.ARROW_URDL="nesw-resize",t.ARROW_ULDR="nwse-resize",t.ROOMBOUNDS_DEFAULT="rbe-default",t.ROOMBOUNDS_MOVING="rbe-moving",t.ROOMBOUNDS_PLACE_NODE="rbe-place-node",t.ROOMBOUNDS_FINISH_ROOM="rbe-finish-room"}(o||(o={}))},73065:(t,e,i)=>{i.d(e,{V$:()=>l,g1:()=>a,ol:()=>r,qD:()=>s,vc:()=>n});var o=i(53172);const s=1e3/60,n=(0,o.pu)(70),r=-n,a=.05,l=.1/60},40742:(t,e,i)=>{i.r(e),i.d(e,{default:()=>T,lookAccelerationKey:()=>P});var o=i(68909),s=i(81662),n=i(73065),r=i(33007),a=i(3249),l=i(4994),c=i(31093),h=i(13893);class d extends l.A{constructor(t){super(),this.cameraPoseProxy=t,this.lookVelocity=new o.Vector2,this.lookAccel=new o.Vector2,this.tempAxis=new o.Vector3,this.tempOrientation=new o.Quaternion,this.currentOrientation=new o.Quaternion,this.tempEuler=new o.Euler,this.transition={active:!1,startTime:0,elapsed:0,progress:0,duration:0,updateParameters:{},easeOut:!1,externalTransitionActive:!0}}setController(t){return null==t&&this.stop(),super.setController(t)}setLookAcceleration(t,e=!1){this.transition.active||(e&&(t.x&&this.lookVelocity.x&&Math.sign(t.x)!==Math.sign(this.lookVelocity.x)&&(this.lookVelocity.x=0),t.y&&this.lookVelocity.y&&Math.sign(t.y)!==Math.sign(this.lookVelocity.y)&&(this.lookVelocity.y=0)),this.lookAccel.x=void 0!==t.x?t.x:this.lookAccel.x,this.lookAccel.y=void 0!==t.y?t.y:this.lookAccel.y)}async rotateBetweenOrientations(t,e,i,o,s=!1){if(!t)return this.startTransition(o,{startRotation:e,endRotation:i},!1,s).nativePromise();if(this.poseController){const t=this.cameraPoseProxy.pose.clone();return t.rotation.copy(i),this.poseController.moveTo({transitionType:h.fl.FadeToBlack,pose:t,transitionTime:o}).nativePromise()}}startTransition(t,e,i,o=!0){var s;const n=new c.i;if(this.transition.active=!0,this.transition.duration=t,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=n,this.transition.easeOut=i,this.transition.externalTransitionActive=!o,this.transition.updateParameters=e,this.lookAccel.set(0,0),e.velocity)this.lookVelocity.copy(e.velocity),this.transition.updateParameters.velocity=e.velocity.clone(),this.transition.updateParameters.startRotation=this.transition.updateParameters.endRotation=void 0;else if(this.lookVelocity.set(0,0),!e.startRotation||!e.endRotation)throw new Error("startTransition: must specify velocity or both startRotation & endRotation");return o||null===(s=this.poseController)||void 0===s||s.beginExternalTransition(),n.promise()}stopTransition(){var t;const e=this.transition.active;this.transition.active&&(this.transition.externalTransitionActive&&(null===(t=this.poseController)||void 0===t||t.endExternalTransition()),this.transition.active=!1),this.transition.deferred&&(e&&this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransitionForVelocityMovement(t,e){if(this.transition.updateParameters.velocity)if(this.lookVelocity.copy(this.transition.updateParameters.velocity),this.transition.elapsed>=this.transition.duration){const t=this.transition.duration-(this.transition.elapsed-e);this.lookVelocity.multiplyScalar(t/e)}else this.lookVelocity.multiplyScalar(t)}updateTransitionForRotationalMovement(){var t;if(!this.transition.updateParameters.startRotation||!this.transition.updateParameters.endRotation)return;const e=this.transition.updateParameters.startRotation,i=this.transition.updateParameters.endRotation;this.currentOrientation.copy(e).slerp(i,this.transition.progress),null===(t=this.poseController)||void 0===t||t.updateCameraRotation(this.currentOrientation)}updateTransition(t,e){this.transition.elapsed+=e,this.transition.progress=this.transition.elapsed/this.transition.duration,this.transition.updateParameters.velocity?this.updateTransitionForVelocityMovement(t,e):this.updateTransitionForRotationalMovement()}updateCameraParametersForVelocityMovement(){var t;const e=this.cameraPoseProxy.pose;this.tempEuler.setFromQuaternion(e.rotation,"YXZ");const i=this.tempEuler.x,o=(0,a.qE)(this.lookVelocity.y,n.ol-i,n.vc-i);this.tempAxis.copy(s.B1.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(e.rotation),o),this.currentOrientation.copy(e.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(s.B1.UP,this.lookVelocity.x),this.currentOrientation.premultiply(this.tempOrientation),e.rotation.equals(this.currentOrientation)||(this.tempOrientation.copy(this.currentOrientation).normalize(),null===(t=this.poseController)||void 0===t||t.updateCameraRotation(this.tempOrientation))}update(t){this.cameraPoseProxy.pose.rotation.equals(this.currentOrientation)||this.currentOrientation.copy(this.cameraPoseProxy.pose.rotation);const e=t/n.qD;this.transition.active?(this.updateTransition(e,t),this.transition.updateParameters.velocity&&this.updateCameraParametersForVelocityMovement(),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)):(this.lookAccel.length()>r.A.epsilon||this.lookVelocity.length()>r.A.epsilon)&&(this.lookVelocity.addScaledVector(this.lookAccel,e),this.updateCameraParametersForVelocityMovement(),this.lookVelocity.multiplyScalar(Math.pow(1-n.g1,e)))}stop(t=!1){this.stopTransition(),this.lookAccel.set(0,0),t||this.lookVelocity.set(0,0)}startRotateTransition(t,e,i){return this.beforeStartRotationTransition&&this.beforeStartRotationTransition(),this.startTransition(t,{velocity:e.clone().multiplyScalar(n.qD)},i).nativePromise()}startTranslateTransition(t,e,i=!0){throw new Error("Panning isn't supported in Panorama Controls")}startZoomTransition(t,e,i){throw new Error("Zooming isn't supported in Panorama Controls")}}var p=i(90834),u=i(2993),m=i(72268),v=i(71397),y=i(28337),O=i(94790),R=i(60043),A=i(25316),g=i(45832),k=i(20599),x=i(17986);const P="Rotation speed";class T extends x.A{constructor(){super(...arguments),this.name="panorama-controls",this.controlsEngaged=!1,this.lookAccelerationSpeed=n.V$,this.calcRotationAngle=(()=>{const t=new o.Matrix4,e=new o.Vector3,i=new o.Vector3;return(s,n)=>{t.copy(this.cameraData.pose.projection.asThreeMatrix4()),t.invert(),e.set(s.x-n.x,s.y-n.y,-1).applyMatrix4(t),i.set(s.x,s.y,-1).applyMatrix4(t);const r=Math.sqrt(e.x*e.x+e.z*e.z),a=Math.sqrt(i.x*i.x+i.z*i.z),l=Math.atan2(e.y,r),c=Math.atan2(i.y,a)-l;e.y=0,i.y=0,e.normalize(),i.normalize();const h=Math.acos(e.dot(i));let d=0;return isNaN(h)||(d=h,n.x>0&&(d*=-1)),new o.Vector2(-d,-c)}})()}async init(t,e){const i=await e.getModuleBySymbol(g.X7);this.controls=new d(i.cameraPoseProxy),this.cameraData=await e.market.waitForData(k.M);const o=this.cameraData;this.controls.beforeStartRotationTransition=()=>{o.transition&&o.transition.activeInternal&&o.transition.to.rotation&&(o.transition.to.rotation=void 0)},i.addControls(u.N3.Panorama,this.controls),i.addControls(u.N3.Mesh,this.controls),this.market=e.market,this.registerActiveStateChangeBinding(),e.getModuleBySymbol(g.mL).then((t=>{t.registerHandler(O.SK,(t=>{this.shouldBeActive()&&this.controls.stop()})),t.registerHandler(O.jF,(t=>{this.shouldBeActive()&&t.buttons&m.O.PRIMARY&&(this.controlsEngaged=!0,this.onDrag(t.position,t.delta),this.controls.update(n.qD),this.controls.stop())})),t.registerHandler(O._w,(t=>{this.shouldBeActive()&&this.controlsEngaged&&(t.timeSinceLastMove<100&&!(t.buttons&m.O.PRIMARY)&&(this.onDrag(t.position,t.delta),this.controls.update(n.qD),this.controls.setLookAcceleration({x:0,y:0})),this.controlsEngaged=!1)})),t.registerHandler(R.k,(t=>{this.shouldBeActive()&&this.onKey(t.key,t.state)})),this.updateInputBindings()}))}onUpdate(t){this.shouldBeActive()&&this.controls.update(t)}onDrag(t,e){this.controls.setLookAcceleration(this.calcRotationAngle(t,e))}onKey(t,e){var i,o;const s=null!==(o=null===(i=this.market.tryGetData(A.o))||void 0===i?void 0:i.tryGetProperty(P,null))&&void 0!==o?o:null;this.lookAccelerationSpeed=s?s*(Math.PI/180)/60:this.lookAccelerationSpeed;const n=e===y.$.DOWN;switch(t){case v.D.LEFTARROW:case v.D.J:this.controls.setLookAcceleration({x:n?this.lookAccelerationSpeed:0},!0);break;case v.D.RIGHTARROW:case v.D.L:this.controls.setLookAcceleration({x:n?-this.lookAccelerationSpeed:0},!0);break;case v.D.K:this.controls.setLookAcceleration({y:n?-this.lookAccelerationSpeed:0},!0);break;case v.D.I:this.controls.setLookAcceleration({y:n?this.lookAccelerationSpeed:0},!0)}}shouldBeActive(){var t,e;return null!==(e=!(null===(t=this.market.tryGetData(p.O))||void 0===t?void 0:t.isVR()))&&void 0!==e&&e}}},39118:(t,e,i)=>{i.d(e,{l:()=>s});var o=i(55141);class s extends o.u{constructor(t){super(),this.payload={roomAssociation:t}}}s.id="REGISTER_ROOM_ASSOCIATION_SOURCE"},304:(t,e,i)=>{i.d(e,{_:()=>n,x:()=>s});var o=i(55141);class s extends o.u{constructor(){super()}}s.id="LOCK_VIEWMODE";class n extends o.u{constructor(){super()}}n.id="UNLOCK_VIEWMODE"},95102:(t,e,i)=>{i.d(e,{m:()=>s});var o=i(68909);class s extends o.Mesh{constructor(t,e){super(t,e)}}}}]);