/*! SDK Interface v25.3.4_webgl-403-g7d2911f42d */var e={846:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Floorplans"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floorplans"},arguments:[{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"StringValue",value:"Matterport",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"origin"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"flags"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"provider"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:402}};t.loc.source={body:'query Floorplans($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      floorplans(provider: "Matterport") {\n        id\n        status\n        url\n        validUntil\n        filename\n        format\n        height\n        width,\n        resolution,\n        origin {\n          x,\n          y\n        }\n        floor {\n          id\n        }\n        flags\n        provider\n      }\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}var n={};function o(e,t){for(var a=0;a<e.definitions.length;a++){var n=e.definitions[a];if(n.name&&n.name.value==t)return n}}t.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.Floorplans=function(e,t){var a={kind:e.kind,definitions:[o(e,t)]};e.hasOwnProperty("loc")&&(a.loc=e.loc);var s=n[t]||new Set,i=new Set,r=new Set;for(s.forEach((function(e){r.add(e)}));r.size>0;){var d=r;r=new Set,d.forEach((function(e){i.has(e)||(i.add(e),(n[e]||new Set).forEach((function(e){r.add(e)})))}))}return i.forEach((function(t){var n=o(e,t);n&&a.definitions.push(n)})),a}(t,"Floorplans")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n,o,s,i,r,d,c,l,h,u,p,m,g,w,f,y,T,v,I,E,C,b,A,S={};a.d(S,{m:()=>Xr}),function(e){let t,a,n,o;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(a=e.Phase||(e.Phase={})),function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(n=e.Application||(e.Application={})),function(e){e.RoomBounds="feature.roombounds",e.Defurnish="feature.defurnish"}(o=e.Feature||(e.Feature={}))}(n||(n={})),function(e){let t,a,n;!function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.TEXT="text",e.AUDIO="audio",e.MODEL="model",e.APPLICATION="application"}(t=e.MediaType||(e.MediaType={})),function(e){e.EXTERNAL="external",e.UPLOAD="upload",e.SANDBOX="sandbox"}(a=e.AttachmentCategory||(e.AttachmentCategory={})),function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(n=e.ParentType||(e.ParentType={}))}(o||(o={})),function(e){let t,a;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(a=e.Direction||(e.Direction={}))}(s||(s={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(i||(i={})),function(e){let t;!function(e){e.SUCCESS="astar.status.success",e.NO_PATH="astar.status.no_path",e.TIMEOUT="astar.status.timeout",e.NO_START_VERTEX="astar.status.no_start",e.NO_END_VERTEX="astar.status.no_end"}(t=e.AStarStatus||(e.AStarStatus={}))}(r||(r={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(d||(d={})),function(e){let t,a,n;!function(e){e.WINDOW="link.creationpolicy.window",e.REFERRER="link.creationpolicy.referrer",e.MATTERPORT="link.creationpolicy.matterport"}(t=e.CreationPolicy||(e.CreationPolicy={})),function(e){e.DEFAULT="link.openpolicy.default",e.NEW_WINDOW="link.openpolicy.newwindow",e.SAME_FRAME="link.openpolicy.sameframe",e.CURRENT_WINDOW="link.openpolicy.current"}(a=e.OpenPolicy||(e.OpenPolicy={})),function(e){e.DEFAULT="link.destination.default",e.MATTERPORT="link.destination.matterport"}(n=e.DestinationPolicy||(e.DestinationPolicy={}))}(c||(c={})),function(e){let t,a,n,o,s;!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(t=e.Transition||(e.Transition={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(a=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(n=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(o=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(s=e.MediaType||(e.MediaType={}))}(l||(l={})),function(e){let t,a,n;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(a=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(n=e.TransitionType||(e.TransitionType={}))}(h||(h={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(u||(u={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(p||(p={})),m||(m={}),function(e){let t,a;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(a=e.SourceType||(e.SourceType={}))}(g||(g={})),function(e){let t,a,n,o;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(a=e.Transition||(e.Transition={})),function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(n=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(o=e.Placement||(e.Placement={}))}(w||(w={})),function(e){let t;!function(e){e.UNKNOWN="tag.attachment.unknown",e.APPLICATION="tag.attachment.application",e.AUDIO="tag.attachment.audio",e.IMAGE="tag.attachment.image",e.MODEL="tag.attachment.model",e.PDF="tag.attachment.pdf",e.RICH="tag.attachment.rich",e.TEXT="tag.attachment.text",e.VIDEO="tag.attachment.video",e.ZIP="tag.attachment.zip",e.SANDBOX="tag.attachment.sandbox"}(t=e.AttachmentType||(e.AttachmentType={}))}(f||(f={})),function(e){let t,a;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={})),function(e){e.INACTIVE="tour.inactive",e.ACTIVE="tour.active",e.STOP_SCHEDULED="tour.stopscheduled"}(a=e.PlayState||(e.PlayState={}))}(y||(y={})),function(e){let t,a;!function(e){e.BASE="viewtype.base",e.LAYERED_BASE="viewtype.layeredbase",e.USER="viewtype.user",e.DEFURNISH="viewtype.defurnish",e.OTHER="viewtype.other"}(t=e.ViewType||(e.ViewType={})),function(e){e.BASE="layertype.base",e.VIEW_DATA="layertype.viewdata",e.USER="layertype.user",e.IN_MEMORY="layertype.inmemory",e.OTHER="layertype.other"}(a=e.LayerType||(e.LayerType={}))}(T||(T={})),function(e){let t,a,n;!function(e){e.OBJ_LOADER="mp.objLoader",e.FBX_LOADER="mp.fbxLoader",e.DAE_LOADER="mp.daeLoader",e.GLTF_LOADER="mp.gltfLoader",e.SCROLLING_TUBE="mp.scrollingTube",e.TRANSFORM_CONTROLS="mp.transformControls",e.LIGHTS_COMPONENT="mp.lights",e.POINT_LIGHT="mp.pointLight",e.DIRECTIONAL_LIGHT="mp.directionalLight",e.AMBIENT_LIGHT="mp.ambientLight",e.CAMERA="mp.camera",e.INPUT="mp.input",e.XR="mp.xr"}(t=e.Component||(e.Component={})),function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(a=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(n=e.PathType||(e.PathType={}))}(v||(v={})),function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.RETURN=13]="RETURN",e[e.SHIFT=16]="SHIFT",e[e.CONTROL=17]="CONTROL",e[e.ALT=18]="ALT",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.HASH=35]="HASH",e[e.LEFTARROW=37]="LEFTARROW",e[e.UPARROW=38]="UPARROW",e[e.RIGHTARROW=39]="RIGHTARROW",e[e.DOWNARROW=40]="DOWNARROW",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.AT=64]="AT",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.L_META=91]="L_META",e[e.R_META=93]="R_META",e[e.SEMICOLON=186]="SEMICOLON",e[e.PLUSEQUALS=187]="PLUSEQUALS",e[e.COMMA=188]="COMMA",e[e.DASHUNDERSCORE=189]="DASHUNDERSCORE",e[e.PERIOD=190]="PERIOD",e[e.OPENBRACKET=219]="OPENBRACKET"}(I||(I={})),function(e){e[e.DOWN=0]="DOWN",e[e.PRESSED=1]="PRESSED",e[e.UP=2]="UP"}(E||(E={})),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.MIDDLE=1]="MIDDLE",e[e.SECONDARY=2]="SECONDARY",e[e.BACK=3]="BACK",e[e.FORWARD=4]="FORWARD",e[e.COUNT=5]="COUNT"}(C||(C={})),function(e){e[e.NONE=0]="NONE",e[e.PRIMARY=1]="PRIMARY",e[e.SECONDARY=4]="SECONDARY",e[e.MIDDLE=2]="MIDDLE",e[e.BACK=8]="BACK",e[e.FORWARD=16]="FORWARD",e[e.ALL=31]="ALL"}(b||(b={}));class D{constructor(e){this.directionMap={[s.Direction.FORWARD]:e.FORWARD.clone(),[s.Direction.LEFT]:e.LEFT.clone(),[s.Direction.RIGHT]:e.RIGHT.clone(),[s.Direction.BACK]:e.BACK.clone(),[s.Direction.UP]:e.UP.clone(),[s.Direction.DOWN]:e.DOWN.clone()}}toVector(e){return this.directionMap[e]}}class O{constructor(e){this.CwfViewmode=e}toSdk(e,t,a){switch(e){case this.CwfViewmode.Panorama:return t?h.Mode.INSIDE:h.Mode.OUTSIDE;case this.CwfViewmode.Dollhouse:return a?h.Mode.FLOORPLAN:h.Mode.DOLLHOUSE;case this.CwfViewmode.Floorplan:return h.Mode.FLOORPLAN;case this.CwfViewmode.Transition:return h.Mode.TRANSITIONING;case this.CwfViewmode.Outdoor:return h.Mode.OUTSIDE;default:return h.Mode.INSIDE}}fromSdk(e){switch(e){case h.Mode.INSIDE:case h.Mode.OUTSIDE:return this.CwfViewmode.Panorama;case h.Mode.DOLLHOUSE:return this.CwfViewmode.Dollhouse;case h.Mode.FLOORPLAN:return this.CwfViewmode.Floorplan;case h.Mode.TRANSITIONING:return this.CwfViewmode.Transition}}}class M{constructor(e){this.CommandMode=e}toSdk(e){switch(e){case this.CommandMode.INSIDE:return h.Mode.INSIDE;case this.CommandMode.DOLLHOUSE:return h.Mode.DOLLHOUSE;case this.CommandMode.FLOORPLAN:return h.Mode.FLOORPLAN;case this.CommandMode.TRANSITIONING:return h.Mode.TRANSITIONING;case this.CommandMode.OUTSIDE:return h.Mode.OUTSIDE;default:return h.Mode.INSIDE}}fromSdk(e){switch(e){case h.Mode.INSIDE:return this.CommandMode.INSIDE;case h.Mode.OUTSIDE:return this.CommandMode.OUTSIDE;case h.Mode.DOLLHOUSE:return this.CommandMode.DOLLHOUSE;case h.Mode.FLOORPLAN:return this.CommandMode.FLOORPLAN;case h.Mode.TRANSITIONING:return this.CommandMode.TRANSITIONING}}}!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade",e.MOVEFADE="transition.movefade",e.ORBIT="transition.orbit"}(A||(A={}));class R{constructor(e){this.toSdkTransitionMap={[e.Interpolate]:A.FLY,[e.FadeToBlack]:A.FADEOUT,[e.Instant]:A.INSTANT,[e.MoveToBlack]:A.MOVEFADE,[e.OrbitTo]:A.ORBIT},this.fromSdkTransitionMap={[A.FLY]:e.Interpolate,[A.FADEOUT]:e.FadeToBlack,[A.INSTANT]:e.Instant,[A.MOVEFADE]:e.MoveToBlack,[A.ORBIT]:e.OrbitTo}}toSdkTransition(e){return this.toSdkTransitionMap[e]}fromSdkTransition(e){return this.fromSdkTransitionMap[e]}}class N{constructor(e){this.THREE=e,this.tempEuler=new e.Euler}quaternionToRotation(e,t){const a=this.tempEuler.setFromQuaternion(e,N.eulerOrder),n=t||{};return n.x=this.THREE.MathUtils.radToDeg(a.x),n.y=this.THREE.MathUtils.radToDeg(a.y),n.z=this.THREE.MathUtils.radToDeg(a.z),n}rotationToQuaternion(e,t){const a=t||new this.THREE.Quaternion;return this.tempEuler.x=this.THREE.MathUtils.degToRad(e.x),this.tempEuler.y=this.THREE.MathUtils.degToRad(e.y),this.tempEuler.z=this.THREE.MathUtils.degToRad(e.z||0),this.tempEuler.order=N.eulerOrder,a.setFromEuler(this.tempEuler)}}N.eulerOrder="YXZ";class P{constructor(e){this.CwfSweepAlignmentType=e}isSweepAligned(e,t){if(!e||!t)return!1;const a=t&&e.getSweep(t);return!!a&&a.alignmentType===this.CwfSweepAlignmentType.ALIGNED}isCurrentSweepAligned(e){return this.isSweepAligned(e,e.currentSweep)}}class x{constructor(e){this.sweepData=e}getIdForSweep(e){return e.platformId}getSweepForId(e){return this.sweepData.getSweep(e)}getIdFromCwfId(e){const t=this.sweepData.getSweep(e);return this.getIdForSweep(t)}}class _{constructor(e){this.floorData=e}getIdForFloor(e){return e.id}getFloorForId(e){return this.floorData.getFloor(e)}getIdFromCwfId(e){const t=this.floorData.getFloor(e);return this.getIdForFloor(t)}}class L{constructor(e){this.roomData=e}getIdForRoom(e){return e.id}getRoomForId(e){return this.roomData.get(e)}getIdFromCwfId(e){const t=this.roomData.get(e);return this.getIdForRoom(t)}}class k{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}class V{constructor(...e){this.fulfilledOptionals=[],this.observable=new k,this.dependencies=e||[]}static createWithOptionals(e,t){const a=new V(...e);a.fulfilledOptionals.length=t.length;for(let e=0;e<t.length;++e){let n;a.fulfilledOptionals[e]={get:()=>n};const o=t[e];Promise.all([o]).then((([e])=>{n=e,a.notify()}))}return a}static getBuilder(){class e{constructor(){this.dependencies=[],this.optionals=[]}addDependencies(...t){const a=new e,n=[...this.dependencies,...t];return a.dependencies=n,a.optionals=this.optionals,a}addOptionals(...t){const a=new e,n=[...this.optionals,...t];return a.dependencies=this.dependencies,a.optionals=n,a}build(){return V.createWithOptionals(this.dependencies,this.optionals)}}return new e}static get none(){return this._none}async getDependencies(){return Promise.all(this.dependencies)}getOptionals(){return this.fulfilledOptionals}onOptionalsFulfilled(e){return this.observable.observe({notify:e})}notify(){this.observable.notify()}static extend(e,...t){return new V(...e.dependencies,...t)}static combine(e,t){return new V(...e.dependencies,...t.dependencies)}}V._none=new V;class F{constructor(e,...t){this.ctor=e,this.args=t}create(...e){return new this.ctor(...this.args,...e)}}const U=window.navigationStart||Date.now();var G;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(G||(G={}));class H{constructor(e){this.timers={},this.handlers={[G.DEBUG]:console.debug,[G.INFO]:console.info,[G.WARN]:console.warn,[G.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){if(H.level>=e&&console){return(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix())}return()=>{}}get debug(){return this.message(G.DEBUG)}get devInfo(){return()=>{}}get debugInfo(){return this.debug}get warnError(){return this.warn}get debugWarn(){return this.message(H.level>=G.DEBUG?G.WARN:G.DEBUG)}get info(){return this.message(G.INFO)}get warn(){return this.message(G.WARN)}get error(){return this.message(G.ERROR)}time(e){H.level>=G.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(H.level>=G.DEBUG){const t=this.timers[e];if(!t)return;const a=(Date.now()-t)/1e3;this.debug(e,a+"s")}}getPrefix(){const e=(Date.now()-U)/1e3+"s";return`${this.prefix} ${e}`}}H.level=G.INFO;const B=new H("sdk command");class z{static async create(e,t){const a=await e.getDependencies(),n=e.getOptionals();return new z(t.create(...a,...n))}constructor(e){this._executor=e}get executor(){return this._executor}validateInput(e,t){return this.executor.validateInput(e,t)}exec(e,t){const a=this.executor.validateInput(e,t);return this.executor.exec(a,t)}}function j(e,t,a){return`'${e}' is expected to be a(n) ${t}; got '${JSON.stringify(a)}'`}function $(e,t,a){return e.validateInput(t,a)}function W(e,t,a){return e.exec(t,a)}async function q(e,t){return new class{constructor(e){this.command=e}validateInput(e,t){return $(this.command,e,t)}exec(e,a){return B.warn(t),this.command.exec(e,a)}}(await e)}function K(e){return!!e&&"string"==typeof e}function Y(e){return"string"==typeof e}const X=["dev-app.matterport.com","dev-app.matterportvr.cn","qa3-app.matterport.com","qa3-app.matterportvr.cn","gc1-app.matterport.com","my.matterport.com","my.matterportvr.cn","showcase-next.matterport.com","static.matterport.com","static.matterportvr.cn","static.matterport.us","matterport.github.io","127.0.0.1","localhost"];class Z{constructor(e){this.getModelViewsQuery=e}validateInput(e,t){return K(e.spaceSid)||this.throw(j("spaceSid","string",e.spaceSid)),{spaceSid:e.spaceSid}}async exec(e,t){return await this.getModelViewsQuery(e.spaceSid)}throw(e){throw Error("Api.getViews: "+e)}}class Q{constructor(e){this.toSdkPhaseMap={[e.UNINITIALIZED]:n.Phase.UNINITIALIZED,[e.WAITING]:n.Phase.WAITING,[e.LOADING]:n.Phase.LOADING,[e.STARTING]:n.Phase.STARTING,[e.PLAYING]:n.Phase.PLAYING,[e.ERROR]:n.Phase.ERROR},this.fromSdkPhaseMap={[n.Phase.UNINITIALIZED]:e.UNINITIALIZED,[n.Phase.WAITING]:e.WAITING,[n.Phase.LOADING]:e.LOADING,[n.Phase.STARTING]:e.STARTING,[n.Phase.PLAYING]:e.PLAYING,[n.Phase.ERROR]:e.ERROR}}toSdkAppPhase(e){return this.toSdkPhaseMap[e]}fromSdkAppPhase(e){return this.fromSdkPhaseMap[e]}}class J{constructor(e){this.toSdkApplicationMap={[e.SHOWCASE]:n.Application.SHOWCASE,[e.WORKSHOP]:n.Application.WORKSHOP,[e.WEBVR]:n.Application.WEBVR,[e.UNKNOWN]:n.Application.UNKNOWN},this.fromSdkApplicationMap={[n.Application.SHOWCASE]:e.SHOWCASE,[n.Application.WORKSHOP]:e.WORKSHOP,[n.Application.WEBVR]:e.WEBVR,[n.Application.UNKNOWN]:e.UNKNOWN}}toSdkApplication(e){return this.toSdkApplicationMap[e]}fromSdkApplication(e){return this.fromSdkApplicationMap[e]}}class ee{static async create(e,t,a){const n=await e.getDependencies();return new ee(n,e,t,a)}constructor(e,t,a,n){this.dependencies=e,this.optionals=t,this.subscriptionFactory=a,this.observers=new Set,this.currentData=n.create(),this.freshDataCache=n.create()}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class t{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}if(this.observers.add(e),1===this.observers.size){const e=()=>{const e=this.optionals.getOptionals();this.currentData.update(...this.dependencies,...e),this.changeSubscription=this.subscriptionFactory.create(new t(this),...this.dependencies,...e)};this.dependencySubscription=this.optionals.onOptionalsFulfilled((()=>{var t;null===(t=this.changeSubscription)||void 0===t||t.cancel(),e()})),e()}e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&(this.dependencySubscription.cancel(),this.changeSubscription.cancel()))}onChanged(){if(this.freshDataCache.update(...this.dependencies,...this.optionals.getOptionals()),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}const te=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,ae=(e,t=[])=>{if(void 0!==e){if(t.includes(e))return Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if(ArrayBuffer.isView(e))for(const t of[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array])if(e instanceof t)return new t(e);if("object"==typeof e){const a=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const n in e){if(te(n))continue;const o=e[n];o instanceof Date?a[n]=new Date(o):"function"!=typeof o&&(t.push(e),a[n]="object"==typeof o?ae(o,t):o,t.pop())}return a}return e}},ne=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const a in t)if(!(a in e))return!0;for(const a in e)if(ne(e[a],t[a]))return!0;return!1};class oe{create(e,t){return t.onChanged((()=>e.onChanged()))}}class se{constructor(e,t){this._data={phase:n.Phase.UNINITIALIZED,phaseTimes:{},application:n.Application.SHOWCASE},this.AppPhase=e.AppPhase,this.appPhaseConverter=t.appPhaseConverter,this.applicationConverter=t.applicationConverter}get data(){return this._data}equals(e){return!ne(this,e)}copy(e){this._data.phase=e.data.phase,function(e,t,...a){for(const n of a)e[n]=t[n]}(this.data.phaseTimes,e.data.phaseTimes),this._data.application=e.data.application}update(e){this._data.phase=this.appPhaseConverter.toSdkAppPhase(e.phase),this._data.application=this.applicationConverter.toSdkApplication(e.application),this._data.phaseTimes[n.Phase.WAITING]=e.phaseTimes[this.AppPhase.WAITING],this._data.phaseTimes[n.Phase.LOADING]=e.phaseTimes[this.AppPhase.LOADING],this._data.phaseTimes[n.Phase.PLAYING]=e.phaseTimes[this.AppPhase.PLAYING],this._data.phaseTimes[n.Phase.STARTING]=e.phaseTimes[this.AppPhase.STARTING],this._data.phaseTimes[n.Phase.UNINITIALIZED]=e.phaseTimes[this.AppPhase.UNINITIALIZED],this._data.phaseTimes[n.Phase.ERROR]=e.phaseTimes[this.AppPhase.ERROR]}}class ie{get id(){return this.constructor.id}}class re extends ie{constructor(){super()}}re.id="GET_APP_STATE";class de extends ie{constructor(){super()}}var ce,le,he;function ue(e){return e.viewType===ce.DEFURNISH}de.id="GET_APP_PHASE_TIMES",function(e){e.BASE="base",e.LAYERED_BASE="layered-base",e.INSIGHTS="insights",e.USER="user",e.DEFURNISH="defurnish",e.SESSION="session",e.DIGIPRO_SESSION="digipro-session",e.TRUEPLAN="trueplan",e.PRIVATE_SESSION="bundle-session",e.OTHER="other"}(ce||(ce={})),function(e){e.BASE_LAYER="matterport.base",e.VIEW_DATA_LAYER="matterport.user.data",e.USER_LAYER="matterport.user.data.ext",e.OVERLAY_ASSETS_LAYER="matterport.overlay.assets",e.COMMON_USER_LAYER="matterport.user.data.common",e.PROXY_LAYER="matterport.proxy.common",e.IN_MEMORY="matterport.in-memory",e.COMMON_IN_MEMORY="matterport.in-memory.common",e.WORKSHOP="matterport.workshop.jsonstore",e.OTHER="other layer type"}(le||(le={})),function(e){e.TYPE="type",e.FLOOR="floor",e.ROOM="room",e.LAYER="layer",e.DATE="date"}(he||(he={}));const pe="model-views-feature",me="data-layers-feature";var ge;!function(e){e.DISABLED="disabled",e.VIEWS_OPTIONAL_OPT_IN="user_views",e.VIEWS_ENABLED="views_enabled",e.VIEWS_AND_LAYERS="views_layers",e.LAYERS_ONLY="layers"}(ge||(ge={}));var we;!function(e){e.DISABLED="0",e.VIEWS_ENABLED="2",e.VIEWS_AND_LAYERS="3",e.LAYERS_ONLY="4"}(we||(we={}));const fe=new H("Subscription");class ye{constructor(e,t,a=!1,n=""){this.startSubscription=e,this.endSubscription=t,this.id=n,this.isSubbed=!1,a&&this.renew()}renew(){this.isSubbed?fe.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed&&(this.endSubscription(),this.isSubbed=!1)}get active(){return this.isSubbed}}function Te(e,t,a=!0,n=""){return new ye(e,t,a,n)}class ve{constructor(){this.isObservable=!0,this._dirtyObservable=!1,this._activeObservable=!0,this._observerNotifying=!1,this._changeObservers=new Set,this._parentObservables=new Set,this._childObservables=new Set,Object.defineProperties(this,{isObservable:{value:this.isObservable,writable:!1,enumerable:!1},_dirtyObservable:{value:this._dirtyObservable,enumerable:!1},_activeObservable:{value:this._activeObservable,enumerable:!1},_observerNotifying:{value:this._observerNotifying,enumerable:!1},_changeObservers:{value:this._changeObservers,writable:!1,enumerable:!1},_childObservables:{value:this._childObservables,writable:!1,enumerable:!1},_parentObservables:{value:this._parentObservables,writable:!1,enumerable:!1}})}onChanged(e){if(this._changeObservers.has(e))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return Te((()=>this._changeObservers.add(e)),(()=>this.removeOnChanged(e)),!0)}removeOnChanged(e){this._changeObservers.delete(e)}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._changeObservers)this.notifyObserver(e);this._dirtyObservable=!1,this._observerNotifying=!1}}notifyObserver(e){e(void 0)}notifyDown(){for(const e of this._childObservables)e.notifyDown();this.notifyObservers()}notifyUp(){for(const e of this._parentObservables)e.notifyUp();this.notifyObservers()}setDirty(e=!0){this.setDirtyUp(),e&&this.notifyUp()}setDirtyUp(){if(!this._dirtyObservable){this._dirtyObservable=!0;for(const e of this._parentObservables)e.setDirtyUp()}}addChildObservable(e){ve.isObservable(e)&&(this._childObservables.add(e),e._parentObservables.add(this))}removeChildObservables(e){ve.isObservable(e)&&(this._childObservables.delete(e),e._parentObservables.delete(this))}atomic(e){if(!this._activeObservable)return e();try{this.setActive(!1),e()}finally{this.setActive(!0)}}setActive(e){const t=this._activeObservable;this._activeObservable=e,!t&&e&&this.notifyObservers();for(const t of this._childObservables)t.setActive(e)}deepCopy(){throw Error("deepCopy is only implemented in subclasses of Observable")}static isObservable(e){return e&&e.isObservable}}const Ie=new H("ObservableObject"),Ee=1===function(e,t=null,a=typeof t){return function(e,t=null,a=typeof t){if(null===e)return t;if("boolean"===a)return"true"===e||"1"===e;if("number"===a)return+e;return e}(new URLSearchParams(window.location.search).get(e),t,a)}("debug",0);const Ce=new Map;if(Ee){const e=setInterval((()=>{(function(){for(const e of Ce.values())for(const t in e)return Ie.error(`ObservableObject property "${t}" was still dirty after one tick! Did you forget a .commit()?`),Ie.error("See stack trace of the property write below:"),Ie.error(e[t].stack),!0;return!1})()&&void 0!==e&&clearInterval(e)}),16)}var be,Ae,Se,De,Oe;!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(be||(be={})),function(e){e.IMPERIAL="imperial",e.METRIC="metric"}(Ae||(Ae={})),function(e){e[e.Pan=0]="Pan",e[e.PanDollhouse=1]="PanDollhouse",e[e.Zoom=2]="Zoom",e[e.Delay=3]="Delay",e[e.None=4]="None"}(Se||(Se={})),function(e){e[e.Left=1]="Left",e[e.Auto=0]="Auto",e[e.Right=-1]="Right"}(De||(De={})),function(e){e[e.Move=0]="Move",e[e.Burns=1]="Burns",e[e.Zoom=2]="Zoom",e[e.Path=3]="Path",e[e.FloorChange=4]="FloorChange",e[e.Delay=5]="Delay",e[e.Nop=6]="Nop"}(Oe||(Oe={}));Oe.Burns,Oe.Zoom,Oe.Delay;var Me;!function(e){e[e.Panorama=1]="Panorama",e[e.Dollhouse=2]="Dollhouse",e[e.Floorplan=3]="Floorplan",e[e.Outdoor=4]="Outdoor",e[e.Orthographic=5]="Orthographic",e[e.Mesh=6]="Mesh",e[e.Transition=-1]="Transition"}(Me||(Me={}));Me.Dollhouse,Me.Panorama;var Re,Ne;!function(e){e.BASE="base",e.STANDARD="standard",e.HIGH="high",e.ULTRAHIGH="ultrahigh"}(Re||(Re={})),function(e){e[e.BASE=512]="BASE",e[e.STANDARD=1024]="STANDARD",e[e.HIGH=2048]="HIGH",e[e.ULTRAHIGH=4096]="ULTRAHIGH"}(Ne||(Ne={}));Re.BASE,Ne.BASE,Re.STANDARD,Ne.STANDARD,Re.HIGH,Ne.HIGH,Re.ULTRAHIGH,Ne.ULTRAHIGH,Ne.BASE,Re.BASE,Ne.STANDARD,Re.STANDARD,Ne.HIGH,Re.HIGH,Ne.ULTRAHIGH,Re.ULTRAHIGH,Re.BASE,Object.freeze({walkingTourIncludeExtraPanosDistance:.4,walkingStageMinimumDistance:.8,maxWalkingSweepsBetweenSnapshots:40}),De.Auto;var Pe;!function(e){e.DefurnishView="defurnish_view",e.PresentedBy="presented_by",e.HighlightReel="highlight_reel",e.FloorPlan="floor_plan",e.RoomBounds="room_bounds",e.TourButtons="tour_buttons",e.Labels="labels",e.LabelsDollhouse="labels_dh",e.Measurements="measurements",e.FloorSelect="floor_select",e.SavedMeasurements="measurements_saved",e.Dollhouse="dollhouse",e.InstantTransitions="fast_transitions",e.TransitionSpeed="transition_speed",e.TransitionTime="transition_time",e.PanSpeed="pan_speed",e.DollhousePanSpeed="dollhouse_pan_speed",e.ZoomDuration="zoom_duration",e.PanAngle="pan_angle",e.PanDirection="pan_direction",e.Units="unit_type",e.DetailsEmail="contact_email",e.DetailsAddress="address",e.DetailsName="contact_name",e.DetailsSummary="model_summary",e.DetailsPhone="contact_phone",e.DetailsModelName="model_name",e.DetailsExternalUrl="external_url",e.BackgroundColor="background_color",e.SpaceSearch="space_search"}(Pe||(Pe={}));function xe(e){return e.tryGetProperty(Pe.RoomBounds,!1)}class _e{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}class Le{constructor(){this.rooms=0,this.rbError=!1,this.views=[],this.layers=[]}create(e,t,a,n){return new _e(t.onChanged((()=>this.throttleSettingsDataChanges(e,t))),a.onChanged((()=>this.throttleRoomBoundDataChanges(e,a))),n.onChanged((()=>this.throttleLayersDataDataChanges(e,n))))}throttleRoomBoundDataChanges(e,t){const a=t.rooms.size;this.rooms!==a&&e.onChanged()}throttleSettingsDataChanges(e,t){const a=t.tryGetProperty("SETTING_RB_ERROR_GETTING_USER_VIEW",!1);this.rbError!==a&&e.onChanged()}throttleLayersDataDataChanges(e,t){let a=!1;const n=t.getOrderedModelViews();for(const e of n)if(!this.views.includes(e)){a=!0;break}this.views=n;const o=t.getCurrentUserLayers();for(const e of o)if(!this.layers.includes(e)){a=!0;break}this.layers=o,a&&e.onChanged()}}class ke{constructor(){this._data={[n.Feature.RoomBounds]:void 0,[n.Feature.Defurnish]:void 0}}get data(){return this._data}equals(e){return Object.entries(e.data).every((([e,t])=>this.data[e]===t))}copy(e){for(const[t,a]of Object.entries(e.data))this.data[t]=a}update(e,t,a){const o=e.tryGetProperty("SETTING_RB_ERROR_GETTING_USER_VIEW",!1),s=t.rooms.size;var i;this.data[n.Feature.Defurnish]=!!(null===(i=a.getOrderedModelViews({includeDefurnish:!0,includeDisabled:!1}).filter((e=>ue(e))).find((e=>ue(e))))||void 0===i?void 0:i.id),this.data[n.Feature.RoomBounds]=xe(e)&&!o&&s>0}}var Ve;!function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct",e.WEBSOCKET="websocket"}(Ve||(Ve={}));const Fe={$id:"records",type:"object",minProperties:1,maxProperties:6,additionalProperties:{type:["string","number"]},required:[]},Ue={$id:"options",type:"object",properties:{version:{type:"number"},records:{$ref:"records"}},required:[],additionalProperties:!1},Ge={$id:"payload",type:"object",properties:{name:{type:"string"},options:{$ref:"options"}},required:["name"],additionalProperties:!1};class He{constructor(e,t){this.sdk=e,this.jsonSchemaValidator=t}validateInput(e,t){this.validate||(this.jsonSchemaValidator.addSchema([Ge,Fe,Ue]),this.validate=this.jsonSchemaValidator.getSchema("payload"));if(!this.validate(e)){const t=this.jsonSchemaValidator.prettify(this.validate,{data:e,colors:!1});throw Error(t)}return e}async exec(e,t){var a,n;const o={version:(null===(a=null==e?void 0:e.options)||void 0===a?void 0:a.version)||1,records:(null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.records)||{}};return this.sdk.track(t,e.name,o)}}class Be{constructor(e){this.localeInterface=e}validateInput(e,t){return e}async exec(e,t){return this.localeInterface.languageCode}}class ze{constructor(e){this.localeInterface=e}validateInput(e,t){return e}async exec(e,t){return this.localeInterface.t.bind(this.localeInterface)}}var je,$e;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(je||(je={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}($e||($e={}));const We=new WeakMap;class qe{constructor({retries:e=0,concurrency:t=6}={}){this.totalBytesDownloaded=0,this.queue=[],this.retries=e,this.concurrency=t}get(e,t){return this.request("GET",e,t)}head(e,t){return this.request("HEAD",e,t)}options(e,t){return this.request("OPTIONS",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}delete(e,t){return this.request("DELETE",e,t)}request(e,t,a){const n=new Ke(e,t,a);if(null==a?void 0:a.signal){const e=()=>{this.queue.includes(n)&&(n.status===$e.SENDING&&n.abort(),this.dequeue(n),n.onFail(new DOMException("Aborted","AbortError")))};a.signal.addEventListener("abort",e),We.set(n,(()=>{var t;null===(t=a.signal)||void 0===t||t.removeEventListener("abort",e),We.delete(n)}))}return this.enqueue(n),n.promise}update(){let e;for(;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=$e.PENDING;this.updateTimeout=null}enqueue(e){let t=0;for(t=0;t<this.queue.length;t++){if(this.queue[t].priority<e.priority)break}this.queue.splice(t,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((()=>{this.update()}),1))}dequeue(e){var t;null===(t=We.get(e))||void 0===t||t();const a=this.queue.indexOf(e);if(-1===a)throw new Error("Can't dequeue request not in queue");this.queue.splice(a,1),this.update()}getNextPendingRequest(){for(let e=0;e<this.queue.length&&e<this.concurrency;e++){const t=this.queue[e];if(t.status===$e.PENDING)return t}return null}getNextOverflowingGet(){for(let e=this.concurrency;e<this.queue.length;e++){const t=this.queue[e];if(t.status===$e.SENDING&&t.priority!==je.HIGHEST&&"GET"===t.method)return t}return null}shouldRetryStatusCode(e){return!qe.doNotRetryStatusCodes[e]}sendRequest(e){e.status=$e.SENDING,e.send().then((t=>{e.status=$e.DONE,this.dequeue(e),e.contentLength&&e.contentLength>0&&(this.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(t)})).catch((t=>{const a=null!==e.maxRetries?e.maxRetries:this.retries;let n=e.sendAttempts<a;if("object"==typeof t){const e=t.status_code||0;n=n&&this.shouldRetryStatusCode(e)}n?(e.status=$e.PENDING,this.update(),console.warn(`Retried ${e.url}`),console.warn(t)):(e.status=$e.FAILED,this.dequeue(e),console.warn(`Failed ${e.url}`),e.onFail(t))}))}}qe.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0};class Ke{constructor(e,t,a={}){this.sendAttempts=0,this.status=$e.PENDING,this.contentLength=0,this.isAborting=!1,this.url=t,this.method=e,this.auth=a.auth||null,this.withCredentials=a.withCredentials||!1,this.priority=a.priority||je.MEDIUM,this.responseType=a.responseType||null,this.body=a.body||null,this.headers=a.headers||{},this.maxRetries=a.maxRetries||null,this.onProgress=a.onProgress,this.promise=new Promise(((e,t)=>{this.onDone=e,this.onFail=t}))}send(){const e=this.xhr=function(e,t,a){let n;if("undefined"!=typeof XMLHttpRequest)n=new XMLHttpRequest,n.withCredentials=a;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");n=new XDomainRequest}return n.open(e,t,!0),n}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)e.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');e.responseType="blob"}"json"===this.responseType&&e.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&e.setRequestHeader("Authorization",this.auth);for(const t in this.headers)e.setRequestHeader(t,this.headers[t]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),e.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(e.onprogress=this.onProgress),new Promise(((t,a)=>{e.onreadystatechange=()=>{if(4===e.readyState){if(200===e.status||201===e.status||204===e.status)return this.parseResponse(this.xhr).then((e=>{t(e)}));if(!this.isAborting)return this.parseResponse(this.xhr).then((t=>{a(Object.assign({status_code:e.status},t))})).catch((()=>{a({status_code:e.status})}));this.isAborting=!1}},e.onerror=function(e){a(e)},e.send(this.body),this.sendAttempts++}))}parseResponse(e){return new Promise(((t,a)=>{var n;try{if(!e)throw new Error(`No request received. Trying ${this.method} on ${this.url} and expecting ${this.responseType}, but request was ${this.xhr}`);let a=e.response;if(this.contentLength=parseInt(null!==(n=e.getResponseHeader("Content-Length"))&&void 0!==n?n:"0",10),"json"===this.responseType&&"object"!=typeof a)t(JSON.parse(e.responseText));else if(200!==e.status&&201!==e.status&&204!==e.status||"image"!==this.responseType)t(a);else{const e=URL.createObjectURL(a);a=new Image,a.onload=function(){URL.revokeObjectURL(e),t(a)},a.src=e,a.crossOrigin="Anonymous"}}catch(e){a({error:"Payload was not valid JSON"})}}))}abort(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.isAborting=!0,this.xhr.abort()}}const Ye=H;class Xe{constructor(){this.base=new Promise(((e,t)=>{this.resolver=e,this.rejecter=t})),this._promise=new Ze(this.base,this),this.progressCallbacks=[]}then(e,t){return this.base.then(e,t)}catch(e){return this.base.catch(e)}resolve(e){return this.resolver(e),this}reject(e){return this.rejecter(e),this}notify(e){for(const t of this.progressCallbacks)t(e)}progress(e){return this.progressCallbacks.push(e),this}promise(){return this._promise}nativePromise(){return this.base}static resolve(){const e=new Xe;return e.resolve(),e.promise()}static reject(e){const t=new Xe;return t.reject(e),t.promise()}static all(e){const t=[];for(const a of e)a.nativePromise?t.push(a.nativePromise()):t.push(a);const a=new Xe;return Promise.all(t).then((e=>a.resolve(e)),(e=>a.reject(e))),a.promise()}}class Ze{constructor(e,t){this.basePromise=e,this.baseDeferred=t}then(e,t){return this.baseDeferred.then(e,t),this}catch(e){return this.baseDeferred.catch(e),this}progress(e){return this.baseDeferred.progress(e),this}nativePromise(){return this.basePromise}}const Qe=new Ye("asset.registerTexture");class Je{constructor(e,t,a){this.THREE=e,this.loadImage=t,this.scopedTextures=a,this.svgLoader=new et(new qe)}validateInput(e,t){const{textureId:a,textureSrc:n}=e;if(!K(a))throw Error(`textureId ${a} is not a valid string`);if(!K(n))throw Error(`textureSrc ${n} is not a valid string`);const o=this.scopedTextures.get(t.client.applicationKey);if(o){if(o.map[a])throw Error(a+" already has a registered texture")}return{textureId:a,textureSrc:n}}async exec(e,t){const{textureId:a,textureSrc:n}=e,o=this.scopedTextures.get(t.client.applicationKey)||{imagePromise:{},map:{}};this.scopedTextures.set(t.client.applicationKey,o);const[s,i]=n.endsWith(".svg")?this.loadSvgTexture(n):this.loadImageTexture(n);o.imagePromise[a]=i;try{const e=await i;s.image=e,s.needsUpdate=!0,o.map[a]=s}catch(t){throw delete o.imagePromise[a],Error(`Failed to load ${e.textureSrc}`)}}loadImageTexture(e){const t=new Xe,a=this.loadImage(e,(()=>t.resolve(a.image)),(e=>t.reject(e)));return[a,t.nativePromise()]}loadSvgTexture(e){return[new this.THREE.Texture,this.svgLoader.load(e)]}}class et{constructor(e){this.queue=e}async load(e){const t=await this.queue.get(e,{responseType:"text"}),a=document.createElement("div");a.innerHTML=t;const n=a.querySelector("svg");if(!n)throw Error("Failed trying to load "+e+"as an svg.");const o=n.getAttribute("width"),s=n.getAttribute("height");return o||s?(s&&!o&&(Qe.warn(e,"does not have a defined width. Defaulting width equal to height"),n.setAttribute("width",s)),o&&!s&&(Qe.warn(e,"does not have a defined height. Defaulting height equal to width"),n.setAttribute("height",o))):(Qe.warn(e,"does not have a defined size. Defaulting to a 128x128 resolution"),n.setAttribute("width",et.defaultResolution),n.setAttribute("height",et.defaultResolution)),new Promise((e=>{const t=new Image;t.onload=()=>e(t),t.src=URL.createObjectURL(new Blob([n.outerHTML],{type:"image/svg+xml"}))}))}}et.defaultResolution="128";var tt,at,nt,ot,st=a(846);!function(e){e.PHOTO="photo",e.RICH="rich",e.VIDEO="video"}(tt||(tt={})),function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(at||(at={})),function(e){e.ALPHA="alpha",e.COLORED_ROOMS="colored_rooms",e.MEASUREMENTS="measurements",e.PHOTOGRAMY="photogramy",e.SCHEMATIC="schematic"}(nt||(nt={})),function(e){e.AVAILABLE="available",e.LOCKED="locked",e.UNAVAILABLE="unavailable"}(ot||(ot={}));class it{constructor(e,t,a){this.floorData=e,this.modelData=t,this.apiClient=a}validateInput(e){const{sid:t}=e;if(!t)return{sid:this.modelData.model.sid};if(K(t))return{sid:t};throw Error(`"${t}" is not a valid sid string`)}async exec(e,t){var a,n,o,s,i,r,d,c,l;const h=this.floorData.getFloorIdMap(!1),u=await this.apiClient.query(st.Floorplans,{modelId:e.sid});(null===(o=null===(n=null===(a=null==u?void 0:u.data)||void 0===a?void 0:a.model)||void 0===n?void 0:n.assets)||void 0===o?void 0:o.floorplans)||this.throw("error fetching floorplans");const p=[];for(const e of null===(i=null===(s=u.data)||void 0===s?void 0:s.model)||void 0===i?void 0:i.assets.floorplans){let t=!1,a=!1;for(const n of e.flags)n===nt.PHOTOGRAMY&&(t=!0),n===nt.ALPHA&&(a=!0);if(t&&a){const t=null===(r=e.url)||void 0===r?void 0:r.search("vr_colorplan");if(t&&-1!==t){const t=null===(d=null==e?void 0:e.floor)||void 0===d?void 0:d.id;if(t){const a=h[t];p[parseInt(a,10)]=e}}}}const m=[];for(const e of p)if(e.url){const t=fetch(e.url).then((e=>e.arrayBuffer()));m.push(t)}return{imageDataUrls:(await Promise.all([...m]).catch((e=>this.throw(e)))).map((e=>(e=>{const t=[];for(let a=0;a<e.length;a+=8192)t.push(String.fromCharCode.apply(null,e.subarray(a,a+8192)));return btoa(t.join(""))})(new Uint8Array(e)))),data:{height:p[0].height||100,imageOriginX:(null===(c=p[0].origin)||void 0===c?void 0:c.x)||0,imageOriginY:(null===(l=p[0].origin)||void 0===l?void 0:l.y)||0,resolutionPpm:p[0].resolution||100,width:p[0].width||100}}}throw(e){throw Error("Asset.getVrColorplans: "+e)}}class rt{constructor(e){this.attachmentRegistry=e}validateInput(e,t){return K(e.id)||this.throw(j("tagId","string",e.id)),this.attachmentRegistry.get(t.client.applicationKey,e.id)||this.throw(`${e.id} does not map to a valid asset`),e}async exec(e,t){const a=this.attachmentRegistry.get(t.client.applicationKey,e.id);return a||this.throw(`${e.id} does not map to a valid asset`),a}throw(e){throw Error("Asset.getAssetById: "+e)}}class dt{constructor(e){this.attachmentRegistry=e}validateInput(e,t){return e}exec(){return this.attachmentRegistry.refresh()}}function ct(e,t,a,n,o,s){const{floorData:i,modelData:r,modelApiClient:d}=o,c=function(e,t){const a=z.create(t,new F(it));return e.addAsyncCommandToInterface({namespace:"Asset",name:"getVrColorplans",args:["sid"],origins:X},a),a}(e,new V(i,r,d)),l=function(e,t,a,n){const o=z.create(n,new F(Je,t,a.loadImage));return e.addAsyncCommandToInterface({namespace:"Asset",name:"registerTexture",args:["textureId","textureSrc"]},o),o}(e,t,a,new V(n)),h=function(e,t){const a=z.create(t,new F(rt));return e.addAsyncCommandToInterface({namespace:"Asset",name:"getAssetById",args:["id"],origins:X},a),a}(e,new V(s)),u=function(e,t){const a=z.create(t,new F(dt));return e.addAsyncCommandToInterface({namespace:"Asset",name:"refreshAssets",args:[],origins:X},a),a}(e,new V(s));return{getVrColorplans:c,registerTexture:l,getAssetById:h,refreshAssets:u}}class lt extends ie{constructor(){super()}}lt.id="GET_POSE";const ht=40*Math.PI/180/1e3;class ut extends ie{constructor(e){super(),this.payload=e}}ut.id="LOOK_AT_SCREEN_COORDS";const pt=new Ye("broadcast.move"),mt=100;function gt(e,t){return Object.values(e).includes(t)}class wt extends ie{constructor(e){super(),this.payload=e}}wt.id="MOVE_DIRECTION";const ft=.005;class yt extends ie{constructor(e){super(),this.payload={x:e.x,z:e.z}}}function Tt(e,t){e.x=t.x,e.y=t.y}function vt(e,t){Tt(e,t),e.z=t.z}yt.id="PAN";class It extends Error{constructor(e,t){var a;super(e instanceof Error?e.message:e),this.name="BaseException",t&&(this.code=t),e instanceof Error&&(this.originalError=e,(a=e)&&a instanceof Error&&a.isMock&&(this.isMock=!0))}}function Et(e,t){const a=t.length;e.length=a;for(let n=0;n<a;++n)e[n]=t[n];return e}class Ct extends It{constructor(){super("Cannot copy into an array of a different size"),this.name="ArraySizeMismatch"}}const bt=(e,t,a=1e-5)=>Math.abs(e-t)<=a,At=(e,t,a=1e-5)=>bt(e.x,t.x,a)&&bt(e.y,t.y,a),St=(e,t,a=1e-5)=>At(e,t,a)&&bt(e.z,t.z,a);class Dt{create(e,t,a,n){const o=()=>e.onChanged();return new _e(t.onChanged(o),a.onChanged(o),n.onChanged(o))}}class Ot{constructor(e,t){this._data={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:h.Mode.TRANSITIONING},this.THREE=e,this.viewmodeConverter=t,this.tempEuler=new e.Euler}get data(){return this._data}equals(e){const t=1e-5;return St(e._data.position,this._data.position,t)&&At(e._data.rotation,this._data.rotation,t)&&((e,t,a=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,n)=>!bt(e,t[n],a))))(e._data.projection,this._data.projection,t)&&e._data.sweep===this._data.sweep&&e._data.mode===this._data.mode}update(e,t,a,n){const o=this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ"),s=t.currentSweep&&t.isSweepUnaligned(t.currentSweep),i=a.isInside()?e.pose.position:e.pose.fovCorrectedPosition();vt(this._data.position,i),this._data.rotation.x=this.THREE.MathUtils.radToDeg(o.x),this._data.rotation.y=this.THREE.MathUtils.radToDeg(o.y),this._data.projection=Float32Array.from(e.pose.projection.asThreeMatrix4().transpose().elements),this._data.sweep=t.currentSweepObject?n.getIdForSweep(t.currentSweepObject):"",this._data.mode=this.viewmodeConverter.toSdk(a.currentMode,!s,e.pose.isPitchFactorOrtho)}copy(e){vt(this._data.position,e.data.position),Tt(this._data.rotation,e.data.rotation),function(e,t){if(e.byteLength!==t.byteLength)throw new Ct;const a=t.length;for(let n=0;n<a;++n)e[n]=t[n]}(this._data.projection,e.data.projection),this._data.sweep=e.data.sweep,this._data.mode=e.data.mode}}var Mt,Rt,Nt,Pt,xt;!function(e){e.Desktop="desktop",e.Mobile="mobile",e.VrOrientOnly="xr.orientonly",e.VrWithController="xr.controller",e.VrWithTrackedController="xr.trackedcontroller",e.VrTransientPointer="xr.transient-pointer",e.VrUnknown="xr."}(Mt||(Mt={})),function(e){e.None="interaction.none",e.Direct="interaction.direct",e.Key="interaction.key",e.Gui="interaction.gui",e.Mouse="interaction.mouse",e.Touch="interaction.touch",e.Pen="interaction.pen",e.XRController="interaction.xr.controller",e.XRGaze="interaction.xr.gaze",e.XRScreen="interaction.xr.screen"}(Rt||(Rt={})),function(e){e[e.Instant=0]="Instant",e[e.FadeToBlack=1]="FadeToBlack",e[e.Interpolate=2]="Interpolate",e[e.MoveToBlack=3]="MoveToBlack",e[e.OrbitTo=4]="OrbitTo"}(Nt||(Nt={})),function(e){e[e.Full=0]="Full",e[e.ClearToBlack=1]="ClearToBlack",e[e.BlackToClear=2]="BlackToClear"}(Pt||(Pt={})),function(e){e[e.Top=1]="Top",e[e.Bottom=2]="Bottom"}(xt||(xt={}));const _t=Math.PI/180;Math.PI;Object.freeze({camera:{transitionBlackoutTime:300,transitionFadeTime:800,baseTransitionTime:200,transitionSpeed:3,autoOrbitMinVelocity:.002,autoOrbitMaxVelocity:.08,autoOrbitTransitionTIme:1e3,autoOrbitLowerPhiLimit:30*_t,autoOrbitUpperPhiLimit:90*_t}});Mt.Desktop,Nt.Interpolate,Mt.Mobile,Nt.Interpolate,Mt.VrOrientOnly,Nt.FadeToBlack,Mt.VrWithController,Nt.FadeToBlack,Mt.VrWithTrackedController,Nt.FadeToBlack,Mt.VrTransientPointer,Nt.FadeToBlack,Mt.VrUnknown,Nt.FadeToBlack;const Lt=75*_t;function kt(e){return async function(t,a,n){const{x:o,y:s,z:i,w:r}=n.startOrientation,d=new e.Quaternion(o,s,i,r).normalize(),{x:c,y:l,z:h,w:u}=n.endOrientation,p=new e.Quaternion(c,l,h,u).normalize(),m=n.duration||0;await t.rotateBetweenOrientations(!!n.fadeToBlack,d,p,m,n.allowOverlappingTransitions)}}class Vt extends ie{constructor(e){super(),this.payload={xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,rotationSpeed:e.rotationSpeed,clampYRotation:e.clampYRotation}}}Vt.id="ROTATE";class Ft extends ie{constructor(e){super(),this.payload={startOrientation:Object.assign({},e.startOrientation),endOrientation:Object.assign({},e.endOrientation),duration:e.duration,fadeToBlack:e.fadeToBlack,allowOverlappingTransitions:e.allowOverlappingTransitions}}}function Ut(e,t,a){const n=new e.Euler,o=new e.Euler;return async function(e,s,i,r){if(i.currentMode!==t.Panorama)throw Error("Camera.setRotation is only available in Panorama mode");const d=r.xAngle%(.5*Math.PI),c=r.yAngle%(2*Math.PI),l=e.pose.rotation;n.setFromQuaternion(l,"YXZ");let h=c-n.y;return Math.abs(h)>Math.PI&&(h-=2*Math.sign(h)*Math.PI),o.set(d-n.x,h,0,"YXZ"),o.y%=2*Math.PI,a(s,e,{xAngle:-o.y,yAngle:o.x,zAngle:0,rotationSpeed:r.rotationSpeed,clampYRotation:!1})}}Ft.id="ROTATE_BETWEEN_ORIENTATIONS";class Gt extends Vt{}function Ht(e,t,a,n){const o=t.MathUtils.degToRad(80)/1e3;n.getDependencies().then((([e,t,n])=>{a.addBinding(Vt,(async n=>await a.rotateCamera(e,t,n))),a.addBinding(Ft,(async n=>await a.rotateCameraBetweenOrientations(e,t,n))),a.addBinding(Gt,(async o=>await a.orientCamera(t,e,n,o)))}));const s=e=>{const a=(e=e||{}).options||{},n=t.MathUtils.degToRad(e.xAngle||0),s=t.MathUtils.degToRad(e.yAngle||0),i=t.MathUtils.degToRad(e.zAngle||0),r=!!e.clampYRotation;let d=o;if(a.speed){if(isNaN(a.speed)||a.speed<=0)throw new Error(`${JSON.stringify(a)} does not contain valid rotation speed`);d=t.MathUtils.degToRad(a.speed)/1e3}if(isNaN(n)||isNaN(s)||isNaN(i))throw new Error(`${JSON.stringify(e)} does not contain valid rotation angles`);return{xAngle:n,yAngle:s,zAngle:i,rotationSpeed:d,clampYRotation:r}};e.addCommandCreator({namespace:"Camera",name:"rotate",args:["xAngle","yAngle","options"]},(e=>new Vt(s({xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,options:e.options,clampYRotation:!0})))),e.addCommandCreator({namespace:"Camera",name:"rotateBetweenOrientations",args:["startOrientation","endOrientation","duration","fadeToBlack","allowOverlappingTransitions"]},(e=>new Ft((e=>{const t=e=>null===e.x||isNaN(e.x)||null===e.y||isNaN(e.y)||null===e.z||isNaN(e.z)||null===e.w||isNaN(e.w);if(!(e=e||{}).duration||isNaN(e.duration)||e.duration<=0)throw new Error(`${JSON.stringify(e)} does not contain valid rotation duration`);if(t(e.startOrientation)||t(e.endOrientation))throw new Error(`${JSON.stringify(e)} does not contain valid start and end orientations`);const{x:a,y:n,z:o,w:s}=e.startOrientation,{x:i,y:r,z:d,w:c}=e.endOrientation;return{startOrientation:{x:a,y:n,z:o,w:s},endOrientation:{x:i,y:r,z:d,w:c},duration:e.duration,fadeToBlack:!!e.fadeToBlack,allowOverlappingTransitions:!!e.allowOverlappingTransitions}})({startOrientation:null==e?void 0:e.startOrientation,endOrientation:null==e?void 0:e.endOrientation,duration:e.duration,fadeToBlack:e.fadeToBlack,allowOverlappingTransitions:e.allowOverlappingTransitions})))),e.addCommandCreator({namespace:"Camera",name:"setRotation",args:["rotation","options"]},(e=>{const t=(e=e||{}).rotation||{};return new Gt(s({xAngle:t.x,yAngle:t.y,zAngle:t.z,options:e.options,clampYRotation:!1}))}))}Gt.id="SET_ORIENTATION";class Bt extends ie{}Bt.id="STOP";const zt=.7,jt=3,$t=function(e,t,a){return Math.max(t,Math.min(e,a))};const Wt=new Ye("command.zoom");class qt{constructor(e,t,a,n){this.cameraData=a,this.viewmodeData=n,this.Viewmode=e.Viewmode,this.ZoomSetCommand=e.ZoomSetCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomPct-0;if(isNaN(t))throw Error(t+" is not a valid zoom level");return t<zt&&jt<t&&(e.zoomPct=$t(t,zt,jt),Wt.warn(t,`is outside the valid zoom range of [${zt}, ${jt}]`)),e}async exec(e,t){return Xt(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomSetCommand(e.zoomPct)),this.cameraData.zoom()}}class Kt{constructor(e,t,a,n){this.cameraData=a,this.viewmodeData=n,this.Viewmode=e.Viewmode,this.ZoomInCommand=e.ZoomInCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomDelta-0;if(isNaN(t))throw Error(t+" is not a valid zoom delta");return e.zoomDelta=t||0,e}async exec(e,t){return Xt(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomInCommand(e.zoomDelta)),this.cameraData.zoom()}}class Yt{constructor(e,t,a,n){this.viewmodeData=n,this.Viewmode=e.Viewmode,this.ZoomResetCommand=e.ZoomResetCommand,this.issueCommand=t.issueCommand}validateInput(e){return e}async exec(e,t){Xt(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomResetCommand)}}function Xt(e,t){if(t!==e.Panorama)throw Error("Zoom controls are currently only supported in Panorama mode")}class Zt{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Qt{constructor(e){this._data={level:1}}get data(){return this._data}equals(e){return this._data.level===e.data.level}copy(e){this._data.level=e.data.level}update(e,t){t.isInside()&&(this._data.level=e.zoom())}}function Jt(e,t){const a=new e.Euler;return function(n,o,s,i,r){const d=a.setFromQuaternion(o.pose.rotation,"YXZ"),c=s.currentSweep&&s.isSweepUnaligned(s.currentSweep);return n.position.x=o.pose.position.x,n.position.y=o.pose.position.y,n.position.z=o.pose.position.z,n.rotation.x=e.MathUtils.radToDeg(d.x),n.rotation.y=e.MathUtils.radToDeg(d.y),n.projection=Float32Array.from(o.pose.projection.asThreeMatrix4().transpose().elements),n.sweep=s.currentSweepObject?r.getIdForSweep(s.currentSweepObject):"",n.mode=t.toSdk(i.currentMode,!c,o.pose.isPitchFactorOrtho),n}}class ea{constructor(){this.wasInTransition=!1,this.currentFloor=""}create(e,t,a,n,o){return new _e(t.makeFloorChangeSubscription((()=>this.throttleCurrentFloorChanges(e,t))),n.onChanged((()=>this.throttleCameraTranstionChanges(e,n,a,o))),a.onChanged((()=>this.throttleCameraTranstionChanges(e,n,a,o))),o.onChanged((()=>this.throttleCameraTranstionChanges(e,n,a,o))))}throttleCameraTranstionChanges(e,t,a,n){const o=t.transition.active||a.transition.active;o!==this.wasInTransition&&(this.wasInTransition=o,e.onChanged())}throttleCurrentFloorChanges(e,t){const a=t.currentFloorId;a!==this.currentFloor&&(this.currentFloor=a,e.onChanged())}}class ta{constructor(e){this._data={id:void 0,sequence:void 0,name:""},this.SweepAlignmentType=e.SweepAlignmentType,this.SweepPlacementType=e.SweepPlacementType}get data(){return this._data}equals(e){const t=this.data,a=e.data;return t.id===a.id&&t.sequence===a.sequence&&t.name===a.name}copy(e){this._data.id=e.data.id,this._data.sequence=e.data.sequence,this._data.name=e.data.name}update(e,t,a,n,o){const s=e.currentFloor,i=t.currentSweep&&t.getSweep(t.currentSweep);!n.isTourActive()&&a.transition.active&&!t.transitionActive||function(){if(t.transitionActive&&t.transition.to&&t.transition.from){const e=t.getSweep(t.transition.to),a=t.getSweep(t.transition.from);return e.floorId!==a.floorId}return!1}()?(this._data.id="",this._data.sequence=void 0,this._data.name=""):i&&i.alignmentType===this.SweepAlignmentType.UNALIGNED&&i.placementType===this.SweepPlacementType.UNPLACED?(this._data.id=void 0,this._data.sequence=void 0,this._data.name=""):s?(this._data.id=o.getIdFromCwfId(s.id),this._data.sequence=s.index,this._data.name=s.name):(this._data.id="",this._data.sequence=-1,this._data.name="all")}}class aa{static async create(e,t,a){const n=await e.getDependencies();return new aa(n,e,t,a)}constructor(e,t,a,n){this.dependencies=e,this.optionals=t,this.subscriptionFactory=a,this.dataFactory=n,this.dirty=!0,this.observers=new Set,this.currentData=n.create(...e,...t.getOptionals());const o=new class{constructor(e){this.collection=e}onChanged(){this.collection.dirty=!0;for(const e of this.collection.observers)e.onChanged()}}(this);this.dependencySubscription=t.onOptionalsFulfilled((()=>{var e;null===(e=this.changeSubscription)||void 0===e||e.cancel(),this.changeSubscription=this.subscriptionFactory.create(o,...this.dependencies,...this.optionals.getOptionals()),o.onChanged()})),this.changeSubscription=this.subscriptionFactory.create(o,...this.dependencies,...this.optionals.getOptionals()),this.changeSubscription.cancel()}getData(){return this.currentData.data}subscribe(e){const t=this.dependencies,a=this.optionals;const n=new class{constructor(e){this.sdkCollection=e,this.needsUpdate=!0,this.diffRecord={added:new Map,removed:new Map,updated:new Map},this.dataView=e.dataFactory.create(...t,...a.getOptionals())}get dirty(){return this.needsUpdate}readDiff(){const{added:t,removed:a,updated:n}=this.diffRecord;if(t.clear(),a.clear(),n.clear(),!this.dirty)return this.diffRecord;this.sdkCollection.update(e);const o=this.sdkCollection.currentData;for(const e in o.data)this.dataView.data.hasOwnProperty(e)?this.dataView.isItemEqual(o,e)||n.set(e,o.data[e]):t.set(e,o.data[e]);for(const e in this.dataView.data)o.data.hasOwnProperty(e)||a.set(e,this.dataView.data[e]);return this.dataView.update(e),this.needsUpdate=!1,this.diffRecord}onChanged(){this.needsUpdate=!0}renew(){this.sdkCollection.addObserver(this)}cancel(){this.sdkCollection.removeObserver(this)}}(this);return this.addObserver(n),n}update(e){this.dirty&&this.observers.size>0&&(this.currentData.update(e),this.dirty=!1)}addObserver(e){0===this.observers.size&&(this.dependencySubscription.renew(),this.changeSubscription.renew(),this.dirty=!0),this.observers.add(e)}removeObserver(e){this.observers.delete(e),0===this.observers.size&&(this.dependencySubscription.cancel(),this.changeSubscription.cancel(),this.currentData.clear())}}class na{create(e,t){return t.onChanged((()=>e.onChanged()))}}class oa{constructor(e,t){this.floorData=e,this.floorIdMap=t,this._data={}}get data(){return this._data}isItemEqual(e,t){const a=this.data[t],n=e.data[t];return a.id===n.id&&a.name===n.name&&a.sequence===n.sequence}update(){for(const e of this.floorData.getCollection()){const t=this.floorIdMap.getIdFromCwfId(e.id),a=this._data[t]||{};a.id=t,a.sequence=e.index,a.name=e.name,this._data[t]=a}for(const e in this.data){this.floorIdMap.getFloorForId(e)||delete this._data[e]}}clear(){this._data={}}}class sa extends ie{}async function ia(e){try{const{currentFloor:t,totalFloors:a}=e,n=e.getFloorNames();return{currentFloor:t?t.index:-1,floorNames:n,totalFloors:a}}catch(e){throw Error("no floors currently loaded")}}sa.id="GET_FLOORS_DATA";class ra extends ie{constructor(e){super(),this.payload=e}}ra.id="MOVE_TO_FLOOR";class da{constructor(e,t,a){this.floorsViewData=a,this.issueCommand=t.issueCommand,this.ShowAllFloorsCommand=e.ShowAllFloorsCommand}validateInput(e){return e}async exec(e,t){try{await this.issueCommand(new this.ShowAllFloorsCommand({moveCamera:!0}));const e=this.floorsViewData.currentFloor;return e?e.index:-1}catch(e){throw Error("Could not show all floors")}}}class ca{constructor(e){this.FloorsData=e}validateInput(e){return{invert:!!(null==e?void 0:e.invert)||!1}}async exec(e,t){return this.FloorsData.getFloorIdMap(e.invert)}}class la extends ie{}function ha(e,t){return function(a,n,o,s){const i=o.getCollection(),r=[],d=new e.Vector2;for(const o of i){t(a,o.position,d);const{id:i,index:c}=n.getFloor(o.floorId),l=s.getIdFromCwfId(i),h=ae(o);r.push(Object.assign(Object.assign({},h),{position:(new e.Vector3).copy(o.position),screenPosition:d,floor:c,floorInfo:{id:l,sequence:c}}))}return r}}la.id="LABEL_GET";class ua{create(e,t){return t.onChanged((()=>e.onChanged()))}}class pa{constructor(e,t,a){this.labelData=e,this.floorsData=t,this.floorIdMap=a,this._data={}}get data(){return this._data}isItemEqual(e,t){return!ne(this.data[t],e.data[t])}update(){var e;for(const t of this.labelData.getCollection()){const a=null!==(e=this.data[t.sid])&&void 0!==e?e:{};a.position=t.position,a.sid=t.sid,a.text=t.text,a.visible=t.visible;const n=this.floorsData.getFloor(t.floorId);a.floorInfo={id:this.floorIdMap.getIdFromCwfId(n.id),sequence:n.index},this.data[a.sid]=a}for(const e in this.data){this.labelData.getLabel(e)||delete this.data[e]}}clear(){this._data={}}}class ma{constructor(e){this.deepLinker=e}validateInput(e){return e}async exec(e,t){const a=this.deepLinker.creator.createLink();return decodeURIComponent(a.href)}}class ga{constructor(e){this.deepLinker=e}validateInput(e){return e}async exec(e,t){const a=this.deepLinker.creator.createDeepLink();return decodeURIComponent(a.href)}}function wa(e){return!!e&&"object"==typeof e}function fa(e){return"boolean"==typeof e}function ya(e,t,a,n){switch(e){case c.OpenPolicy.DEFAULT:a.handler.resetPolicy(t);break;case c.OpenPolicy.NEW_WINDOW:a.handler.setPolicy(t,a.handler.HandlingPolicy.NEW_WINDOW);break;case c.OpenPolicy.SAME_FRAME:a.handler.setPolicy(t,a.handler.HandlingPolicy.IN_FRAME);break;case c.OpenPolicy.CURRENT_WINDOW:a.handler.setPolicy(t,a.handler.HandlingPolicy.CUSTOM,(e=>{n.sendPrivateMessage("open link",{href:e})}))}}class Ta{constructor(e,t,a){this.sdk=e,this.deepLinker=t,this.api=a}validateInput(e){if(!gt(c.OpenPolicy,e.policy))throw Error(`Link.setModelLinkPolicy: ${e.policy} is not a valid Link.OpenPolicy`);if(!K(e.baseHref))throw Error("Link.setModelLinkPolicy: could not determine window.location");if(gt(c.DestinationPolicy,e.destinationPolicy))return{policy:e.policy,baseHref:e.baseHref,destinationPolicy:e.destinationPolicy};const t=wa(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!K(t)||K(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setModelLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}async exec(e,t){const a=va(e,this.api);e.policy!==c.OpenPolicy.NEW_WINDOW&&e.policy!==c.OpenPolicy.CURRENT_WINDOW||!a?ya(e.policy,this.deepLinker.LinkType.MODEL,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.MODEL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const n=new URLSearchParams(window.location.search),o=new URL(t).searchParams;n.set("m",o.get("m")||o.get("model")||"");const s=new URL(ba(a,n));s.searchParams.set("m",o.get("m")||o.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===c.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(s.href)})}))}}function va(e,t){var a;if(function(e){return!e.destinationPolicy}(e))return null===(a=e.options)||void 0===a?void 0:a.templateHref;const n=t.getApi().baseUrl;return{[c.DestinationPolicy.DEFAULT]:"",[c.DestinationPolicy.MATTERPORT]:n+"/show/"}[e.destinationPolicy]}class Ia{constructor(e,t,a){this.sdk=e,this.deepLinker=t,this.api=a}validateInput(e){if(!gt(c.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);if(!K(e.baseHref))throw Error("Link.setNavigationLinkPolicy: could not determine window.location");if(gt(c.DestinationPolicy,e.destinationPolicy))return{policy:e.policy,baseHref:e.baseHref,destinationPolicy:e.destinationPolicy};const t=wa(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!K(t)||K(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setNavigationLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}async exec(e,t){const a=va(e,this.api);e.policy!==c.OpenPolicy.NEW_WINDOW&&e.policy!==c.OpenPolicy.CURRENT_WINDOW||!a?ya(e.policy,this.deepLinker.LinkType.NAVIGATION,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.NAVIGATION,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const n=new URLSearchParams(window.location.search),o=new URLSearchParams(t),s=new URL(ba(a,n));!function(e,t){const[a,n,o,s,i,r,d]=[t.get("sm"),t.get("sp"),t.get("sq"),t.get("sr"),t.get("ss"),t.get("sz"),t.get("start")];K(a)&&e.set("sm",a);K(n)&&e.set("sp",n);K(o)&&e.set("sq",o);K(s)&&e.set("sr",s);K(i)&&e.set("ss",i);K(r)&&e.set("sz",r);K(d)&&e.set("start",d)}(s.searchParams,o),s.searchParams.set("m",o.get("m")||o.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===c.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(s.href)})}))}}class Ea{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){if(!gt(c.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);return{policy:e.policy}}async exec(e,t){ya(e.policy,this.deepLinker.LinkType.SAME_ORIGIN,this.deepLinker,this.sdk)}}class Ca{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){const{openInNewWindow:t}=e;if(!fa(t))throw Error(`${e.openInNewWindow} is expected to strictly be a boolean to avoid confusion about truth-y and false-y values.`);return{openInNewWindow:t}}async exec(e,t){e.openInNewWindow?this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.NEW_WINDOW):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(e=>{this.sdk.sendPrivateMessage("open link",{href:e})}))}}function ba(e,t){const a=/\$\{([a-zA-Z]+)\}/,n=new URL(e);let o,s=decodeURI(n.pathname);for(;o=s.match(a);){const e=t.get(o[1]);s=s.replace(o[0],`${e}`)}for(n.pathname=s;o=n.search.match(a);){const e=t.get(o[1]);n.search=null!==e||""===e?n.search.replace(o[0],`${o[1]}=${e}`):n.search.replace(o[0],`${o[1]}`)}return n.href}function Aa(e,t){return!!Array.isArray(e)&&e.every(t)}class Sa{constructor(e){this.deepLinks=e}validateInput(e){const{policy:t,baseHref:a}=e;if(!gt(c.CreationPolicy,t))throw Error(`Link.setShareLinkPolicy: ${e.policy} is not a valid Link.ShareLinkPolicy`);if(!K(a))throw Error("Link.setShareLinkPolicy: Could not determine window.location");const n=wa(e.options)&&e.options.includeParams?e.options.includeParams:[];if(!Aa(n,K))throw Error("Link.setShareLinkPolicy: 'includeParams' expects an array of strings");return{policy:t,baseHref:this.validateBaseHref(t,a),options:{includeParams:n}}}validateBaseHref(e,t){const a=/^https:\/\/([a-z0-9\-]*\.)*(matterport\.com|matterportvr\.cn)$/,n=/^https:\/\/static\.(matterport\.com|matterportvr\.cn)$/;return{[c.CreationPolicy.MATTERPORT]:function(){if(window.location.origin.match(a)&&!window.location.origin.match(n))return window.location.href;const e=decodeURIComponent(new URLSearchParams(window.location.search.toLowerCase()).get("apihost")||"");return e.match(a)?e+"/show/":"https://my.matterport.com/show/"},[c.CreationPolicy.REFERRER]:function(){return t},[c.CreationPolicy.WINDOW]:function(){return window.location.href}}[e]()}async exec(e,t){this.deepLinks.creator.setDefaultBaseHref(e.baseHref,e.options.includeParams)}}class Da{constructor(e,t){this.toSdkMediaMap={[e.PHOTO]:l.MediaType.PHOTO,[e.VIDEO]:l.MediaType.VIDEO,[e.RICH]:l.MediaType.RICH},this.toSdkMediaFromChunk={[t.error]:l.MediaType.NONE,[t.link]:l.MediaType.NONE,[t.none]:l.MediaType.NONE,[t.photo]:l.MediaType.PHOTO,[t.rich]:l.MediaType.RICH,[t.text]:l.MediaType.NONE,[t.video]:l.MediaType.VIDEO}}toSdkMedia(e){return this.toSdkMediaMap[e]}fromTagChunkType(e){return this.toSdkMediaFromChunk[e]}}class Oa{constructor(e){this.toSdkChunkTypeMap={[e.error]:l.DescriptionChunkType.NONE,[e.link]:l.DescriptionChunkType.LINK,[e.none]:l.DescriptionChunkType.NONE,[e.photo]:l.DescriptionChunkType.NONE,[e.rich]:l.DescriptionChunkType.NONE,[e.text]:l.DescriptionChunkType.TEXT,[e.video]:l.DescriptionChunkType.NONE}}toSdkChunkType(e){return this.toSdkChunkTypeMap[e]}}class Ma{constructor(e){this.toSdkLinkTypeMap={[e.NAVIGATION]:l.LinkType.NAVIGATION,[e.MODEL]:l.LinkType.MODEL,[e.EXT_LINK]:l.LinkType.EXT_LINK}}toSdkLinkType(e){return this.toSdkLinkTypeMap[e]}}var Ra,Na,Pa,xa,_a;!function(){(Ra||(Ra={})).create=async function(t,a){const n=await t.getDependencies();return new e(a.create(...n))};class e{constructor(e){this.executor=e}validateInput(e,t){return this.executor.validateInput(e,t)}exec(e,t){const a=this.executor.validateInput(e,t);return this.executor.exec(a,t)}}}(),function(e){e.FILE_TOO_LARGE="oversize",e.EMPTY_FILE="empty",e.OVER_QUOTA="overQuota",e.UPLOAD_FAILED="failed",e.PERMISSION_DENIED="permission"}(Na||(Na={})),function(e){e.EMBED_FAIL="embedFail",e.EMBED_SUCCESS="success"}(Pa||(Pa={})),function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.TEXT="text",e.AUDIO="audio",e.MODEL="model",e.APPLICATION="application"}(xa||(xa={})),function(e){e.EXTERNAL="external",e.UPLOAD="upload",e.SANDBOX="sandbox"}(_a||(_a={}));const La=new Ye("expiring-resource"),ka=new WeakMap;class Va{constructor(e,t){this.value=e,this.validUntil=t}refreshFrom(e){if(!e)return;this.value=e.value,this.validUntil=e.validUntil;const t=ka.get(this);t&&(t.resolve(),ka.delete(this))}async get(){if(this.validUntil&&this.onStale){const e=Date.now();if(e+6e4+1e4>this.validUntil.getTime()){let t=ka.get(this);t||(t=new Xe,ka.set(this,t),this.onStale()),e+6e4+1e3>this.validUntil.getTime()&&(La.info("Stale resource, waiting for refresh"),await t.nativePromise(),La.info("Refreshed resource"))}}return this.value}getCurrentValue(){return this.value}}function Fa(e=11,t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"){let a="";const n=window.crypto||window.msCrypto;let o;o=n?n.getRandomValues(new Uint8Array(e)):new Uint8Array(e).map((()=>255*Math.random()));for(let n=0;n<e;n++)a+=t.charAt(o[n]%t.length);return a}var Ua,Ga;!function(e){e.PHOTO="photo",e.VIDEO="video",e.LINK="link",e.RICH="rich"}(Ua||(Ua={})),function(e){e.IMAGE="tag.attachment.image",e.RICH="tag.attachment.rich",e.VIDEO="tag.attachment.video"}(Ga||(Ga={}));class Ha{constructor(e,t,a,n){this.attachmentsModule=t,this.pluginConfigData=n,this.globalAttachments=new Map,this.perClientAttachments=new Map,this.clientAttachments=new Map,this.clientIds=new Set,this.attachmentDescriptors=new Map,this.observable=new k,this.oEmbed=a;for(const t of e.getTagList()){const a=e.getTag(t);for(const e of a.fileAttachments)this.globalAttachments.set(e.id,e),this.autoRefreshExpiringAttachment(e);for(const e of a.externalAttachments)this.globalAttachments.set(e.id,e),this.setDescriptorUrl(e,e.src)}null==n||n.getMdsResult().then((e=>e.flatMap((e=>e.attachments)))).then((e=>{e.forEach((e=>{this.globalAttachments.set(e.id,e),this.autoRefreshExpiringAttachment(e)}))}))}async refresh(){const e=await this.attachmentsModule.getAllAttachments();for(const t of e)this.globalAttachments.has(t.id)||(this.globalAttachments.set(t.id,t),this.autoRefreshExpiringAttachment(t));if(this.pluginConfigData){(await this.pluginConfigData.getMdsResult()).flatMap((e=>e.attachments)).forEach((e=>{this.globalAttachments.set(e.id,e),this.autoRefreshExpiringAttachment(e)}))}}get(e,t){return this.globalAttachments.get(t)||this.clientAttachments.get(t)}add(e,t){const a=this.createIAttachment({src:t.src,type:t.type});return this.clientAttachments.set(a.id,a),this.setDescriptorUrl(a,t.src),this.clientIds.add(a.id),this.observable.notify(),a.id}async addBySrc(e,t){const a=await this.createOEmbedIAttachment(t);return this.clientAttachments.set(a.id,a),this.setDescriptorUrl(a,t),this.clientIds.add(a.id),this.observable.notify(),a.id}addSandbox(e,t){const a=this.getUniqueId(),n=t.name||"sandbox-"+a,o={id:a,src:n,srcDoc:t.srcDoc,onLoad:t.sandboxLoadedHandler,category:_a.SANDBOX,mediaType:xa.RICH,parentType:at.MATTERTAG,thumbnailUrl:new Va("",null),downloadUrl:new Va("",null),url:new Va("",null),created:new Date,height:t.size.h,width:t.size.w};return this.clientAttachments.set(a,o),this.setDescriptorUrl(o,n),this.clientIds.add(a),this.observable.notify(),[a,o]}has(e){return this.globalAttachments.has(e)||this.clientIds.has(e)}*[Symbol.iterator](e){for(const e of this.globalAttachments)yield e;for(const e of this.clientAttachments)yield e;if(e){const t=this.perClientAttachments.get(e)||[];for(const e of t)yield e}}*descriptors(){for(const e of this.attachmentDescriptors)yield e}onChanged(e){return this.observable.observe(e)}getUniqueId(){const e=Fa(10);return this.globalAttachments.has(e)||this.clientIds.has(e)?this.getUniqueId():e}async autoRefreshExpiringAttachment(e){const t=e.url,a=async()=>{if(t.validUntil){const n=t.validUntil.getTime()-Date.now(),o=n<=0;if(o){const a=await t.get();this.setDescriptorUrl(e,a),this.observable.notify()}setTimeout(a,o?0:n)}},n=await t.get();this.setDescriptorUrl(e,n),a(),this.observable.notify()}setDescriptorUrl(e,t){this.attachmentDescriptors.set(e.id,{id:e.id,src:t,type:this.getAttachmentType(e.mediaType)})}getAttachmentType(e){return{[xa.APPLICATION]:f.AttachmentType.APPLICATION,[xa.AUDIO]:f.AttachmentType.AUDIO,[xa.IMAGE]:f.AttachmentType.IMAGE,[xa.MODEL]:f.AttachmentType.MODEL,[xa.PDF]:f.AttachmentType.PDF,[xa.RICH]:f.AttachmentType.RICH,[xa.TEXT]:f.AttachmentType.TEXT,[xa.VIDEO]:f.AttachmentType.VIDEO,[xa.ZIP]:f.AttachmentType.ZIP}[e]}createIAttachment(e){const t={[Ga.IMAGE]:xa.IMAGE,[Ga.RICH]:xa.RICH,[Ga.VIDEO]:xa.VIDEO};return{id:this.getUniqueId(),mediaType:t[e.type],category:_a.EXTERNAL,src:e.src,parentType:at.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new Va("",null),downloadUrl:new Va("",null),url:new Va("",null),mimeType:""}}async createOEmbedIAttachment(e){const t={[Ua.PHOTO]:xa.IMAGE,[Ua.RICH]:xa.RICH,[Ua.VIDEO]:xa.VIDEO},a=this.getUniqueId(),n=t[(await this.oEmbed.getOEmbedData(e)).type];if(!n)throw Error("unable to determine media type");return{id:a,mediaType:n,category:_a.EXTERNAL,src:e,parentType:at.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new Va("",null),downloadUrl:new Va("",null),url:new Va("",null),mimeType:""}}}const Ba={[l.MediaType.PHOTO]:Ga.IMAGE,[l.MediaType.RICH]:Ga.RICH,[l.MediaType.VIDEO]:Ga.VIDEO};class za{constructor(e,t,a,n){this.tagAdd=e,this.tagEditIcon=t,this.tagAttach=a,this.attachmentRegistry=n}validateInput(e,t){return{descriptors:this.tagAdd.validateInput({descriptors:Array.isArray(e.descriptors)?e.descriptors:[e.descriptors]},t).descriptors}}async exec(e,t){const a=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors],n=new Map;for(const e of a)if(e.media&&e.media.type!==l.MediaType.NONE){const a=this.attachmentRegistry.add(t.client.applicationKey,{src:e.media.src,type:Ba[e.media.type]});n.set(e.media.src,a)}const o=async e=>{for(let n=0;n<e.length;++n){const o=a[n];o.iconId&&await this.tagEditIcon.exec({id:e[n],iconId:o.iconId},t)}},s=async e=>{for(let o=0;o<e.length;++o){const s=a[o];if(s.media&&s.media.type!==l.MediaType.NONE){const a=n.get(s.media.src);a&&this.tagAttach.exec({tagId:e[o],attachmentIds:[a]},t)}}};return this.tagAdd.exec({descriptors:a},t).then((async e=>(await o(e),await s(e),e)))}}function ja(e,t,a){return(a=a||{}).x=e[t].x,a.y=e[t].y,a.z=e[t].z,a}function $a(e,t,a){return(a=a||{}).r=e[t].r,a.g=e[t].g,a.b=e[t].b,a}class Wa{create(e,t){return t.onChanged((()=>e.onChanged()))}}class qa{constructor(e,t,a,n){this.mattertagData=t,this.floorsData=a,this.floorIdMap=n,this._data={},this.mediaConverter=e.mediaConverter}get data(){return this._data}isItemEqual(e,t){return!ne(this.data[t],e.data[t])}update(){for(const e of this.mattertagData.getTagList()){const t=this.mattertagData.getTag(e),a=this.floorsData.getFloor(t.floorId),n=this.data[t.sid]||{};n.sid=t.sid,n.enabled=t.enabled,n.anchorPosition=ja(t,"anchorPosition",n.anchorPosition),n.stemVector=ja(t,"stemVector",n.stemVector),n.stemVisible=t.stemVisible,n.label=t.label,n.description=t.description,n.media=this.getMedia(t,n.media),n.color=$a(t,"color",n.color),n.floorIndex=a?a.index:-1,n.floorInfo=n.floorInfo||{},n.floorInfo.id=this.floorIdMap.getIdFromCwfId(a.id),n.floorInfo.sequence=a.index,this._data[t.sid]=n}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}getMedia(e,t){const a=e.externalAttachments.get(0),n=a?this.mediaConverter.toSdkMedia(a.mediaType):l.MediaType.NONE,o=a&&n!==l.MediaType.NONE?a.src:"";return(t=t||{}).src=o,t.type=n,t}}class Ka{constructor(e,t,a){this.tagEditBillboard=t,this.tagAttach=a,[this.mattertagData,this.attachmentRegistry]=e}validateInput(e,t){if(!wa(e.properties))throw Error("Mattertag.editBillboard: editable properties is not an object");const a=$(this.tagEditBillboard,e,t),n=e.properties.media;if(n){if(!wa(n)||!gt(l.MediaType,n.type))throw Error("Mattertag.editBillboard: media was not a valid media descriptor");if(n.type!==l.MediaType.NONE){if(!K(n.src))throw Error(`Mattertag.editBillboard: media was of type "${n.type}" but has no src value`);return{id:a.id,properties:Object.assign(Object.assign({},a.properties),{media:{src:n.src,type:n.type}})}}a.properties.media={src:"",type:l.MediaType.NONE}}return a}async exec(e,t){const a=this.mattertagData.getTag(e.id),n=(()=>{if(e.properties.media&&e.properties.media.type!==l.MediaType.NONE)return this.attachmentRegistry.add(t.client.applicationKey,{src:e.properties.media.src,type:Ba[e.properties.media.type]})})(),o=this.mattertagData;return W(this.tagEditBillboard,e,t).then((()=>{e.properties.media&&(a.fileAttachments.replace([]),a.externalAttachments.replace([])),n&&W(this.tagAttach,{tagId:a.sid,attachmentIds:[n]},t),o.commit()}))}}function Ya(e,t,a){function n(e){if(!e)return;return{label:e.label,type:a.toSdkLinkType(e.type),url:e.url,navigationData:e.navigationData}}const o=[];for(const a of e)o.push({type:t.toSdkChunkType(a.type),link:n(a.link),text:a.text});return o}class Xa{constructor(e,t,a,n){this.commands=e,this.tagData=t,this.floorData=a,this.floorIdMap=n}validateInput(e,t){return e}async exec(e,t){return function(e,t,a,n){const o=[];return e.iterate((e=>{const{id:s,index:i}=t.getFloor(e.floorId),r=a.getIdFromCwfId(s),d=e.externalAttachments.get(0),c=d?n.mediaConverter.toSdkMedia(d.mediaType):l.MediaType.NONE,h=d&&c!==l.MediaType.NONE?d.src:"";o.push({sid:e.sid,label:e.label,description:e.description,parsedDescription:Ya(e.parsedDescription,n.chunkTypeConverter,n.linkTypeConverter),mediaSrc:h,mediaType:c,media:{type:c,src:h},anchorPosition:{x:e.anchorPosition.x,y:e.anchorPosition.y,z:e.anchorPosition.z},anchorNormal:{x:e.anchorNormal.x,y:e.anchorNormal.y,z:e.anchorNormal.z},color:{r:e.color.r,g:e.color.g,b:e.color.b},enabled:e.enabled,floorId:i,floorIndex:i,floorInfo:{id:r,sequence:i},stemVector:{x:e.stemVector.x,y:e.stemVector.y,z:e.stemVector.z},stemHeight:e.stemHeight,stemVisible:e.stemVisible})})),o}(this.tagData,this.floorData,this.floorIdMap,this.commands)}}class Za extends It{constructor(e){super("Expected tagId parameter to be of type string; got "+(Array.isArray(e)?"Array":typeof e))}}class Qa{constructor(e,t,a){this.mattertagsData=e,this.attachmentRegistry=t,this.registerSandbox=a}validateInput(e,t){var a,n;if(!K(e.tagId)||!this.mattertagsData.getTag(e.tagId))throw new Za(e.tagId);const o=e.options||{};return"string"==typeof(null===(a=o.size)||void 0===a?void 0:a.w)&&(o.size.w=parseInt(o.size.w,10)),"string"==typeof(null===(n=o.size)||void 0===n?void 0:n.h)&&(o.size.h=parseInt(o.size.h,10)),Object.assign(Object.assign({},this.registerSandbox.validateInput(Object.assign(Object.assign({},e),{options:o}),t)),{tagId:e.tagId})}async exec(e,t){const{clientId:a,html:n,options:o,tagId:s}=e,{sandboxId:i,attachmentId:r}=await this.registerSandbox.exec({clientId:a,html:n,options:o},t),d=this.attachmentRegistry.get(t.client.applicationKey,r);return d&&function(e){return"onLoad"in e}(d)&&this.mattertagsData.getTag(s).sandboxAttachments.replace([d]),{sandboxId:i,attachmentId:r}}}class Ja{constructor(e){this.tagRemove=e}validateInput(e,t){return{ids:$(this.tagRemove,{ids:Array.isArray(e.ids)?e.ids:[e.ids]},t).ids}}async exec(e,t){return W(this.tagRemove,{ids:Array.isArray(e.ids)?e.ids:[e.ids]},t)}}const en={[l.Transition.FLY]:Nt.Interpolate,[l.Transition.FADEOUT]:Nt.FadeToBlack,[l.Transition.INSTANT]:Nt.Instant};class tn{constructor(e,t,a,n,o,s){this.FocusOnPinInsideCommand=e,this.OpenTagCommand=t,this.issueCommand=a,this.mattertagData=n,this.tagsViewData=o,this.annotationsViewData=s}validateInput(e,t){if(!K(e.id)||!this.mattertagData.getTag(e.id))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.transitionType&&!gt(l.Transition,e.transitionType))throw Error(`${e.transitionType} does not match valid transition type`);return{id:e.id,transitionType:e.transitionType,force:!!e.force}}async exec(e,t){const a=this.mattertagData.getTag(e.id);let n=en[e.transitionType];return void 0===n&&(n=Nt.Interpolate),(this.tagsViewData.getCapabilities(e.id).focus||e.force)&&(await this.issueCommand(new this.FocusOnPinInsideCommand({pinPosition:Object.assign(Object.assign({},a),{stemLength:a.stemHeight,stemNormal:a.stemVector}),transition:n})),(this.annotationsViewData.getCapabilities(e.id).preview||e.force)&&await this.issueCommand(new this.OpenTagCommand(e.id))),e.id}}class an{constructor(e,t){this.tagAllowAction=e,this.annotationsViewData=t}validateInput(e,t){const a=$(this.tagAllowAction,{id:e.tagId,allow:{}},t),n={navigating:!1,opening:!1};return wa(e.prevent)&&(n.navigating=!!e.prevent.navigating,n.opening=!!e.prevent.opening),{tagId:a.id,prevent:n}}exec(e,t){const a=this.annotationsViewData.getCapabilities(e.tagId);return W(this.tagAllowAction,{id:e.tagId,allow:{navigating:!e.prevent.navigating,opening:!e.prevent.opening,docking:a.dock}},t)}}function nn(e,t,a,n,o,s){e.addEnumToInterface({namespace:"Mattertag",name:"DescriptionChunkType",values:l.DescriptionChunkType}),e.addEnumToInterface({namespace:"Mattertag",name:"Event",values:l.Event}),e.addEnumToInterface({namespace:"Mattertag",name:"LinkType",values:l.LinkType}),e.addEnumToInterface({namespace:"Mattertag",name:"MediaType",values:l.MediaType}),e.addEnumToInterface({namespace:"Mattertag",name:"Transition",values:l.Transition});const i=Object.assign(Object.assign({},a),{mediaConverter:new on(t.MediaType)}),[r,d,c,h,u,p]=s;!function(e,t,a){const n=["",!1],o=e=>(n[0]=e.id,n[1]=e.hovering,n);a.subscribe(t.PinHoverChangeMessage,(a=>{a.pinType===t.PinType.MATTERTAG&&e.broadcast(l.Event.HOVER,o,a)}));const s=[""],i=e=>(s[0]=e.id,s);a.subscribe(t.PinClickedMessage,(a=>{a.pinType===t.PinType.MATTERTAG&&e.broadcast(l.Event.CLICK,i,a)}))}(e,t,a),function(e,t,a,n){n.getDependencies().then((([n])=>{const o=["",""],s=e=>{var t;return o[0]=(null===(t=n.billboardAnnotation)||void 0===t?void 0:t.id)||"",o[1]=e.url,o};a.subscribe(t.MattertagLinkOpenedMessage,(t=>{e.broadcast(l.Event.LINK_OPEN,s,t)}))}))}(e,t,a,new V(c));const m=function(e,t,a){const n=Ra.create(new V(t.add,t.editIcon,t.attach,a),new F(za));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"add",args:["descriptors"],options:{replay:!0,deprecated:"Tag.add"}},n),n}(e,o,p),g=function(e,t,a){const n=aa.create(a,new Wa,new F(qa,t));return e.addCollectionToInterface({namespace:"Mattertag",name:"data"},n),n}(e,i,new V(r,h,u)),w=function(e,t,a){const n=z.create(new V(a.getDependencies(),t.editBillboard,t.attach),new F(Ka));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editBillboard",args:["id","properties"],options:{replay:!0,deprecated:"`Tag.editBillboard`, or `Tag.registerAttachment` and `Tag.attach` for media"}},n),n}(e,o,new V(r,p)),f=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editColor",args:["id","color"],options:{replay:!0,deprecated:"Tag.editColor"}},t),t}(e,o.editColor),y=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editIcon",args:["id","iconId"],options:{replay:!0,deprecated:"Tag.editIcon"}},t),t}(e,o.editIcon),T=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editOpacity",args:["id","opacity"],options:{replay:!0,deprecated:"Tag.editOpacity"}},t),t}(e,o.editOpacity),v=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editPosition",args:["id","options"],options:{replay:!0,deprecated:"Tag.editPosition"}},t),t}(e,o.editPosition),I=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editStem",args:["id","stemParams"],options:{replay:!0,deprecated:"Tag.editStem"}},t),t}(e,o.editStem);!function(e,t,a){const n=z.create(a,new F(Xa,t));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"getData",args:[],options:{deprecated:"Tag.data"}},n)}(e,i,new V(r,h,u));const E=function(e,t,a){const n=Ra.create(V.extend(a,t.registerSandbox),new F(Qa));return e.addCommandToInterface({namespace:"Mattertag",name:"injectHTML",subRoutine:"mattertag.inject",args:["tagId","html","options"],options:{replay:!0,deprecated:"Tag.registerSandbox and Tag.attaach"}},n),n}(e,o,new V(r,p));!function(e,t,a,n){const o=z.create(n,new F(tn,t.FocusOnPinInsideCommand,t.OpenTagCommand,a.issueCommand));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"navigateToTag",args:["id","transitionType","force"]},o)}(e,t,a,new V(r,d,c));const C=function(e,t){const a=z.create(t,new F(an));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"preventAction",args:["tagId","prevent"],options:{replay:!0,deprecated:"Tag.allowAction"}},a),a}(e,new V(o.allowAction,c));!function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"registerIcon",args:["textureId","textureSrc"],options:{deprecated:"Asset.registerTexture"}},t)}(e,n.registerTexture);const b=function(e,t){const a=z.create(new V(t),new F(Ja));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"remove",args:["ids"],options:{replay:!0,deprecated:"Tag.remove"}},a),a}(e,o.remove),A=function(e,t){return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"resetIcon",args:["id"],options:{replay:!0,deprecated:"Tag.resetIcon"}},t),t}(e,o.resetIcon);return{data:g,add:m,editBillboard:w,editColor:f,editIcon:y,editOpacity:T,editPosition:v,editStem:I,inject:E,preventAction:C,remove:b,resetIcon:A}}class on{constructor(e){this.toSdkMediaMap={[e.IMAGE]:l.MediaType.PHOTO,[e.VIDEO]:l.MediaType.VIDEO,[e.RICH]:l.MediaType.RICH,[e.APPLICATION]:l.MediaType.NONE,[e.AUDIO]:l.MediaType.NONE,[e.MODEL]:l.MediaType.NONE,[e.PDF]:l.MediaType.NONE,[e.TEXT]:l.MediaType.NONE,[e.ZIP]:l.MediaType.NONE}}toSdkMedia(e){return this.toSdkMediaMap[e]}}class sn extends ie{}sn.id="MEASUREMENTS_GET";const rn=async(e,t)=>{const a=[];for(const n of e.groups()){const e=n.info,o=t.getFloor(e.floorId);for(let t=1;t<n.count;t++){const s=n.get(t-1),i=n.get(t);a.push({sid:e.sid,label:e.text,floor:o.index,start:{x:s.x,y:s.y,z:s.z},end:{x:i.x,y:i.y,z:i.z}})}}return a};class dn{constructor(e){this.CwfMeasuringPhase=e}create(e,t){let a=t.groupCount,n=t.phase;const o=()=>{const o=t.groupCount,s=t.phase;a===o&&n!==this.CwfMeasuringPhase.EDITING||s!==this.CwfMeasuringPhase.IDLE||(e.onChanged(),a=o),n=s};return new _e(t.onPhaseChanged(o),t.onSelectedGroupIndexChanged(o))}}class cn{constructor(e){this.measurementModeData=e,this.data={}}update(){for(const e of this.measurementModeData.groups())this.createMeasurement(e);for(const e in this.data){this.measurementModeData.getGroupInfoBySid(e)||delete this.data[e]}}isItemEqual(e,t){return!ne(this.data[t],e.data[t])}clear(){this.data={}}createMeasurement(e){const t=e.info.sid,a=this.data[t]||{},n=a.points||[];a.label=e.info.text,a.segmentLengths=e.segmentLengths,a.totalLength=e.length,function(e,t){let a=0;for(const n of t){const t=e[a]||{};t.x=n.x,t.y=n.y,t.z=n.z,e[a]=t,++a}e.length=a}(n,e),a.sid=t,a.points=n,this.data[t]=a}}class ln{create(e,t){return t.onChanged((()=>e.onChanged()))}}class hn{constructor(){this._data={active:!1}}get data(){return this._data}equals(e){return this._data.active===e.data.active}copy(e){this._data.active=e.data.active}update(e){this._data.active=e.modeActive()}}class un extends ie{constructor(e){super(),this.payload={active:e}}}un.id="SDK_MEASUREMENT_TOGGLE";class pn extends It{constructor(e="Unhandled Transition Exception"){super(e),this.name="TransitionException"}}class mn extends pn{constructor(e="Unhandled Viewmode Exception",t){super(e),this.originalError=t,this.name="ViewmodeException"}}class gn extends mn{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}function wn(e){return"number"==typeof e&&!isNaN(e)}function fn(e){return e-0}function yn(e,t,a){return Math.max(t,Math.min(e,a))}function Tn(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e&&"z"in e){const t=e;return wn(t.x)&&wn(t.y)&&wn(t.z)}return!1}const vn=new Ye("move-to-mode-command");class In extends ie{constructor(e){super(),this.payload=e}}In.id="MOVE_TO_MODE";class En{constructor(e,t,a,n){this.THREE=e,this.viewmodeConverter=t,this.conversion=a,this.transitionTypeConverter=n}validateMoveToModeInput(e){if(!e)throw Error("Mode.moveTo -> no arguments provided -- mode is required");e.options||(e.options={});const t=e.mode;if(!gt(h.Mode,e.mode))throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);if(t===h.Mode.TRANSITIONING)throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);e.options&&e.options.rotation&&(e.options.rotation.z=e.options.rotation.z||0);const a=this.validatePayloadOptions(e.options);return{mode:this.viewmodeConverter.fromSdk(t),options:{transition:a.transition,position:a.position,rotation:a.rotation,zoom:a.zoom}}}validatePayloadOptions(e){let t,a,n,o;if(e){if(e.transition&&(n=this.transitionTypeConverter.fromSdkTransition(e.transition),void 0===n))throw Error(`Mode.moveTo -> ${e.transition} is not a valid transition style`);e.rotation&&Tn(e.rotation)&&(t=this.conversion.rotationToQuaternion(e.rotation)),e.position&&Tn(e.position)&&(a=new this.THREE.Vector3(parseFloat(e.position.x),parseFloat(e.position.y),parseFloat(e.position.z))),e.zoom&&!isNaN(e.zoom)&&(o=$t(e.zoom,1,30))}return{rotation:t,position:a,transition:n,zoom:o}}}class Cn{create(e,t,a,n){const o=()=>e.onChanged();return new _e(n.pose.isPitchFactorOrthoObservable.onChanged(o),a.onChanged(o),t.onChanged(o))}}class bn{constructor(e,t){this._data=h.Mode.INSIDE,this.viewmodeConverter=t.viewmodeConverter}get data(){return this._data}equals(e){return this._data===e.data}copy(e){this._data=e.data}update(e,t,a){const n=t.currentSweep&&t.isSweepAligned(t.currentSweep);this._data=this.viewmodeConverter.toSdk(e.currentMode,!!n,a.pose.isPitchFactorOrtho)}}class An extends ie{}function Sn(e,t,a){t.addBinding(An,(async()=>{const e=await a.getDependencies();return await async function(e,a,n,o){const s={sid:"",sweeps:[],modelSupportsVr:!1};try{const i=a.getSweepList(),r=e.model;return await t.makeModelData(r.sid,r.options.isVR,i,n,o,s),s}catch(e){throw Error("no model currently loaded")}}(...e)})),e.addCommandCreator({namespace:"Model",name:"getData",args:[]},(()=>new An))}An.id="GET_MODEL_DATA";class Dn extends ie{}function On(e,t,a,n){n.getDependencies().then((e=>a.addBinding(Dn,(async()=>function(e,a){function n(e,t){if(a.tryGetProperty(e,!0))return t}const o=e.model;return{sid:o.sid,name:n(t.OptionsKey.DetailsModelName,o.details.name),presentedBy:n(t.OptionsKey.PresentedBy,o.details.presentedBy),summary:n(t.OptionsKey.DetailsSummary,o.details.summary),defaultViewId:n(t.OptionsKey.DetailsSummary,o.details.defaultViewId),description:n(t.OptionsKey.DetailsSummary,o.details.description),formattedAddress:n(t.OptionsKey.DetailsAddress,o.details.formattedAddress),contactEmail:n(t.OptionsKey.DetailsEmail,o.details.contact.email),contactName:n(t.OptionsKey.DetailsName,o.details.contact.name),phone:n(t.OptionsKey.DetailsPhone,o.details.contact.phone),formattedContactPhone:n(t.OptionsKey.DetailsPhone,o.details.contact.formattedPhone),externalUrl:n(t.OptionsKey.DetailsExternalUrl,o.details.externalUrl)}}(...e))))),e.addCommandCreator({namespace:"Model",name:"getDetails",args:[]},(()=>new Dn))}Dn.id="GET_MODEL_DETAILS";const Mn=e=>null!==e.position?{x:e.position.x,y:e.position.y,z:e.position.z}:null;function Rn(e,t){return async function(a,n,o,s,i,r){r.sweeps=[];for(const a of o){const n=a.floorId?s.getFloor(a.floorId).index:-1;r.sweeps.push({uuid:i.getIdForSweep(a),sid:i.getIdForSweep(a),alignmentType:t.toSdkAlignment(a.alignmentType),placementType:t.toSdkPlacement(a.placementType),neighbors:await Promise.all(a.neighbours.map((async e=>await i.getIdFromCwfId(e)))),position:Mn(a),rotation:e.quaternionToRotation(a.rotation),floor:n})}return r.sid=a,r.modelSupportsVr=n,r}}const Nn="OAuth.updateToken";class Pn{constructor(e){this.tokenUpdater=e}validateInput(e){const{token:t}=e;if(!K(t))throw Error();return{token:t}}async exec(e,t){this.tokenUpdater.setToken(e.token)}}var xn;!function(e){e[e.None=0]="None",e[e.AnonymousFetch=1]="AnonymousFetch",e[e.UserFetch=2]="UserFetch"}(xn||(xn={}));const _n=["$fetchLevel","$canPlaceInGrid"];class Ln{constructor(e){this.pluginRegistry=e}validateInput(e){if(!wa(e.key))throw Error(e.key+" is not a valid object");const t=e.key;if(!Y(t.applicationKey))throw Error(t.applicationKey+" is not a valid string");if(!Y(t.id))throw Error(t.id+"is not a valid string");if(!Y(e.path))throw Error(e.path+" is not a valid string");return e}async exec(e){var t,a,n;let o=xn.AnonymousFetch,s=!1;void 0!==(null===(t=e.config)||void 0===t?void 0:t.$fetchLevel)?o=yn(e.config.$fetchLevel,xn.None,xn.UserFetch):void 0!==(null===(a=e.config)||void 0===a?void 0:a.$canPlaceInGrid)&&(s=e.config.$canPlaceInGrid);const i={};for(const t in e.config)_n.includes(t)||(i[t]=e.config[t]);const r=Object.assign({},null===(n=e.metadata)||void 0===n?void 0:n.peerDependencies);return this.pluginRegistry.load({applicationKey:e.key.applicationKey,id:e.key.id||"default",src:e.path,strict:!1,fetchLevel:o,canPlaceInGrid:s,config:i||{},peerDependencies:r})}}class kn{constructor(e){this.pluginRegistry=e}validateInput(e){if(!wa(e.key))throw Error(e.key+" is not a valid object");if(!Y(e.key.applicationKey))throw Error(e.key+" is not a valid string");return e}async exec(e){return this.pluginRegistry.unload(e.key)}}class Vn{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Fn{constructor(e,t){this.colliderTypes=t,this.ZERO=new e.Vector3(0,0,0),this.tempVec=new e.Vector3,this._data={position:{x:0,y:0,z:0},normal:{x:0,y:0,z:0},object:p.Colliders.NONE,floorId:void 0,floorIndex:void 0}}get data(){return this._data}equals(e){const t=1e-5,a=e.data.position,n=this._data.position,o=e.data.normal,s=this._data.normal;return St(a,n,t)&&St(o,s,t)&&e.data.object===this._data.object}update(e,t,a,n,o){const s=e.hit;s?(vt(this._data.position,s.point),vt(this._data.normal,s.face.normal),this._data.floorId=void 0,s.object instanceof this.colliderTypes.ModelColliderTarget?(this._data.object=p.Colliders.MODEL,this._data.floorId=function(e,t,a,n,o,s){let i;const r=o.floorIdFromObject(e.object);if(r)return i=t.getFloor(r),i.index;s.copy(e.point);const d=n.meshSubGroupsFromPoint(s);if(!d.length)return;const c=a.getByMeshSubgroup(d[0]);if(!c)return;return i=t.getFloor(c.floorId),i.index}(s,t,a,n,o,this.tempVec)):s.object instanceof this.colliderTypes.PinHeadMesh||s.object instanceof this.colliderTypes.InstancedPinHeads?this._data.object=p.Colliders.TAG:s.object instanceof this.colliderTypes.PuckCollider?this._data.object=p.Colliders.SWEEP:this._data.object=p.Colliders.UNKNOWN):(vt(this._data.position,this.ZERO),vt(this._data.normal,this.ZERO),this._data.object=p.Colliders.NONE,this._data.floorId=void 0),this._data.floorIndex=this._data.floorId}copy(e){vt(this._data.position,e.data.position),vt(this._data.normal,e.data.normal),this._data.object=e.data.object,this._data.floorId=e.data.floorId,this._data.floorIndex=e.data.floorIndex}}class Un{constructor(e,t){this.cursorController=e,this.textureAaps=t}validateInput(e){if(!K(e.textureId))throw Error("textureId is not a valid string");return{textureId:e.textureId}}async exec(e,t){const{textureId:a}=e,n=this.textureAaps.get(t.client.applicationKey).map[a];this.cursorController.setTexture(n)}}class Gn{constructor(e){this.cursorController=e}validateInput(e){return e}async exec(e,t){this.cursorController.setTexture(null)}}class Hn{constructor(e){this.cursorController=e}validateInput(e){(e=e||{}).props=e.props||{};const t=e.props;if(t.fadeIn){const e=t.fadeIn;if(e.duration&&(!wn(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeIn.duration was specified but was not a valid duration; got ${e.duration}`)}if(t.fadeOut){const e=t.fadeOut;if(e.duration&&(!wn(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeOut.duration was specified but was not a valid duration; got ${e.duration}`);if(e.delay&&(!wn(e.delay)||e.delay<=0))throw Error(`Pointer.setFadeProps: fadeOut.delay was specified but was not a valid delay; got ${e.delay}`)}return e}async exec(e,t){this.cursorController.setFadeProps(e.props)}}class Bn{constructor(e){this.cursorController=e,this.visible=!0,this.ruleAdded=!1}isVisible(){return this.visible}validateInput(e){if(!fa(e.visible))throw Error(`Pointer.setVisible: visible was specified but was not a valid boolean; got ${e.visible}`);return e}async exec(e,t){this.ruleAdded||(this.isVisible=this.isVisible.bind(this),this.cursorController.addVisibilityRule(this.isVisible),this.ruleAdded=!0),this.visible=e.visible}}class zn{constructor(e){this.r3fModule=e}validateInput(e){return e}async exec(e,t){return this.r3fModule.registerExternalR3F(e.callbacks)}}const jn=new Ye("mpSdk.R3F.navigationToggle");class $n{constructor(e){this.enabled=!0,this.userNavigationEnabled=()=>this.enabled,e.addNavigationRule(this.userNavigationEnabled.bind(this))}validateInput(e){return e}async exec(e,t){this.enabled=e.enabled,jn.debug(e)}}class Wn{constructor(e,t,a,n,o){this.THREE=e,this.cwfTypes=t,this.commands=a,this.navigation=n,this.viewmodeData=o}validateInput(e){if(!e)throw Error('focus: no arguments provided -- "target" point|box is required');const t=e.target;if(!function(e){if(e&&"object"==typeof e&&"min"in e&&"max"in e){const t=e;if(Tn(t.min)&&Tn(t.max))return!0}return!1}(t)&&!Tn(t))throw new Error('focus: invalid "target"');const a=e.options;if(a){const{from:e,mode:t,transition:n}=a;if(e&&!Tn(e))throw new Error('focus: "options.from" must be a Vector3|undefined');if(t){if(void 0===this.commands.viewmodeConverter.fromSdk(t))throw Error(`focus: ${t} is not a valid "options.mode"`)}let o=this.cwfTypes.CameraTransitionType.Interpolate;if(n&&(o=this.commands.cameraTransitionConverter.fromSdkTransition(n),void 0===o))throw Error(`focus: ${n} is not a valid "options.transition"`)}return e}async exec(e,t){const a=e.target,n=this.convertOptions(e);try{await this.navigation.focus(a,n)}catch(e){console.warn("focus: unable to focus",e)}}convertOptions(e){var t,a,n,o;const s=null===(t=e.options)||void 0===t?void 0:t.mode,i=s?this.commands.viewmodeConverter.fromSdk(s):null!==(a=this.viewmodeData.currentMode)&&void 0!==a?a:void 0,r=null===(n=e.options)||void 0===n?void 0:n.from,d=r&&Tn(r)?new this.THREE.Vector3(r.x,r.y,r.z):void 0,c=null===(o=e.options)||void 0===o?void 0:o.transition;return{from:d,mode:i,transition:c?this.commands.cameraTransitionConverter.fromSdkTransition(c):this.cwfTypes.CameraTransitionType.Interpolate}}}class qn{constructor(){}onAccessGranted(e){}onAccessRevoked(e){}}const Kn=new Ye("mpSdk.R3F.controlsToggle");class Yn{constructor(e){this.controls=e,this.sub=null}validateInput(e){return e}async exec(e,t){if(Kn.debug(e),this.sub&&e.enabled&&(this.sub.cancel(),this.sub=null),!this.sub&&!e.enabled){const e=this.controls.cameraPoseProxy;this.sub=e.newSession(new qn)}}}class Xn{constructor(e,t){this.captureCamera=e,this.encodeRenderTarget=t}async capture(e,t,a,n){const{camera:o,scene:s}=t.getScene();return o.getWorldPosition(this.captureCamera.position),o.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(o.projectionMatrix),this.captureCamera.layers.mask=e.visibleObjects.mask,n.setSize(e.resolution.width,e.resolution.height),a.render(n.target,s,this.captureCamera),await this.encodeRenderTarget(n)}}function Zn(e){return wn(e)&&e%1==0}const Qn=new Ye("command.takeScreenshot");var Jn,eo;!function(e){e.Base64JPG="screenshot.base64.jpg",e.ArrayBufferJPG="screenshot.arraybuffer.jpg"}(Jn||(Jn={}));class to{constructor(e,t,a,n,o,s){this.canvasData=n,this.rendererModule=o,this.renderToTexture=s,this.RenderLayers=t.RenderLayers,this.screenCapturer=e,this.requestTarget=a.requestTarget,this.getRenderLayer=a.getRenderLayer,this.jpegAsBase64=a.jpegAsBase64}validateInput(e){return{resolution:this.validateResolution(e.resolution,this.canvasData,this.rendererModule),visibleObjects:this.buildVisibilityOptions(e.visibleObjects),returnType:e.returnType===Jn.ArrayBufferJPG?Jn.ArrayBufferJPG:Jn.Base64JPG}}async exec(e,t){const a=await this.requestTarget(),n=await this.screenCapturer.capture({resolution:e.resolution,visibleObjects:this.buildVisibilityLayers(e.visibleObjects)},this.rendererModule,this.renderToTexture,a);return e.returnType===Jn.ArrayBufferJPG?n.buffer:this.jpegAsBase64(n)}validateResolution(e,t,a){const n={width:0,height:0};if(!e)return n.width=t.width,n.height=t.height,n;if(!function(e){const t=e;return!!t&&("number"==typeof t.width&&"number"==typeof t.height)}(e))throw Error('"resolution" provided was not valid. Expected .width and .height to be numbers.');n.width=e.width,n.height=e.height;const o=a.maxTextureSize;if(e.width<=0||e.width>o)throw Error('"resolution.width" provided was outside the valid range of [0, '+o+"]");if(e.height<=0||e.height>o)throw Error('"resolution.height" provided was outside the valid range of [0, '+o+"]");if(!Zn(n.width)){const e=Math.round(n.width);Qn.info(`Integer width expected. Rounding from ${n.width} to ${e}`),n.width=e}if(!Zn(n.height)){const e=Math.round(n.height);Qn.info(`Integer width expected. Rounding from ${n.height} to ${e}`),n.height=e}return n}buildVisibilityOptions(e){const t=e||{};return{measurements:!!t.measurements,mattertags:!!t.mattertags,sweeps:!!t.sweeps,views:!!t.views}}buildVisibilityLayers(e){const t=this.RenderLayers.ALL;return e.mattertags||t.removeLayers(this.getRenderLayer("pins")),e.measurements||t.removeLayers(this.getRenderLayer("measurements")),e.sweeps||t.removeLayers(this.getRenderLayer("sweep-pucks")),e.views||(t.removeLayers(this.getRenderLayer("sweep-portal-mesh")),t.removeLayers(this.getRenderLayer("sweep-pin-mesh"))),t}}class ao{constructor(e,t,a,n,o,s,i,r){this.renderer=n,this.renderToTexture=o,this.viewmodeData=s,this.sweepData=i,this.sweepTextureLoader=r,this.Viewmode=t.Viewmode,this.requestTarget=a.requestTarget,this.encodeRenderTarget=a.encodeRenderTarget,this.jpegAsBase64=a.jpegAsBase64,this.getXmp=a.getXmp,this.getOrientedAngleTo=a.getOrientedAngleTo,this.forward=new e.Vector3(0,0,-1),this.sweepForward=new e.Vector3,this.viewForward=new e.Vector3}validateInput(e){return e}async exec(e,t){if(!this.sweepData.currentSweep||this.viewmodeData.currentMode!==this.Viewmode.Panorama)throw new Error("Can only capture equirectangular projections while stationary in a sweep");const a=this.renderer.getScene().camera,n=this.sweepData.getSweep(this.sweepData.currentSweep),o=await this.sweepTextureLoader.load(n);this.sweepForward.copy(this.forward),this.sweepForward.copy(this.forward).applyQuaternion(n.rotation).setY(0);const s=this.getOrientedAngleTo(this.sweepForward,a.getWorldDirection(this.viewForward).setY(0))+Math.PI,i=await this.requestTarget();i.setSize(ao.equirectangularRes.width,ao.equirectangularRes.height),this.renderToTexture.renderEquirectangular(o,i.target,s);const r=await this.encodeRenderTarget(i,this.getXmp(i.width,i.height,0,0));return this.jpegAsBase64(r)}}ao.equirectangularRes={width:4096,height:2048};class no{constructor(e,t){this.issueCommand=t.issueCommand,this.GetScreenPositionCommand=e.GetScreenPositionCommand}validateInput(e){if(!Tn(e.worldPosition))throw Error(`Renderer.getScreenPosition: 'worldPosition' was specified but was not a valid Vector3; got ${e.worldPosition}`);return e}async exec(e,t){return await this.issueCommand(new this.GetScreenPositionCommand(e))}}class oo{constructor(e,t,a){this.floorsData=a,this.GetFloorIntersectCommand=e.GetFloorIntersectCommand,this.issueCommand=t.issueCommand}validateInput(e){if(!function(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e){const t=e;return wn(t.x)&&wn(t.y)}return!1}(e.screenPosition))throw Error(`Renderer.getWorldPositionData: 'screenPosition' was not a valid Vector2; got ${e.screenPosition}`);return e}async exec(e,t){const a=await this.issueCommand(new this.GetFloorIntersectCommand(e)),n=this.floorsData.getFloorAtIndex(a.floorIndex);return n?{position:a.position,floorInfo:{id:n.id,sequence:n.index},floor:a.floorIndex}:{position:a.position,floorInfo:{id:"",sequence:-1},floor:-1}}}function so(e,t,a,n,o,s,i){e.id=a.getIdFromCwfId(t.id),e.label=i&&i.hasRoom(t.id)?i.getRoomLabel(t.id,""):"",e.bounds=e.bounds||{},e.bounds.min=ja(n.boundingBox,"min",e.bounds.min),e.bounds.max=ja(n.boundingBox,"max",e.bounds.max),e.floorInfo=function(e,t,a,n){n=n||{};try{const o=t.getFloor(e);n.id=a.getIdFromCwfId(o.id),n.sequence=o.index}catch(e){n.id="",n.sequence=-1}return n}(t.floorId,o,s,e.floorInfo)}class io{constructor(){this.wasTransitioning360=!1,this.cameraPosition={x:0,y:0,z:0}}create(e,t,a,n,o){return new _e(n.onChanged((()=>this.throttleCameraPositionChanges(e,n))),o.onChanged((()=>this.throttleSweepChanges(e,o))))}throttleCameraPositionChanges(e,t){const a=t.pose.position;a.x===this.cameraPosition.x&&a.y===this.cameraPosition.y&&a.z===this.cameraPosition.z||(this.cameraPosition.x=a.x,this.cameraPosition.y=a.y,this.cameraPosition.z=a.z,e.onChanged())}throttleSweepChanges(e,t){const a=t.transition;t.transitionActive?(t.isSweepUnaligned(a.from)||t.isSweepUnaligned(a.to))&&(this.wasTransitioning360=!0):this.wasTransitioning360&&!t.isSweepUnaligned(t.currentSweep)&&(e.onChanged(),this.wasTransitioning360=!1)}}class ro{constructor(){this.currentRooms={rooms:[]}}get data(){return this.currentRooms}equals(e){return this.data.rooms.length===e.data.rooms.length&&this.currentRooms.rooms.every((t=>e.data.rooms.findIndex((e=>e.id===t.id))>-1))}copy(e){this.currentRooms.rooms.length=e.data.rooms.length,Et(this.currentRooms.rooms,e.data.rooms)}update(e,t,a,n,o,s,i,r,d){if(o.isInside()&&n.isSweepUnaligned(n.currentSweep)||n.transitionActive&&(n.isSweepUnaligned(n.transition.to)||n.isSweepUnaligned(n.transition.from)))return void(this.currentRooms.rooms.length=0);const c=s.meshSubGroupsFromPoint(a.pose.position);this.currentRooms.rooms.length=0;for(let a=0;a<c.length;++a){const n=c[a],o=e.getByMeshSubgroup(n),l=s.meshGroups.rooms.get(n);if(!o||!l)continue;const h=this.currentRooms.rooms[a]||{};so(h,o,i,l,t,r,d.get()),this.currentRooms.rooms.push(h)}}}class co{constructor(){}create(e,t){return{renew(){},cancel(){}}}}class lo{constructor(e,t,a,n,o,s){this.roomData=e,this.floorData=t,this.roomIdMap=a,this.floorIdMap=n,this.meshData=o,this.roomBoundData=s,this._data={}}get data(){return this._data}isItemEqual(e,t){const a=this.data[t],n=e.data[t];return a.id===n.id&&St(a.bounds.min,n.bounds.min)&&St(a.bounds.max,n.bounds.max)}update(){for(const e of this.roomData.rooms()){const t=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(!t)continue;const a=this.roomIdMap.getIdFromCwfId(e.id),n=this._data[a]||{};so(n,e,this.roomIdMap,t,this.floorData,this.floorIdMap,this.roomBoundData.get()),this._data[a]=n}for(const e in this.data){this.roomIdMap.getRoomForId(e)||delete this._data[e]}}clear(){this._data={}}}class ho{constructor(e,t){this.RoomData=e,this.FloorsData=t}validateInput(e){return{invert:!!(null==e?void 0:e.invert)||!1}}async exec(e,t){return this.RoomData.getRoomIdMap(this.FloorsData,e.invert)}}class uo{constructor(e){this.roomBoundViewData=e}validateInput(e){return{visible:!!e.visible}}async exec(e){await this.roomBoundViewData.forceRoomDimensionVisibility(e.visible)}}!function(e){e.OUTPUT="output",e.INPUT="input",e.EVENT="event",e.EMIT="emit"}(eo||(eo={}));class po{constructor(e){this.sceneModule=e}validateInput(e){if(!K(e.name))throw Error(`Scene.register name ${e.name} is not a string`);if(!e.factory||"function"!=typeof e.factory)throw Error("Scene.register factory is not a function");return e}async exec(e,t){if(this.sceneModule.registerFactory({scope:t.client.applicationKey,name:e.name},e.factory))return{dispose:()=>{this.sceneModule.unregisterFactory(e.name,e.factory)}};throw Error("There was an error registering the scene component")}}class mo{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){return this.sceneModule.createNode(t.client.applicationKey,{owner:t.client.id}).publicFacade()}}class go extends ie{constructor(e){super(),this.payload=e}}go.id="SCENE_QUERY";class wo extends ie{constructor(e){super(),this.payload=e}}wo.id="SCENE_CONFIGURE";class fo extends ie{constructor(e){super(),this.payload=e}}fo.id="SCENE_GETIMAGE";(class extends ie{constructor(e){super(),this.payload=e}}).id="SCENE_EXPORT";class yo{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){return this.sceneModule.deserialize(t.client.applicationKey,e.text,t.client.id).object}}const To=new Ye("serialize");class vo{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){Array.isArray(e.objects)&&To.warn("Serializing an array of ISceneNodes is deprecated and may produce an unexpected result.                Serialization of the ISceneObject container should be done instead.");return Array.isArray(e.objects)?this.sceneModule.serializeNodeList(e.objects):this.sceneModule.serialize(e.objects)}}class Io{constructor(e){this.sceneModule=e}validateInput(e){if(!wn(e.count))throw Error("count is not a valid number");return e}async exec(e,t){const a=[];for(let n=0;n<e.count;n++){const e=this.sceneModule.createNode(t.client.applicationKey,{owner:t.client.id});a.push(e.publicFacade())}return a}}class Eo{constructor(e){this.sceneModule=e}validateInput(e){if(!Aa(e.components,wa))throw Error("Scene.registerComponents array elements must be objects");for(const t of e.components){if(!K(t.name))throw Error(`Scene.registerComponents name ${t.name} is not a string`);if(!t.factory||"function"!=typeof t.factory)throw Error("Scene.registerComponents factory is not a function")}return e}async exec(e,t){const a=[];for(const n of e.components){if(!this.sceneModule.registerFactory({scope:t.client.applicationKey,name:n.name},n.factory))throw Error("There was an error registering a scene component");{const e=this.sceneModule,t=function(t,a){return{dispose:function(){e.unregisterFactory(t,a)}}}(n.name,n.factory);a.push(t)}}return a}}class Co{constructor(e){this.sceneModule=e}validateInput(e){if(!wn(e.count))throw Error("count is not a valid number");return e}async exec(e,t){const a=[];for(let n=0;n<e.count;n++)a.push(this.sceneModule.createObject(t.client.applicationKey,{owner:t.client.id}).publicFacade());return a}}(class extends ie{constructor(e){super(),this.payload=e}}).id="SCENE_UNREGISTER_COMPONENTS";class bo{constructor(e){this.sceneModule=e}validateInput(e){if(e=e||{},!Array.isArray(e.components))throw Error("components must be an array");return e.components=e.components||[],e}async exec(e){for(const t of e.components)this.sceneModule.unregisterFactory(t.name,t.factory)}}class Ao{constructor(e,t){this.sensorModule=e,this.sensorMap=t}validateInput(e){if(!K(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!fa(e.show))throw Error(`Sensor.showDebug: 'show' was not a boolean; got ${e.show}`);return{sensorId:e.sensorId,show:e.show}}async exec(e){if(e.show){const t=this.sensorMap.get(e.sensorId);this.sensorModule.setDebugSensor(t)}else this.sensorModule.setDebugSensor(null)}}class So{constructor(e){this.sensor=e,this.sourceMap=new Map,this.reverseSourceLookup=new Map,this.sourceId=0,this._data={}}get data(){return this._data}isItemEqual(e,t){return e.data[t].inRange===this.data[t].inRange&&e.data[t].inView===this.data[t].inView}update(){for(const[e,t]of this.sensor.readings){const a=this.addOrGetSourceId(e),n=this._data[a]||{};n.inRange=t.inRange,n.inView=t.inView,n.distanceSquared=t.distanceSq,n.direction=ja(t,"direction",n.direction),this._data[a]=n}for(const e in this.data){const t=this.reverseSourceLookup.get(e);t&&!this.sensor.readings.get(t)&&(this.sourceMap.delete(t),this.reverseSourceLookup.delete(e),delete this._data[e])}}clear(){this._data={}}addOrGetSourceId(e){const t=this.sourceMap.get(e);if(t)return t;const a="source-"+ ++this.sourceId;return this.sourceMap.set(e,a),this.reverseSourceLookup.set(a,e),a}}class Do{constructor(){this._data={origin:{x:0,y:0,z:0},forward:{x:0,y:0,z:-1}}}get data(){return this._data}equals(e){const t=1e-5;return St(this.data.origin,e.data.origin,t)&&St(this.data.forward,e.data.forward,t)}copy(e){vt(this._data.origin,e.data.origin),vt(this._data.forward,e.data.forward)}update(e){vt(this._data.origin,e.frustum.origin),vt(this._data.forward,e.frustum.forward)}}class Oo{constructor(e,t,a,n,o){this.sdk=e,this.sensorFactories=t,this.sensors=a,this.sensorMap=n,this.removerMap=o}validateInput(e){if(!gt(g.SensorType,e.type))throw Error(e.type+" is not a valid sensor type");return this.sensorFactories[e.type].validateInput(e)}async exec(e,t){const a=this.sensorFactories[e.type].create(e,this.sensors),n="sensor-"+ ++Oo.nextSensorId;this.sensorMap.set(n,a);const o=ee.create(new V(a),new Ro,new F(Do)),s=this.sdk.addObservable(n,o),i=aa.create(new V(a),new No,new F(So)),r=this.sdk.addCollection(n,i);return this.removerMap.set(n,{dispose(){s.dispose(),r.dispose()}}),{sensorId:n}}}Oo.nextSensorId=0;class Mo{validateInput(e){return e}create(e,t){return t.createCameraBoundSensor()}}class Ro{create(e,t){return t.frustum.observe(new Po(e))}}class No{create(e,t){return t.onReadingsUpdated(new Po(e))}}class Po{constructor(e){this.dependencyObserver=e}notify(){this.dependencyObserver.onChanged()}}class xo{constructor(e,t){this.sensorMap=e,this.sourceMap=t}validateInput(e){if(!K(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!Aa(e.sourceIds,K))throw Error("dev error: this should not occur unless the sdk was not setup properly");for(const t of e.sourceIds)if(!this.sourceMap.has(t))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId,sourceIds:e.sourceIds}}async exec(e){const t=this.sensorMap.get(e.sensorId),a=e.sourceIds.map(this.sourceMap.get,this.sourceMap);t.addSource(...a)}}class _o{constructor(e,t){this.sensorMap=e,this.removerMap=t}validateInput(e){if(!K(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId}}async exec(e){this.removerMap.get(e.sensorId).dispose();this.sensorMap.get(e.sensorId).dispose()}}const Lo={namespace:"Sensor",name:"createSensor",subRoutine:"sensor.create",args:[]},ko="Sensor.addSource",Vo="sensor.dispose",Fo="sensor.showDebug",Uo={namespace:"Sensor",name:"createSource",subRoutine:"source.create",args:["type","options"]},Go="Sensor.updateSource";class Ho{constructor(e,t,a){this.radius=1/0,this.type=e.SPHERE,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{origin:this._volume.origin,radius:this._volume.radius}}}const Bo=Math.PI/180;class zo{constructor(e,t,a){this.type=e.BOX,this._volume=t,this.eulerCache=new a.Euler,this.quaternionCache=new a.Quaternion}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{center:this._volume.center,size:this._volume.size,orientation:this.convertQuaternionToOrientation(this._volume.orientation)}}updateOrientation(e){this.eulerCache.set(e.pitch*Bo,e.yaw*Bo,e.roll*Bo,"YXZ"),this.quaternionCache.setFromEuler(this.eulerCache),this._volume.updateOrientation(this.quaternionCache)}convertQuaternionToOrientation(e){return this.eulerCache.setFromQuaternion(this.quaternionCache.set(e.x,e.y,e.z,e.w)).reorder("YXZ"),{yaw:this.eulerCache.y*Bo,pitch:this.eulerCache.x*Bo,roll:this.eulerCache.z*Bo}}}class jo{constructor(e,t,a){this.type=e.CYLINDER,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{basePoint:this._volume.basePoint,height:this._volume.height,radius:this._volume.radius}}}function $o(e){if(e&&"object"==typeof e&&"yaw"in e&&"pitch"in e&&"roll"in e){const t=e;return wn(t.yaw)&&wn(t.pitch)&&wn(t.roll)}return!1}class Wo{constructor(e,t){this.sourceFactories=e,this.sourceMap=t}validateInput(e){if(!gt(g.SourceType,e.type))throw Error(e.type+" is not a valid source type");return this.sourceFactories[e.type].validateInput(e)}async exec(e){const t=this.sourceFactories[e.type].create(e),a="source-"+ ++Wo.nextSourceId;return this.sourceMap.set(a,t),{sourceId:a,type:e.type,volume:t.describeVolume()}}}Wo.nextSourceId=0;class qo{constructor(e,t,a){this.sourceType=e,this.sphereVolumeFactory=t,this.THREE=a}validateInput(e){if(wa(e.options)){if(e.options.origin&&!Tn(e.options.origin))throw Error(`Source.Box: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(e.options.radius&&(!wn(e.options.radius)||e.options.radius<0))throw Error(`Source.Sphere: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{origin:t.origin||{x:0,y:0,z:0},radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Ho(this.sourceType,new this.sphereVolumeFactory,this.THREE),a=t.volume;return a.updateOrigin(e.options.origin),a.updateRadius(e.options.radius),t}}class Ko{constructor(e,t,a){this.sourceType=e,this.boxVolumeFactory=t,this.THREE=a}validateInput(e){if(wa(e.options)){if(e.options.center&&!Tn(e.options.center))throw Error(`Source.Box: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&(!Tn(e.options.size)||e.options.size.x<0||e.options.size.y<0||e.options.size.z<0))throw Error(`Source.Box: 'size' was specified but was not a valid Vector3; got ${e.options.size}`);if(e.options.orientation&&!$o(e.options.orientation))throw Error(`Source.Box: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`)}const t=e.options||{};return{type:e.type,options:{center:t.center||{x:0,y:0,z:0},size:t.size||{x:1/0,y:1/0,z:1/0},orientation:t.orientation||{yaw:0,pitch:0,roll:0}}}}create(e){const t=new zo(this.sourceType,new this.boxVolumeFactory,this.THREE),a=t.volume;return a.updateCenter(e.options.center),a.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),t}}class Yo{constructor(e,t,a){this.sourceType=e,this.cylinderVolumeFactory=t,this.THREE=a}validateInput(e){if(wa(e.options)){if(e.options.basePoint&&!Tn(e.options.basePoint))throw Error(`Source.Cylinder: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&(!wn(e.options.height)||e.options.height<0))throw Error(`Source.Cylinder: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&(!wn(e.options.radius)||e.options.radius<0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{basePoint:t.basePoint||{x:0,y:0,z:0},height:t.hasOwnProperty("height")?t.height:1/0,radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new jo(this.sourceType,new this.cylinderVolumeFactory,this.THREE),a=t.volume;return a.updateBasePoint(e.options.basePoint),a.updateHeight(e.options.height),a.updateRadius(e.options.radius),t}}class Xo{constructor(e,t){this.sourceUpdaters=e,this.sourceMap=t}validateInput(e){if(!K(e.sourceId)||!this.sourceMap.has(e.sourceId))throw Error("dev error: this should not occur unless the sdk was not setup properly");const t=this.sourceMap.get(e.sourceId);return this.sourceUpdaters[t.type].validateInput(e)}async exec(e){const t=this.sourceMap.get(e.sourceId);this.sourceUpdaters[t.type].update(e,t)}}class Zo{validateInput(e){if(!wa(e.options))throw Error("Source.Sphere.update: invalid options provided to .update");if(!Tn(e.options.origin))throw Error(`Source.Sphere.update: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(!wn(e.options.radius)||e.options.radius<0)throw Error(`Source.Sphere.update: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const a=t.volume;a.updateOrigin(e.options.origin),a.updateRadius(e.options.radius),a.notify()}}class Qo{validateInput(e){if(!wa(e.options))throw Error("Source.Box.update: invalid options provided to .update");if(e.options.center&&!Tn(e.options.center))throw Error(`Source.Box.update: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&!(Tn(e.options.size)&&e.options.size.x>=0&&e.options.size.y>=0&&e.options.size.z>=0))throw Error(`Source.Box.update: 'size' was specified but was not a valid Vector3; got ${JSON.stringify(e.options.size)}\n        ${"object"==typeof e}`);if(e.options.orientation&&!$o(e.options.orientation))throw Error(`Source.Box.update: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`);return e}update(e,t){const a=t.volume;a.updateCenter(e.options.center),a.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),a.notify()}}class Jo{validateInput(e){if(!wa(e.options))throw Error("Source.Cylinder.update: invalid options provided to .update");if(e.options.basePoint&&!Tn(e.options.basePoint))throw Error(`Source.Cylinder.update: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&(!wn(e.options.height)||e.options.height<0))throw Error(`Source.Cylinder.update: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&(!wn(e.options.radius)||e.options.radius<0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const a=t.volume;a.updateBasePoint(e.options.basePoint),a.updateHeight(e.options.height),a.updateRadius(e.options.radius),a.notify()}}function es(e,t,a){const n=new Map,o=new Map;return function(s,i){!function(e,t,a,n){const o=new Map,s=z.create(new V(t,a),new F(xo)),i=z.create(new V(t,o),new F(_o)),r=z.create(V.extend(n,t),new F(Ao));e.addCommand(ko,s),e.addCommand(Vo,i),e.addCommand(Fo,r);const d={[g.SensorType.CAMERA]:new Mo},c=z.create(V.extend(n,t,o),new F(Oo,e,d));e.addCommandToInterface(Object.assign({},Lo),c),e.addEnumToInterface({namespace:"Sensor",name:"SensorType",values:g.SensorType})}(s,n,o,i),function(e,t,a,n,o){const s=new V(t),i={[n.SPHERE]:new Zo,[n.BOX]:new Qo,[n.CYLINDER]:new Jo},r=z.create(s,new F(Xo,i));e.addCommand(Go,r);const d={[g.SourceType.SPHERE]:new qo(n,o.sphere,a),[g.SourceType.BOX]:new Ko(n,o.box,a),[g.SourceType.CYLINDER]:new Yo(n,o.cylinder,a)},c=z.create(s,new F(Wo,d));e.addCommandToInterface(Object.assign({},Uo),c),e.addEnumToInterface({namespace:"Sensor",name:"SourceType",values:g.SourceType})}(s,o,e,t,a)}}var ts;!function(e){e.FPS="stat.fps"}(ts||(ts={}));class as{constructor(e,t){this.perfStatInterval=1e3,this.elapsedTime=0,this.frameCount=0,this.lastCalcTime=0,this.fps=[0],this.waitForUpdate=e,this.perfStatInterval=t.tryGetProperty("perfInterval",this.perfStatInterval)}async calcAndBroadcast(e){await this.waitForUpdate();const t=Date.now(),a=t-this.lastCalcTime;this.lastCalcTime=t,this.elapsedTime+=a,this.frameCount++,this.elapsedTime>=this.perfStatInterval&&(this.fps[0]=1e3*this.frameCount/this.elapsedTime,this.elapsedTime=0,this.frameCount=0,e.broadcast(ts.FPS,(()=>this.fps))),this.calcAndBroadcast(e)}}function ns(e,t="",a=""){let n="sdkStorage/";return t&&t.length>0&&(n=n+t+"/"),a&&a.length>0&&(n=n+a+"/"),n+e}class os{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return e}async exec(e){localStorage.setItem(ns(e.key,this.modelData.model.sid),JSON.stringify(e.data))}}class ss{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e){const t=localStorage.getItem(ns(e.key,this.modelData.model.sid));return t?JSON.parse(t):null}}class is{constructor(e){this.modelData=e}validateInput(e){let t=null==e?void 0:e.modelId;if(null==t)t=this.modelData.model.sid;else if("*"===t)t="";else if("string"!=typeof t)throw Error(t+" is not a valid key");return{modelId:t}}async exec(e){const t=ns("",e.modelId),a={};for(const[e,n]of Object.entries(localStorage))e.startsWith(t)&&(a[e.slice(t.length)]=JSON.parse(n));return a}}class rs{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e){localStorage.removeItem(ns(e.key,this.modelData.model.sid))}}class ds{constructor(e,t){this.toSdkAlignmentMap={[e.ALIGNED]:w.Alignment.ALIGNED,[e.UNALIGNED]:w.Alignment.UNALIGNED},this.toSdkPlacementMap={[t.UNPLACED]:w.Placement.UNPLACED,[t.AUTO]:w.Placement.AUTO,[t.MANUAL]:w.Placement.MANUAL}}toSdkAlignment(e){return this.toSdkAlignmentMap[e]}toSdkPlacement(e){return this.toSdkPlacementMap[e]}}const cs=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",defurnishableStartDate:new Date("03/10/2023"),defurnishableStartVersion:"1.2.29221.4-gcac59bd3ec.REL_1425",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"});class ls{constructor(){this.currentSweep="",this.sweepTransitionActive=!1,this.currentMode=null,this.modeTransitionActive=!1}create(e,t,a){return new _e(t.onChanged((()=>this.throttleSweepDataChanges(e,t))),a.onChanged((()=>this.throttleViewmodeDataChanges(e,a))))}throttleSweepDataChanges(e,t){const a=t.currentSweep||"",n=t.transition.active&&t.transition.to!==t.transition.from;this.currentSweep===a&&this.sweepTransitionActive===n||(this.currentSweep=a,this.sweepTransitionActive=n,e.onChanged())}throttleViewmodeDataChanges(e,t){const a=t.currentMode,n=t.transition.active;this.currentMode===a&&this.modeTransitionActive===n||(this.currentMode=a,this.modeTransitionActive=n,e.onChanged())}}class hs{constructor(e,t){this.currentSweep=Object.assign(Object.assign({},hs.empty),{floorInfo:Object.assign({},hs.empty.floorInfo),neighbors:[],position:Object.assign({},hs.empty.position),rotation:Object.assign({},hs.empty.rotation)}),this.Viewmode=e.Viewmode,this.sweepPlacementConverter=t.sweepPlacementConverter}get data(){return this.currentSweep}equals(e){const t=cs.epsilon;return this.currentSweep.id===e.data.id&&this.currentSweep.enabled===e.data.enabled&&this.currentSweep.alignmentType===e.data.alignmentType&&this.currentSweep.placementType===e.data.placementType&&this.currentSweep.floorInfo.id===e.data.floorInfo.id&&this.currentSweep.floorInfo.sequence===e.data.floorInfo.sequence&&this.compareNeighbors(e.currentSweep)&&St(this.currentSweep.position,e.data.position,t)&&St(this.currentSweep.rotation,e.data.rotation,t)}copy(e){this.copySweep(e.data)}update(e,t,a,n,o){const s=e.currentSweepObject;if(!s||e.transition.active||t.transition.active||!t.isInside()&&t.currentMode!==this.Viewmode.Outdoor)return void this.copySweep(hs.empty);let i;try{i=a.getFloor(s.floorId||"")}catch(e){i={id:void 0,index:void 0}}const r=n.getIdForSweep(s);this.currentSweep.uuid=s.uuid,this.currentSweep.sid=r,this.currentSweep.id=r,this.currentSweep.enabled=s.enabled,this.currentSweep.alignmentType=this.sweepPlacementConverter.toSdkAlignment(s.alignmentType),this.currentSweep.placementType=this.sweepPlacementConverter.toSdkPlacement(s.placementType),this.currentSweep.neighbors=[...s.neighbours.map((e=>n.getIdFromCwfId(e)))],vt(this.currentSweep.position,s.position),vt(this.currentSweep.rotation,s.rotation),this.currentSweep.alignmentType===w.Alignment.UNALIGNED&&this.currentSweep.placementType===w.Placement.UNPLACED?(this.currentSweep.floorInfo.id=void 0,this.currentSweep.floorInfo.sequence=void 0):(this.currentSweep.floorInfo.id=i.id?o.getIdFromCwfId(i.id):i.id,this.currentSweep.floorInfo.sequence=i.index)}copySweep(e){this.currentSweep.uuid=e.uuid,this.currentSweep.sid=e.sid,this.currentSweep.id=e.id,this.currentSweep.enabled=e.enabled,this.currentSweep.alignmentType=e.alignmentType,this.currentSweep.placementType=e.placementType,this.currentSweep.floorInfo.id=e.floorInfo.id,this.currentSweep.floorInfo.sequence=e.floorInfo.sequence,this.currentSweep.neighbors=[...e.neighbors],vt(this.currentSweep.position,e.position),vt(this.currentSweep.rotation,e.rotation)}compareNeighbors(e){const t=this.currentSweep.neighbors.length;for(let a=0;a<t;++a)if(this.currentSweep.neighbors[a]!==e.neighbors[a])return!1;return t===e.neighbors.length}}hs.empty={uuid:"",sid:"",id:"",enabled:!1,alignmentType:w.Alignment.ALIGNED,placementType:w.Placement.UNPLACED,floorInfo:{id:void 0,sequence:void 0},neighbors:[],position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}};class us{constructor(e,t,a,n){this.sweepData=a,this.sweepIdMap=n,this.NavigateToSweepCommand=e.NavigateToSweepCommand,this.issueCommand=t.issueCommand,this.cameraTransitionConverter=t.cameraTransitionConverter,this.conversion=t.conversionUtils}validateInputSweepId(e,t,a){if(!e||!K(e))throw Error(`Sweep.moveTo: 'sweep' was not a valid sweep id; got ${e}`);const n=a.getSweepForId(e);if(!n)throw Error(e+" does not map to a valid sweep in this model");return n.id}validateInputRotation(e){if(!e)return;const t=Error(`Sweep.moveTo: 'options.rotation' was specified but was not a valid Rotation; got ${e}`);if(e&&!wa(e))throw t;const a=e||{},n={x:fn(a.x),y:fn(a.y)};if(a.z&&(n.z=fn(a.z)),!function(e){const t=e;return!!t&&!("object"!=typeof t||"z"in t&&!wn(t.z))&&wn(t.x)&&wn(t.y)}(n))throw t;return n}validateTransitionTime(e){if(!e)return;const t=Error(`Sweep.moveTo: options.transitionTime was specified but was not a valid, positive time; got ${e}`);if(!wn(e)&&!K(e))throw t;const a="number"==typeof e?e:fn(e);if(!wn(a)||a<=0)throw t;return a}validateInput(e){const t=this.validateInputSweepId(e.sweep,this.sweepData,this.sweepIdMap),a=e.options||{},n=this.validateInputRotation(a.rotation),o=this.validateTransitionTime(a.transitionTime);if(a.transition&&!gt(A,a.transition))throw Error(`Sweep.moveTo: options.transition was specified but was not a valid transition type; got ${a.transition}`);return{sweep:t,options:{rotation:n,transition:a.transition,transitionTime:o}}}async exec(e,t){const a=e.options.rotation?this.conversion.rotationToQuaternion(e.options.rotation):void 0,n=e.options.transition,o=e.options.transition?this.cameraTransitionConverter.fromSdkTransition(n):void 0,s=e.options.transitionTime;return await this.issueCommand(new this.NavigateToSweepCommand({sweep:e.sweep,rotation:a,transition:o,transitionTime:s}))}}class ps{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ms{constructor(e,t,a,n,o,s){this.sweepData=a,this.floorsData=n,this.sweepIdMap=o,this.floorIdMap=s,this._data={},this.conversionUtils=e,this.sweepPlacementConverter=t}get data(){return this._data}isItemEqual(e,t){return!ne(this.data[t],e.data[t])}update(){const e={};for(const t of this.sweepData.sweeps()){const{id:a,index:n}=t.floorId?this.floorsData.getFloor(t.floorId):{id:"",index:-1},o=a?this.floorIdMap.getIdFromCwfId(a):void 0,s=this.sweepIdMap.getIdFromCwfId(t.id);e[s]=t.id;const i=this.data[s]||{};i.uuid=t.uuid,i.sid=s,i.id=s,i.enabled=t.enabled,i.alignmentType=this.sweepPlacementConverter.toSdkAlignment(t.alignmentType),i.placementType=this.sweepPlacementConverter.toSdkPlacement(t.placementType),i.neighbors=t.neighbours.map((e=>this.sweepIdMap.getIdFromCwfId(e))),i.position=gs(t,i.position),i.rotation=this.conversionUtils.quaternionToRotation(t.rotation,i.rotation),i.floorInfo=o?{id:o,sequence:n}:{id:"",sequence:-1},this.data[i.id]=i}for(const t in this.data)this.sweepData.containsSweep(e[t])||delete this.data[t]}clear(){this._data={}}}function gs(e,t){return(t=t||{}).x=e.position.x,t.y=e.position.y,t.z=e.position.z,t}class ws{constructor(e){this.sweepData=e}validateInput(e){return{invert:!!(null==e?void 0:e.invert)||!1}}async exec(e,t){return this.sweepData.getSweepIdMap(e.invert)}}class fs{constructor(e){this.sweepData=e}validateInput(e,t){const a=null==e?void 0:e.id;if(!a)throw Error("Sweep.GetLabelFromIdExecutor: Missing input 'id' field");if(!Y(a))throw Error(`Sweep.GetLabelFromIdExecutor: provided ${null==e?void 0:e.id} is not a valid string`);return{id:a}}async exec(e,t){var a,n;let o=null===(a=this.sweepData.getSweep(e.id))||void 0===a?void 0:a.index;return void 0===o&&(o=null===(n=this.sweepData.getSweepByUuid(e.id))||void 0===n?void 0:n.index),void 0!==o?(o+1).toString():null}}class ys{constructor(e,t,a){this.sweepData=e,this.sweepViewData=t,this.sweepIdMap=a}validateInput(e){return{sweepIds:vs(e.sweepIds,this.sweepData,this.sweepIdMap)}}async exec(e,t){for(const t of e.sweepIds)Is(t,!0,this.sweepData,this.sweepViewData)}}class Ts{constructor(e,t,a){this.sweepData=e,this.sweepViewData=t,this.sweepIdMap=a}validateInput(e){return{sweepIds:vs(e.sweepIds,this.sweepData,this.sweepIdMap)}}async exec(e,t){for(const t of e.sweepIds)Is(t,!1,this.sweepData,this.sweepViewData)}}function vs(e,t,a){if(!Array.isArray(e))throw Error();return e.map((e=>function(e,t,a){if(!K(e))throw Error(e+" is not a valid string input");const n=a.getSweepForId(e);if(!n)throw Error(e+" does not map to a valid sweep in this model");return n.id}(e,0,a)))}function Is(e,t,a,n){n.setVisible(e,t);const o=a.getSweep(e);o.enabled=t,o.commit()}class Es{constructor(e,t,a){this.sweepData=a,this.SweepNeighborModifyCommand=e.SweepNeighborModifyCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const a=null==e?void 0:e.sweepId;if(!a)throw Error("Sweep.AddSweepNeighborsExecutor: Missing input 'sweepId' field");if(!Y(a))throw Error(`Sweep.AddSweepNeighborsExecutor: provided "${null==e?void 0:e.sweepId}" is not a valid string`);if(!this.sweepData.containsSweep(e.sweepId))throw Error(`Sweep.AddSweepNeighborsExecutor: provided sweep ID "${null==e?void 0:e.sweepId}" is not a valid V2 ID`);const n=this.sweepData;const o=null==e?void 0:e.toAdd;if(!o||!Aa(o,(function(e){const t=n.containsSweep(e);return Y(e)&&t})))throw Error("Sweep.AddSweepNeighborsExecutor: Invalid list of neighbors to add");return{sweepId:a,toAdd:o}}async exec(e,t){const a=this.sweepData.getSweep(e.sweepId);return await this.issueCommand(new this.SweepNeighborModifyCommand(a.id,e.toAdd)),this.sweepData.getSweep(e.sweepId).neighbours}}class Cs{constructor(e,t,a){this.sweepData=a,this.SweepNeighborModifyCommand=e.SweepNeighborModifyCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const a=null==e?void 0:e.sweepId;if(!a)throw Error("Sweep.RemoveSweepNeighborsExecutor: Missing input 'sweep' field");if(!Y(a))throw Error(`Sweep.RemoveSweepNeighborsExecutor: provided "${null==e?void 0:e.sweepId}" is not a valid string`);if(!this.sweepData.containsSweep(e.sweepId))throw Error(`Sweep.AddSweepNeighborsExecutor: provided sweep ID "${null==e?void 0:e.sweepId}" is not a valid V2 Sweep ID`);const n=this.sweepData;const o=null==e?void 0:e.toRemove;if(!o||!Aa(o,(function(e){const t=n.getSweep(a).neighbours.includes(e);return Y(e)&&t})))throw Error("Sweep.RemoveSweepNeighborsExecutor: Invalid list of neighbors to remove.");return{sweepId:a,toRemove:o}}async exec(e,t){const a=this.sweepData.getSweep(e.sweepId);return await this.issueCommand(new this.SweepNeighborModifyCommand(a.id,[],e.toRemove)),this.sweepData.getSweep(e.sweepId).neighbours}}class bs{create(e,t){return t.onChanged({notify(){e.onChanged()}})}}class As{constructor(e){this.attachmentRegistry=e,this._data={}}get data(){return this._data}isItemEqual(e,t){return this.data[t].id===e.data[t].id&&this.data[t].src===e.data[t].src&&this.data[t].type===e.data[t].type}update(){for(const[,e]of this.attachmentRegistry.descriptors()){const t=this._data[e.id]||{};t.id=e.id,t.src=e.src,t.type=e.type,this._data[e.id]=t}for(const e in this.data){this.attachmentRegistry.has(e)||delete this._data[e]}}clear(){this._data={}}}class Ss{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t,this.attachmentCounts=new Map}validateInput(e,t){K(e.tagId)||this.throw(j("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),Aa(e.attachmentIds,K)||this.throw(j("attachmentId","string or strings",e.tagId));for(const a of e.attachmentIds)this.attachmentRegistry.get(t.client.applicationKey,a)||this.throw(`${a} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t){for(const a of e.attachmentIds){const n=this.attachmentRegistry.get(t.client.applicationKey,a);n||this.throw(`${a} does not map to a valid attachment`);const o=this.attachmentCounts.get(n)||0;this.attachmentCounts.set(n,o+1);const s=this.mattertagData.getTag(e.tagId);n.category===_a.UPLOAD?s.fileAttachments.push(n):n.category===_a.EXTERNAL?s.externalAttachments.push(n):n.category===_a.SANDBOX&&s.sandboxAttachments.push(Object.assign(Object.assign({},n),{src:n.src+`?id=${n.id}&parent=${e.tagId}&${o}`}))}this.mattertagData.commit()}throw(e){throw Error("Tag.attach: "+e)}}class Ds{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t}validateInput(e,t){K(e.tagId)||this.throw(j("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),Aa(e.attachmentIds,K)||this.throw(j("attachmentId","string or strings",e.tagId));for(const a of e.attachmentIds)this.attachmentRegistry.get(t.client.applicationKey,a)||this.throw(`${a} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t){for(const a of e.attachmentIds){const n=this.attachmentRegistry.get(t.client.applicationKey,a);if(!n)return void this.throw(`${a} does not map to a valid attachment`);const o=this.mattertagData.getTag(e.tagId);n.category===_a.UPLOAD?Os(o.fileAttachments,n.id):n.category===_a.EXTERNAL?Os(o.externalAttachments,n.id):n.category===_a.SANDBOX&&Os(o.sandboxAttachments,n.id)}this.mattertagData.commit()}throw(e){throw Error("Tag.detach: "+e)}}function Os(e,t){const a=e.findIndex((e=>e.id===t));a>=0&&e.splice(a,1)}class Ms{constructor(e){this.attachmentRegistry=e,this.log=new Ye("tag.registerAttachment")}validateInput(e){const t=e.srcs;return Aa(t,Y)||(Aa(t,this.validateDescriptor)&&this.log.warn("Using attachment descriptors is deprecated and will be removed when Early Access closes."),this.throw(j("descriptors","Array of AttachmentDescriptors or strings",t))),{srcs:t}}validateDescriptor(e,t){return wa(e)||this.throw(`descriptor #${t} is not an object`),K(e.src)||this.throw(`descriptor[${t}].src is not a string`),gt(f.AttachmentType,e.type)&&e.type!==f.AttachmentType.UNKNOWN||this.throw(`descriptor[${t}].type is not a valid attachment type`),e.type===f.AttachmentType.SANDBOX&&this.throw(`descriptor[${t}] has type ${f.AttachmentType.SANDBOX} and should be registered using 'Tag.registerSandbox' instead`),!0}async exec(e,t){const a=[];for(const n of e.srcs){const e="string"==typeof n?await this.attachmentRegistry.addBySrc(t.client.applicationKey,n):this.attachmentRegistry.add(t.client.applicationKey,n);a.push(e)}return a}throw(e){throw Error("Tag.registerAttachment: "+e)}}(class extends ie{constructor(e){super(),this.payload={tags:e}}}).id="MATTERTAG_DISC_POSITIONS";class Rs extends ie{constructor(e){super(),this.payload=e}}Rs.id="ADD_MATTERTAG";(class extends ie{constructor(e){super(),this.payload={sid:e}}}).id="DELETE_MATTERTAG";class Ns extends ie{constructor(e,t,a,n){super(),this.payload={sid:e,standardOptions:t,mediaOptions:a,positionOptions:n}}}Ns.id="MATTERTAG_EDIT";class Ps extends ie{constructor(e,t,a){super(),this.payload={sid:e,attachmentOptions:t,operation:a}}}Ps.id="MATTERTAG_EDIT_ATTACHMENTS",function(e){let t;!function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"}(t=e.Operation||(e.Operation={}))}(Ps||(Ps={}));class xs extends ie{constructor(e,t,a=[],n){super(),this.payload={id:e,properties:t,fileAttachments:a,embed:n}}}xs.id="MATTERTAG_NEW_SAVE";(class extends ie{constructor(e,t,a=[],n=[],o){super(),this.payload={id:e,properties:t,pendingAttachments:a,removedAttachments:n,embed:o}}}).id="MATTERTAG_SAVE";class _s extends ie{constructor(e){super(),this.payload={viewId:e}}}class Ls extends ie{constructor(e,t){super(),this.payload={viewId:e,name:t}}}(class extends ie{}).id="MODEL_TO_LAYERED_COMMAND";(class extends ie{}).id="CHECK_FOR_PROXY_LAYER_COMMAND";(class extends ie{}).id="DISABLE_WORKSHOP_SESSION_COMMAND";(class extends _s{}).id="MODEL_VIEW_SET_COMMAND";(class extends ie{constructor(e){super(),this.payload={name:e}}}).id="USER_VIEW_ADD_COMMAND";(class extends _s{}).id="VIEW_DELETE_COMMAND";(class extends Ls{}).id="VIEW_RENAME_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={viewId:e,enabled:t}}}).id="VIEW_TOGGLE_ENABLE_COMMAND";(class extends Ls{}).id="VIEW_DUPLICATE_COMMAND";(class extends ie{constructor(e){super(),this.payload={confirmViewChange:e}}}).id="REGISTER_CONFIRM_VIEW_CHANGE";(class extends ie{constructor(e){super(),this.payload=e}}).id="REGISTER_DUPLICATE_VIEW_HELPER_COMMAND";(class extends ie{constructor(e){super(),this.payload=e}}).id="UNREGISTER_DUPLICATE_VIEW_HELPER_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={layerId:e,items:t}}}).id="LAYER_ITEMS_COPY_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={name:e,items:t}}}).id="LAYER_ITEMS_COPY_NEW_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={layerId:e,items:t}}}).id="LAYER_ITEMS_MOVE_COMMAND";(class extends ie{constructor(e){super(),this.payload={items:e}}}).id="VIEW_ITEMS_DELETE_COMMAND";class ks extends ie{constructor(e,t){super(),this.payload={label:e,common:t}}}ks.id="ADD_LAYER_COMMAND";class Vs extends ie{constructor(e){super(),this.payload={layerProps:e}}}Vs.id="ADD_INMEMORY_LAYER_COMMAND";class Fs extends ie{constructor(e){super(),this.payload={layerId:e}}}Fs.id="DELETE_INMEMORY_LAYER_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={layerId:e,label:t}}}).id="DATA_LAYER_DUPLICATE_COMMAND";(class extends ie{constructor(e){super(),this.payload={layerId:e}}}).id="DELETE_LAYER_COMMAND";(class extends ie{constructor(e){super(),this.payload={layerId:e}}}).id="REMOVE_LAYER_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={layerId:e,label:t}}}).id="RENAME_LAYER_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={layerId:e,visible:t}}}).id="LAYER_TOGGLE_VISIBLE_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={layerId:e,common:t}}}).id="LAYER_TOGGLE_COMMON_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={layerId:e,position:t}}}).id="SET_LAYER_POSITION_COMMAND";class Us extends ie{constructor(e,t){super(),this.payload={layerId:e,selected:t}}}Us.id="LAYER_SELECT_COMMAND";(class extends ie{constructor(e,t){super(),this.payload={layerId:e,on:t}}}).id="LAYER_TOGGLE_COMMAND";(class extends ie{constructor(e=!1){super(),this.payload={syncWithSweepTransition:e}}}).id="TOGGLE_DEFURNISH_COMMAND";const Gs=new Ye("mattertag-util");function Hs(e,t,a,n){const o=n.meshSubGroupsFromPoint(e);let s=1/0,i="";for(const t of a.rooms())if(o.includes(t.meshSubgroup)){const a=n.meshGroups.rooms.get(t.meshSubgroup),o=e.y-((null==a?void 0:a.boundingBox.min.y)||-1/0);o<s&&(s=o,i=t.floorId)}try{return t.getFloor(i).index}catch(e){return Gs.debug("Unable to deduce floor index from position; defaulting to floor 0"),0}}function Bs(e,t){return e instanceof Function?e(t):t===e}class zs extends ve{constructor(e){super(),this.value=e}notifyObserver(e){e(this.value)}get value(){return this._value}set value(e){this._value!==e&&(this.removeChildObservables(this._value),this.addChildObservable(e),this._value=e,this.setDirty())}deepCopy(){return ae(this._value)}waitFor(e){return new Promise((t=>{if(Bs(e,this._value))t();else{const a=this.onChanged((n=>{Bs(e,n)&&(a.cancel(),t())}))}}))}}const js=new Ye("ProgressTracker");class $s{constructor(e){this.totalTasks=e,this.taskCompleted=0,this.percentCompleted=new zs(-1)}start(){js.debug("start"),this.percentCompleted.value=0}notifyTaskCompleted(){this.taskCompleted>=this.totalTasks||(this.taskCompleted++,this.percentCompleted.value=this.taskCompleted/this.totalTasks,js.debug(`percent completed: ${this.percentCompleted.value}`))}forceComplete(){this.percentCompleted.value=1,js.debug(`forceComplete: ${this.percentCompleted.value}`)}}const Ws=new Ye("command.importTags");class qs{constructor(e,t,a,n,o,s,i,r){this.sdkLayer=e,this.THREE=t,this.externals=a,this.getTagsQuery=n,this.mattertagsData=o,this.floorsData=s,this.roomData=i,this.meshData=r}validateInput(e,t){if(K(e.spaceSid)||this.throw(j("spaceSid","string",e.spaceSid)),!e.options)return{spaceSid:e.spaceSid,options:{}};const a={};wa(e.options)||this.throw("options is not an object");const n=e.options;return n.progress&&("function"==typeof n.progress?a.progress=n.progress:this.throw("progress option is not a function")),n.allowedLayers&&(Aa(n.allowedLayers,Y)?a.allowedLayers=n.allowedLayers:this.throw("allowedLayers option is not an array")),{spaceSid:e.spaceSid,options:a}}async exec(e,t){const a=await this.getTagsQuery(e.spaceSid),n=[];for(const t of a)t.sid="imported-"+t.sid,this.mattertagsData.getTag(t.sid)||(e.options.allowedLayers?e.options.allowedLayers.includes(t.layerId)&&n.push(t):n.push(t));const o=[],s=n.length+1,i=new $s(s),r=[];if(e.options.progress&&r.push(i.percentCompleted.onChanged(e.options.progress)),i.start(),!this.sdkLayer)return Ws.warn("SDK Layers is not ready to be used."),[];await this.externals.issueCommand(new Us(this.sdkLayer.id,!0)),i.notifyTaskCompleted();for(const t of n){const a=new this.THREE.Vector3,n=new this.THREE.Vector3;a.set(t.anchorPosition.x,t.anchorPosition.y,t.anchorPosition.z),n.set(t.stemVector.x,t.stemVector.y,t.stemVector.z);const s=n.length();n.normalize();const i=Hs(a,this.floorsData,this.roomData,this.meshData),r=this.floorsData.getFloorAtIndex(i);r||this.throw(`Could not add Tag ${t.sid} due to invalid floor position floorIndex: ${i} spaceId ${e.spaceSid}`),o.push({id:t.sid,positionOptions:{position:t.anchorPosition,normal:n,floorId:r.id},standardOptions:{label:t.label,description:t.description,stemVisible:t.stemVisible,stemHeight:s,color:t.color,icon:t.icon},attachmentOptions:{fileAttachments:t.fileAttachments,externalAttachments:t.externalAttachments,refreshIds:[e.spaceSid]}})}r.push(this.mattertagsData.mattertags.onElementChanged({onAdded:()=>{i.notifyTaskCompleted()}}));const d=await this.externals.issueCommand(new Rs(o));for(let e=0;e<n.length;e++){const t=n[e],a=this.mattertagsData.getTag(d[e]);a.enabled=t.enabled;for(const e of t.keywords)a.keywords.push(e)}return i.forceComplete(),r.forEach((e=>e.cancel())),d}throw(e){throw Error("Tag.importTags: "+e)}}class Ks{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Ys{constructor(e,t,a,n,o,s){this.THREE=e,this.mattertagData=t,this.tagsViewData=a,this.roomIdMap=n,this.roomData=o,this.meshData=s,this._data={}}get data(){return this._data}isItemEqual(e,t){return!ne(this.data[t],e.data[t])}update(){const e=e=>{const t=(new this.THREE.Vector3).set(e.x,e.y,e.z);for(const e of this.roomData.rooms()){const a=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(a&&a.boundingBox.containsPoint(t))return e}};for(const t of this.tagsViewData.getOrderedTags()){const a=this.mattertagData.getTag(t.id),n=this.data[a.sid]||{};if(n.id=a.sid,n.enabled=a.enabled,n.anchorPosition=ja(a,"anchorPosition",n.anchorPosition),n.stemVector=ja(a,"stemVector",n.stemVector),n.stemVisible=a.stemVisible,n.label=a.label,n.description=a.description,n.color=$a(a,"color",n.color),n.keywords=Et(n.keywords||[],a.keywords.values()),n.fontId=a.icon?a.icon.split("_")[2]:"",a.roomId)n.roomId=this.roomIdMap.getIdFromCwfId(a.roomId);else{const t=e(n.anchorPosition);t&&t.id&&(n.roomId=this.roomIdMap.getIdFromCwfId(t.id))}const o=a.fileAttachments.map((e=>e.id)),s=a.externalAttachments.map((e=>e.id)),i=a.sandboxAttachments.map((e=>e.id));n.attachments=[...o,...s,...i],this._data[a.sid]=n}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}}function Xs(e){if(e&&"object"==typeof e&&"r"in e&&"g"in e&&"b"in e){const t=e;return wn(t.r)&&wn(t.g)&&wn(t.b)}return!1}const Zs=new Ye("command.add");class Qs{constructor(e,t,a,n,o,s,i,r,d,c,l,h){this.THREE=e,this.issueCommand=t.issueCommand,this.isMpFontId=t.isMpFontId,this.mattertagsData=a,this.tagAttach=n,this.tagEditIcon=o,this.tagEditOpacity=s,this.attachmentRegistry=i,this.iconMaps=r,this.floorsData=c,this.roomData=l,this.meshData=h}validateInput(e,t){const{descriptors:a}=e;return Aa(a,((e,a)=>this.validateDescriptor(e,a,t)))||this.throw("descriptors is not an array"),{descriptors:a}}validateDescriptor(e,t,a){var n,o,s;if(wa(e)||this.throw(`descriptor #${t} is not an object`),Tn(e.anchorPosition)||this.throw(`descriptor[${t}].anchorPosition is not vector`),Tn(e.stemVector)||this.throw(`descriptor[${t}].stemVector is not vector`),void 0===e.id||K(e.id)||this.throw(`descriptor[${t}].id is not a valid string`),void 0===e.enabled||fa(e.enabled)||this.throw(`descriptor #${t}.enabled is not a boolean`),void 0===e.stemVisible||fa(e.stemVisible)||this.throw(`descriptor[${t}].stemVisible is not a boolean`),void 0===e.label||Y(e.label)||this.throw(`descriptor[${t}].label is not a string`),void 0===e.description||Y(e.description)||this.throw(`descriptor[${t}].description is not a string`),void 0!==e.attachments){Aa(e.attachments,Y)||this.throw(`descriptor[${t}].attachments is not an array of strings`);for(let n=0;n<e.attachments.length;++n){const o=e.attachments[n];this.attachmentRegistry.get(a.client.applicationKey,o)||this.throw(`descriptor[${t}].attachment[${n}] does not map to a valid attachment`)}}return void 0===e.color||Xs(e.color)||this.throw(`descriptor[${t}].color is not a Color`),void 0!==e.opacity&&(wn(e.opacity)||this.throw(`descriptor[${t}].opacity is not a number`),o=e.opacity,s=1,0<=o&&o<=s||(Zs.warn(`descriptor[${t}].opacity was clamped from ${e.opacity} to the range [0, 1]`),e.opacity=yn(e.opacity,0,1))),void 0===e.iconId||K(e.iconId)||this.throw(`descriptor[${t}].iconId is not a valid string`),e.id=a.client.getOrClaimId(e.id),e.id&&K(e.id)&&this.mattertagsData.getTag(e.id)&&this.throw(`descriptor[${t}].id (${e.id}) is already in use`),!e.iconId||this.isMpFontId(e.iconId)||(null===(n=this.iconMaps.get(a.client.applicationKey))||void 0===n?void 0:n.imagePromise[e.iconId])||this.throw(`descriptor[${t}].iconId (${e.iconId}) does not map to a registered icon`),e.keywords&&!Aa(e.keywords,Y)&&this.throw(`descriptor[${t}].attachments is not an array of strings`),!0}async exec(e,t){const a=[],n=[];for(let t=0;t<e.descriptors.length;t++){const o=new this.THREE.Vector3,s=new this.THREE.Vector3,i=e.descriptors[t];o.set(i.anchorPosition.x,i.anchorPosition.y,i.anchorPosition.z),s.set(i.stemVector.x,i.stemVector.y,i.stemVector.z);const r=s.length();s.normalize();const d=Hs(o,this.floorsData,this.roomData,this.meshData),c=this.floorsData.getFloorAtIndex(d);c||this.throw(`Could not add Tag on invalid floor with index: ${d}`),a.push({id:i.id,positionOptions:{position:o,normal:s,floorId:c.id},standardOptions:{enabled:i.enabled,label:i.label,description:i.description,stemVisible:i.stemVisible,stemHeight:r,color:i.color,keywords:i.keywords}}),i.attachments&&n.push(t)}const o=await this.issueCommand(new Rs(a));for(let a=0;a<e.descriptors.length;a++){const n=o[a],s=e.descriptors[a];void 0!==s.opacity&&await this.tagEditOpacity.exec({id:n,opacity:s.opacity},t),void 0!==s.iconId&&this.tagEditIcon.exec({id:n,iconId:s.iconId},t),s.attachments&&this.tagAttach.exec({tagId:n,attachmentIds:s.attachments},t)}return o}throw(e){throw Error("Tag.add: "+e)}}function Js(e,t){return K(e)&&!!t.getTag(e)}class ei{constructor(e,t){this.externals=e,this.mattertagsData=t}validateInput(e,t){var a;if(!Js(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.options&&!wa(e.options))throw Error(j("options","object",e.options));return{id:e.id,options:{force:!!(null===(a=e.options)||void 0===a?void 0:a.force)}}}async exec(e,t){await this.externals.issueCommand(new this.externals.OpenTagCommand(e.id,{forceOpen:e.options.force}))}}var ti,ai;!function(e){e.NOTE="note",e.TAG="tag",e.OBJECT="object"}(ti||(ti={}));class ni{constructor(e,t){this.externals=e,this.mattertagsData=t}validateInput(e,t){var a;if(!Js(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.options&&!wa(e.options))throw Error(j("options","object",e.options));return{id:e.id,options:{force:!!(null===(a=e.options)||void 0===a?void 0:a.force)}}}async exec(e,t){await this.externals.issueCommand(new this.externals.DockAnnotationCommand(e.id,ti.TAG,e.options.force))}}class oi{constructor(e,t,a){this.externals=e,this.mattertagsData=t,this.tagsViewData=a}validateInput(e,t){if(!Js(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);return{id:e.id}}async exec(e,t){var a;(null===(a=this.tagsViewData.openTagView)||void 0===a?void 0:a.id)===e.id&&await this.externals.issueCommand(new this.externals.CloseTagCommand)}}!function(e){e.MATTERTAG="mattertag",e.NOTE="note",e.OBJECT="object"}(ai||(ai={}));ai.MATTERTAG,ai.NOTE,ai.OBJECT;var si,ii,ri,di;!function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(si||(si={})),function(e){e.IDLE="idle",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed"}(ii||(ii={})),function(e){e.UP="up",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN="down",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right",e.LEFT="left",e.RIGHT="right"}(ri||(ri={}));class ci{constructor(){this.focusedPin=null,this.selectedPin=null,this.dockedAnnotation=null}create(e,t,a){return new _e(t.onChanged((()=>this.throttlePinChanges(e,t))),a.onChanged((()=>this.throttleAnnotationChanges(e,a))))}throttlePinChanges(e,t){var a,n;const o=null!==(n=null===(a=t.focusedPin)||void 0===a?void 0:a.id)&&void 0!==n?n:null,s=t.selectedPinId;this.focusedPin===o&&this.selectedPin===s||(this.focusedPin=o,this.selectedPin=s,e.onChanged())}throttleAnnotationChanges(e,t){var a,n;const o=null!==(n=null===(a=t.dockedAnnotation)||void 0===a?void 0:a.id)&&void 0!==n?n:null;this.dockedAnnotation!==o&&(this.dockedAnnotation=o,e.onChanged())}}class li{constructor(){this._data={hovered:null,selected:new Set,docked:null}}get data(){return this._data}equals(e){return this.data.hovered===e.data.hovered&&this.data.docked===e.data.docked&&(t=this.data.selected,a=e.data.selected,t.size===a.size&&[...t].every((e=>a.has(e))));var t,a}update(e,t){var a,n;const o=e.focusedPin,s=e.selectedPinId?e.getPin(e.selectedPinId):null,i=null!==(n=null===(a=t.dockedAnnotation)||void 0===a?void 0:a.id)&&void 0!==n?n:null;this._data.hovered=(null==o?void 0:o.pinType)===ai.MATTERTAG?o.id:null,this._data.selected.clear(),s&&s.pinType===ai.MATTERTAG&&this._data.selected.add(s.id),this._data.docked=i}copy(e){this._data.hovered=e.data.hovered,this._data.docked=e.data.docked,function(e,t){e.clear();for(const a of t)e.add(a)}(this._data.selected,e.data.selected)}}!function(e){e.SETUP="sandbox.setup",e.TO_SANDBOX="sandbox.to.sandbox",e.TO_CLIENT="sandbox.to.client"}(di||(di={}));Symbol.iterator;class hi{constructor(){this.values=new Map}add(e,t){this.getValuesAtKey(e).add(t)}remove(e,t){const a=this.values.get(e);null==a||a.delete(t)}removeKey(e){this.values.delete(e)}getValuesAtKey(e){const t=this.values.get(e)||new Set;return this.values.set(e,t),t}valuesPerKey(e){return this.getValuesAtKey(e).size}get keys(){return this.values.keys()}hasKey(e){return this.values.has(e)}has(e,t){var a;return!!(null===(a=this.values.get(e))||void 0===a?void 0:a.has(t))}*[Symbol.iterator](){for(const[e,t]of this.values)for(const a of t)yield[e,a]}}class ui{constructor(){this.usedIds=new Set,this.usedIds.add(0)}generate(){let e;do{e=Math.floor(1e6*Math.random())}while(this.usedIds.has(e));return this.usedIds.add(e),e}isInUse(e){return this.usedIds.has(e)}}class pi{constructor(e,t,a,n){this.sdk=e,this.attachmentRegistry=t,this.tagViewData=a,this.iframeSrcDoc=n,this.idGenerator=new ui,this.sandboxSubs=new Set}validateInput(e){if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!wn(e.clientId))throw Error("Unexpected error: unable to create iframe");const t=e.options||{},a={on:"on",off:"off",send:"send",tag:"tag",docked:"docked"};t.globalVariableMap&&(K(t.globalVariableMap.on)&&(a.on=t.globalVariableMap.on),K(t.globalVariableMap.off)&&(a.off=t.globalVariableMap.off),K(t.globalVariableMap.send)&&(a.send=t.globalVariableMap.send),K(t.globalVariableMap.tag)&&(a.tag=t.globalVariableMap.tag),K(t.globalVariableMap.docked)&&(a.docked=t.globalVariableMap.docked));const n={w:0,h:0};if(t.size){if(!(wn(t.size.w)&&t.size.w>=0&&wn(t.size.h)&&t.size.h>=0))throw Error(j("options.size","Size",t.size));n.w=t.size.w,n.h=t.size.h}return{clientId:e.clientId,html:e.html,options:{name:t.name||"",globalVariableMap:a,size:n}}}async exec(e,t){const a=this.idGenerator.generate(),n=e=>{const n=n=>{n.source===e&&n.data.sandboxId===a&&this.sdk.sendPrivateMessage(di.TO_CLIENT,n.data,t.client.id)};window.addEventListener("message",n),this.sandboxSubs.add({dispose(){window.removeEventListener("message",n)}})},o=e=>{const n=this.sdk.addPrivateMessageHandler({clientId:t.client.id,messageType:di.TO_SANDBOX,onMessage(t){t.sandboxId===a&&e.postMessage(t,"*")}});this.sandboxSubs.add(n)},[s]=this.attachmentRegistry.addSandbox(t.client.applicationKey,{name:e.options.name,srcDoc:this.iframeSrcDoc,sandboxLoadedHandler:(t,s)=>{var i;const r=t.contentWindow;for(const e of this.sandboxSubs)e.dispose();this.sandboxSubs.clear(),n(r),o(r),r.postMessage({type:di.SETUP,sandboxId:a,customHTML:e.html,parentTag:s,docked:(null===(i=this.tagViewData.dockedAnnotation)||void 0===i?void 0:i.id)===s,globalVariableMap:e.options.globalVariableMap},"*")},size:e.options.size});return{sandboxId:a,attachmentId:s}}}class mi{constructor(e,t,a,n,o){this.externalTypes=e,this.externalCommands=t,this.pinViewData=a,this.tagsViewData=n,this.annotationsViewData=o}validateInput(e,t){const a=e.id;K(a)&&this.pinViewData.getPin(a)||this.throw(`${e.id} does not map to a valid tag`);const n={opening:!1,navigating:!1,docking:!1,sharing:!1};return wa(e.allow)&&(n.opening=!!e.allow.opening,n.navigating=!!e.allow.navigating,n.docking=!!e.allow.docking,n.sharing=!!e.allow.sharing),{id:a,allow:n}}async exec(e,t){var a,n;const o=this.pinViewData.getPin(e.id);o?(this.annotationsViewData.updateCapabilities(o.id,{dock:e.allow.docking,preview:e.allow.opening,share:e.allow.sharing}),this.tagsViewData.updateCapabilities(o.id,{focus:!!e.allow.navigating}),(!e.allow.docking&&(null===(a=this.annotationsViewData.dockedAnnotation)||void 0===a?void 0:a.id)===e.id||!e.allow.opening&&(null===(n=this.annotationsViewData.selectedAnnotation)||void 0===n?void 0:n.id)===e.id)&&this.externalCommands.issueCommand(new this.externalTypes.CloseAnnotationCommand(o.id,ti.TAG))):this.throw(`${e.id} does not map to a valid tag`)}throw(e){throw Error("Tag.allowAction: "+e)}}class gi{constructor(e,t,a){this.mattertagData=a,this.EditMattertagCommand=e.EditMattertagCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const{id:a}=e;return K(a)||this.throw(j("id","string",a)),this.mattertagData.getTag(a)||this.throw(`${a} does not map to a valid tag`),{id:a,properties:this.validateProperties(e.properties)}}validateProperties(e){wa(e)||this.throw("'properties' input is not an object");const{label:t,description:a}=e;return void 0===t||Y(t)||this.throw(j("label","string (or undefined)",t)),void 0===a||Y(a)||this.throw(j("description","string (or undefined)",a)),{label:t,description:a}}async exec(e,t){try{await this.issueCommand(new this.EditMattertagCommand(e.id,{label:e.properties.label,description:e.properties.description}))}catch(e){this.throw(e)}}throw(e){throw Error("Tag.editBillboard: "+e)}}class wi{constructor(e,t,a,n){this.THREE=e,this.EditMattertagCommand=t.EditMattertagCommand,this.issueCommand=a.issueCommand,this.mattertagData=n}validateInput(e,t){return K(e.id)||this.throw(j("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),Xs(e.color)||this.throw(j("color","Color",e.color)),{id:e.id,color:e.color}}async exec(e,t){try{const t=(new this.THREE.Color).setRGB(e.color.r,e.color.g,e.color.b);await this.issueCommand(new this.EditMattertagCommand(e.id,{color:t}))}catch(e){this.throw(e)}}throw(e){throw Error("Tag.editColor: "+e)}}class fi{constructor(e,t,a,n,o,s){this.THREE=t,this.isMpFontId=a,this.mattertagData=n,this.pinsModule=o,this.iconMaps=s,this.issueCommand=e.issueCommand}validateInput(e,t){var a;K(e.id)||this.throw(j("id","string",e.id));this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),K(e.iconId)||this.throw(j("iconId","string",e.iconId));const n=this.isMpFontId(e.iconId);return(null===(a=this.iconMaps.get(t.client.applicationKey))||void 0===a?void 0:a.imagePromise[e.iconId])||n||this.throw(`${e.iconId} does not map to a registered icon or font id`),{id:e.id,iconId:e.iconId}}async exec(e,t){const{id:a,iconId:n}=e,o=this.iconMaps.get(t.client.applicationKey);if(o&&e.iconId in o.imagePromise){let e;try{e=await o.imagePromise[n]}catch(e){this.throw(e)}const t=o.map[n],s=e.naturalWidth/e.naturalHeight,i=new this.THREE.Vector3;s>1?i.set(s,1,1):i.set(1,1/s,1),this.pinsModule.pinRenderer.setPinRenderOverrides(a,t,i)}else{this.mattertagData.getTag(e.id).icon=e.iconId,await this.issueCommand(new Ns(e.id,{icon:e.iconId}))}}throw(e){throw Error("Tag.editIcon: "+e)}}class yi{constructor(e,t,a,n,o){this.cwfTypes=e,this.closeTag=a,this.mattertagData=n,this.annotationsViewData=o,this.issueCommand=t.issueCommand}validateInput(e,t){Y(e.id)&&this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),e.stemParams&&wa(e.stemParams)||this.throw("invalid stem parameters objeect");const{stemHeight:a,stemVisible:n}=e.stemParams;return void 0===a||wn(a)||this.throw(j("stemHeight","number",e.id)),void 0===n||fa(n)||this.throw(j("stemVisibility","boolean",e.id)),{id:e.id,stemParams:{stemHeight:a,stemVisible:n}}}async exec(e,t){var a;const{stemHeight:n,stemVisible:o}=e.stemParams,s={};void 0!==n&&(s.stemHeight=n,(null===(a=this.annotationsViewData.dockedAnnotation)||void 0===a?void 0:a.id)!==e.id&&this.closeTag.exec({id:e.id},t)),void 0!==o&&(s.stemVisible=o),await this.issueCommand(new this.cwfTypes.EditMattertagCommand(e.id,s))}throw(e){throw Error("Tag.editStem: "+e)}}class Ti{constructor(e,t,a,n){this.ChangePinOpacityScaleCommand=e.ChangePinOpacityScaleCommand,this.PinType=e.PinType,this.issueCommand=t.issueCommand,this.mattertagData=a,this.pinsViewData=n}validateInput(e,t){return K(e.id)||this.throw(j("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),(!wn(e.opacity)||e.opacity<0||e.opacity>1)&&this.throw("'opacity' should be a number in the range of [0, 1]"),{id:e.id,opacity:e.opacity}}async exec(e,t){await this.waitForTagView(e.id),await this.issueCommand(new this.ChangePinOpacityScaleCommand(e.id,this.PinType.MATTERTAG,e.opacity))}async waitForTagView(e){if(!this.pinsViewData.getPin(e))return new Promise((t=>{const a=this.pinsViewData.onPinUpdate({onAdded(n,o){o===e&&(a.cancel(),t())}})}))}throw(e){throw Error("Tag.editOpacity: "+e)}}class vi{constructor(e){this.editPositions=e}validateInput(e,t){return this.editPositions.validateInput({descriptors:[{id:e.id,options:e.options}]},t).descriptors[0]}async exec(e,t){this.editPositions.exec({descriptors:[{id:e.id,options:e.options}]},t)}}class Ii{constructor(e,t,a,n){this.closeTag=e,this.mattertagData=t,this.annotationsViewData=a,this.roomIdMap=n}validateInput(e,t){const{descriptors:a}=e;return Aa(a,((e,a)=>this.validateDescriptor(e,a,t)))||this.throw("descriptors is not an array"),{descriptors:a}}validateDescriptor(e,t,a){return wa(e)||this.throw(`descriptor #${t} is not an object`),void 0===e.id||K(e.id)||this.throw(`descriptor[${t}].id is not a valid string`),this.validateOptions(e.options)||this.throw(`descriptor #${t}.options is not an object`),!0}validateOptions(e){return e&&wa(e)||this.throw("invalid options provided"),{anchorPosition:this.validateVector3(e.anchorPosition,"`anchorPosition` was provided but not a valid Vector3"),stemVector:this.validateVector3(e.stemVector,"`stemVector` was provided, but not a valid Vector3"),roomId:this.validateRoomId(e.roomId)}}validateVector3(e,t){return void 0===e||Tn(e)||this.throw(t),e}validateRoomId(e){return void 0===e||K(e)||this.throw(j("roomId","string (or undefined)",e)),e&&!this.roomIdMap.getRoomForId(e)&&this.throw(`${e} does not map to a valid room`),e}throw(e){throw Error("Tag.editPositions: "+e)}async exec(e,t){this.mattertagData.atomic((()=>{var a;for(const n of e.descriptors){const{anchorPosition:e,stemVector:o}=n.options,s=this.mattertagData.getTag(n.id),i=n.options.roomId&&this.roomIdMap.getRoomForId(n.options.roomId),r=i?i.floorId:s.floorId,d=e?s.anchorPosition.clone().set(e.x,e.y,e.z):s.anchorPosition,c=o?s.stemVector.clone().set(o.x,o.y,o.z):s.stemVector,l=o?c.length():s.stemHeight;c.normalize(),(e||o)&&(null===(a=this.annotationsViewData.dockedAnnotation)||void 0===a?void 0:a.id)!==n.id&&this.closeTag.exec({id:n.id},t),s.atomic((()=>{s.anchorPosition.set(d.x,d.y,d.z),s.anchorNormal.set(c.x,c.y,c.z),s.floorId=r,s.stemHeight=l,s.anchorPosition.set(d.x,d.y,d.z),s.stemVector.set(c.x,c.y,c.z),s.floorId=r,s.commit()}))}}))}}const Ei={key:"Tag.editKeywords",def:{namespace:"Tag",name:"editKeywords",args:["tagId","keywords"]}};class Ci{constructor(e){this.tagsData=e}validateInput(e){if(!Aa(e.keywords,K))throw Error();if(K(e.tagId)){const t=this.tagsData.getTag(e.tagId);if(t)return{tag:t,keywords:e.keywords}}throw Error(`${e.tagId} does not map to a valid tag`)}async exec(e){const t=new Set(e.keywords);e.tag.keywords.replace([...t]),e.tag.commit()}}const bi={key:"Tag.editEnabled",def:{namespace:"Tag",name:"editEnabled",args:["tagId","enabled"]}};class Ai{constructor(e){this.tagsData=e}validateInput(e,t){if(!fa(e.enabled))throw Error(j("enabled","boolean",e.enabled));if(K(e.tagId)){const t=this.tagsData.getTag(e.tagId);if(t)return{tag:t,enabled:e.enabled}}throw Error(`${e.tagId} does not map to a valid tag`)}async exec(e,t){e.tag.enabled=e.enabled,e.tag.commit()}}class Si{constructor(e,t,a){this.mattertagData=a,this.cwfTypes=e,this.issueCommand=t.issueCommand}validateInput(e){const t=e.ids;return Aa(t,K)||this.throw("'ids' is expected to be a series of strings"),{ids:t}}async exec(e){const t=[],a=[];for(const t of e.ids)a.push(this.issueCommand(new this.cwfTypes.CloseAnnotationCommand(t,ti.TAG)));return await Promise.all(a),this.mattertagData.atomic((()=>{for(const a of e.ids)this.mattertagData.removeTag(a),t.push(a)})),t}throw(e){throw Error("Tag.remove: "+e)}}class Di{constructor(e,t){this.mattertagData=e,this.pinsModule=t}validateInput(e,t){return K(e.id)||this.throw(j("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),{id:e.id}}async exec(e,t){const{id:a}=e;this.pinsModule.pinRenderer.setPinRenderOverrides(a,null,null)}throw(e){throw Error(`Tag.resetIcon: ${e}`)}}const Oi="TAG_NAV_OVERLAY",Mi="TAG_BILLBOARD_SHARE",Ri="TAG_BILLBOARD_DOCK";Object.freeze({colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"]});class Ni{constructor(e,t){this.setting=e,this.settingsData=t}validateInput(e){if(void 0===e.enable&&(e.enable=!this.settingsData.tryGetProperty(this.setting,!0)),!fa(e.enable))throw Error(j("enable","boolean or undefined",e.enable));return{enable:e.enable}}async exec(e){this.settingsData.setProperty(this.setting,e.enable)}}class Pi extends ie{constructor(e,t,a){super(),this.payload={parentId:e,parentType:t,src:a}}}Pi.id="EMBED_MEDIA";(class extends ie{constructor(e){super(),this.payload={attachment:e}}}).id="LOAD_ATTACHMENT_EMBED";class xi extends ie{constructor(e,t,a){super(),this.payload={parentId:e,parentType:t,files:a}}}xi.id="UPLOAD_ATTACHMENTS";(class extends ie{constructor(e,t,a){super(),this.payload={parentId:e,parentType:t,prevParentId:a}}}).id="CONFIRM_ATTACHMENT_CHANGES";(class extends ie{constructor(e){super(),this.payload={uploadId:e}}}).id="CANCEL_ATTACHMENT_UPLOAD";(class extends ie{}).id="CANCEL_ATTACHMENT_CHANGES";class _i extends ie{constructor(){super()}}_i.id="ATTACHMENTS_RESET_DATA";(class extends ie{constructor(e,t,a){super(),this.payload={open:e,attachments:t,attachmentId:a}}}).id="TOGGLE_VIEW_ATTACHMENTS";(class extends ie{constructor(e){super(),this.payload={attachment:e}}}).id="ATTACHMENT_REMOVE";(class extends ie{constructor(e){super(),this.payload={id:e}}}).id="ATTACHMENT_REMOVE_FAILED_UPLOAD";(class extends ie{constructor(e){super(),this.payload={id:e}}}).id="ATTACHMENT_DELETE";const Li=function(e){let t="";const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)t+=a.charAt(Math.floor(62*Math.random()));return t},ki=new Ye("command.saveToLayer");class Vi{constructor(e,t,a,n){this.sdkLayer=e,this.externalCommands=t,this.remove=a,this.mattertagsData=n}validateInput(e,t){const a={};if(!e.options)return{options:a};if(!wa(e.options))throw Error("Tag.saveToLayer: options is not an object");const n=e.options;if(n.progress){if("function"!=typeof n.progress)throw Error("Tag.saveToLayer: progress option is not a function");a.progress=n.progress}return{options:a}}async exec(e,t){if(null===this.sdkLayer)return ki.warn("Layers must be enabled to use Tag.saveToLayer."),[];const a=[];for(const e of this.mattertagsData)e.layerId===this.sdkLayer.id&&a.push(e);if(0===a.length)return[];const n=a.reduce(((e,t)=>e+t.fileAttachments.length+t.externalAttachments.length),0),o=new $s(a.length+n+2);let s;e.options.progress&&(s=o.percentCompleted.onChanged(e.options.progress)),o.start();const i=(new Date).toLocaleString();await this.externalCommands.issueCommand(new ks(`Imported ${i}`,!1)),o.notifyTaskCompleted();const r=[];for(const e of a)if(e.layerId===this.sdkLayer.id){let t=Li(11);for(;this.mattertagsData.getTag(t);)t=Li(11);const a=[];if(e.fileAttachments)for(const n of e.fileAttachments){const e=await fetch(await n.url.get()),s=await e.blob(),i=new File([s],n.filename||"image.jpg",{type:s.type}),r=await this.externalCommands.issueCommand(new xi(t,at.MATTERTAG,[i]));r[0].attachment&&a.push(r[0].attachment),o.notifyTaskCompleted()}e.fileAttachments.length=0,a.forEach((t=>{e.fileAttachments.push(t)}));let n=null;e.externalAttachments&&e.externalAttachments.length>0&&(n=await this.externalCommands.issueCommand(new Pi(t,at.MATTERTAG,e.externalAttachments.get(0).src)),o.notifyTaskCompleted());try{await this.externalCommands.issueCommand(new xs(t,{position:e.anchorPosition,normal:e.anchorNormal,roomId:e.roomId,floorId:e.floorId,color:Object.assign({},e.color),description:e.description,label:e.label,stemHeight:e.stemHeight,stemVisible:e.stemVisible,enabled:e.enabled,keywords:e.keywords.values(),icon:e.icon},a,n)),r.push(e)}catch(a){ki.warn(`Could not save tag sid:${t} label: ${e.label}}, skipping it.`)}o.notifyTaskCompleted(),this.externalCommands.issueCommand(new _i)}return await this.remove.exec({ids:r.map((e=>e.sid))},t),o.notifyTaskCompleted(),o.forceComplete(),null==s||s.cancel(),r.map((e=>e.sid))}}const Fi=new Ye("command.importAttachments");class Ui{constructor(e,t){this.externals=e,this.getTagsQuery=t}validateInput(e,t){if(!K(e.srcSpaceId))throw Error("invalid space id"+e.srcSpaceId);if(!K(e.destTagId))throw Error("invalid tag id"+e.destTagId);if(!Aa(e.attachmentIds,K))throw Error("invalid attachment ids"+JSON.stringify(e.attachmentIds));return e}async exec(e,t){const a=(await this.getTagsQuery(e.srcSpaceId)).reduce(((e,t)=>({fileAttachments:Object.fromEntries([...Object.entries(e.fileAttachments),...t.fileAttachments.map((e=>[e.id,e]))]),externalAttachments:Object.fromEntries([...Object.entries(e.externalAttachments),...t.externalAttachments.map((e=>[e.id,e]))])})),{fileAttachments:{},externalAttachments:{}}),n=Object.values(a.fileAttachments).filter((t=>e.attachmentIds.includes(t.id))),o=Object.values(a.externalAttachments).filter((t=>e.attachmentIds.includes(t.id))),s=e.attachmentIds.filter((e=>n.find((t=>t.id!==e))&&o.find((t=>t.id!==e))));return s.length>0&&Fi.warn(`couldn't find ${s.length} attachments. Continuing without them.\n         \n\t${[...s].join("\n\t")}`),await this.externals.issueCommand(new Ps(e.destTagId,{fileAttachments:n,externalAttachments:o,refreshIds:[e.srcSpaceId]},Ps.Operation.ADD)),{copied:e.attachmentIds.filter((e=>!s.includes(e))),missing:s}}}function Gi(e,t,a,n,o,s,i,r,d,c,l){const{mattertagData:h,pinsModule:u,meshData:p,floorData:m,pinViewData:g,annotationsViewData:w,tagsViewData:y,roomData:T,roomIdMap:v,settingsData:I}=l;e.addEnumToInterface({namespace:"Tag",name:"AttachmentType",values:f.AttachmentType});const E=function(e,t){const a=aa.create(t,new bs,new F(As));return e.addCollectionToInterface({namespace:"Tag",name:"attachments"},a),a}(e,new V(s)),C=function(e,t){const a=z.create(t,new F(Ms));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerAttachment",args:["srcs"],varArg:!0},a),a}(e,new V(s)),b=function(e,t){const a=z.create(t,new F(pi,e));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerSandbox",args:["html","options"],subRoutine:"tag.registerSandbox"},a),a}(e,new V(s,w,i)),A=function(e,t){const a=z.create(t,new F(Ss));return e.addAsyncCommandToInterface({namespace:"Tag",name:"attach",args:["tagId","attachmentIds"],varArg:!0,options:{replay:!0}},a),a}(e,new V(h,s)),S=function(e,t){const a=z.create(t,new F(Ds));return e.addAsyncCommandToInterface({namespace:"Tag",name:"detach",args:["tagId","attachmentIds"],varArg:!0,options:{replay:!0}},a),a}(e,new V(h,s)),D=function(e,t){const a=ee.create(t,new ci,new F(li));return e.addObservableToInterface({namespace:"Tag",name:"openTags"},a),a}(e,new V(g,w)),O=function(e,t,a){const n=aa.create(a,new Ks,new F(Ys,t));return e.addCollectionToInterface({namespace:"Tag",name:"data",elementFactory:"tag.data"},n),n}(e,t,new V(h,y,v,T,p)),M=function(e,t,a,n){const o=z.create(n,new F(ei,Object.assign(Object.assign({},t),a)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"open",args:["id","options"]},o),o}(e,a,n,new V(h,y)),R=function(e,t,a,n){const o=z.create(n,new F(ni,Object.assign(Object.assign({},t),a)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"dock",args:["id","options"]},o),o}(e,a,n,new V(h,y)),N=function(e,t,a,n){const o=z.create(n,new F(oi,Object.assign(Object.assign({},t),a)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"close",args:["id"]},o),o}(e,a,n,new V(h,y)),P=function(e,t,a,n){const o=z.create(n,new F(mi,t,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"allowAction",args:["id","allow"],options:{replay:!0}},o),o}(e,a,n,new V(g,y,w)),x=function(e,t,a,n){const o=z.create(n,new F(gi,t,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editBillboard",args:["id","properties"],options:{replay:!0}},o),o}(e,a,n,new V(h)),_=function(e,t,a,n,o){const s=z.create(o,new F(wi,t,a,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editColor",args:["id","color"],options:{replay:!0}},s),s}(e,t,a,n,new V(h)),L=function(e,t,a,n,o){const s=z.create(o,new F(fi,t,a,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editIcon",args:["id","iconId"],options:{replay:!0}},s),s}(e,n,t,c,new V(h,u,o,y)),k=function(e,t,a,n){const o=z.create(n,new F(Ti,t,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editOpacity",args:["id","opacity"],options:{replay:!0}},o),o}(e,a,n,new V(h,g)),U=function(e,t,a,n){const o=z.create(n,new F(yi,t,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editStem",args:["id","stemParams"],options:{replay:!0}},o),o}(e,a,n,new V(N,h,w)),G=function(e,t){const a=z.create(t,new F(Ii));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editPositions",args:["descriptors"],varArg:!0,options:{replay:!0}},a),a}(e,new V(N,h,w,v)),H=function(e,t){const a=z.create(t,new F(vi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editPosition",args:["id","options"],options:{replay:!0}},a),a}(e,new V(G)),B=function(e,t){const a=Ra.create(t,new F(Ci));return e.addCommand(Ei.key,a),a}(e,new V(h)),j=function(e,t){const a=Ra.create(t,new F(Ai));return e.addCommand(bi.key,a),a}(e,new V(h)),$=function(e,t,a,n){const o=z.create(n,new F(Si,t,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"remove",args:["ids"],varArg:!0,options:{replay:!0}},o),o}(e,a,n,new V(h)),W=function(e,t){const a=z.create(t,new F(Di));return e.addAsyncCommandToInterface({namespace:"Tag",name:"resetIcon",args:["id"],options:{replay:!0}},a),a}(e,new V(h,u)),q=function(e,t,a,n){const o=z.create(n,new F(Qs,t,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"add",args:["descriptors"],varArg:!0,options:{replay:!0}},o),o}(e,t,n,new V(h,A,L,k,s,o,y,m,T,p)),K=function(e,t,a,n,o,s){const i=z.create(o,new F(qs,t,a,n,s));return e.addAsyncCommandToInterface({namespace:"Tag",name:"importTags",args:["spaceSid","options"],varArg:!1,origins:X,options:{replay:!1}},i),i}(e,d,t,n,new V(h,m,T,p),r),Y=function(e,t,a,n){const o=z.create(n,new F(Vi,t,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"saveToLayer",args:["options"],varArg:!1,origins:X,options:{replay:!1}},o),o}(e,d,n,new V($,h)),Z=function(e,t,a){const n=z.create(V.none,new F(Ui,t,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"importAttachments",args:["destTagId","srcSpaceId","attachmentIds"],origins:X},n),n}(e,n,r),Q=new V(I),J=function(e,t){const a=z.create(t,new F(Ni,Ri));return e.addAsyncCommandToInterface({namespace:"Tag",name:"toggleDocking",args:["enable"]},a),a}(e,Q),te=function(e,t){const a=z.create(t,new F(Ni,Oi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"toggleNavControls",args:["enable"]},a),a}(e,Q),ae=function(e,t){const a=z.create(t,new F(Ni,Mi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"toggleSharing",args:["enable"]},a),a}(e,Q);return{attachments:E,registerAttachment:C,registerSandbox:b,attach:A,importTags:K,detach:S,data:O,openTags:D,add:q,open:M,dock:R,close:N,allowAction:P,editBillboard:x,editColor:_,editIcon:L,editOpacity:k,editStem:U,editPosition:H,editPositions:G,editKeywords:B,editEnabled:j,remove:$,resetIcon:W,toggleDocking:J,toggleNavControls:te,toggleSharing:ae,saveToLayer:Y,importAttachments:Z}}class Hi{constructor(e,t){this.tagsViewData=e,this.layersData=t}validateInput(e,t){return{}}async exec(e,t){const a={};for(const e of this.tagsViewData.getCollection()){const t=this.layersData.getLayer(e.layerId);a[e.id]=!!(null==t?void 0:t.toggled)||!e.layerId}return a}}class Bi{validateInput(e){if(!K(e.arg0))throw Error(`Stat.test: arg0 was specified but was not a valid string; got ${e.arg0}`);return e}async exec(e,t){return e.arg0}}class zi{create(){return Te((()=>{}),(()=>{}))}}class ji{constructor(){this._data={}}get data(){return this._data}isItemEqual(e,t){const a=this.data[t],n=e.data[t];return a.test===n.test}update(){}clear(){this._data={}}}var $i;!function(e){e.ENUM1="test.enum1",e.ENUM2="test.enum2"}($i||($i={}));class Wi{validateInput(e){return e}async exec(e,t){}}class qi{create(e){return Te((()=>{}),(()=>{}))}}class Ki{constructor(){this._data={testString:"hello"}}get data(){return this._data}equals(e){return this._data.testString===e.data.testString}copy(e){this._data.testString=e.data.testString}update(){}}function Yi(e,t){const{tagsViewData:a,layersData:n}=t,o=function(e,t){const a=aa.create(t,new zi,new F(ji));return e.addCollectionToInterface({namespace:"Test",name:"directCollection",sdkTypes:[Ve.DIRECT],origins:X},a),e.addCollectionToInterface({namespace:"Test",name:"postMessageCollection",sdkTypes:[Ve.POSTMESSAGE],origins:X},a),a}(e,V.none),s=function(e,t){const a=ee.create(t,new qi,new F(Ki));return e.addObservableToInterface({namespace:"Test",name:"directObservable",sdkTypes:[Ve.DIRECT],origins:X},a),e.addObservableToInterface({namespace:"Test",name:"postMessageObservable",sdkTypes:[Ve.POSTMESSAGE],origins:X},a),a}(e,V.none),i=function(e,t){const a=z.create(t,new F(Hi));return e.addAsyncCommandToInterface({namespace:"Test",name:"getTagVisibility",args:[],origins:X},a),a}(e,new V(a,n));return function(e){e.addEnumToInterface({namespace:"Test",name:"directEnum",values:$i,sdkTypes:[Ve.DIRECT],origins:X}),e.addEnumToInterface({namespace:"Test",name:"postMessageEnum",values:$i,sdkTypes:[Ve.POSTMESSAGE],origins:X})}(e),function(e,t){const a=z.create(t,new F(Bi));e.addCommandToInterface({namespace:"Test",name:"echo",args:["arg0"],origins:X},a),e.addAsyncCommandToInterface({namespace:"Test",name:"echoAsync",args:["arg0"],origins:X},a),e.addCommandToInterface({namespace:"Test.Sub",name:"echo",args:["arg0"],origins:X},a),e.addAsyncCommandToInterface({namespace:"Test.Sub",name:"echoAsync",args:["arg0"],origins:X},a),e.addCommandToInterface({namespace:"Test.Sub.Sub2",name:"echo",args:["arg0"],origins:X},a),e.addAsyncCommandToInterface({namespace:"Test.Sub.Sub2",name:"echoAsync",args:["arg0"],origins:X},a)}(e,V.none),function(e,t){const a=z.create(t,new F(Wi));e.addCommandToInterface({namespace:"Test",name:"directCommand",args:[],sdkTypes:[Ve.DIRECT],varArg:!1,origins:X},a),e.addCommandToInterface({namespace:"Test",name:"postMessageCommand",args:[],sdkTypes:[Ve.POSTMESSAGE],varArg:!1,origins:X},a)}(e,V.none),{collection:o,observable:s,visibleTagsCheckCommand:i}}const Xi=new Ye("sdk: tours");class Zi{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){return void 0!==e.index&&isNaN(e.index)&&(Xi.warn(e.index,"is not a valid number"),e.index=void 0),void 0!==e.steps&&isNaN(e.steps)&&(Xi.warn(e.steps,"is not a valid number"),e.steps=void 0),e}async exec(e){if(0===this.tourData.getSnapshotCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStart ignored, cannot change location at this time, another transition is active");try{this.tourControls.startTour(e.index,e.steps,e.loop)}catch(e){throw Error(`Error occurred while starting tour - ${e}`)}}}class Qi{constructor(e){this.tourControls=e}validateInput(e){return e}async exec(e){try{await this.tourControls.stopTour()}catch(e){throw Error(`Error occurred while stopping tour - ${e}`)}}}class Ji{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){const t=e.index;if(!wn(t))throw Error(t+" is not a valid tour snapshot index");if(t<0||t>this.tourData.getSnapshotCount())throw Error(`${t} is outside of the range of tour snapshots: [0 , ${this.tourData.getSnapshotCount()-1}]`);return{index:t}}async exec(e){if(0===this.tourData.getSnapshotCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");try{this.tourControls.tourGoTo(e.index)}catch(e){throw Error(`Error occurred while jumping to new tour location - ${e}`)}}}class er{constructor(e,t,a){this.forward=e,this.tourControls=t,this.tourData=a}validateInput(e){return e}async exec(e){if(0===this.tourData.getSnapshotCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");try{this.forward?this.tourControls.tourGoNext(!1):this.tourControls.tourGoPrevious(!1)}catch(e){throw Error(`Error while trying to travel to the next tour snapshot - ${e}`)}}}function tr(e,t,a,n){!function(e,t,a){t.addBinding(ar,(async()=>a.getDependencies().then((async([a,n])=>{const o=await Promise.all(n.getEnabledSnapshots().map((a=>async function(e,t,a){const n=!e.is360,o=a.viewmodeConverter.toSdk(e.metadata.cameraMode,n);if(!o||o===a.commandModeConverter.toSdk(t.CommandViewmode.TRANSITIONING))throw Error("Failed to convert snapshot, invalid viewmode");const s={sid:e.sid,thumbnailUrl:await e.thumbnailUrl.get(),imageUrl:await e.imageUrl.get(),is360:e.is360,name:e.name,mode:o,zoom:e.metadata.ssZoom,position:e.metadata.cameraPosition,rotation:a.conversionUtils.quaternionToRotation(e.metadata.cameraQuaternion)};return s}(a,e,t))));if(0===o.length)throw Error("No tour data found");return o}))))}(t,a,n),e.addCommandCreator({namespace:"Tour",name:"getData",args:[]},(()=>new ar));const o=n,s=z.create(o,new F(Zi)),i=z.create(o,new F(Qi)),r=z.create(o,new F(Ji)),d=z.create(o,new F(er,!0)),c=z.create(o,new F(er,!1));e.addAsyncCommandToInterface({namespace:"Tour",name:"start",args:["index"]},s),e.addCommandToInterface({namespace:"Tour",name:"stop",args:[]},i),e.addCommandToInterface({namespace:"Tour",name:"step",args:["index"]},r),e.addCommandToInterface({namespace:"Tour",name:"prev",args:[]},d),e.addCommandToInterface({namespace:"Tour",name:"next",args:[]},c)}class ar extends ie{}ar.id="GET_TOUR_DATA";class nr{create(e,t){return t.onChanged((()=>e.onChanged()))}}class or{constructor(){this._data={step:null,index:null}}get data(){return this._data}equals(e){return this._data.step===e.data.step&&this._data.index===e.data.index}copy(e){this._data.step=e.data.step,this._data.index=e.data.index}update(e){var t,a;this._data.step=e.isTourActive()&&null!==(t=e.getTourCurrentSnapshotSid())&&void 0!==t?t:null,this._data.index=e.isTourActive()&&null!==(a=e.getTourCurrentSnapshotIndex())&&void 0!==a?a:null}}class sr{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ir{constructor(e){this._data={current:y.PlayState.INACTIVE},this.tourStateConverter=e.tourStateConverter}get data(){return this._data}equals(e){return this._data.current===e.data.current}copy(e){this._data.current=e.data.current}update(e){this._data.current=this.tourStateConverter.toSdkTourState(e.getTourState())}}class rr{constructor(e){this.toSdkTourStateMap={[e.Inactive]:y.PlayState.INACTIVE,[e.Active]:y.PlayState.ACTIVE,[e.StopScheduled]:y.PlayState.STOP_SCHEDULED}}toSdkTourState(e){return this.toSdkTourStateMap[e]}}class dr{create(e,t){return t.onChanged((()=>e.onChanged()))}}class cr{constructor(){this._data={from:null,to:null}}get data(){return this._data}equals(e){return this._data.from===e.data.from&&this._data.to===e.data.to}copy(e){this._data.from=e.data.from,this._data.to=e.data.to}update(e){const t=this.hasEnded;if(this.hasEnded=e.tourEnded,!t&&this.hasEnded)return this._data.from=null,void(this._data.to=null);const a=-1===e.tourCurrentSnapshot?null:e.getTourSnapshotSid(e.tourCurrentSnapshot),n=-1===e.transition.toIndex?null:e.getTourSnapshotSid(e.transition.toIndex);null!==n&&(a===n?(this._data.from=null,this._data.to=null):(this._data.from=a,this._data.to=n))}}const lr={includeDefurnish:!0,includeDisabled:!1,includeInsights:!1};function hr(e,t){var a;const n={[le.BASE_LAYER]:T.LayerType.BASE,[le.VIEW_DATA_LAYER]:T.LayerType.VIEW_DATA,[le.USER_LAYER]:T.LayerType.USER,[le.COMMON_USER_LAYER]:T.LayerType.USER,[le.IN_MEMORY]:T.LayerType.IN_MEMORY,[le.COMMON_IN_MEMORY]:T.LayerType.IN_MEMORY};var o;return(t=t||{}).id=e.id,t.name=e.name,t.type=null!==(a=n[e.layerType])&&void 0!==a?a:T.LayerType.OTHER,t.toggled=e.toggled,t.common=(o=e.layerType)===le.COMMON_IN_MEMORY||o===le.COMMON_USER_LAYER||o===le.PROXY_LAYER,t}class ur{constructor(){this.layerSubscriptions=new Map}create(e,t){const a=t.onCurrentLayersChanged((()=>{this.subscribeToLayers(e,t),e.onChanged()}));return{renew:()=>{a.renew();for(const[,e]of this.layerSubscriptions)e.renew()},cancel:()=>{a.cancel();for(const[,e]of this.layerSubscriptions)e.cancel()}}}subscribeToLayers(e,t){for(const a of t.getOrderedModelViews(lr)){if(a.enabled)for(const n of t.filterUserFacingLayers(a.layers))this.layerSubscriptions.has(n)||this.layerSubscriptions.set(n,n.onChanged((()=>e.onChanged())));for(const a of t.inMemoryLayers)this.layerSubscriptions.has(a)||this.layerSubscriptions.set(a,a.onChanged((()=>e.onChanged())))}}}class pr{constructor(e){this.layersData=e,this._data={}}get data(){return this._data}isItemEqual(e,t){return this.isLayerEqual(this.data[t],e.data[t])}isLayerEqual(e,t){return e.id===t.id&&e.name===t.name&&e.toggled===t.toggled&&e.type===t.type}update(){const e=new Set;for(const t of this.layersData.getOrderedModelViews(lr))if(t.enabled)for(const a of this.layersData.filterUserFacingLayers(t.layers))this._data[a.id]=hr(a,this._data[a.id]),e.add(a.id);for(const t of this.layersData.inMemoryLayers)this._data[t.id]=hr(t,this._data[t.id]),e.add(t.id);for(const t in this.data)e.has(t)||delete this._data[t]}clear(){this._data={}}}function mr(e,t,a){const n={[ce.DEFURNISH]:T.ViewType.DEFURNISH,[ce.BASE]:T.ViewType.BASE,[ce.LAYERED_BASE]:T.ViewType.LAYERED_BASE,[ce.USER]:T.ViewType.USER};(a=a||{}).id=t.id,a.name=t.name,a.type=(t.viewType?n[t.viewType]:T.ViewType.OTHER)||T.ViewType.OTHER,a.active=e.currentViewId===t.id;const o=e.filterUserFacingLayers(t.layers).concat(e.commonInMemoryLayers.values()).map((e=>hr(e)));return a.layers=Et(a.layers||[],o),a}class gr{create(e,t){return new _e(t.onModelViewsChanged((()=>e.onChanged())),t.onCurrentLayersChanged((()=>e.onChanged())))}}class wr{constructor(e){this.layersData=e,this._data={}}get data(){return this._data}isItemEqual(e,t){return this.isViewEqual(this.data[t],e.data[t])}isViewEqual(e,t){return e.id===t.id&&e.name===t.name&&e.layers.length===t.layers.length&&e.active===t.active&&e.type===t.type&&e.layers.every(((e,a)=>{const n=t.layers[a];return e.id===n.id&&e.name===n.name&&e.toggled===n.toggled}))}update(){for(const e of this.layersData.getOrderedModelViews(lr))this._data[e.id]=mr(this.layersData,e,this._data[e.id]);for(const e in this.data)try{this.layersData.getView(e)||delete this._data[e]}catch(t){delete this._data[e]}}clear(){this._data={}}}class fr{constructor(e,t){this.commands=e,this.ownedLayers=t}validateInput(e,t){if(!K(e.name))throw Error("an empty name is not allowed");const a=e.options;if(a&&!wa(a))throw Error("invalid `options` object");const n=null==a?void 0:a.common;if(void 0!==n&&!fa(n))throw j("options.common","boolean",n);return{name:e.name,options:{common:!!n}}}async exec(e,t){const{options:{common:a}}=e,n=await this.commands.issueCommand(new Vs({name:e.name,toggled:!0,visible:!0,common:a}));return this.ownedLayers.add(t.client.applicationKey,n.id),{id:n.id,name:n.name,type:T.LayerType.IN_MEMORY,toggled:!0,common:a}}}class yr{constructor(e,t,a){this.commands=e,this.ownedLayers=t,this.layersData=a}validateInput(e,t){if(!K(e.layerId))throw Error(`${e.layerId} does not map to a valid layer`);const a=this.layersData.findLayer(e.layerId);if(!a)throw Error(`${e.layerId} does not map to a valid layer`);if(!this.ownedLayers.has(t.client.applicationKey,a.id))throw Error("Cannot delete a layer not associated with this SDK connection");return{layer:a}}async exec(e,t){for(const t of this.layersData.getOrderedModelViews()){const a=t.layers.findIndex((t=>t.id===e.layer.id));a>-1&&t.layers.remove(a)}await this.commands.issueCommand(new Fs(e.layer.id))}}var Tr;!function(e){e.ADD="view.add.layer",e.REMOVE="view.remove.layer"}(Tr||(Tr={}));const vr={key:"View.update",def:{namespace:"View",name:"update",args:["op","viewId","layerId"]}},Ir={key:"View.activate",def:{namespace:"View",name:"activate",args:["viewId","returnToStart"]}},Er={key:"Layer.toggle",def:{namespace:"View",name:"toggleLayer",args:["layerId","activate"]}},Cr=new Ye("View.updateLayer");class br{constructor(e,t){this.ownedLayers=e,this.layersData=t}validateInput(e,t){if(!gt(Tr,e.op))throw Error(`${e.op} is an unsupported operation`);if(!K(e.viewId))throw Error(`${e.viewId} is not a valid view id`);const a=this.layersData.getView(e.viewId);if(!a)throw Error(`${e.viewId} does not map to a valid View`);if(!K(e.layerId))throw Error(`${e.layerId} is not a valid layer id`);const n=this.layersData.inMemoryLayers.find((t=>t.id===e.layerId));if(!n)throw Error(`Only SDK created layers can be manipulated. ${e.layerId} does not map to an SDK-owned layer`);if(!this.ownedLayers.has(t.client.applicationKey,n.id))throw Error("Cannot manipulate layers not associated with this SDK connection");return{op:e.op,view:a,layer:n}}async exec(e,t){({[Tr.ADD]:(e,t)=>{this.layersData.commonInMemoryLayers.includes(t)?Cr.debug("Layer is common. No need to add."):e.layers.push(t)},[Tr.REMOVE]:(e,t)=>{const a=e.layers.findIndex((e=>e.id===t.id));if(a>=0){this.layersData.commonInMemoryLayers.includes(t)?Cr.debug("Layer is common. Cannot be removed from View."):e.layers.remove(a)}}})[e.op](e.view,e.layer)}}class Ar{constructor(e,t){this.commands=e,this.layersData=t}validateInput(e,t){if(!K(e.viewId)||!this.layersData.getView(e.viewId))throw Error(`${e.viewId} does not map to a valid View`);return{viewId:e.viewId,returnToStart:!!e.returnToStart}}async exec(e,t){e.returnToStart?await this.commands.issueCommand(new this.commands.SetActiveModelViewCommand(e.viewId)):(await this.commands.issueCommand(new this.commands.SetMoveCameraOnViewChange(!1)),await this.commands.issueCommand(new this.commands.SetActiveModelViewCommand(e.viewId)),await this.commands.issueCommand(new this.commands.SetMoveCameraOnViewChange(!0)))}}class Sr{create(e,t){return t.onPropertyChanged("currentViewId",(()=>e.onChanged()))}}class Dr{constructor(){this._data={id:"",name:"",active:!1,type:T.ViewType.OTHER,layers:[]}}get data(){return this._data}copy(e){this._data.id=e.data.id,this._data.name=e.data.name,this._data.active=e.data.active,this._data.type=e.data.type,Et(this._data.layers,e.data.layers)}equals(e){return this.data.id===e.data.id&&this.data.name===e.data.name&&this.data.active===e.data.active&&this.data.type===e.data.type&&this.data.layers.length===e.data.layers.length&&this._data.layers.every(((e,t)=>{const a=this.data.layers[t];return e.id===a.id&&e.name===a.name&&e.toggled===a.toggled}))}update(e){const t=e.getView(e.currentViewId);mr(e,t,this._data)}}class Or{static isValue(e){return new Or(new Mr(e))}static isType(e){return new Or(new Rr(e))}static isInstanceOf(e){return new Or(new Nr(e))}static is(e){return new Or(new Pr(e))}static isAny(){return new Or(new xr)}constructor(e){this.matcher=e}compare(e){return this.matcher.matches(e)}}class Mr{constructor(e){this.value=e}matches(e){return this.value===e}}class Rr{constructor(e){this.type=e}matches(e){return Object.getPrototypeOf(e).constructor===this.type}}class Nr{constructor(e){this.type=e}matches(e){if("object"==typeof e)return e instanceof this.type;const t=this.type;switch(typeof e){case"number":return t===Number;case"string":return t===String;case"boolean":return t===Boolean;case"function":return t===Function}return!1}}class Pr{constructor(e){this.predicate=e}matches(e){return this.predicate(e)}}class xr{constructor(){}matches(){return!0}}class _r{constructor(e,t){this.sdk=e,this.commandFilter=t,this._data=new Map}validateInput(){return{}}async exec(){return this.data}get data(){return this._data=new Map(this.sdk.registeredCommands(this.commandFilter)),this._data}}class Lr{constructor(e,t){this.commands=e,this.layersData=t}validateInput(e,t){if(!K(e.layerId))throw Error(`${e.layerId} does not map to a valid Layer`);const a=this.layersData.getLayer(e.layerId);if(!a)throw Error(`${e.layerId} does not map to a valid Layer`);return{layer:a,activate:void 0===e.activate?void 0:!!e.activate}}exec(e,t){return void 0!==e.activate?this.commands.issueCommand(new this.commands.ToggleLayerCommand(e.layer.id,e.activate)):this.commands.issueCommand(new this.commands.ToggleLayerCommand(e.layer.id,!e.layer.toggled))}}function kr(e,t,a){e.addEnumToInterface({namespace:"View",name:"ViewType",values:T.ViewType}),e.addEnumToInterface({namespace:"View",name:"LayerType",values:T.LayerType});const n=new hi,o=new V(t.layersData),s=function(e,t){const a=ee.create(t,new Sr,new F(Dr));return e.addObservableToInterface({namespace:"View",name:"current",objectFactory:"View"},a),a}(e,o),i=function(e,t){const a=aa.create(t,new gr,new F(wr));return e.addCollectionToInterface({namespace:"View",name:"views",elementFactory:"View"},a),a}(e,o),r=function(e,t){const a=aa.create(t,new ur,new F(pr));return e.addCollectionToInterface({namespace:"View",name:"layers",elementFactory:"Layer"},a),a}(e,o);!function(e){const t=Or.is((e=>{var t,a;return!(null===(t=e.options)||void 0===t?void 0:t.deprecated)&&!!(null===(a=e.options)||void 0===a?void 0:a.replay)})),a=Ra.create(V.none,new F(_r,e,t));e.addCommand("Layer.interface",a)}(e);const d=function(e,t,a){const n=Ra.create(t,new F(br,a));return e.addCommand(vr.key,n),n}(e,o,n),c=function(e,t,a){const n=Ra.create(a,new F(Ar,t));return e.addCommand(Ir.key,n),n}(e,a,o),l=function(e,t,a){const n=Ra.create(V.none,new F(fr,t,a));return e.addCommandToInterface({namespace:"View",name:"createLayer",args:["name","options"],subRoutine:"Layer"},n),n}(e,a,n),h=function(e,t,a,n){const o=Ra.create(a,new F(yr,t,n));return e.addCommandToInterface({namespace:"View",name:"deleteLayer",args:["layerId"],subRoutine:"view.deleteLayer"},o),o}(e,a,o,n),u=function(e,t,a){const n=Ra.create(a,new F(Lr,t));return e.addCommand(Er.key,n),n}(e,a,o);return{current:s,views:i,layers:r,updateView:d,activateView:c,createLayer:l,deleteLayer:h,toggleLayer:u}}class Vr{constructor(e,t,a,n){this.layersData=e,this.commonLayer=t,this.getCurrentLayer=a,this.selectLayer=n,this.layerToReset=null}async intercept(e,t){var a;this.layerToReset=null!==(a=this.getCurrentLayer())&&void 0!==a?a:null;const n=t.layerId&&this.layersData.findLayer(t.layerId)||this.commonLayer;await this.selectLayer(n)}async postExec(){this.layerToReset&&await this.selectLayer(this.layerToReset)}}class Fr{constructor(e){this.commands=e,this.issueCommand=this.commands.issueCommand}validateInput(e){return{}}async exec(e){await this.issueCommand(new this.commands.DisableInputCommand)}}class Ur{constructor(e){this.commands=e,this.issueCommand=this.commands.issueCommand}validateInput(e){return{}}async exec(e){await this.issueCommand(new this.commands.EnableInputCommand)}}class Gr{create(e,t,a){const n=()=>e.onChanged();return new _e(a.onChanged(n),t.onChanged(n))}}class Hr{constructor(e){this._data={from:null,to:null},this.viewmodeConverter=e.viewmodeConverter}get data(){return this._data}equals(e){return this._data.from===e._data.from&&this._data.to===e._data.to}copy(e){this._data={from:e._data.from,to:e._data.to}}update(e,t){const a=t.currentSweep&&t.isSweepAligned(t.currentSweep),n=t.transition.to&&t.isSweepAligned(t.transition.to);this._data=e.transition.active?{from:this.viewmodeConverter.toSdk(e.transition.from,!!a,e.transition.isFromPitchFactorOrtho),to:this.viewmodeConverter.toSdk(e.transition.to,!!n,e.transition.isToPitchFactorOrtho)}:{from:null,to:null}}}class Br{create(e,t){return t.onChanged((()=>e.onChanged()))}}class zr{constructor(e){this.pluginData=e,this._data={}}get data(){return this._data}isItemEqual(e,t){const a=this.data[t],n=e.data[t];return a.applicationKey===n.applicationKey&&a.id===n.id}update(){for(const e of this.pluginData.plugins.entries())this._data[e[0]]={applicationKey:e[1].applicationKey,id:e[1].id};for(const e in this.data)this.pluginData.plugins.has(e)||delete this._data[e]}clear(){this._data={}}}function*jr(e){const t=[...e];for(let e=t.length-1;e>=0;--e)yield t[e]}const $r=new Ye("sdk history");class Wr{constructor(e,t,a){this.sdk=e,this.layersData=t,this.commonLayer=a,this.claimedIds=new Set,this.allRegisteredCommands=new Map,this.commandObservers=new Set,this.interceptors=new Set,this.commandInterceptors=new hi}getOrClaimId(e,t){const a=t||this.generateUniqueId();return this.claimedIds.add(a),a}generateUniqueId(){let e="";do{e=Fa(12)}while(this.claimedIds.has(e));return e}connect(e,t){return this.sdk.connect(e,t)}connectPlugin(e,t){return this.sdk.connectPlugin(e,t)}getClientAuth(e){return this.sdk.getClientAuth(e)}addEnumToInterface(e){return this.sdk.addEnumToInterface(e)}addCommand(e,t,a){return this.sdk.addCommand(e,t,a)}addCommandToInterface(e,t){return this.sdk.addCommandToInterface(e,this.createCommandProxy(e,t))}addAsyncCommandToInterface(e,t){return this.sdk.addAsyncCommandToInterface(e,this.createCommandProxy(e,t))}addObservable(e,t){return this.sdk.addObservable(e,t)}addObservableToInterface(e,t){return this.sdk.addObservableToInterface(e,t)}addCollection(e,t){return this.sdk.addCollection(e,t)}addCollectionToInterface(e,t){return this.sdk.addCollectionToInterface(e,t)}broadcast(e,t,a){return this.sdk.broadcast(e,t,a)}sendPrivateMessage(e,t){return this.sdk.sendPrivateMessage(e,t)}addPrivateMessageHandler(e){return this.sdk.addPrivateMessageHandler(e)}addCommandCreator(e,t){return this.sdk.addCommandCreator(e,t)}interceptCommands(e,...t){if(0===t.length)this.interceptors.add(e);else for(const a of t)this.commandInterceptors.add(a,e)}async createCommandProxy(e,t){var a;const n=new Kr,o=new Set,s=new Set,i={visitor:n,beforeExec:async(a,s,i,r)=>{var d,c;if(o.clear(),n.reset(),null==a?void 0:a.layerId){const e=this.layersData.findLayer(a.layerId);if(!e)throw Error(a.layerId+"does not map to a valid layer");this.layersData.getCurrentView().layers.find((t=>t===e))||this.layersData.commonInMemoryLayers.find((t=>t===e))||(n.stopPropagation("not ready to execute"),s.validateInput(i,a))}for(const t of this.interceptors){if(!n.propagate)break;await(null===(d=t.intercept)||void 0===d?void 0:d.call(t,e,a)),o.add(t)}for(const s of this.commandInterceptors.getValuesAtKey(t)){if(!n.propagate)break;await(null===(c=s.intercept)||void 0===c?void 0:c.call(s,e,a)),o.add(s)}},afterExec:async(a,i,r,d)=>{var c,l,h,u,p;const m=async()=>{$r.debug("executing",`${e.namespace}.${e.name}`,r);try{await d.exec(r,a)}catch(e){$r.debugWarn(e)}};if((null===(c=e.options)||void 0===c?void 0:c.replay)&&!s.has(a.executionId))if(s.add(a.executionId),a.layerId){const e=this.layersData.findLayer(a.layerId);if(!e)throw Error(a.layerId+"does not map to a valid layer");e.onApply(m)}else null===(l=this.commonLayer)||void 0===l||l.onApply(m);if(n.propagate){for(const e of jr(this.commandInterceptors.getValuesAtKey(t)))await(null===(h=e.postExec)||void 0===h?void 0:h.call(e));for(const e of jr(this.interceptors))await(null===(u=e.postExec)||void 0===u?void 0:u.call(e))}else for(const e of jr(o))null===(p=e.postExec)||void 0===p||p.call(e)}},r=(e,t)=>this.getOrClaimId(e,t);if(this.allRegisteredCommands.set(`${e.namespace}.${e.name}`,e),this.triggerCommandObservers(e),null===(a=e.options)||void 0===a?void 0:a.deprecated){const a=`"${e.namespace}.${e.name}" is deprecated`+(Y(e.options.deprecated)?`; use ${e.options.deprecated}`:"");return new qr(i,r,await q(t,a))}return new qr(i,r,await t)}*registeredCommands(e){for(const t of this.allRegisteredCommands){const[,a]=t;e.compare(a)&&(yield t)}}onCommandsUpdated(e,t){const a=[e,t],n={renew:()=>this.commandObservers.add(a),cancel:()=>this.commandObservers.delete(a)};return n.renew(),n}triggerCommandObservers(e){for(const[t,a]of this.commandObservers)a.compare(e)&&t(e)}track(e,t,a){this.sdk.track(e,t,a)}}class qr{constructor(e,t,a){this.hooks=e,this.claimId=t,this.command=a,this.clientCache=new Map,this.contextCache=new Map}async exec(e,t){const a=this.getContextWithIdLookup(t);let n;return await this.hooks.beforeExec(a,this.command,e,this),this.hooks.visitor.propagate&&(n=await this.command.exec(e,a)),this.hooks.afterExec(a,this.command,e,this),n}validateInput(e,t){const a=this.getContextWithIdLookup(t);return this.command.validateInput(e,a)}getContextWithIdLookup(e){const t=e.client,a=this.clientCache.get(t)||Object.assign(Object.assign({},t),{getOrClaimId:e=>this.claimId(a,e)}),n=this.contextCache.get(e.executionId)||Object.assign(Object.assign({},e),{client:a});return this.clientCache.set(t,a),this.contextCache.set(e.executionId,n),n}}class Kr{constructor(){this.reason="",this.propagate=!0}stopPropagation(e){this.propagate=!1,this.reason=e}reset(){this.reason="",this.propagate=!0}}const Yr=new Ye("SDK interface");async function Xr(e,t,a,o,r,l,m,g){Ye.level=m.logLevel||G.INFO;const{THREE:f}=t,{api:T,appPhaseModule:I,locale:E,applicationData:C,cameraData:b,canvasData:S,deepLinks:k,floorData:U,floorViewData:H,labelData:B,layersData:j,mattertagData:$,tagsViewData:W,measurementModeData:K,meshData:Y,modelData:te,annotationsViewData:ae,raycasterData:ne,roomData:ie,roomBoundData:ce,roomBoundViewData:le,settingsData:he,sweepData:ue,sweepViewData:ge,tourData:we,viewmodeData:fe,attachmentsModule:ye,commonControlsModule:Te,floorCasterModule:ve,meshQuery:Ie,modelMeshModule:Ee,navigationModule:Ce,plugin:be,pluginConfigData:Ae,renderToTextureModule:Se,sceneModule:De,sensorModule:Oe,settingsModule:Me,tourControlsModule:Re,webglRendererModule:Ne,zoomControlModule:Pe,sweepTextureLoader:xe,cursorController:_e,pluginData:Fe,externalR3FModule:Ue,analytics:Ge}=r,[je,$e]=await Promise.all([j,he]);let We=$e.tryGetProperty(me,!1)||$e.tryGetProperty(pe,!1),qe=null;try{qe=await o.issueCommand(new Vs({name:"Temporary Layer",visible:!0,toggled:!0,common:!0}))}catch(e){We=!1,qe=null,Yr.info("Error setting up layers. Views and Layers features will be disabled. -- ",e)}const Ke=new Wr(e,je,qe),Xe=new N(f),Ze=new O(a.Viewmode),Qe=function(e){return async function(t,a,n){const o=n.rotationSpeed;let s=n.yAngle;if(n.clampYRotation)if(a.pose.isPitchFactorOrtho)s=0;else{const e=a.pose.phi()+n.yAngle-Lt;e>0&&(s=Math.max(n.yAngle-e,0))}let i=0;const r=Math.abs(n.xAngle),d=Math.abs(s),c=Math.max(r,d);if(c>=Math.PI){const e=c/Math.PI,t=Math.floor(e),a=r/e,n=d/e,o=r-a*t,s=d-n*t;i=Math.acos(Math.cos(a)*Math.cos(n))*t+Math.acos(Math.cos(o)*Math.cos(s))}else i=Math.acos(Math.cos(Math.abs(n.xAngle))*Math.cos(Math.abs(s)));if(i){const a=new e.Vector2(-n.xAngle,s);return a.multiplyScalar(o/i),t.startRotateTransition(i/o,a,!1)}}}(f),Je=new ds(a.SweepAlignmentType,a.SweepPlacementType),et=Object.assign(Object.assign({},o),{conversionUtils:new N(f),directionConverter:new D(a.Vectors),getPose:Jt(f,Ze),rotateCamera:Qe,rotateCameraBetweenOrientations:kt(f),orientCamera:Ut(f,a.Viewmode,Qe),stopCamera:async function(e){return e.stop()},appPhaseConverter:new Q(a.AppPhase),applicationConverter:new J(a.Application),mediaConverter:new Da(a.MattertagMediaType,a.TagDescriptionChunkType),chunkTypeConverter:new Oa(a.TagDescriptionChunkType),linkTypeConverter:new Ma(a.TagLinkType),sweepPlacementConverter:Je,viewmodeConverter:Ze,commandModeConverter:new M(a.CommandViewmode),cameraTransitionConverter:new R(a.CameraTransitionType),makeLabelData:ha(f,o.worldToScreenPosition),makeModelData:Rn(Xe,Je),sweepUtils:new P(a.SweepAlignmentType),tourStateConverter:new rr(a.TourState)}),tt=async function(e){const t=await e;return new x(t)}(ue),at=async function(e){const t=await e;return new _(t)}(U),nt=async function(e){const t=await e;return new L(t)}(ie),ot=async function(e,t,a,n){const[o,s,i]=await Promise.all([e,t,n]);return new Ha(o,s,a,i)}($,ye,t.oEmbed,void 0),st=new Map;!function(e,t){const a=z.create(new V,new F(Z,t));e.addAsyncCommandToInterface({namespace:"API",name:"getViews",args:["spaceSid"],varArg:!1,origins:X,options:{replay:!1}},a)}(Ke,et.getModelViewsQuery),function(e){e.addEnumToInterface({namespace:"App",name:"Phase",values:n.Phase}),e.addEnumToInterface({namespace:"App",name:"Event",values:n.Event}),e.addEnumToInterface({namespace:"App",name:"Feature",values:n.Feature}),e.addEnumToInterface({namespace:"App",name:"Application",values:n.Application})}(Ke),function(e,t,a){const o=[void 0],s=e=>(o[0]=a.appPhaseConverter.toSdkAppPhase(e.phase),o);a.subscribe(t.AppPhaseChangeMessage,(t=>{e.broadcast(n.Event.PHASE_CHANGE,s,t)}))}(Ke,a,et),function(e,t,a){a.getDependencies().then((([e])=>{t.addBinding(re,(async()=>{try{const a=e.getData();return{phase:t.appPhaseConverter.toSdkAppPhase(a.phase),application:t.applicationConverter.toSdkApplication(a.application)}}catch(e){throw Error("Error: Can't get application data at this time")}}))})),e.addCommandCreator({namespace:"App",name:"getState",args:[]},(()=>new re))}(Ke,et,new V(I)),function(e,t,a){t.addBinding(de,(async()=>{const e={[n.Phase.WAITING]:null,[n.Phase.LOADING]:null,[n.Phase.STARTING]:null,[n.Phase.PLAYING]:null,[n.Phase.ERROR]:null},[o]=await a.getDependencies();for(const a in o.phaseTimes){const n=Number(a);e[t.appPhaseConverter.toSdkAppPhase(n)]=o.phaseTimes[n]}return e})),e.addCommandCreator({namespace:"App",name:"getLoadTimes",args:[]},(()=>new de))}(Ke,et,new V(C)),function(e,t,a,n){const o=ee.create(n,new oe,new F(se,t,a));e.addObservableToInterface({namespace:"App",name:"state"},o)}(Ke,a,et,new V(C)),function(e,t){const a=ee.create(t,new Le,new F(ke));e.addObservableToInterface({namespace:"App",name:"features"},a)}(Ke,new V(he,ce,je)),function(e,t){const a=z.create(t,new F(Be));e.addCommandToInterface({namespace:"App.Locale",name:"getLanguageCode",args:[]},a)}(Ke,new V(E)),function(e,t){const a=z.create(t,new F(ze));e.addCommandToInterface({namespace:"App.Locale",name:"getT",args:[],sdkTypes:[Ve.DIRECT]},a)}(Ke,new V(E)),function(e,t,a){const n=z.create(a,new F(He,e,t));e.addCommandToInterface({namespace:"App",name:"track",args:["name","options"],sdkTypes:[Ve.DIRECT]},n)}(Ke,t.jsonSchemaValidator,new V(Ge));const it=ct(Ke,f,et,st,r,ot);!function(e,t,a){a.getDependencies().then((([e,a,n,o])=>{const s={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:h.Mode.TRANSITIONING};t.addBinding(lt,(async()=>t.getPose(s,e,a,n,o)))})),e.addCommandCreator({namespace:"Camera",name:"getPose",args:[]},(()=>new lt))}(Ke,et,new V(b,ue,fe,tt)),function(e,t,a,n){n.getDependencies().then((([e,n,o])=>{a.addBinding(ut,(async function(s={}){if(!o.isInside())throw Error("Camera.lookAtScreenCoords must be called from Inside mode");const i=a.screenPositionToNDC(s.x,s.y,n.width,n.height),r=new t.Vector3(0,0,-1).applyQuaternion(n.pose.rotation),d=a.ndcToWorldPosition(n,new t.Vector2(i.x,i.y),1).normalize(),c=r.clone().setY(0).angleTo(d.clone().setY(0)),l=Math.asin(d.y-r.y),h=c*Math.sign(i.x),u=l;return a.rotateCamera(e,n,{xAngle:h,yAngle:u,zAngle:0,rotationSpeed:ht,clampYRotation:!1})}))})),e.addCommandCreator({namespace:"Camera",name:"lookAtScreenCoords",args:["x","y"]},(function(e={}){if(e.x=e.x||0,e.y=e.y||0,isNaN(e.x)||isNaN(e.y))throw new Error(`${JSON.stringify(e)} does not contain valid screen coordinates`);return new ut({x:e.x,y:e.y})}))}(Ke,f,et,new V(Te,b,fe)),function(e,t,a){a.getDependencies().then((([a,n,o,i])=>{const r=[{position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:h.Mode.TRANSITIONING}],d=(()=>{let c=0,l=!1;const h=()=>(t.getPose(r[0],a,n,o,i),r);return()=>{const t=Date.now(),a=c+mt;if(t>a){l=!1,c=t;try{e.broadcast(s.Event.MOVE,h)}catch(e){pt.debug("failed to broadcast pose, one of the module dependencies are probably not loaded yet")}}else l||(setTimeout((()=>d()),a-t),l=!0)}})();a.onChanged(d),o.onChanged(d)})),e.addEnumToInterface({namespace:"Camera",name:"Event",values:s.Event})}(Ke,et,new V(b,ue,fe,tt)),function(e,t,a){a.getDependencies().then((([e])=>t.addBinding(wt,(async a=>{const n=a.direction;if(!gt(s.Direction,a.direction))throw new Error(`${a.direction} is not a valid direction`);await e.navigateInLocalDirection(t.directionConverter.toVector(n))})))),e.addEnumToInterface({namespace:"Camera",name:"Direction",values:s.Direction}),e.addCommandCreator({namespace:"Camera",name:"moveInDirection",args:["direction"]},(e=>new wt(e||{})))}(Ke,et,new V(Ce)),function(e,t,a,n){n.getDependencies().then((([e,n])=>{a.addBinding(yt,(async a=>{const o=n.pose.position,s=a.x-o.x,i=a.z-o.z,r=new t.Vector2(s,i),d=r.length();r.setLength(ft),await e.startTranslateTransition(d/ft,r,!1)}))})),e.addCommandCreator({namespace:"Camera",name:"pan",args:["position"]},(e=>{if((e=e||{}).position=e.position||{},e.position.x=e.position.x-0,e.position.z=e.position.z-0,isNaN(e.position.x)||isNaN(e.position.z))throw new Error(`${JSON.stringify(e)} does not contain a valid position to pan`);return new yt({x:e.position.x,z:e.position.z})}))}(Ke,f,et,new V(Te,b)),function(e,t,a,n){const o=ee.create(n,new Dt,new F(Ot,t,a.viewmodeConverter));e.addObservableToInterface({namespace:"Camera",name:"pose"},o)}(Ke,f,et,new V(b,ue,fe,tt)),Ht(Ke,f,et,new V(Te,b,fe)),function(e,t,a){a.getDependencies().then((([e])=>{t.addBinding(Bt,(async()=>await t.stopCamera(e)))})),e.addCommandCreator({namespace:"Camera",name:"stop",args:[]},(()=>new Bt))}(Ke,et,new V(Te)),function(e,t,a,n){const o=n,s=z.create(o,new F(qt,t,a)),i=z.create(o,new F(Kt,t,a)),r=z.create(o,new F(Yt,t,a));e.addCommandToInterface({namespace:"Camera",name:"zoomTo",args:["zoomPct"]},s),e.addCommandToInterface({namespace:"Camera",name:"zoomBy",args:["zoomDelta"]},i),e.addCommandToInterface({namespace:"Camera",name:"zoomReset",args:[]},r)}(Ke,a,et,new V(b,fe,Pe)),function(e,t,a){const n=ee.create(a,new Zt,new F(Qt,t));e.addObservableToInterface({namespace:"Camera",name:"zoom"},n)}(Ke,a,new V(b,fe)),function(e,t,a){const n=ee.create(a,new ea,new F(ta,t));e.addObservableToInterface({namespace:"Floor",name:"current"},n)}(Ke,a,new V(H,ue,b,we,at)),function(e,t,a,n){e.addEnumToInterface({namespace:"Floor",name:"Event",values:i.Event}),n.getDependencies().then((([n])=>{const o=[-1,-1];function s(e){if(n){const t=e.to?n.getFloor(e.to):null,a=e.from?n.getFloor(e.from):null;t&&(o[0]=t.index),a&&(o[1]=a.index)}return o}const r=[-1,""];function d(e){if(n){const t=e.floorId?n.getFloor(e.floorId):null;t&&(r[0]=t.index)}return r[1]=e.floorName,r}a.subscribe(t.StartMoveToFloorMessage,(t=>e.broadcast(i.Event.CHANGE_START,s,t))),a.subscribe(t.EndMoveToFloorMessage,(t=>e.broadcast(i.Event.CHANGE_END,d,t)))}))}(Ke,a,et,new V(U)),function(e,t){const a=aa.create(t,new na,new F(oa));e.addCollectionToInterface({namespace:"Floor",name:"data"},a)}(Ke,new V(U,at)),function(e,t,a){t.addBinding(sa,(async()=>{const[e]=await a.getDependencies();return ia(e)})),e.addCommandCreator({namespace:"Floor",name:"getData",args:[]},(()=>new sa))}(Ke,et,new V(H)),function(e,t,a,n){n.getDependencies().then((([e])=>a.addBinding(ra,(async n=>{if("number"!=typeof n.floorIndex||n.floorIndex<0)throw Error("floor index must be a non-negative number");try{const o="boolean"==typeof n.moveCamera&&!n.moveCamera,s=o?250:void 0;await a.issueCommand(new t.MoveToFloorIndexCommand(n.floorIndex,o,s));const i=e.currentFloor;return i?i.index:-1}catch(e){throw Error(`Could not move to floor at index ${n.floorIndex}`)}})))),e.addCommandCreator({namespace:"Floor",name:"moveTo",args:["floorIndex","moveCamera"]},(e=>new ra(e)))}(Ke,a,et,new V(H)),function(e,t,a,n){const o=z.create(n,new F(da,t,a));e.addCommandToInterface({namespace:"Floor",name:"showAll",args:["moveCamera"]},o)}(Ke,a,et,new V(H)),function(e,t){const a=z.create(t,new F(ca));e.addCommandToInterface({namespace:"Floor.Conversion",name:"createIdMap",args:["invert"]},a)}(Ke,new V(U)),function(e,t,a){t.addBinding(la,(async()=>t.makeLabelData(...await a.getDependencies()))),e.addCommandCreator({namespace:"Label",name:"getData",args:[]},(()=>new la))}(Ke,et,new V(b,U,B,at)),function(e,t,a,n){e.addEnumToInterface({namespace:"Label",name:"Event",values:d.Event}),n.getDependencies().then((([t,n,o,s,i])=>{const r=()=>[a.makeLabelData(t,o,n,i)];t.onChanged((a=>{t.pose.isPitchFactorOrtho&&e.broadcast(d.Event.POSITION_UPDATED,r,a)}))}))}(Ke,0,et,new V(b,B,U,fe,at)),function(e,t){const a=aa.create(t,new ua,new F(pa));e.addCollectionToInterface({namespace:"Label",name:"data"},a)}(Ke,new V(B,U,at)),function(e,t){const a=z.create(t,new F(ma));e.addAsyncCommandToInterface({namespace:"Link",name:"createLink",args:[]},a)}(Ke,new V(k)),function(e,t){const a=z.create(t,new F(ga));e.addAsyncCommandToInterface({namespace:"Link",name:"createDeepLink",args:[]},a)}(Ke,new V(k)),function(e,t){const a=z.create(t,new F(Ta,e)),n=z.create(t,new F(Ia,e)),o=z.create(t,new F(Ea,e)),s=z.create(t,new F(Ca,e));e.addEnumToInterface({namespace:"Link",name:"OpenPolicy",values:c.OpenPolicy}),e.addEnumToInterface({namespace:"Link",name:"DestinationPolicy",values:c.DestinationPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setModelLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},a),e.addAsyncCommandToInterface({namespace:"Link",name:"setNavigationLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},n),e.addAsyncCommandToInterface({namespace:"Link",name:"setSameOriginLinkPolicy",args:["policy"]},o),e.addAsyncCommandToInterface({namespace:"Link",name:"setExternalLinkPolicy",args:["openInNewWindow"]},s)}(Ke,new V(k,l)),function(e,t){const a=z.create(t,new F(Sa));e.addEnumToInterface({namespace:"Link",name:"CreationPolicy",values:c.CreationPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setShareLinkPolicy",args:["policy","baseHref","options"],subRoutine:"link.setsharepolicy"},a)}(Ke,new V(k));const rt=async function(){const e=m.sandboxPath;return(await fetch(e)).text()}(),dt=Gi(Ke,f,a,et,st,ot,rt,et.getTagsQuery,qe,et.isMpFontId,Object.assign(Object.assign({},r),{roomIdMap:nt})),Tt=nn(Ke,a,Object.assign(Object.assign({},et),{getIframeSrcDoc:rt}),it,dt,[$,W,ae,U,at,ot]);!function(e,t,a){t.addBinding(sn,(async()=>{const[e,t]=await a.getDependencies();return rn(e,t)})),e.addCommandCreator({namespace:"Measurements",name:"getData",args:[]},(()=>new sn))}(Ke,et,new V(K,U)),function(e,t,a){const n=aa.create(a,new dn(t.MeasuringPhase),new F(cn));e.addCollectionToInterface({namespace:"Measurements",name:"data"},n)}(Ke,a,new V(K)),function(e,t){const a=ee.create(t,new ln,new F(hn));e.addObservableToInterface({namespace:"Measurements",name:"mode"},a)}(Ke,new V(K)),function(e,t,a){a.addBinding(un,(async e=>a.issueCommand(new t.ToggleToolCommand(t.Tools.MEASUREMENTS,e.active)))),e.addCommandCreator({namespace:"Measurements",name:"toggleMode",args:["active"]},(e=>new un(e.active)))}(Ke,a,et),function(e,t,a,n){e.addEnumToInterface({namespace:"Mode",name:"Event",values:h.Event}),n.getDependencies().then((([n,o,s])=>{const i=[void 0,void 0],r=e=>{const t=o.currentMode,s=a.sweepUtils.isSweepAligned(n,e.fromSweep),r=a.sweepUtils.isSweepAligned(n,e.toSweep);return i[0]=a.viewmodeConverter.toSdk(t,s),i[1]=a.viewmodeConverter.toSdk(t,r),i};a.subscribe(t.EndMoveToSweepMessage,(t=>{a.sweepUtils.isSweepAligned(n,t.fromSweep)!==a.sweepUtils.isSweepAligned(n,t.toSweep)&&e.broadcast(h.Event.CHANGE_END,r,t)}));const d=[void 0,void 0],c=e=>{const t=a.sweepUtils.isCurrentSweepAligned(n);return d[0]=a.viewmodeConverter.toSdk(e.fromMode,t,s.pose.isPitchFactorOrtho),d[1]=a.viewmodeConverter.toSdk(e.toMode,t,s.pose.isPitchFactorOrtho),d};a.subscribe(t.BeginSwitchViewmodeMessage,(t=>e.broadcast(h.Event.CHANGE_START,c,t)));const l=[void 0,void 0],u=e=>{const t=a.sweepUtils.isCurrentSweepAligned(n);return l[0]=a.viewmodeConverter.toSdk(e.fromMode,t,s.pose.isPitchFactorOrtho),l[1]=a.viewmodeConverter.toSdk(e.toMode,t,s.pose.isPitchFactorOrtho),l};a.subscribe(t.EndSwitchViewmodeMessage,(t=>e.broadcast(h.Event.CHANGE_END,u,t)))}))}(Ke,a,et,new V(ue,fe,b)),function(e,t,a,n){n.addBinding(In,(async e=>{try{e.options=e.options||{};let t=a.CameraTransitionType.Interpolate;const o=e.options.transition;return void 0===o||isNaN(o)||(t=o),await n.issueCommand(new a.ChangeViewmodeCommand(e.mode,t,{position:e.options.position,rotation:e.options.rotation,zoom:e.options.zoom})),e.mode}catch(t){const a=t instanceof gn?`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`:`Mode.moveTo -> Could not move to ${e.mode}`;if(vn.info(t,a),t instanceof gn)throw Error(`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`);throw Error(`Mode.moveTo -> Could not move to ${e.mode}`)}}));const o=new En(t,n.commandModeConverter,n.conversionUtils,n.cameraTransitionConverter);e.addCommandCreator({namespace:"Mode",name:"moveTo",args:["mode","options"]},(e=>new In(o.validateMoveToModeInput(e)))),e.addEnumToInterface({namespace:"Mode",name:"Mode",values:h.Mode}),e.addEnumToInterface({namespace:"Mode",name:"TransitionType",values:A})}(Ke,f,a,et,new V),function(e,t,a,n){const o=ee.create(n,new Cn,new F(bn,t,a));e.addObservableToInterface({namespace:"Mode",name:"current"},o)}(Ke,a,et,new V(fe,ue,b)),function(e,t,a){const n=ee.create(a,new Gr,new F(Hr,t));e.addObservableToInterface({namespace:"Mode",name:"transition"},n)}(Ke,et,new V(fe,ue)),Sn(Ke,et,new V(te,ue,U,tt)),On(Ke,a,et,new V(te,he)),function(e,t,a,n){e.addEnumToInterface({namespace:"Model",name:"Event",values:u.Event});const o={sid:"",sweeps:[],modelSupportsVr:!1},s=[o];n.getDependencies().then((n=>{a.subscribe(t.ModelDataLoadedMessage,(async t=>{const[i,r,d]=n;await a.makeModelData(t.sid,t.vrSupported,i.getSweepList(),r,d,o),e.broadcast(u.Event.MODEL_LOADED,(()=>s))}))}))}(Ke,a,et,new V(ue,U,tt)),function(e,t){const a=z.create(t,new F(Pn));e.addCommand(Nn,a)}(Ke,new V(a.MpSdkAuthentication)),function(e,t){const a=aa.create(t,new Br,new F(zr));e.addCollectionToInterface({namespace:"Plugin",name:"data",sdkTypes:[Ve.POSTMESSAGE],origins:X},a)}(Ke,new V(Fe)),function(e,t){const a=z.create(t,new F(Ln));e.addAsyncCommandToInterface({namespace:"Plugin",name:"load",args:["key","path","config","metadata"],varArg:!1,sdkTypes:[Ve.POSTMESSAGE],origins:X},a)}(Ke,new V(be)),function(e,t){const a=z.create(t,new F(kn));e.addAsyncCommandToInterface({namespace:"Plugin",name:"unload",args:["key"],varArg:!1,sdkTypes:[Ve.POSTMESSAGE],origins:X},a)}(Ke,new V(be)),function(e,t,a,n){const o=ee.create(n,new Vn,new F(Fn,t,a));e.addEnumToInterface({namespace:"Pointer",name:"Colliders",values:p.Colliders}),e.addObservableToInterface({namespace:"Pointer",name:"intersection"},o)}(Ke,f,a,new V(ne,U,ie,Y,Ie)),function(e,t,a){const n=z.create(a,new F(Un)),o=z.create(a,new F(Gn));e.addCommandToInterface({namespace:"Pointer",name:"registerTexture",args:["textureId","textureSrc"],varArg:!1},t),e.addCommandToInterface({namespace:"Pointer",name:"editTexture",args:["textureId"],varArg:!1},n),e.addCommandToInterface({namespace:"Pointer",name:"resetTexture",args:[],varArg:!1},o)}(Ke,it.registerTexture,new V(_e,st)),function(e,t){const a=z.create(t,new F(Hn));e.addCommandToInterface({namespace:"Pointer",name:"setFadeProps",args:["props"],varArg:!1},a)}(Ke,new V(_e)),function(e,t){const a=z.create(t,new F(Bn));e.addCommandToInterface({namespace:"Pointer",name:"setVisible",args:["visible"],varArg:!1},a)}(Ke,new V(_e)),function(e,t,a,n,o){const s=new Xn(new t.PerspectiveCamera,n.encodeRenderTarget),i=new F(to,s,a,n),r=z.create(o,i),d=z.create(o,i);e.addCommandToInterface({namespace:"Renderer",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},r),e.addCommandToInterface({namespace:"Camera",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},q(d,"`Camera.takeScreenshot` is deprecated; use `Renderer.takeScreenshot` instead"))}(Ke,f,a,et,new V(S,Ne,Se)),function(e,t,a,n,o){const s=z.create(o,new F(ao,t,a,n));e.addCommandToInterface({namespace:"Renderer",name:"takeEquirectangular",args:[]},s)}(Ke,f,a,et,new V(Ne,Se,fe,ue,xe)),function(e,t,a,n){const o=z.create(n,new F(no,t,a));e.addCommandToInterface({namespace:"Renderer",name:"getScreenPosition",args:["worldPosition"]},o)}(Ke,a,et,new V(Ne)),function(e,t,a,n){const o=z.create(n,new F(oo,t,a));e.addCommandToInterface({namespace:"Renderer",name:"getWorldPositionData",args:["screenPosition","height","includeHiddenFloors"]},o)}(Ke,a,et,new V(U,ve)),function(e,t){const a=z.create(t,new F(zn));e.addAsyncCommandToInterface({namespace:"R3F",name:"registerR3F",args:["callbacks"],sdkTypes:[Ve.DIRECT]},a)}(Ke,new V(Ue)),function(e,t,a,n,o){e.addAsyncCommandToInterface({namespace:"R3F",name:"focus",args:["target","options"],sdkTypes:[Ve.DIRECT]},z.create(o,new F(Wn,t,a,n)))}(Ke,f,a,et,new V(Ce,fe)),function(e,t){const a=z.create(t,new F(Yn));e.addAsyncCommandToInterface({namespace:"R3F",name:"controlsToggle",args:["enabled"],sdkTypes:[Ve.DIRECT]},a)}(Ke,new V(Te)),function(e,t){const a=z.create(t,new F($n));e.addAsyncCommandToInterface({namespace:"R3F",name:"navigationToggle",args:["enabled"],sdkTypes:[Ve.DIRECT]},a)}(Ke,new V(Ce)),function(){const e=V.getBuilder().addDependencies(ie,U,b,ue,fe,Y,nt,at).addOptionals(ce).build();!function(e,t){const a=ee.create(t,new io,new F(ro));e.addObservableToInterface({namespace:"Room",name:"current",objectFactory:"current.room"},a)}(Ke,e);const t=V.getBuilder().addDependencies(ie,U,nt,at,Y).addOptionals(ce).build();!function(e,t){const a=aa.create(t,new co,new F(lo));e.addCollectionToInterface({namespace:"Room",name:"data",elementFactory:"collection.room"},a)}(Ke,t),function(e,t){const a=z.create(t,new F(ho));e.addCommandToInterface({namespace:"Room.Conversion",name:"createIdMap",args:["invert"]},a)}(Ke,new V(ie,U)),function(e,t){const a=z.create(t,new F(uo));e.addCommandToInterface({namespace:"Room.Bounds",name:"forceRoomDimensionVisibility",args:["visible"]},a)}(Ke,new V(le))}(),function(e,t,a,n,o,s,i){(function(e){e.addEnumToInterface({namespace:"Scene",name:"InteractionType",values:v.InteractionType,sdkTypes:[Ve.DIRECT]}),e.addEnumToInterface({namespace:"Scene",name:"Component",values:v.Component,sdkTypes:[Ve.DIRECT]}),e.addEnumToInterface({namespace:"Scene",name:"PathType",values:eo,sdkTypes:[Ve.DIRECT]})})(e),function(e,t){const a=z.create(t,new F(po));e.addAsyncCommandToInterface({namespace:"Scene",name:"register",args:["name","factory"],sdkTypes:[Ve.DIRECT]},a)}(e,new V(n)),function(e,t){const a=z.create(t,new F(mo));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNode",args:[],varArg:!1,sdkTypes:[Ve.DIRECT]},a)}(e,new V(n)),function(e,t,a){t.addBinding(go,(async e=>{const[t]=await a.getDependencies();return t.sceneTags().getObjects(e.tags)})),e.addCommandCreator({namespace:"Scene",name:"query",args:["tags"],sdkTypes:[Ve.DIRECT]},(e=>new go(e)))}(e,t,new V(n,o)),function(e,t,a,n){n.getDependencies().then((([e])=>{a.addBinding(wo,(async a=>{a.callback(e.threeRenderer,t,e.getScene().effectComposer)}))})),e.addCommandCreator({namespace:"Scene",name:"configure",args:["callback"],sdkTypes:[Ve.DIRECT]},(e=>new wo(e)))}(e,a,t,new V(s)),function(e,t,a){a.getDependencies().then((([e])=>{t.addBinding(fo,(async t=>e.getImageBitmap(t.path,t.width,t.height,t.options)))})),e.addCommandCreator({namespace:"Scene",name:"getImage",args:["path","width","height","options"],sdkTypes:[Ve.DIRECT]},(e=>new fo(e)))}(e,t,new V(i)),function(e,t){const a=z.create(t,new F(yo));e.addAsyncCommandToInterface({namespace:"Scene",name:"deserialize",args:["text"],varArg:!1,sdkTypes:[Ve.DIRECT]},a)}(e,new V(n)),function(e,t){const a=z.create(t,new F(vo));e.addCommandToInterface({namespace:"Scene",name:"serialize",args:["objects"],varArg:!1,sdkTypes:[Ve.DIRECT]},a)}(e,new V(n)),function(e,t){const a=z.create(t,new F(Io));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNodes",args:["count","userContext"],varArg:!1,sdkTypes:[Ve.DIRECT]},a)}(e,new V(n)),function(e,t){const a=z.create(t,new F(Eo));e.addAsyncCommandToInterface({namespace:"Scene",name:"registerComponents",args:["components"],sdkTypes:[Ve.DIRECT]},a)}(e,new V(n)),function(e,t){const a=z.create(t,new F(Co));e.addAsyncCommandToInterface({namespace:"Scene",name:"createObjects",args:["count"],varArg:!1,sdkTypes:[Ve.DIRECT]},a)}(e,new V(n)),function(e,t,a){const n=z.create(a,new F(bo));e.addCommandToInterface({namespace:"Scene",name:"unregisterComponents",args:["components"],varArg:!1,sdkTypes:[Ve.DIRECT]},n)}(e,0,new V(n))}(Ke,et,f,De,Ee,Ne,T),es(f,a.SourceType,a.sensorVolumes)(Ke,new V(Oe)),function(e,t,a,n){a.addBinding(t.SettingGetCommand,(async e=>{const[t]=await n.getDependencies();return t.tryGetProperty(e.key,t.settingsData.getOverrideParam(e.key,void 0))})),e.addCommandCreator({namespace:"Settings",name:"get",args:["key"]},(e=>new t.SettingGetCommand(e.key)))}(Ke,a,et,new V(Me)),function(e,t,a,n){a.addBinding(t.SettingUpdateCommand,(async e=>{if(!e.key||"string"!=typeof e.key)throw Error("Settings: invalid key");const[t]=await n.getDependencies();return t.updateSetting(e.key,e.value),t.tryGetProperty(e.key,void 0)})),e.addCommandCreator({namespace:"Settings",name:"update",args:["key","value"]},(e=>new t.SettingUpdateCommand(e.key,e.value)))}(Ke,a,et,new V(Me)),function(e,t,a){a.getDependencies().then((([a])=>{new as(t.waitForUpdate,a).calcAndBroadcast(e)})),e.addEnumToInterface({namespace:"Stat",name:"Event",values:ts})}(Ke,et,new V(he)),function(e,t){const a=z.create(t,new F(os));e.addAsyncCommandToInterface({namespace:"XStorage",name:"setItem",args:["key","data"],origins:X},a)}(Ke,new V(te)),function(e,t){const a=z.create(t,new F(ss));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getItem",args:["key"],origins:X},a)}(Ke,new V(te)),function(e,t){const a=z.create(t,new F(is));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getAllItems",args:["modelId"],origins:X},a)}(Ke,new V(te)),function(e,t){const a=z.create(t,new F(rs));e.addAsyncCommandToInterface({namespace:"XStorage",name:"removeItem",args:["key"],origins:X},a)}(Ke,new V(te)),function(e){e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:A}),e.addEnumToInterface({namespace:"Sweep",name:"Alignment",values:w.Alignment}),e.addEnumToInterface({namespace:"Sweep",name:"Placement",values:w.Placement})}(Ke),function(e,t,a,n){const o=ee.create(n,new ls,new F(hs,t,a));e.addObservableToInterface({namespace:"Sweep",name:"current"},o)}(Ke,a,et,new V(ue,fe,U,tt,at)),function(e,t,a,n){e.addEnumToInterface({namespace:"Sweep",name:"Event",values:w.Event});const o=["",""],s=()=>o;a.subscribe(t.BeginMoveToSweepMessage,(async t=>{const a=await n;t.fromSweep&&t.fromSweep!==t.toSweep&&(o[0]=t.fromSweep?a.getIdFromCwfId(t.fromSweep):t.fromSweep,o[1]=a.getIdFromCwfId(t.toSweep),e.broadcast(w.Event.EXIT,s,t))})),a.subscribe(t.BeginSwitchViewmodeMessage,(a=>{a.fromMode===t.Viewmode.Panorama&&a.toMode!==t.Viewmode.Panorama&&(o[0]=i[1],o[1]=void 0,e.broadcast(w.Event.EXIT,s))}));const i=["",""],r=()=>i;a.subscribe(t.EndMoveToSweepMessage,(async t=>{const a=await n;i[0]=t.fromSweep?a.getIdFromCwfId(t.fromSweep):t.fromSweep,i[1]=a.getIdFromCwfId(t.toSweep),e.broadcast(w.Event.ENTER,r)}))}(Ke,a,et,tt),function(e,t,a,n){const o=z.create(n,new F(us,t,a));e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:A}),e.addCommandToInterface({namespace:"Sweep",name:"moveTo",args:["sweep","options"]},o)}(Ke,a,et,new V(ue,tt,Ce)),function(e,t){const a=z.create(t,new F(ws));e.addCommandToInterface({namespace:"Sweep.Conversion",name:"createIdMap",args:["invert"]},a);const n=z.create(t,new F(fs));e.addCommandToInterface({namespace:"Sweep.Conversion",name:"getLabelFromId",args:["id"]},n)}(Ke,new V(ue)),function(e,t,a){const n=aa.create(a,new ps,new F(ms,t.conversionUtils,t.sweepPlacementConverter));e.addCollectionToInterface({namespace:"Sweep",name:"data"},n)}(Ke,et,new V(ue,U,tt,at)),function(e,t){const a=z.create(t,new F(ys)),n=z.create(t,new F(Ts));e.addCommandToInterface({namespace:"Sweep",name:"enable",args:["sweepIds"],varArg:!0},a),e.addCommandToInterface({namespace:"Sweep",name:"disable",args:["sweepIds"],varArg:!0},n)}(Ke,new V(ue,ge,tt)),function(e,t,a,n){const o=z.create(n,new F(Es,t,a));e.addCommandToInterface({namespace:"Sweep",name:"addNeighbors",args:["sweepId","toAdd"]},o);const s=z.create(n,new F(Cs,t,a));e.addCommandToInterface({namespace:"Sweep",name:"removeNeighbors",args:["sweepId","toRemove"]},s)}(Ke,a,et,new V(ue)),Yi(Ke,r),function(e){e.addEnumToInterface({namespace:"Tour",name:"PlayState",values:y.PlayState})}(Ke),function(e,t,a){e.addEnumToInterface({namespace:"Tour",name:"Event",values:y.Event}),a.subscribe(t.TourStartedMessage,(()=>e.broadcast(y.Event.STARTED))),a.subscribe(t.TourStoppedMessage,(()=>e.broadcast(y.Event.STOPPED))),a.subscribe(t.TourEndedMessage,(()=>e.broadcast(y.Event.ENDED)));const n=[-1],o=e=>(n[0]=e.index,n);a.subscribe(t.TourSteppedMessage,(t=>e.broadcast(y.Event.STEPPED,o,t)))}(Ke,a,et),tr(Ke,a,et,new V(Re,we)),function(e,t){const a=ee.create(t,new nr,new F(or));e.addObservableToInterface({namespace:"Tour",name:"currentStep"},a)}(Ke,new V(we)),function(e,t,a){const n=ee.create(a,new sr,new F(ir,t));e.addObservableToInterface({namespace:"Tour",name:"state"},n)}(Ke,et,new V(we)),function(e,t){const a=ee.create(t,new dr,new F(cr));e.addObservableToInterface({namespace:"Tour",name:"transition"},a)}(Ke,new V(we)),function(e,t,a){const n=z.create(a,new F(Fr,t)),o=z.create(a,new F(Ur,t));e.addCommandToInterface({namespace:"App.Input",name:"disable",args:[]},n),e.addCommandToInterface({namespace:"App.Input",name:"enable",args:[]},o)}(Ke,{issueCommand:et.issueCommand,DisableInputCommand:a.DisableInputCommand,EnableInputCommand:a.EnableInputCommand},new V),We&&qe&&(kr(Ke,r,{issueCommand:et.issueCommand,SetActiveModelViewCommand:a.SetActiveModelViewCommand,ToggleLayerCommand:a.ToggleLayerCommand,SetMoveCameraOnViewChange:a.SetMoveCameraOnViewChange}),We&&Ke.interceptCommands(new Vr(je,qe,(()=>je.getActiveLayer()),(e=>o.issueCommand(new a.SelectLayerCommand(e.id,!0)))),dt.add,Tt.add))}Yr.info("Showcase SDK interface version","25.3.4_webgl-403-g7d2911f42d");var Zr=S.m;export{Zr as setup};